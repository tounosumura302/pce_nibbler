#[1]   nibbler.asm
    5           0001      MAIN_BANK       equ 1
    6           0004      BGPATTERN_BANK  equ 4
    7           0005      SPRPATTERN_BANK equ 5
    8           0006      WAVEMAP_BANK    equ 6
    9                     
#[2]   pce.asm
   10                             .include "pce.asm"        
    1                     ;       ÈÆ´ÔºÅÈÆ´ÔºÅÈÆ´ÔºÅ(Fire Shark) ÂãùÊâãÁßªÊ§çÁâà for PCEngine
    2                     ;       2020/12/09
    3                     ;
    4                     ;       common definitions
    5                     ;
    6                     ;       VDC
    7                     ;
    8           0000      VdcPort         .equ    $0000
    9           0000      VdcReg          .equ    VdcPort
   10           0000      VdcStatus       .equ    VdcPort
   11           0002      VdcData         .equ    VdcPort+2
   12           0002      VdcDataL        .equ    VdcData
   13           0003      VdcDataH        .equ    VdcData+1
   14                     ;
   15                     ;       VCE
   16                     ;
   17           0400      VcePort         .equ    $0400
   18           0400      VceCtrl         .equ    VcePort
   19           0402      VceIndex        .equ    VcePort+2
   20           0402      VceIndexL       .equ    VceIndex
   21           0403      VceIndexH       .equ    VceIndex+1
   22           0404      VceData         .equ    VcePort+4
   23           0404      VceDataL        .equ    VceData
   24           0405      VceDataH        .equ    VceData+1
   25                     ;
   26                     ;       PSG
   27                     ;
   28           0800      PsgPort         .equ    $0800
   29           0800      PsgChannel      .equ    PsgPort
   30           0801      PsgMainVol      .equ    PsgPort+1
   31           0802      PsgFreqL        .equ    PsgPort+2
   32           0803      PsgFreqH        .equ    PsgPort+3
   33           0804      PsgCtrl         .equ    PsgPort+4
   34           0805      PsgChVol        .equ    PsgPort+5
   35           0806      PsgWave         .equ    PsgPort+6
   36           0807      PsgNoise        .equ    PsgPort+7
   37           0808      PsgLfoFreq      .equ    PsgPort+8
   38           0809      PsgLfoCtrl      .equ    PsgPort+9
   39                     ;
   40                     ;       timer
   41                     ;
   42           0C00      TimerPort       .equ    $0c00
   43           0C00      TimerCounter    .equ    TimerPort
   44           0C01      TimerCtrl       .equ    TimerPort+1
   45                     ;
   46                     ;       interrupt
   47                     ;
   48           1402      IntCtrlPort     .equ    $1402
   49           1402      IntCtrlMask     .equ    IntCtrlPort
   50           1403      IntCtrlState    .equ    IntCtrlPort+1
   51                     ;
   52                     ;       control pad
   53                     ;
   54           1000      PadPort         .equ    $1000
   55                     
#[1]   nibbler.asm
#[2]   task.inc
   11                             .include "task.inc"
    1                     tkChangeTask_   .macro
    2                     ;    .if \1=0
    3                     ;    stz <ztkChgTask
    4                     ;    stz <ztkChgTask+1
    5                     ;    .else
    6                         lda #LOW(\1)
    7                         sta <ztkChgTask
    8                         lda #HIGH(\1)
    9                         sta <ztkChgTask+1
   10                     ;    .endif
   11                         .endm
#[1]   nibbler.asm
   12                             
#[2]   bank0.asm
   13                             .include "bank0.asm"
    1                     ;       ÈÆ´ÔºÅÈÆ´ÔºÅÈÆ´ÔºÅ(Fire Shark) ÂãùÊâãÁßªÊ§çÁâà for PCEngine
    2                     ;       2020/12/09
    3                     ;
    4                     ;       „Éê„É≥„ÇØÔºê„Å´ÈÖçÁΩÆ„Åô„Åπ„Åç„Ç≥„Éº„Éâ
    5                     ;       Ââ≤„ÇäËæº„Åø„Éô„ÇØ„Çø„ÉªÂâ≤„ÇäËæº„Åø„Éè„É≥„Éâ„É©ÔºàRESETÔºâ
    6                     ;       „Ç¢„Éâ„É¨„Çπ„ÅØ $e000-$ffff
    7                     
    8           0000      BANK0_BANK .equ 0
    9                     
   10           E000              .code
   11           0000              .bank BANK0_BANK
   12                     ;
   13                     ;       interrupt vectors
   14                     ;
   15           FFF6              .org $fff6
   16  00:FFF6  00 E0             .dw     interrupt_dummy         ;$fff6 IRQ2/BRK
   17  00:FFF8  01 E0             .dw     interrupt_dummy2         ;$fff8 IRQ1
   18  00:FFFA  02 E0             .dw     interrupt_dummy3         ;$fffa timer
   19  00:FFFC  03 E0             .dw     interrupt_dummy4         ;$fffc NMI
   20  00:FFFE  04 E0             .dw     interrupt_reset         ;$fffe RESET
   21                     ;
   22                     ;       interrupt handlers
   23                     ;
   24           E000              .org $e000
   25                     ;
   26                     ;       dummy handler
   27                     ;
   28  00:E000            interrupt_dummy:
   29  00:E000  40                rti
   30                     
   31  00:E001            interrupt_dummy2:
   32  00:E001  40                rti
   33                     
   34  00:E002            interrupt_dummy3:
   35  00:E002  40                rti
   36                     
   37  00:E003            interrupt_dummy4:
   38  00:E003  40                rti
   39                     ;
   40                     ;       RESET interrupt handler
   41                     ;
   42  00:E004            interrupt_reset:
   43  00:E004  78                sei                             ; disable interrupt
   44  00:E005  D4                csh                             ; high speed mode
   45  00:E006  D8                cld                             ; 
   46                     
   47  00:E007  A2 FF             ldx     #$ff                    ; initialize stack pointer
   48  00:E009  9A                txs
   49                     
   50  00:E00A  A9 FF             lda     #$ff                    ; map i/o bank
   51  00:E00C  53 01             tam0
   52  00:E00E  A9 F8             lda     #$f8                    ; map ram bank
   53  00:E010  53 02             tam1
   54                     
   55  00:E012  9C 00 20          stz     $2000                   ; clear ram
   56  00:E015  73 00 20          tii     $2000,$2001,$1fff
       00:E018  01 20 FF  
       00:E01B  1F        
   57                             
   58  00:E01C  9C 01 0C          stz     TimerCtrl               ; stop timer
   59                     
   60  00:E01F  20 3E E0          jsr     initPsg
   61  00:E022  20 62 E0          jsr     initVdc
   62  00:E025  20 BA E0          jsr     initPad
   63                     
   64  00:E028  9C 02 14          stz     IntCtrlMask             ; disable interrupt
   65                     
   66  00:E02B  A9 05             lda     #5
   67  00:E02D  8D 00 00          sta     VdcReg
   68  00:E030  A9 C8             lda     #$c8                    ; enable sprite & bg / disable interrupt
   69  00:E032  8D 02 00          sta     VdcDataL
   70  00:E035  23 00             st2     #0                      ; auto increment +1
   71                     
   72                     ;       jump to main
   73  00:E037  A9 01             lda     #BANK(main)
   74  00:E039  53 40             tam     #PAGE(main)
   75  00:E03B  4C 07 C0          jmp     main
   76                     ;
   77                     ;       initialize psg
   78                     ;
   79  00:E03E            initPsg:
   80  00:E03E  9C 01 08          stz     PsgMainVol
   81  00:E041  9C 09 08          stz     PsgLfoCtrl
   82                     
   83                     ;       disable all channels
   84  00:E044  A9 05             lda     #5
   85  00:E046  8D 00 08  .loop:  sta     PsgChannel
   86  00:E049  9C 01 08          stz     PsgMainVol
   87  00:E04C  9C 04 08          stz     PsgCtrl
   88  00:E04F  3A                dec     a
   89  00:E050  10 F4             bpl     .loop
   90                     
   91                     ;       disable noise(channel 4/5)
   92  00:E052  A9 04             lda     #4
   93  00:E054  8D 00 08          sta     PsgChannel
   94  00:E057  9C 07 08          stz     PsgNoise
   95  00:E05A  1A                inc     a
   96  00:E05B  8D 00 08          sta     PsgChannel
   97  00:E05E  9C 07 08          stz     PsgNoise
   98                     
   99  00:E061  60                rts
  100                     ;
  101                     ;       initialize VDC,VCE
  102                     ;       TODO: Ëß£ÂÉèÂ∫¶„ÅåÊ®™336„Éâ„ÉÉ„ÉàÈôêÂÆö„ÅÆË®≠ÂÆö„Å´„Å™„Å£„Å¶„ÅÑ„Çã
  103                     
  104                     ; ----
  105                     ; HSR(xres)
  106                     ; ----
  107                     ; macros to calculate the value of the HSR VDC register
  108                     ; ----
  109                     ; IN :  xres, horizontal screen resolution
  110                     ; ----
  111                     
  112                     HSR     .macro
  113                              .if (\1 <= 272)
  114                               ; low res
  115                               .db $02
  116                               .db (18 - (((\1 / 8) - 1) / 2))
  117                              .else
  118                               ; high res
  119                               .db $03
  120                               .db (24 - (((\1 / 8) - 1) / 2))
  121                              .endif
  122                             .endm
  123                     
  124                     
  125                     ; ----
  126                     ; HDR(xres)
  127                     ; ----
  128                     ; macros to calculate the value of the HDR VDC register
  129                     ; ----
  130                     ; IN :  xres, horizontal screen resolution
  131                     ; ----
  132                     
  133                     HDR     .macro
  134                              .db ((\1 / 8) - 1)
  135                              .if (\1 <= 272)
  136                               ; low res
  137                               .db (38 - ((18 - (((\1 / 8) - 1) / 2)) + (\1 / 8)))
  138                              .else
  139                               ; high res
  140                               .db (54 - ((24 - (((\1 / 8) - 1) / 2)) + (\1 / 8)))
  141                              .endif
  142                             .endm
  143                     
  144                     
  145  00:E062            initVdc:
  146                     ;       set VDC registers from .table
  147  00:E062  82                clx
  148  00:E063            .loop:
  149  00:E063  BD 95 E0          lda     .table,x
  150  00:E066  F0 14             beq     .endloop
  151  00:E068  8D 00 00          sta     VdcReg
  152  00:E06B  E8                inx
  153  00:E06C  BD 95 E0          lda     .table,x
  154  00:E06F  8D 02 00          sta     VdcDataL
  155  00:E072  E8                inx
  156  00:E073  BD 95 E0          lda     .table,x
  157  00:E076  8D 03 00          sta     VdcDataH
  158  00:E079  E8                inx
  159  00:E07A  80 E7             bra     .loop
  160  00:E07C            .endloop:
  161                     
  162                     ;       init vce
  163                     ;        lda     #1              ;horizontal resolution >272!!!!!!
  164                     ;        sta     VceCtrl
  165  00:E07C  9C 00 04          stz     VceCtrl
  166                     
  167                     ;       clear vram
  168  00:E07F  03 00             st0     #0
  169  00:E081  13 00             st1     #0
  170  00:E083  23 00             st2     #0
  171  00:E085  03 02             st0     #2
  172                     
  173  00:E087  A2 80             ldx     #128
  174  00:E089  C2        .cl2:   cly
  175  00:E08A  13 00     .cl1:   st1     #0
  176  00:E08C  23 00             st2     #0
  177  00:E08E  88                dey
  178  00:E08F  D0 F9             bne     .cl1
  179  00:E091  CA                dex
  180  00:E092  D0 F5             bne     .cl2
  181                     
  182  00:E094  60                rts
  183                     
  184                     ;       resolution      256x240
  185                     ;       bat size        32x32
  186                     ;       satb copy       $7f00
  187  00:E095            .table:
  188  00:E095  05 00 00          .db     $05,$00,$00     ;control register
  189  00:E098  06 00 00          .db     $06,$00,$00     ;raster counter register
  190  00:E09B  07 00 00          .db     $07,$00,$00     ;x scroll register
  191  00:E09E  08 00 00          .db     $08,$00,$00     ;y scroll register
  192  00:E0A1  09 00 00          .db     $09,$00,$00     ;memory access width register
  193  00:E0A4  0A                .db     $0a             ;horizontal synchro register
  194                             HSR     256
                0001               .if (256 <= 272)
                                    ; low res
       00:E0A5  02                  .db $02
       00:E0A6  03                  .db (18 - (((256 / 8) - 1) / 2))
                                   .else
                                   .endif
  195  00:E0A7  0B                .db     $0b             ;horizontal display register
  196                             HDR     256
       00:E0A8  1F                 .db ((256 / 8) - 1)
                0001               .if (256 <= 272)
                                    ; low res
       00:E0A9  03                  .db (38 - ((18 - (((256 / 8) - 1) / 2)) + (256 / 8)))
                                   .else
                                   .endif
  197  00:E0AA  0C 02 0F          .db     $0c,$02,$0f     ;vertical synchro register
  198  00:E0AD  0D EF 00          .db     $0d,$ef,$00     ;vertical display register
  199  00:E0B0  0E 03 00          .db     $0e,$03,$00     ;vertical display end position register
  200  00:E0B3  0F 10 00          .db     $0f,$10,$00     ;dma control register
  201  00:E0B6  13 00 7F          .db     $13,$00,$7f     ;vram-satb source address register
  202  00:E0B9  00                .db     $00             ;end of table
  203                     ;
  204                     ;       initialize pad
  205                     ;
  206  00:E0BA            initPad:
  207  00:E0BA  64 00             stz     <zpad
  208  00:E0BC  64 02             stz     <zpadold
  209  00:E0BE  64 01             stz     <zpaddelta
  210  00:E0C0  60                rts
  211                     ;
  212                     ;       read pad
  213                     ;       TODO: support multi tap
  214  00:E0C1            readPad:
  215  00:E0C1  A9 01             lda     #1
  216  00:E0C3  8D 00 10          sta     PadPort
  217  00:E0C6  A9 03             lda     #3
  218  00:E0C8  8D 00 10          sta     PadPort
  219                     
  220  00:E0CB  A5 00             lda     <zpad
  221  00:E0CD  49 FF             eor     #$ff
  222  00:E0CF  85 02             sta     <zpadold
  223                     
  224  00:E0D1  A9 01             lda     #1
  225  00:E0D3  8D 00 10          sta     PadPort
  226  00:E0D6  22                sax                     ;wait 10 cycles
  227  00:E0D7  22                sax
  228  00:E0D8  EA                nop
  229  00:E0D9  EA                nop
  230  00:E0DA  AD 00 10          lda     PadPort
  231  00:E0DD  0A                asl     a
  232  00:E0DE  0A                asl     a
  233  00:E0DF  0A                asl     a
  234  00:E0E0  0A                asl     a
  235  00:E0E1  85 00             sta     <zpad
  236                     
  237  00:E0E3  9C 00 10          stz     PadPort
  238  00:E0E6  22                sax                     ;wait 10 cycles
  239  00:E0E7  22                sax
  240  00:E0E8  EA                nop
  241  00:E0E9  EA                nop
  242  00:E0EA  AD 00 10          lda     PadPort
  243  00:E0ED  29 0F             and     #$0f
  244  00:E0EF  05 00             ora     <zpad
  245  00:E0F1  49 FF             eor     #$ff
  246  00:E0F3  85 00             sta     <zpad
  247                     
  248  00:E0F5  25 02             and     <zpadold
  249  00:E0F7  85 01             sta     <zpaddelta
  250                     
  251  00:E0F9  60                rts
  252                     ;
  253           2000              .zp
  254  --:2000            zpad:          .ds 1   ;pad status
  255  --:2001            zpaddelta      .ds 1   ;pad status(delta)
  256  --:2002            zpadold        .ds 1   ;pad status(previous)
  257                     
#[1]   nibbler.asm
#[2]   main.asm
   14                             .include "main.asm"
    1                     ; Zero-page variables
    2                     
    3           2003              .zp
    4                     
    5  --:2003            ztmp0:  ds      1
    6  --:2004            ztmp1:  ds      1
    7  --:2005            ztmp2:  ds      1
    8  --:2006            ztmp3:  ds      1
    9  --:2007            ztmp4:  ds      1
   10  --:2008            ztmp5:  ds      1
   11  --:2009            ztmp6:  ds      1
   12                     
   13  --:200A            zarg0:  ds      1
   14  --:200B            zarg1:  ds      1
   15  --:200C            zarg2:  ds      1
   16  --:200D            zarg3:  ds      1
   17  --:200E            zarg4:  ds      1
   18  --:200F            zarg5:  ds      1
   19                     
   20                     
   21                             ;; scroll counter
   22  --:2010            scrx:   .ds     2
   23  --:2012            scry:   .ds     2
   24                     
   25  --:2014            zframe: .ds     1
   26                     
   27                     
   28  --:2015            zdotnum:        ds      1
   29  --:2016            zwave:  ds      1
   30  --:2017            ztime:  ds      2
   31                     
   32                     ;--- CODE area ----------
   33                     
   34           E0FA              .code
   35           0001              .bank MAIN_BANK
   36           C000              .org  $C000
   37                     
   38                     ;       wait VSync (polling)
   39  01:C000            waitVsync:
   40  01:C000            .wait:
   41  01:C000  93 20 00          tst     #$20,VdcStatus
       01:C003  00        
   42  01:C004  F0 FA         beq     .wait
   43  01:C006  60            rts
   44                     
   45                     
   46                     
   47                     ;
   48                     ;       main
   49                     ;
   50  01:C007            main:   
   51  01:C007  A9 04             lda     #BANK(BgPattern)
   52  01:C009  53 04             tam     #PAGE(BgPattern)
   53                     
   54  01:C00B  A9 05             lda     #BANK(SpPattern)
   55  01:C00D  53 08             tam     #PAGE(SpPattern)
   56                     
   57  01:C00F  A9 06             lda     #BANK(WaveMap)
   58  01:C011  53 10             tam     #PAGE(WaveMap)
   59                     
   60                             ; set bg pattern
   61                     
   62  01:C013  03 00             st0     #0
   63  01:C015  A9 00             lda     #$00
   64  01:C017  8D 02 00          sta     VdcDataL
   65  01:C01A  A9 10             lda     #$10
   66  01:C01C  8D 03 00          sta     VdcDataH
   67  01:C01F  03 02             st0     #2
   68  01:C021  E3 00 40          tia     BgPattern,VdcData,BgPattern_size
       01:C024  02 00 E0  
       01:C027  07        
   69                     
   70                             ; set bg palette
   71  01:C028  A9 00             lda     #LOW(0*16)
   72  01:C02A  8D 02 04          sta     VceIndexL
   73  01:C02D  A9 00             lda     #HIGH(0*16)
   74  01:C02F  8D 03 04          sta     VceIndexH
   75  01:C032  E3 E0 47          tia     BgPalette,VceData,16*16*2
       01:C035  04 04 00  
       01:C038  02        
   76                     
   77                             
   78                             ; set sprite pattern
   79  01:C039  03 00             st0     #0
   80  01:C03B  A9 00             lda     #$00
   81  01:C03D  8D 02 00          sta     VdcDataL
   82  01:C040  A9 40             lda     #$40
   83  01:C042  8D 03 00          sta     VdcDataH
   84  01:C045  03 02             st0     #2
   85  01:C047  E3 00 60          tia     SpPattern,VdcData,SpPattern_size
       01:C04A  02 00 80  
       01:C04D  00        
   86                     
   87                             ; set sprite palette
   88  01:C04E  A9 00             lda     #LOW(16*16)
   89  01:C050  8D 02 04          sta     VceIndexL
   90  01:C053  A9 01             lda     #HIGH(16*16)
   91  01:C055  8D 03 04          sta     VceIndexH
   92  01:C058  E3 80 60          tia     SpPalette,VceData,16*16*2
       01:C05B  04 04 00  
       01:C05E  02        
   93                     
   94                             ;vsync                  ; vsync to avoid snow
   95  01:C05F  20 00 C0          jsr     waitVsync
   96                     
   97                     
   98  01:C062  20 9E C1          jsr     spr_init
   99  01:C065  20 E9 C1          jsr     spr_update
  100                     
  101  01:C068  20 F4 C6          jsr     vqInit
  102                     
  103  01:C06B  20 0B C1          jsr     initPsgTest
  104                     
  105  01:C06E  20 F9 C1          jsr     tkInit
  106                     
  107  01:C071  64 16             stz     <zwave
  108                     
  109  01:C073  A9 99             lda     #$99
  110  01:C075  85 17             sta     <ztime
  111  01:C077  85 18             sta     <ztime+1
  112                     
  113                             tkChangeTask_   tklInitWave
                          ;    .if tklInitWave=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C079  A9 A6         lda #LOW(tklInitWave)
       01:C07B  85 1C         sta <ztkChgTask
       01:C07D  A9 C2         lda #HIGH(tklInitWave)
       01:C07F  85 1D         sta <ztkChgTask+1
                          ;    .endif
  114                     
  115           0000              .if     0
  148                             .endif
  149                     
  150                             ;; initialize sprite
  151                     ;       jsr     plInit
  152                     
  153  01:C081            mainloop:
  154  01:C081  20 4B C2          jsr     tkDispatch
  155  01:C084  20 70 C2          jsr     tkChangeTasks
  156  01:C087  4C 81 C0          jmp     mainloop
  157                     
  158                     
  159  01:C08A            DrawWaveTask:
  160  01:C08A  20 92 C4          jsr     DrawWave
  161                     
  162  01:C08D  20 BA C2          jsr     plInit
  163                     
  164  01:C090  20 5D C2          jsr     tkYield
  165                     
  166                             tkChangeTask_   tklGameMain
                          ;    .if tklGameMain=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C093  A9 AC         lda #LOW(tklGameMain)
       01:C095  85 1C         sta <ztkChgTask
       01:C097  A9 C2         lda #HIGH(tklGameMain)
       01:C099  85 1D         sta <ztkChgTask+1
                          ;    .endif
  167  01:C09B  20 5D C2          jsr     tkYield
  168                     
  169                     
  170  01:C09E            WaveClearTask:
  171  01:C09E  A5 16             lda     <zwave
  172  01:C0A0  1A                inc     a
  173  01:C0A1  C9 64             cmp     #100
  174  01:C0A3  30 01             bmi     .set
  175  01:C0A5  62                cla
  176  01:C0A6            .set:
  177  01:C0A6  85 16             sta     <zwave
  178                     
  179                             tkChangeTask_   tklInitWave
                          ;    .if tklInitWave=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C0A8  A9 A6         lda #LOW(tklInitWave)
       01:C0AA  85 1C         sta <ztkChgTask
       01:C0AC  A9 C2         lda #HIGH(tklInitWave)
       01:C0AE  85 1D         sta <ztkChgTask+1
                          ;    .endif
  180  01:C0B0  20 5D C2          jsr     tkYield
  181                     
  182  01:C0B3            TimerTask:
  183                                                             ;TODO: „Çø„Ç§„Éû„Éº„ÅÆÊ∏õÂ∞ëÈñìÈöîË™øÊï¥
  184  01:C0B3  A5 14             lda     <zframe
  185  01:C0B5  29 3F             and     #64-1
  186  01:C0B7  D0 26             bne     .yield
  187                     
  188  01:C0B9  F8                sed
  189  01:C0BA  A5 17             lda     <ztime
  190  01:C0BC  38                sec
  191  01:C0BD  E9 01             sbc     #1
  192  01:C0BF  85 17             sta     <ztime
  193  01:C0C1  A5 18             lda     <ztime+1
  194  01:C0C3  E9 00             sbc     #0
  195  01:C0C5  85 18             sta     <ztime+1
  196  01:C0C7  D8                cld
  197                     
  198  01:C0C8  A9 C0             lda #LOW(0+30*32)
  199  01:C0CA  85 0A         sta <zarg0
  200  01:C0CC  A9 03         lda #HIGH(0+30*32)
  201  01:C0CE  85 0B         sta <zarg1
  202  01:C0D0  A9 17             lda     #LOW(ztime)
  203  01:C0D2  85 0C             sta     <zarg2
  204  01:C0D4  A9 20             lda     #HIGH(ztime)
  205  01:C0D6  85 0D             sta     <zarg3
  206  01:C0D8  A9 02             lda     #2
  207  01:C0DA  85 0E             sta     <zarg4
  208  01:C0DC  20 5E C7          jsr     drawDigits
  209  01:C0DF            .yield:
  210  01:C0DF  20 5D C2          jsr     tkYield
  211  01:C0E2  80 CF             bra     TimerTask
  212                     
  213                     
  214                     
  215                     ;
  216                     ;       vsync
  217                     ;
  218  01:C0E4            VSyncTask:
  219  01:C0E4  20 E9 C1      jsr spr_update
  220  01:C0E7  20 00 C0      jsr waitVsync
  221                     
  222  01:C0EA  20 25 C7          jsr     vqDraw
  223                     
  224                     ;       scroll
  225  01:C0ED  03 07             st0     #7
  226  01:C0EF  9C 02 00          stz     VdcDataL
  227  01:C0F2  9C 03 00          stz     VdcDataH
  228                     
  229  01:C0F5  03 08             st0     #8
  230  01:C0F7  A9 EF             lda     #$ef
  231  01:C0F9  8D 02 00          sta     VdcDataL
  232  01:C0FC  A9 FF             lda     #$ff
  233  01:C0FE  8D 03 00          sta     VdcDataH
  234                     
  235  01:C101  20 C1 E0      jsr readPad
  236                     
  237  01:C104  E6 14             inc     <zframe
  238                             
  239  01:C106  20 5D C2          jsr     tkYield
  240  01:C109  80 D9             bra     VSyncTask
  241                     
  242                     
  243                     
  244                     
  245                     ;       psg test        
  246  01:C10B            initPsgTest:
  247  01:C10B  A9 00             lda     #0
  248  01:C10D  8D 00 08          sta     PsgChannel
  249                     
  250                     ;       write wave data
  251  01:C110  A9 40             lda     #$40
  252  01:C112  8D 04 08          sta     PsgCtrl
  253  01:C115  9C 04 08          stz     PsgCtrl
  254                     
  255  01:C118  82                clx
  256  01:C119  BD 3B C1  .loop:  lda     .wave,x
  257  01:C11C  C9 FF             cmp     #$ff
  258  01:C11E  F0 06             beq     .loopend
  259  01:C120  8D 06 08          sta     PsgWave
  260  01:C123  E8                inx
  261  01:C124  80 F3             bra     .loop
  262                     
  263  01:C126            .loopend:
  264                     ;       set frequency
  265  01:C126  A9 FE             lda     #$fe
  266  01:C128  8D 02 08          sta     PsgFreqL
  267  01:C12B  9C 03 08          stz     PsgFreqH
  268                     
  269                     ;       set volume
  270                             ;lda    #$ff
  271  01:C12E  62                cla
  272  01:C12F  8D 05 08          sta     PsgChVol
  273  01:C132  8D 01 08          sta     PsgMainVol
  274                     
  275  01:C135  A9 8F             lda     #$8f
  276  01:C137  8D 04 08          sta     PsgCtrl
  277                     
  278  01:C13A  60                rts
  279                     
  280  01:C13B            .wave:
  281  01:C13B  1F 1D 1B          .db     $1f,$1d,$1b,$19,$17,$15,$13,$11
       01:C13E  19 17 15  
       01:C141  13 11     
  282  01:C143  0F 0D 0B          .db     $0f,$0d,$0b,$09,$07,$05,$03,$01
       01:C146  09 07 05  
       01:C149  03 01     
  283  01:C14B  1F 1D 1B          .db     $1f,$1d,$1b,$19,$17,$15,$13,$11
       01:C14E  19 17 15  
       01:C151  13 11     
  284  01:C153  0F 0D 0B          .db     $0f,$0d,$0b,$09,$07,$05,$03,$01
       01:C156  09 07 05  
       01:C159  03 01     
  285  01:C15B  FF                .db     $ff     
  286                     
  287  01:C15C  1F 1F 1F          .db     $1f,$1f,$1f,$1f,$1f,$1f,$1f,$1f
       01:C15F  1F 1F 1F  
       01:C162  1F 1F     
  288  01:C164  00 00 00          .db     $00,$00,$00,$00,$00,$00,$00,$00
       01:C167  00 00 00  
       01:C16A  00 00     
  289  01:C16C  00 00 00          .db     $00,$00,$00,$00,$00,$00,$00,$00
       01:C16F  00 00 00  
       01:C172  00 00     
  290  01:C174  00 00 00          .db     $00,$00,$00,$00,$00,$00,$00,$00
       01:C177  00 00 00  
       01:C17A  00 00     
  291  01:C17C  FF                .db     $ff
  292                     
  293  01:C17D  0F 12 15          .db     $0f,$12,$15,$17,$19,$1b,$1d,$1E
       01:C180  17 19 1B  
       01:C183  1D 1E     
  294  01:C185  1E 1E 1D          .db     $1e,$1e,$1d,$1b,$19,$17,$15,$12
       01:C188  1B 19 17  
       01:C18B  15 12     
  295  01:C18D  0F 0C 09          .db     $0f,$0c,$09,$07,$05,$03,$01,$00
       01:C190  07 05 03  
       01:C193  01 00     
  296  01:C195  00 00 01          .db     $00,$00,$01,$03,$05,$07,$09,$0c
       01:C198  03 05 07  
       01:C19B  09 0C     
  297  01:C19D  FF                .db     $ff     
  298                     
  299                     
  300  01:C19E            spr_init:
  301                     
  302                             ;; clear satb
  303  01:C19E  9C 00 22          stz     satb
  304  01:C1A1  73 00 22          tii     satb,satb+1,512-1
       01:C1A4  01 22 FF  
       01:C1A7  01        
  305                     
  306                             ;; set satb 0
  307  01:C1A8  A9 40             lda     #$40
  308  01:C1AA  8D 00 22          sta     satb+0
  309  01:C1AD  9C 01 22          stz     satb+1
  310                     
  311  01:C1B0  A9 20             lda     #$20
  312  01:C1B2  8D 02 22          sta     satb+2
  313  01:C1B5  9C 03 22          stz     satb+3
  314                     
  315  01:C1B8  9C 04 22          stz     satb+4
  316  01:C1BB  A9 02             lda     #$2             ;vram address = $4000 -> $200
  317  01:C1BD  8D 05 22          sta     satb+5
  318                     
  319  01:C1C0  A9 80             lda     #$80            ;priority  & color=0
  320  01:C1C2  8D 06 22          sta     satb+6
  321  01:C1C5  9C 07 22          stz     satb+7
  322                     
  323                     
  324                             ;; set satb 1
  325  01:C1C8  A9 40             lda     #$40
  326  01:C1CA  8D 08 22          sta     satb+8
  327  01:C1CD  9C 09 22          stz     satb+9
  328                     
  329  01:C1D0  A9 20             lda     #$20
  330  01:C1D2  8D 0A 22          sta     satb+10
  331  01:C1D5  9C 0B 22          stz     satb+11
  332                     
  333  01:C1D8  9C 0C 22          stz     satb+12
  334  01:C1DB  A9 02             lda     #$2             ;vram address = $4000 -> $200
  335  01:C1DD  8D 0D 22          sta     satb+13
  336                     
  337  01:C1E0  A9 80             lda     #$80            ;priority  & color=0
  338  01:C1E2  8D 0E 22          sta     satb+14
  339  01:C1E5  9C 0F 22          stz     satb+15
  340                     
  341  01:C1E8  60                rts
  342                     
  343                     
  344  01:C1E9            spr_update:
  345  01:C1E9  03 00             st0     #0
  346  01:C1EB  13 00             st1     #$00
  347  01:C1ED  23 7F             st2     #$7f
  348  01:C1EF  03 02             st0     #2
  349  01:C1F1  E3 00 22          tia     satb,VdcDataL,512
       01:C1F4  02 00 00  
       01:C1F7  02        
  350  01:C1F8  60                rts
  351                     
  352                     
  353                     
  354                             ;...
  355                             ;; satb
  356           2200              .bss
  357  --:2200            satb    .ds 512 ; the local SATB
#[1]   nibbler.asm
#[2]   task.asm
   15                             .include "task.asm"
    1                     
    2                     
    3           0004      TK_MAX_TASK equ 4               ;„Çø„Çπ„ÇØÊï∞
    4           0010      TK_TASK_STACK_SIZE  equ 16      ;„Çø„Çπ„ÇØ„ÅÇ„Åü„Çä„ÅÆ„Çπ„Çø„ÉÉ„ÇØ„Çµ„Ç§„Ç∫
    5           2100      TK_STACK_AREA   equ $2100       ;„Çπ„Çø„ÉÉ„ÇØÈñãÂßã„Ç¢„Éâ„É¨„Çπ
    6                     
    7           2019          .zp
    8  --:2019            ztkTaskNum: ds  1
    9  --:201A            ztkSaveSp:  ds  1               ;tkDispatch ÂÆüË°åÊôÇ„ÅÆsp‰øùÂ≠ò
   10  --:201B            ztkCurTask: ds  1               ;tkDispatch ÂÆüË°å‰∏≠„ÅÆ„Çø„Çπ„ÇØÁï™Âè∑
   11  --:201C            ztkChgTask: ds  2
   12                     
   13           2400          .bss
   14                     
   15  --:2400            tkSp:   ds  TK_MAX_TASK         ;„Çø„Çπ„ÇØ„ÅÆsp
   16                     
   17           C1F9          .code
   18           0001          .bank   MAIN_BANK
   19                     
   20                     
   21                     ;
   22                     ;   „Çø„Çπ„ÇØÂàùÊúüÂåñ
   23                     ;   @args           „Å™„Åó
   24                     ;   @saveregs       „Å™„Åó
   25                     ;   @return         „Å™„Åó
   26                     ;
   27                                     ;p„É¨„Ç∏„Çπ„Çø„ÇÇ‰øùÁÆ°„Åô„Çã„Å®„ÄÅÂâ≤„ÇäËæº„ÅøÁä∂ÊÖã„ÇÇÂ§â„Çè„Å£„Å¶„Åó„Åæ„Å£„Å¶‰∫àÊúü„Åõ„Å¨Âãï„Åç„Å´Áπã„Åå„Çä„Åã„Å≠
   28                                     ;ÂÆüÈöõ„ÄÅÁ¶ÅÊ≠¢„Åó„Å¶„ÅÑ„ÅüÂâ≤„ÇäËæº„Åø„ÅåÂãùÊâã„Å´„Åã„Åã„Å£„Å¶„Åó„Åæ„ÅÑ„ÄÅ„Åä„Åã„Åó„Å™Âãï„Åç„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„
   29  01:C1F9            tkInit:
   30  01:C1F9  9C 19 20      stz ztkTaskNum
   31                     
   32  01:C1FC  A9 A4         lda #LOW(tklNone)
   33  01:C1FE  85 0C         sta <zarg2
   34  01:C200  A9 C2         lda #HIGH(tklNone)
   35  01:C202  85 0D         sta <zarg3
   36  01:C204  20 30 C2      jsr tkSetAllTasks
   37                     
   38                         tkChangeTask_   0
                          ;    .if 0=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C207  A9 00         lda #LOW(0)
       01:C209  85 1C         sta <ztkChgTask
       01:C20B  A9 00         lda #HIGH(0)
       01:C20D  85 1D         sta <ztkChgTask+1
                          ;    .endif
   39  01:C20F  60            rts
   40                     
   41                     ;
   42                     ;   „Çø„Çπ„ÇØÂ§âÊõ¥
   43                     ;   @args           zarg0,1 = „Çø„Çπ„ÇØÈñãÂßã„Ç¢„Éâ„É¨„Çπ
   44                     ;                   x = „Çø„Çπ„ÇØÁï™Âè∑
   45                     ;   @saveregs       x
   46                     ;   @return         „Å™„Åó
   47                     ;
   48  01:C210            tkSetTask:
   49  01:C210  DA            phx
   50                     
   51  01:C211  8A            txa
   52  01:C212  1A            inc a
   53           0001          .if TK_TASK_STACK_SIZE=16
   54  01:C213  0A            asl a
   55  01:C214  0A            asl a
   56  01:C215  0A            asl a
   57  01:C216  0A            asl a
   58                         .else
   60                         .endif
   61  01:C217  9D 00 24      sta tkSp,x
   62                     
   63  01:C21A  AA            tax
   64  01:C21B  9E 01 21      stz TK_STACK_AREA+1,x
   65  01:C21E  9E 02 21      stz TK_STACK_AREA+2,x
   66  01:C221  9E 03 21      stz TK_STACK_AREA+3,x
   67  01:C224  A5 0A         lda <zarg0
   68  01:C226  9D 04 21      sta TK_STACK_AREA+4,x
   69  01:C229  A5 0B         lda <zarg1
   70  01:C22B  9D 05 21      sta TK_STACK_AREA+5,x
   71                     
   72  01:C22E  FA            plx
   73  01:C22F  60            rts
   74                     
   75                     ;
   76                     ;   ÂÖ®„Å¶„ÅÆ„Çø„Çπ„ÇØÂ§âÊõ¥
   77                     ;   @args           zarg2,3 = „Çø„Çπ„ÇØ„É™„Çπ„Éà„Ç¢„Éâ„É¨„Çπ
   78                     ;   @saveregs       „Å™„Åó
   79                     ;   @return         „Å™„Åó
   80                     ;
   81  01:C230            tkSetAllTasks:
   82  01:C230  82            clx
   83  01:C231  C2            cly
   84                     
   85  01:C232            .loop:
   86  01:C232  B1 0C         lda [zarg2],y
   87  01:C234  85 0A         sta <zarg0
   88  01:C236  C8            iny
   89  01:C237  11 0C         ora [zarg2],y
   90  01:C239  F0 0D         beq .taskend
   91                     
   92  01:C23B  B1 0C         lda [zarg2],y
   93  01:C23D  85 0B         sta <zarg1
   94  01:C23F  20 10 C2      jsr tkSetTask
   95                     
   96  01:C242  C8            iny
   97  01:C243  E8            inx
   98  01:C244  E0 04         cpx #TK_MAX_TASK
   99  01:C246  D0 EA         bne .loop
  100  01:C248            .taskend:
  101  01:C248  86 19         stx <ztkTaskNum
  102                     
  103  01:C24A  60            rts
  104                     
  105                     
  106                     
  107                     ;
  108                     ;   „Çø„Çπ„ÇØ„ÅÆÂÆüË°å
  109                     ;   @args           „Å™„Åó
  110                     ;   @saveregs       „Å™„Åó
  111                     ;   @return         „Å™„Åó
  112                     ;
  113  01:C24B            tkDispatch:
  114                                         ;„Çø„Çπ„ÇØ„Åå„Å™„ÅÑÂ†¥Âêà
  115  01:C24B  A5 19         lda <ztkTaskNum
  116  01:C24D  F0 20         beq tkDispatch_end
  117                     
  118                                         ;„Åì„ÅÆ„É´„Éº„ÉÅ„É≥ÈñãÂßãÊôÇ„ÅÆsp„Çí‰øùÁÆ°
  119  01:C24F  BA            tsx
  120  01:C250  86 1A         stx <ztkSaveSp
  121                     
  122  01:C252  C2            cly             ;y=„Çø„Çπ„ÇØÁï™Âè∑
  123                     
  124  01:C253            tkDispatch_loop:
  125                                         ;„Çø„Çπ„ÇØ„ÇíÂÆüË°å
  126                                         ;„Çø„Çπ„ÇØ„ÅÆsp„ÇíÂæ©ÂÖÉ
  127  01:C253  BE 00 24      ldx tkSp,y
  128  01:C256  9A            txs
  129  01:C257  84 1B         sty <ztkCurTask ;ÁèæÂú®„ÅÆ„Çø„Çπ„ÇØÁï™Âè∑„Çí‰øùÁÆ°
  130                                         ;„Çø„Çπ„ÇØ„ÅÆ„É¨„Ç∏„Çπ„Çø„ÇíÂæ©ÂÖÉ
  131  01:C259  7A            ply
  132  01:C25A  FA            plx
  133  01:C25B  68            pla
  134  01:C25C  60            rts             ;„Çø„Çπ„ÇØ„ÅÆÂÆüË°å„Ç¢„Éâ„É¨„Çπ„Å´„Ç∏„É£„É≥„Éó
  135                     
  136                                         ;„Çø„Çπ„ÇØÂàá„ÇäÊõø„Åà
  137  01:C25D            tkYield:
  138                                         ;„Çø„Çπ„ÇØ„ÅÆ„É¨„Ç∏„Çπ„Çø„Çí‰øùÁÆ°
  139  01:C25D  48            pha
  140  01:C25E  DA            phx
  141  01:C25F  5A            phy
  142                                         ;„Çø„Çπ„ÇØ„ÅÆsp„Çí‰øùÁÆ°
  143  01:C260  A4 1B         ldy <ztkCurTask ;y=ÁèæÂú®„ÅÆ„Çø„Çπ„ÇØÁï™Âè∑
  144  01:C262  BA            tsx
  145  01:C263  8A            txa
  146  01:C264  99 00 24      sta tkSp,y      
  147                                         ;Ê¨°„ÅÆ„Çø„Çπ„ÇØ
  148  01:C267            tkNextTask:
  149  01:C267  C8            iny
  150                     ;    cpy #TK_MAX_TASK
  151  01:C268  C4 19         cpy <ztkTaskNum
  152  01:C26A  D0 E7         bne tkDispatch_loop
  153                                         ;tkDispatchÈñãÂßãÊôÇ„ÅÆsp„ÇíÂæ©ÂÖÉ
  154  01:C26C  A6 1A         ldx <ztkSaveSp
  155  01:C26E  9A            txs
  156                     
  157  01:C26F            tkDispatch_end:
  158  01:C26F  60            rts
  159                     
  160                     ;
  161                     ;
  162                     ;
  163  01:C270            tkChangeTasks:
  164  01:C270  A5 1C         lda <ztkChgTask
  165  01:C272  24 1D         bit <ztkChgTask+1
  166  01:C274  D0 01         bne .chg
  167  01:C276  60            rts
  168  01:C277            .chg:
  169  01:C277  85 0C         sta <zarg2
  170  01:C279  A5 1D         lda <ztkChgTask+1
  171  01:C27B  85 0D         sta <zarg3
  172  01:C27D  20 30 C2      jsr tkSetAllTasks
  173                     
  174                         tkChangeTask_   0
                          ;    .if 0=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C280  A9 00         lda #LOW(0)
       01:C282  85 1C         sta <ztkChgTask
       01:C284  A9 00         lda #HIGH(0)
       01:C286  85 1D         sta <ztkChgTask+1
                          ;    .endif
  175  01:C288  60            rts
  176                     ;
  177                     ;   ÂÆüË°å‰∏≠„ÅÆ„Çø„Çπ„ÇØ„ÅÆÂ§âÊõ¥
  178                     ;   ‚Äª„Çø„Çπ„ÇØÂÜÖ„Åã„Çâ„ÅÆÂëº„Å≥Âá∫„ÅóÂ∞ÇÁî®
  179                     ;   @args           zarg0,1 = „Çø„Çπ„ÇØÈñãÂßã„Ç¢„Éâ„É¨„Çπ
  180                     ;   @saveregs       „Å™„Åó
  181                     ;   @return         „Å™„Åó
  182                     ;
  183  01:C289            tkLink:
  184                                         ;„Çø„Çπ„ÇØ„ÅÆ„É¨„Ç∏„Çπ„Çø„Çí‰øùÁÆ°
  185  01:C289  48            pha
  186  01:C28A  DA            phx
  187  01:C28B  5A            phy
  188                                         ;„Çø„Çπ„ÇØ„ÅÆsp„Çí‰øùÁÆ°
  189  01:C28C  A4 1B         ldy <ztkCurTask ;y=ÁèæÂú®„ÅÆ„Çø„Çπ„ÇØÁï™Âè∑
  190  01:C28E  BA            tsx
  191  01:C28F  8A            txa
  192  01:C290  99 00 24      sta tkSp,y      
  193                                         ;„Çø„Çπ„ÇØ„ÅÆÈñãÂßã„Ç¢„Éâ„É¨„Çπ„ÇíÂ§âÊõ¥
  194  01:C293  A5 0A         lda <zarg0
  195  01:C295  9D 04 21      sta TK_STACK_AREA+4,x
  196  01:C298  A5 0B         lda <zarg1
  197  01:C29A  9D 05 21      sta TK_STACK_AREA+5,x
  198                     
  199  01:C29D  80 C8         bra tkNextTask
  200                     
  201                     
  202                     
  203                     
  204                     ;
  205                     ;   ‰Ωï„ÇÇ„Åó„Å™„ÅÑ„Çø„Çπ„ÇØ
  206                     ;
  207  01:C29F            tkDummyTask:
  208  01:C29F  20 5D C2      jsr tkYield
  209  01:C2A2  80 FB         bra tkDummyTask
  210                     
  211                     
  212                     
  213                     ;
  214                     ;   „Çø„Çπ„ÇØ„É™„Çπ„Éà
  215                     ;
  216                     ;
  217                     tkTaskAddress_  .macro
  218                     ;    .if \1!=0
  219                         dw  \1-1
  220                     ;    .else
  221                     ;    dw  0
  222                     ;    .endif
  223                         .endm
  224                     
  225                     tkEndTaskList_  .macro
  226                         dw  0
  227                         .endm
  228                     
  229                     
  230  01:C2A4            tklNone:
  231                         tkEndTaskList_
       01:C2A4  00 00         dw  0
  232                     
  233  01:C2A6            tklInitWave:
  234                         tkTaskAddress_  DrawWaveTask
                          ;    .if DrawWaveTask!=0
       01:C2A6  89 C0         dw  DrawWaveTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  235                         tkTaskAddress_  VSyncTask
                          ;    .if VSyncTask!=0
       01:C2A8  E3 C0         dw  VSyncTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  236                         tkEndTaskList_
       01:C2AA  00 00         dw  0
  237                     
  238  01:C2AC            tklGameMain:
  239                         tkTaskAddress_  plTask
                          ;    .if plTask!=0
       01:C2AC  3A C4         dw  plTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  240                         tkTaskAddress_  TimerTask
                          ;    .if TimerTask!=0
       01:C2AE  B2 C0         dw  TimerTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  241                         tkTaskAddress_  VSyncTask
                          ;    .if VSyncTask!=0
       01:C2B0  E3 C0         dw  VSyncTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  242                         tkEndTaskList_
       01:C2B2  00 00         dw  0
  243                     
  244  01:C2B4            tklClearWave:
  245                         tkTaskAddress_  WaveClearTask
                          ;    .if WaveClearTask!=0
       01:C2B4  9D C0         dw  WaveClearTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  246                         tkTaskAddress_  VSyncTask
                          ;    .if VSyncTask!=0
       01:C2B6  E3 C0         dw  VSyncTask-1
                          ;    .else
                          ;    dw  0
                          ;    .endif
  247                         tkEndTaskList_
       01:C2B8  00 00         dw  0
#[1]   nibbler.asm
   16                     ;        .include "chrdriver.asm"
#[2]   player.asm
   17                             .include "player.asm"
    1                     
    2           2404              .bss
    3                     
    4           201E              .zp
    5                                         ;„Ç≠„É£„É©„ÇØ„ÇøÈÖçÂàó
    6  --:201E            zplx:   ds  2       ;xÂ∫ßÊ®ô
    7  --:2020            zply:   ds  2       ;yÂ∫ßÊ®ô
    8  --:2022            zpldir: ds  2       ;ÁßªÂãïÊñπÂêë(LDRU----)
    9  --:2024            zpldirr:    ds  2   ;ÁßªÂãïÊñπÂêë„ÅÆÈÄÜÊñπÂêë(LDRU----)
   10  --:2026            zplspeed:   ds  2   ;ÁßªÂãïÈÄüÂ∫¶
   11                     
   12  --:2028            zplTailStop:    ds  1
   13                     
   14           C2BA          .code
   15           0001          .bank   MAIN_BANK
   16                     
   17                     ;
   18                     ;   ÂàùÊúüÂåñ
   19                     ;
   20                     ;   @args       „Å™„Åó
   21                     ;   @saveregs   „Å™„Åó
   22                     ;   @return     „Å™„Åó
   23  01:C2BA            plInit:
   24           200C      .tmp_fldadr_l   equ     zarg2       ;„Éï„Ç£„Éº„É´„Éâ„Ç¢„Éâ„É¨„Çπ
   25           200D      .tmp_fldadr_h   equ     zarg3
   26                     
   27  01:C2BA  64 28         stz <zplTailStop
   28                     
   29                                             ;È†≠„ÅÆÂ∫ßÊ®ô
   30  01:C2BC  82            clx
   31  01:C2BD  A9 80         lda     #(5*3+1)*8
   32  01:C2BF  85 1E         sta     <zplx
   33  01:C2C1  A9 C8         lda     #(8*3+1)*8
   34  01:C2C3  85 20         sta     <zply
   35  01:C2C5  A9 02         lda     #2
   36  01:C2C7  85 26         sta     <zplspeed
   37  01:C2C9  A9 20         lda     #%00100000
   38  01:C2CB  20 F1 C2      jsr     plSetDir
   39                                             ;Â∞ªÂ∞æ„ÅÆÂ∫ßÊ®ô
   40  01:C2CE  A2 01         ldx #1
   41  01:C2D0  A9 50         lda     #(3*3+1)*8
   42  01:C2D2  95 1E         sta     <zplx,x
   43  01:C2D4  A9 C8         lda     #(8*3+1)*8
   44  01:C2D6  95 20         sta     <zply,x
   45  01:C2D8  A9 02         lda     #2
   46  01:C2DA  95 26         sta     <zplspeed,x
   47  01:C2DC  A9 20         lda     #%00100000
   48  01:C2DE  20 F1 C2      jsr     plSetDir
   49                                             ;ËÉ¥‰Ωì
   50                                             ;TODO: ËÉ¥‰Ωì„ÅÆÁµµ„ÇíÊèè„ÅÑ„Å¶„Å™„ÅÑ
   51  01:C2E1  20 02 C3      jsr plGetBatFldAdr
   52  01:C2E4  C2            cly
   53  01:C2E5            .loop:
   54  01:C2E5  B1 0C         lda [.tmp_fldadr_l],y
   55  01:C2E7  09 02         ora #%00000010
   56  01:C2E9  91 0C         sta [.tmp_fldadr_l],y
   57  01:C2EB  C8            iny
   58  01:C2EC  C0 06         cpy #6
   59  01:C2EE  D0 F5         bne .loop
   60                     
   61  01:C2F0  60            rts
   62                     
   63                     ;
   64                     ;   ÁßªÂãïÊñπÂêëÔºà„Å®„Åù„ÅÆÈÄÜÊñπÂêëÔºâ„Çí„Çª„ÉÉ„Éà
   65                     ;
   66                     ;   @args       a = ÁßªÂãïÊñπÂêë(LDRU----)
   67                     ;               x = „Ç≠„É£„É©„ÇØ„Çø„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
   68                     ;   @saveregs   x
   69                     ;   @return     „Å™„Åó
   70  01:C2F1            plSetDir:
   71  01:C2F1  29 F0         and     #$f0        ;‰∏ã‰Ωç4„Éì„ÉÉ„Éà„ÅØÂøÖ„Åö„ÇØ„É™„Ç¢„Åó„Å¶„Åä„ÅèÔºàÊñπÂêëËª¢ÊèõÂà§ÂÆö„ÅßË™§Âà§ÂÆö„ÅÆÂÖÉ„Å®„Å™„ÇãÔºâ
   72  01:C2F3  95 22         sta     <zpldir,x
   73                     
   74  01:C2F5  89 A0         bit     #%10100000
   75  01:C2F7  F0 04         beq     .du
   76  01:C2F9  49 A0         eor     #%10100000
   77  01:C2FB  80 02         bra     .set
   78  01:C2FD            .du:
   79  01:C2FD  49 50         eor     #%01010000
   80  01:C2FF            .set:
   81  01:C2FF  95 24         sta     <zpldirr,x
   82  01:C301  60            rts
   83                     
   84                     
   85                     ;
   86                     ;   BAT„Ç¢„Éâ„É¨„Çπ&„Éï„Ç£„Éº„É´„Éâ„Ç¢„Éâ„É¨„Çπ
   87                     ;
   88                     ;   @args       x = „Ç≠„É£„É©„ÇØ„Çø„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
   89                     ;   @saveregs   x
   90                     ;   @return     zarg0,1 = BAT„Ç¢„Éâ„É¨„Çπ
   91                     ;               zarg2,3 = „Éï„Ç£„Éº„É´„Éâ„Ç¢„Éâ„É¨„Çπ
   92  01:C302            plGetBatFldAdr:
   93           200A      .arg_batadr_l     equ     zarg0
   94           200B      .arg_batadr_h     equ     zarg1
   95           200C      .arg_fldadr_l     equ     zarg2
   96           200D      .arg_fldadr_h     equ     zarg3
   97                     
   98  01:C302  B5 1E         lda     <zplx,x
   99  01:C304  4A            lsr     a
  100  01:C305  4A            lsr     a
  101  01:C306  4A            lsr     a
  102  01:C307  85 0A         sta     <.arg_batadr_l
  103  01:C309  64 0B         stz     <.arg_batadr_h
  104  01:C30B  B5 20         lda     <zply,x
  105  01:C30D  29 F8         and     #$f8
  106  01:C30F  0A            asl     a
  107  01:C310  26 0B         rol     <.arg_batadr_h
  108  01:C312  0A            asl     a
  109  01:C313  26 0B         rol     <.arg_batadr_h
  110  01:C315  04 0A         tsb     <.arg_batadr_l
  111                     
  112  01:C317  A5 0A         lda <.arg_batadr_l
  113  01:C319  18            clc
  114  01:C31A  69 04         adc #LOW(VMap)
  115  01:C31C  85 0C         sta <.arg_fldadr_l
  116  01:C31E  A5 0B         lda <.arg_batadr_h
  117  01:C320  69 24         adc #HIGH(VMap)
  118  01:C322  85 0D         sta <.arg_fldadr_h
  119                     
  120  01:C324  60            rts
  121                     
  122                     ;
  123                     ;       „Éò„Éì„ÅÆÈ†≠„ÅÆÂãï„Åç
  124                     ;
  125                     ;       @args           x = „Ç≠„É£„É©„ÇØ„Çø„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  126                     ;       @saveregs       x
  127                     ;       @return         „Åù„ÅÆÂ†¥„ÅßÂÅúÊ≠¢„Åô„Åπ„ÅçÊôÇ„ÅØ cf=1
  128  01:C325            plHeadAction:
  129           200C      .tmp_fldadr_l   equ     zarg2       ;„Éï„Ç£„Éº„É´„Éâ„Ç¢„Éâ„É¨„Çπ
  130           200D      .tmp_fldadr_h   equ     zarg3
  131           2005      .tmp_fldv       equ     ztmp2       ;„Éï„Ç£„Éº„É´„Éâ‰∏ä„ÅÆÂÄ§
  132           2006      .tmp_pad        equ     ztmp3       ;„Ç≥„É≥„Éà„É≠„Éº„É©„Éº„ÅÆÂÄ§
  133                     
  134           2003      .tmp_dead_flg   equ ztmp0
  135                     
  136                                             ;„Ç∞„É™„ÉÉ„Éâ„ÅÆ‰∏≠Èñì„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
  137  01:C325  B5 1E         lda <zplx,x
  138  01:C327  15 20         ora <zply,x
  139  01:C329  29 07         and #$07
  140  01:C32B  F0 02         beq .act
  141  01:C32D  18            clc
  142  01:C32E  60            rts
  143                                             ;Â∞ªÂ∞æ„ÇíÂÅúÊ≠¢„Åó„Å¶„ÅÑ„Çã„Å™„ÇâËß£Èô§
  144  01:C32F            .act:
  145  01:C32F  A5 28         lda <zplTailStop
  146  01:C331  F0 03         beq .act2
  147  01:C333  3A            dec a
  148  01:C334  85 28         sta <zplTailStop
  149  01:C336            .act2:
  150                     
  151                     
  152  01:C336  20 02 C3      jsr plGetBatFldAdr
  153                                             ;„Éï„Ç£„Éº„É´„Éâ‰∏ä„ÅÆÁèæÂú®‰ΩçÁΩÆ„ÅÆÂÄ§
  154  01:C339  B2 0C         lda     [.tmp_fldadr_l]
  155  01:C33B  85 05         sta     <.tmp_fldv
  156                     
  157                     ;    lda <.tmp_fldv
  158  01:C33D  29 0F         and #$0f
  159  01:C33F  F0 0C         beq .controller
  160                                             ;ÁèæÂú®‰ΩçÁΩÆ„Å´Â∞ªÂ∞æ„Åå„ÅÇ„Å£„Åü„ÇâÊ≠ª‰∫°
  161  01:C341  C9 09         cmp #9
  162  01:C343  30 5A         bmi .dead
  163                     
  164  01:C345  C9 0F         cmp #$0f
  165  01:C347  D0 04         bne .controller
  166                                             ;ÁèæÂú®‰ΩçÁΩÆ„Å´„Éâ„ÉÉ„Éà„Åå„ÅÇ„Çã„Å™„ÇâÂ∞ªÂ∞æ„ÇíÂÅúÊ≠¢„Åï„Åõ„ÇãÔºàËÉ¥‰Ωì„Çí‰º∏„Å∞„ÅôÔºâ
  167  01:C349  E6 28         inc <zplTailStop
  168                     
  169  01:C34B  C6 15         dec <zdotnum        ;„Éâ„ÉÉ„ÉàÊï∞Ê∏õÂ∞ë
  170                     
  171  01:C34D            .controller:
  172                                             ;
  173                                             ;„Ç≥„É≥„Éà„É≠„Éº„É©„Éº„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆÊñπÂêëËª¢ÊèõÂà§ÂÆö ldru
  174  01:C34D  A5 00         lda     <zpad
  175  01:C34F  29 F0         and     #$f0
  176                                             ;Êäº„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ
  177  01:C351  F0 10         beq     .notpushed
  178                                             ;ÁßªÂãïÊñπÂêë„Åä„Çà„Å≥ÈÄÜÊñπÂêë„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Å¶„ÇÇÊäº„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Å®„Åø„Å™„Åô
  179  01:C353  85 06         sta     <.tmp_pad
  180  01:C355  B5 22         lda     <zpldir,x
  181  01:C357  15 24         ora     <zpldirr,x
  182  01:C359  14 06         trb     <.tmp_pad
  183  01:C35B  F0 06         beq     .notpushed
  184                                             ;ÁßªÂãïÊñπÂêë‰ª•Â§ñ„Åã„Å§ÈÄÜÊñπÂêë‰ª•Â§ñ„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Å¶„ÄÅ„Åù„Å£„Å°„Å´ÁßªÂãïÂèØËÉΩ„Å™„ÇâÂ§âÊõ¥
  185  01:C35D  A5 06         lda     <.tmp_pad
  186  01:C35F  24 05         bit     <.tmp_fldv
  187  01:C361  D0 1A         bne     .changed
  188                                             ;„Ç≥„É≥„Éà„É≠„Éº„É©„Éº„ÅåÊäº„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆÊñπÂêëËª¢ÊèõÂà§ÂÆö
  189  01:C363            .notpushed:
  190                                             ;Áõ¥ÈÄ≤ÂèØËÉΩ„Å™„Çâ„Åù„ÅÆ„Åæ„ÅæÈÄ≤„ÇÄ
  191  01:C363  A5 05         lda     <.tmp_fldv
  192  01:C365  34 22         bit     <zpldir,x
  193  01:C367  D0 17         bne     .notchanged
  194                                             ;Áõ¥ÈÄ≤„Å®ÂæåÈÄÄ‰ª•Â§ñ„ÅÆÁßªÂãïÂèØËÉΩÊñπÂêëÔºü
  195  01:C369  4A            lsr     a
  196  01:C36A  4A            lsr     a
  197  01:C36B  4A            lsr     a
  198  01:C36C  4A            lsr     a
  199  01:C36D  A8            tay
  200  01:C36E  B9 A5 C3      lda     .DirCountTbl,y
  201                                             ;Áõ¥Ëßí
  202  01:C371  C9 02         cmp     #2
  203  01:C373  F0 04         beq     .dc2
  204                                             ;„Åì„ÅÆÊôÇÁÇπ„ÅßÁßªÂãïÂèØËÉΩÊñπÂêë„ÅØ3‰ª•Â§ñ„ÅØ„ÅÇ„Çä„Åà„Å™„ÅÑ
  205                                             ;Áõ¥ÈÄ≤„Åß„Åç„Å™„ÅÑ„ÅÆ„ÅßÁßªÂãïÂèØËÉΩÊñπÂêë„ÅØ1,2,3„ÅÆ„ÅÑ„Åö„Çå„Åã
  206                                             ;2„ÅÆÂ†¥Âêà„ÅØÂàÜÂ≤ê„Åó„Å¶„Åä„Çä„ÄÅ1Ôºà„Å§„Åæ„ÇäË°å„ÅçÊ≠¢„Åæ„ÇäÔºâ„ÅØÂ≠òÂú®„Åó„Å™„ÅÑ
  207                                             ;„Çà„Å£„Å¶3„ÅÆ„ÅøÔºà„Å§„Åæ„Çä‰∏ÅÂ≠óË∑Ø„ÅßÁõ¥ÈÄ≤ÊñπÂêë„ÅåÂ°û„Åå„Å£„Å¶„ÅÑ„ÇãÁä∂ÊÖãÔºâ
  208                     ;    cmp     #3
  209                     ;    bne     .notchanged
  210  01:C375  38            sec                 ;‰∏ÅÂ≠óË∑Ø„ÅÆÂ†¥Âêà„ÅØ‰∏ÄÊôÇÂÅúÊ≠¢
  211  01:C376  64 03         stz <.tmp_dead_flg  ;Ê≠ª„Çì„Åß„ÅÑ„Å™„ÅÑ
  212  01:C378  60            rts
  213                                             ;Áõ¥Ëßí„Å´Êõ≤„Åå„Çã
  214  01:C379            .dc2:
  215  01:C379  A5 05         lda     <.tmp_fldv
  216  01:C37B  55 24         eor     <zpldirr,x  ;2ÊñπÂêë„ÅÆ„ÅÜ„Å°ÈÄ≤Ë°åÊñπÂêë„ÅÆÈÄÜ„ÇíÊâì„Å°Ê∂à„Åó„Å¶ÊÆã„Å£„ÅüÊñπÂêë„ÅåÈÄ≤„ÇÄ„Åπ„ÅçÊñπÂêë
  217                     
  218                                             ;ÈÄ≤Ë°åÊñπÂêë„ÇíÂ§âÊõ¥
  219  01:C37D            .changed:
  220  01:C37D  20 F1 C2      jsr     plSetDir
  221  01:C380            .notchanged:
  222                     
  223  01:C380            .draw:
  224                                             ;ËÉ¥‰Ωì
  225                                             ;„Éï„Ç£„Éº„É´„Éâ„Å´ËÉ¥‰Ωì„Éï„É©„Ç∞„Çí„Çª„ÉÉ„Éà
  226  01:C380  A9 0F         lda #$0f
  227  01:C382  14 05         trb <.tmp_fldv
  228  01:C384  B5 22         lda <zpldir,x
  229  01:C386  4A            lsr a
  230  01:C387  4A            lsr a
  231  01:C388  4A            lsr a
  232  01:C389  4A            lsr a
  233  01:C38A  05 05         ora <.tmp_fldv
  234  01:C38C  92 0C         sta [.tmp_fldadr_l]
  235                                             ;ÊèèÁîª
  236                                             ;TODO: ÁßªÂãïÊñπÂêë„Å´Âêà„Çè„Åõ„Å¶„Çø„Ç§„É´„ÇíÂ§â„Åà„Çã
  237  01:C38E  A9 B5         lda #LOW(BodyPartsTiles)
  238  01:C390  85 0C         sta <zarg2
  239  01:C392  A9 C3         lda #HIGH(BodyPartsTiles)
  240  01:C394  85 0D         sta <zarg3
  241  01:C396  A9 01         lda #1
  242  01:C398  85 0E         sta <zarg4
  243  01:C39A  20 01 C7      jsr vqPush
  244                     
  245  01:C39D  18            clc                 ;ÊåáÂÆöÊñπÂêë„Å´ÈÄ≤Ë°å
  246  01:C39E  60            rts
  247                     
  248                                             ;Ê≠ª‰∫°
  249                                             ;TODO: Ê≠ª‰∫°ÊôÇ„ÅÆÂá¶ÁêÜ„ÇíÂÆüË£Ö
  250  01:C39F            .dead:
  251  01:C39F  A9 01         lda #1
  252  01:C3A1  85 03         sta <.tmp_dead_flg  ;Ê≠ª„Çì„Å†
  253  01:C3A3  38            sec
  254  01:C3A4  60            rts
  255                     ;
  256                     ;       ÁßªÂãïÂèØËÉΩÊñπÂêë„ÅÆÊï∞Ôºà„Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÂÄ§„ÅÆ„Çª„ÉÉ„Éà„Åï„Çå„Åü„Éì„ÉÉ„Éà„ÅÆÊï∞Ôºâ
  257                     ;
  258  01:C3A5            .DirCountTbl:
  259  01:C3A5  00 01 01      db      0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4
       01:C3A8  02 01 02  
       01:C3AB  02 03 01  
       01:C3AE  02 02 03  
       01:C3B1  02 03 03  
       01:C3B4  04        
  260                     
  261                     
  262                     
  263           1000      PatternAddress  equ $1000
  264  01:C3B5            BodyPartsTiles:
  265  01:C3B5  3E 01         dw  (PatternAddress+62*16)/16
  266                     
  267  01:C3B7            BlankPartsTiles:
  268  01:C3B7  30 01         dw  (PatternAddress+48*16)/16
  269                     
  270                     
  271                     ;
  272                     ;       „Éò„Éì„ÅÆÂ∞ªÂ∞æ„ÅÆÂãï„Åç
  273                     ;
  274                     ;       @args           x = „Ç≠„É£„É©„ÇØ„Çø„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  275                     ;       @saveregs       x
  276                     ;       @return         „Åù„ÅÆÂ†¥„ÅßÂÅúÊ≠¢„Åô„Åπ„ÅçÊôÇ„ÅØ cf=1
  277                     ;
  278  01:C3B9            plTailAction:
  279           200C      .tmp_fldadr_l   equ     zarg2       ;„Éï„Ç£„Éº„É´„Éâ„Ç¢„Éâ„É¨„Çπ
  280           200D      .tmp_fldadr_h   equ     zarg3
  281                     
  282                                             ;Â∞ªÂ∞æ„ÇíÂÅúÊ≠¢„Åï„Åõ„ÇãÊåáÁ§∫„ÅåÂá∫„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
  283  01:C3B9  A5 28         lda <zplTailStop
  284  01:C3BB  D0 2C         bne .notmove
  285                     
  286                                             ;„Ç∞„É™„ÉÉ„Éâ„ÅÆ‰∏≠Èñì„Å´„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
  287  01:C3BD  B5 1E         lda <zplx,x
  288  01:C3BF  15 20         ora <zply,x
  289  01:C3C1  29 07         and #$07
  290  01:C3C3  F0 02         beq .move
  291  01:C3C5  18            clc
  292  01:C3C6  60            rts
  293                     
  294  01:C3C7            .move:
  295  01:C3C7  20 02 C3      jsr plGetBatFldAdr
  296                                             ;„Éï„Ç£„Éº„É´„Éâ‰∏ä„ÅÆÁèæÂú®‰ΩçÁΩÆ„ÅÆÂÄ§
  297                                             ;È†≠„ÅåÁßªÂãï„Åó„ÅüÊñπÂêë„ÇíÂ∞ªÂ∞æ„ÅÆÁßªÂãïÊñπÂêë„Å®„Åô„Çã
  298  01:C3CA  B2 0C         lda [.tmp_fldadr_l]
  299  01:C3CC  48            pha
  300  01:C3CD  0A            asl a
  301  01:C3CE  0A            asl a
  302  01:C3CF  0A            asl a
  303  01:C3D0  0A            asl a
  304  01:C3D1  95 22         sta <zpldir,x
  305                                             ;È†≠„ÅåÁßªÂãï„Åó„ÅüÊñπÂêë„Çí„ÇØ„É™„Ç¢
  306  01:C3D3  68            pla
  307  01:C3D4  29 F0         and #$f0
  308  01:C3D6  92 0C         sta [.tmp_fldadr_l]
  309                     
  310                                             ;ÊèèÁîª
  311  01:C3D8  A9 B7         lda #LOW(BlankPartsTiles)
  312  01:C3DA  85 0C         sta <zarg2
  313  01:C3DC  A9 C3         lda #HIGH(BlankPartsTiles)
  314  01:C3DE  85 0D         sta <zarg3
  315  01:C3E0  A9 01         lda #1
  316  01:C3E2  85 0E         sta <zarg4
  317  01:C3E4  20 01 C7      jsr vqPush
  318                     
  319  01:C3E7  18            clc
  320  01:C3E8  60            rts
  321                     
  322  01:C3E9            .notmove:
  323  01:C3E9  38            sec
  324  01:C3EA  60            rts
  325                     
  326                     
  327                     
  328                     
  329                     ;       ÁßªÂãï
  330                     ;       @args           x = „Ç≠„É£„É©„ÇØ„Çø„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  331                     ;       @saveregs       x,y
  332                     ;       @return         „Å™„Åó
  333  01:C3EB            plMove:
  334  01:C3EB  B5 22         lda     <zpldir,x         ;bits of zpldir = LDRU----
  335  01:C3ED  0A            asl     a
  336  01:C3EE  B0 11         bcs     .moveleft
  337  01:C3F0  0A            asl     a
  338  01:C3F1  B0 17         bcs     .movedown
  339  01:C3F3  0A            asl     a
  340  01:C3F4  B0 1D         bcs     .moveright
  341  01:C3F6  10 22         bpl     .notmove
  342  01:C3F8            .moveup:
  343  01:C3F8  B5 20         lda     <zply,x
  344  01:C3FA  38            sec
  345  01:C3FB  F5 26         sbc     <zplspeed,x
  346  01:C3FD  95 20         sta     <zply,x
  347  01:C3FF  80 19         bra     .moved
  348  01:C401            .moveleft:
  349  01:C401  B5 1E         lda     <zplx,x
  350  01:C403  38            sec
  351  01:C404  F5 26         sbc     <zplspeed,x
  352  01:C406  95 1E         sta     <zplx,x
  353  01:C408  80 10         bra     .moved
  354  01:C40A            .movedown:
  355  01:C40A  B5 20         lda     <zply,x
  356  01:C40C  18            clc
  357  01:C40D  75 26         adc     <zplspeed,x
  358  01:C40F  95 20         sta     <zply,x
  359  01:C411  80 07         bra     .moved
  360  01:C413            .moveright:
  361  01:C413  B5 1E         lda     <zplx,x
  362  01:C415  18            clc
  363  01:C416  75 26         adc     <zplspeed,x
  364  01:C418  95 1E         sta     <zplx,x
  365  01:C41A            .notmove:
  366  01:C41A            .moved:
  367                                             ;„Çπ„Éó„É©„Ç§„ÉàÂ∫ßÊ®ôË®≠ÂÆö
  368  01:C41A  8A            txa
  369  01:C41B  0A            asl a
  370  01:C41C  0A            asl a
  371  01:C41D  0A            asl a
  372  01:C41E  A8            tay
  373                     
  374  01:C41F  B5 1E         lda     <zplx,x
  375  01:C421  18            clc
  376  01:C422  69 1C         adc     #$20-4
  377  01:C424  99 02 22      sta     satb+2,y
  378  01:C427  62            cla
  379  01:C428  99 03 22      sta     satb+3,y
  380                     
  381  01:C42B  B5 20         lda     <zply,x
  382  01:C42D  18            clc
  383  01:C42E  69 4C         adc     #$40-4+16   ;+16 „ÅØ„Çπ„ÇØ„É≠„Éº„É´„Ç´„Ç¶„É≥„Çø„ÅÆÂ∑ÆÂàÜ
  384  01:C430  99 00 22      sta     satb+0,y
  385  01:C433  A9 00         lda     #0
  386  01:C435  69 00         adc     #0
  387  01:C437  99 01 22      sta     satb+1,y
  388                     
  389  01:C43A  60            rts
  390                     
  391                     
  392                     ;
  393                     ;   task test
  394                     ;
  395  01:C43B            plTask:
  396           2003      .tmp_dead_flg   equ ztmp0
  397                     
  398                                         ;È†≠
  399  01:C43B  82                clx
  400  01:C43C  20 25 C3          jsr     plHeadAction
  401  01:C43F  B0 0F             bcs     .skipmove
  402  01:C441  20 EB C3          jsr     plMove
  403                                         ;Â∞ªÂ∞æ
  404  01:C444  A2 01         ldx #1
  405  01:C446  20 B9 C3      jsr plTailAction
  406  01:C449  B0 0A         bcs .yield
  407  01:C44B  20 EB C3      jsr plMove
  408  01:C44E  80 05         bra .yield
  409                     
  410  01:C450            .skipmove:
  411  01:C450  83 FF 03      tst #$ff,<.tmp_dead_flg
  412  01:C453  D0 09         bne .dead
  413                     
  414  01:C455            .yield:
  415  01:C455  A5 15         lda <zdotnum
  416  01:C457  F0 12         beq .clear
  417                     
  418  01:C459  20 5D C2      jsr tkYield
  419  01:C45C  80 DD         bra plTask
  420                     
  421  01:C45E            .dead:
  422                                         ;TODO: Ê≠ª‰∫°ÊôÇ„ÅÆÂá¶ÁêÜ
  423                                         ;„Çø„Çπ„ÇØ„ÅÆÂá¶ÁêÜ„ÅÆÂ§âÊõ¥„ÅØ„ÄÅplTask„ÅÆ‰∏≠„Åã„ÇâÂëº„Å≥Âá∫„Åï„Å™„ÅÑ„Å®„Å†„ÇÅÔºàsp„ÅåÂ§â„Çè„Å£„Å¶„Åó„Åæ„Å£„Å¶„
  424  01:C45E  64 28         stz <zplTailStop
  425                     
  426  01:C460  A9 75         lda #LOW(plDeadTask-1)
  427  01:C462  85 0A         sta <zarg0
  428  01:C464  A9 C4         lda #HIGH(plDeadTask-1)
  429  01:C466  85 0B         sta <zarg1
  430  01:C468  20 89 C2      jsr tkLink
  431                     
  432  01:C46B            .clear:
  433                             tkChangeTask_   tklClearWave
                          ;    .if tklClearWave=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C46B  A9 B4         lda #LOW(tklClearWave)
       01:C46D  85 1C         sta <ztkChgTask
       01:C46F  A9 C2         lda #HIGH(tklClearWave)
       01:C471  85 1D         sta <ztkChgTask+1
                          ;    .endif
  434  01:C473  20 5D C2      jsr tkYield
  435                     
  436                     
  437                     ;
  438                     ;   Ëá™ÂàÜ„ÅÆËÉ¥‰Ωì„ÇíÂôõ„Çì„Å†ÊôÇ„ÅÆÂá¶ÁêÜ
  439                     ;
  440                     ;   TODO:
  441                     
  442  01:C476            plDeadTask:
  443  01:C476  A2 01         ldx #1
  444  01:C478  20 B9 C3      jsr plTailAction
  445  01:C47B  B5 22         lda <zpldir,x
  446  01:C47D  F0 08         beq .over
  447  01:C47F  20 EB C3      jsr plMove
  448  01:C482  20 5D C2      jsr tkYield
  449  01:C485  80 EF         bra plDeadTask
  450                     
  451  01:C487            .over:
  452                             tkChangeTask_   tklInitWave
                          ;    .if tklInitWave=0
                          ;    stz <ztkChgTask
                          ;    stz <ztkChgTask+1
                          ;    .else
       01:C487  A9 A6         lda #LOW(tklInitWave)
       01:C489  85 1C         sta <ztkChgTask
       01:C48B  A9 C2         lda #HIGH(tklInitWave)
       01:C48D  85 1D         sta <ztkChgTask+1
                          ;    .endif
  453  01:C48F  20 5D C2      jsr tkYield
  454                     ;    lda #LOW(tkDummyTask-1)
  455                     ;    sta <zarg0
  456                     ;    lda #HIGH(tkDummyTask-1)
  457                     ;    sta <zarg1
  458                     ;    jsr tkLink
#[1]   nibbler.asm
   18                     ;        .include "pbullet.asm"
   19                     ;        .include "direction.asm"
   20                     ;        .include "enemy.asm"
   21                     ;        .include "ebullet.asm"
   22                     ;        .include "collision.asm"
   23                     ;        .include "effect.asm"
   24                      ;       .include        "sprpattern.asm"
   25                     
#[2]   bgpattern.asm
   26                             .include "bgpattern.asm"
    1           C492              .code
    2                     ;        .bank   MAIN_BANK+3
    3           0004          .bank   BGPATTERN_BANK
    4           4000              .org    $4000
    5                     
    6  04:4000            BgPattern:
    7                     
    8                     ;
    9                     ;   „Éï„Ç©„É≥„Éà 0-9,A-Z ,
   10                     ;
   11  04:4000            bp_font_0:
   12  04:4000  38 00         db  %00111000,0
   13  04:4002  4C 00         db  %01001100,0
   14  04:4004  C6 00         db  %11000110,0
   15  04:4006  C6 00         db  %11000110,0
   16  04:4008  C6 00         db  %11000110,0
   17  04:400A  64 00         db  %01100100,0
   18  04:400C  38 00         db  %00111000,0
   19  04:400E  00 00         db  %00000000,0
   20  04:4010  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4012  00 00     
       04:4014  00 00     
       04:4016  00 00     
       04:4018  00 00     
       04:401A  00 00     
       04:401C  00 00     
       04:401E  00 00     
   21                     
   22  04:4020            bp_font_1:
   23  04:4020  30 00         db  %00110000,0
   24  04:4022  70 00         db  %01110000,0
   25  04:4024  30 00         db  %00110000,0
   26  04:4026  30 00         db  %00110000,0
   27  04:4028  30 00         db  %00110000,0
   28  04:402A  30 00         db  %00110000,0
   29  04:402C  FC 00         db  %11111100,0
   30  04:402E  00 00         db  %00000000,0
   31  04:4030  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4032  00 00     
       04:4034  00 00     
       04:4036  00 00     
       04:4038  00 00     
       04:403A  00 00     
       04:403C  00 00     
       04:403E  00 00     
   32                     
   33  04:4040            bp_font_2:
   34  04:4040  7C 00         db  %01111100,0
   35  04:4042  C6 00         db  %11000110,0
   36  04:4044  0E 00         db  %00001110,0
   37  04:4046  3C 00         db  %00111100,0
   38  04:4048  78 00         db  %01111000,0
   39  04:404A  E0 00         db  %11100000,0
   40  04:404C  FE 00         db  %11111110,0
   41  04:404E  00 00         db  %00000000,0
   42  04:4050  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4052  00 00     
       04:4054  00 00     
       04:4056  00 00     
       04:4058  00 00     
       04:405A  00 00     
       04:405C  00 00     
       04:405E  00 00     
   43                     
   44  04:4060            bp_font_3:
   45  04:4060  FE 00         db  %11111110,0
   46  04:4062  0C 00         db  %00001100,0
   47  04:4064  18 00         db  %00011000,0
   48  04:4066  3C 00         db  %00111100,0
   49  04:4068  06 00         db  %00000110,0
   50  04:406A  C6 00         db  %11000110,0
   51  04:406C  7C 00         db  %01111100,0
   52  04:406E  00 00         db  %00000000,0
   53  04:4070  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4072  00 00     
       04:4074  00 00     
       04:4076  00 00     
       04:4078  00 00     
       04:407A  00 00     
       04:407C  00 00     
       04:407E  00 00     
   54                     
   55  04:4080            bp_font_4:
   56  04:4080  1C 00         db  %00011100,0
   57  04:4082  3C 00         db  %00111100,0
   58  04:4084  6C 00         db  %01101100,0
   59  04:4086  CC 00         db  %11001100,0
   60  04:4088  FE 00         db  %11111110,0
   61  04:408A  0C 00         db  %00001100,0
   62  04:408C  0C 00         db  %00001100,0
   63  04:408E  00 00         db  %00000000,0
   64  04:4090  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4092  00 00     
       04:4094  00 00     
       04:4096  00 00     
       04:4098  00 00     
       04:409A  00 00     
       04:409C  00 00     
       04:409E  00 00     
   65                     
   66  04:40A0            bp_font_5:
   67  04:40A0  FC 00         db  %11111100,0
   68  04:40A2  C0 00         db  %11000000,0
   69  04:40A4  FC 00         db  %11111100,0
   70  04:40A6  06 00         db  %00000110,0
   71  04:40A8  06 00         db  %00000110,0
   72  04:40AA  C6 00         db  %11000110,0
   73  04:40AC  7C 00         db  %01111100,0
   74  04:40AE  00 00         db  %00000000,0
   75  04:40B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:40B2  00 00     
       04:40B4  00 00     
       04:40B6  00 00     
       04:40B8  00 00     
       04:40BA  00 00     
       04:40BC  00 00     
       04:40BE  00 00     
   76                     
   77  04:40C0            bp_font_6:
   78  04:40C0  3C 00         db  %00111100,0
   79  04:40C2  60 00         db  %01100000,0
   80  04:40C4  C0 00         db  %11000000,0
   81  04:40C6  FC 00         db  %11111100,0
   82  04:40C8  C6 00         db  %11000110,0
   83  04:40CA  C6 00         db  %11000110,0
   84  04:40CC  7C 00         db  %01111100,0
   85  04:40CE  00 00         db  %00000000,0
   86  04:40D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:40D2  00 00     
       04:40D4  00 00     
       04:40D6  00 00     
       04:40D8  00 00     
       04:40DA  00 00     
       04:40DC  00 00     
       04:40DE  00 00     
   87                     
   88  04:40E0            bp_font_7:
   89  04:40E0  FE 00         db  %11111110,0
   90  04:40E2  C6 00         db  %11000110,0
   91  04:40E4  0C 00         db  %00001100,0
   92  04:40E6  18 00         db  %00011000,0
   93  04:40E8  30 00         db  %00110000,0
   94  04:40EA  30 00         db  %00110000,0
   95  04:40EC  30 00         db  %00110000,0
   96  04:40EE  00 00         db  %00000000,0
   97  04:40F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:40F2  00 00     
       04:40F4  00 00     
       04:40F6  00 00     
       04:40F8  00 00     
       04:40FA  00 00     
       04:40FC  00 00     
       04:40FE  00 00     
   98                     
   99  04:4100            bp_font_8:
  100  04:4100  78 00         db  %01111000,0
  101  04:4102  C4 00         db  %11000100,0
  102  04:4104  E4 00         db  %11100100,0
  103  04:4106  78 00         db  %01111000,0
  104  04:4108  9E 00         db  %10011110,0
  105  04:410A  86 00         db  %10000110,0
  106  04:410C  7C 00         db  %01111100,0
  107  04:410E  00 00         db  %00000000,0
  108  04:4110  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4112  00 00     
       04:4114  00 00     
       04:4116  00 00     
       04:4118  00 00     
       04:411A  00 00     
       04:411C  00 00     
       04:411E  00 00     
  109                     
  110  04:4120            bp_font_9:
  111  04:4120  7C 00         db  %01111100,0
  112  04:4122  C6 00         db  %11000110,0
  113  04:4124  C6 00         db  %11000110,0
  114  04:4126  7E 00         db  %01111110,0
  115  04:4128  06 00         db  %00000110,0
  116  04:412A  0C 00         db  %00001100,0
  117  04:412C  78 00         db  %01111000,0
  118  04:412E  00 00         db  %00000000,0
  119  04:4130  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4132  00 00     
       04:4134  00 00     
       04:4136  00 00     
       04:4138  00 00     
       04:413A  00 00     
       04:413C  00 00     
       04:413E  00 00     
  120                     
  121  04:4140            bp_font_A:
  122  04:4140  38 00         db  %00111000,0
  123  04:4142  6C 00         db  %01101100,0
  124  04:4144  C6 00         db  %11000110,0
  125  04:4146  C6 00         db  %11000110,0
  126  04:4148  FE 00         db  %11111110,0
  127  04:414A  C6 00         db  %11000110,0
  128  04:414C  C6 00         db  %11000110,0
  129  04:414E  00 00         db  %00000000,0
  130  04:4150  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4152  00 00     
       04:4154  00 00     
       04:4156  00 00     
       04:4158  00 00     
       04:415A  00 00     
       04:415C  00 00     
       04:415E  00 00     
  131                     
  132  04:4160            bp_font_B:
  133  04:4160  FC 00         db  %11111100,0
  134  04:4162  C6 00         db  %11000110,0
  135  04:4164  C6 00         db  %11000110,0
  136  04:4166  FC 00         db  %11111100,0
  137  04:4168  C6 00         db  %11000110,0
  138  04:416A  C6 00         db  %11000110,0
  139  04:416C  FC 00         db  %11111100,0
  140  04:416E  00 00         db  %00000000,0
  141  04:4170  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4172  00 00     
       04:4174  00 00     
       04:4176  00 00     
       04:4178  00 00     
       04:417A  00 00     
       04:417C  00 00     
       04:417E  00 00     
  142                     
  143  04:4180            bp_font_C:
  144  04:4180  3C 00         db  %00111100,0
  145  04:4182  66 00         db  %01100110,0
  146  04:4184  C0 00         db  %11000000,0
  147  04:4186  C0 00         db  %11000000,0
  148  04:4188  C0 00         db  %11000000,0
  149  04:418A  66 00         db  %01100110,0
  150  04:418C  3C 00         db  %00111100,0
  151  04:418E  00 00         db  %00000000,0
  152  04:4190  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4192  00 00     
       04:4194  00 00     
       04:4196  00 00     
       04:4198  00 00     
       04:419A  00 00     
       04:419C  00 00     
       04:419E  00 00     
  153                     
  154  04:41A0            bp_font_D:
  155  04:41A0  F8 00         db  %11111000,0
  156  04:41A2  CC 00         db  %11001100,0
  157  04:41A4  C6 00         db  %11000110,0
  158  04:41A6  C6 00         db  %11000110,0
  159  04:41A8  C6 00         db  %11000110,0
  160  04:41AA  CC 00         db  %11001100,0
  161  04:41AC  F8 00         db  %11111000,0
  162  04:41AE  00 00         db  %00000000,0
  163  04:41B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:41B2  00 00     
       04:41B4  00 00     
       04:41B6  00 00     
       04:41B8  00 00     
       04:41BA  00 00     
       04:41BC  00 00     
       04:41BE  00 00     
  164                     
  165  04:41C0            bp_font_E:
  166  04:41C0  FC 00         db  %11111100,0
  167  04:41C2  C0 00         db  %11000000,0
  168  04:41C4  C0 00         db  %11000000,0
  169  04:41C6  F8 00         db  %11111000,0
  170  04:41C8  C0 00         db  %11000000,0
  171  04:41CA  C0 00         db  %11000000,0
  172  04:41CC  FC 00         db  %11111100,0
  173  04:41CE  00 00         db  %00000000,0
  174  04:41D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:41D2  00 00     
       04:41D4  00 00     
       04:41D6  00 00     
       04:41D8  00 00     
       04:41DA  00 00     
       04:41DC  00 00     
       04:41DE  00 00     
  175                     
  176  04:41E0            bp_font_F:
  177  04:41E0  FC 00         db  %11111100,0
  178  04:41E2  C0 00         db  %11000000,0
  179  04:41E4  C0 00         db  %11000000,0
  180  04:41E6  F8 00         db  %11111000,0
  181  04:41E8  C0 00         db  %11000000,0
  182  04:41EA  C0 00         db  %11000000,0
  183  04:41EC  C0 00         db  %11000000,0
  184  04:41EE  00 00         db  %00000000,0
  185  04:41F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:41F2  00 00     
       04:41F4  00 00     
       04:41F6  00 00     
       04:41F8  00 00     
       04:41FA  00 00     
       04:41FC  00 00     
       04:41FE  00 00     
  186                     
  187  04:4200            bp_font_G:
  188  04:4200  3E 00         db  %00111110,0
  189  04:4202  60 00         db  %01100000,0
  190  04:4204  C0 00         db  %11000000,0
  191  04:4206  CE 00         db  %11001110,0
  192  04:4208  C6 00         db  %11000110,0
  193  04:420A  66 00         db  %01100110,0
  194  04:420C  3E 00         db  %00111110,0
  195  04:420E  00 00         db  %00000000,0
  196  04:4210  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4212  00 00     
       04:4214  00 00     
       04:4216  00 00     
       04:4218  00 00     
       04:421A  00 00     
       04:421C  00 00     
       04:421E  00 00     
  197                     
  198  04:4220            bp_font_H:
  199  04:4220  C6 00         db  %11000110,0
  200  04:4222  C6 00         db  %11000110,0
  201  04:4224  C6 00         db  %11000110,0
  202  04:4226  FE 00         db  %11111110,0
  203  04:4228  C6 00         db  %11000110,0
  204  04:422A  C6 00         db  %11000110,0
  205  04:422C  C6 00         db  %11000110,0
  206  04:422E  00 00         db  %00000000,0
  207  04:4230  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4232  00 00     
       04:4234  00 00     
       04:4236  00 00     
       04:4238  00 00     
       04:423A  00 00     
       04:423C  00 00     
       04:423E  00 00     
  208                     
  209  04:4240            bp_font_I:
  210  04:4240  FC 00         db  %11111100,0
  211  04:4242  30 00         db  %00110000,0
  212  04:4244  30 00         db  %00110000,0
  213  04:4246  30 00         db  %00110000,0
  214  04:4248  30 00         db  %00110000,0
  215  04:424A  30 00         db  %00110000,0
  216  04:424C  FC 00         db  %11111100,0
  217  04:424E  00 00         db  %00000000,0
  218  04:4250  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4252  00 00     
       04:4254  00 00     
       04:4256  00 00     
       04:4258  00 00     
       04:425A  00 00     
       04:425C  00 00     
       04:425E  00 00     
  219                     
  220  04:4260            bp_font_J:
  221  04:4260  06 00         db  %00000110,0
  222  04:4262  06 00         db  %00000110,0
  223  04:4264  06 00         db  %00000110,0
  224  04:4266  06 00         db  %00000110,0
  225  04:4268  06 00         db  %00000110,0
  226  04:426A  C6 00         db  %11000110,0
  227  04:426C  7C 00         db  %01111100,0
  228  04:426E  00 00         db  %00000000,0
  229  04:4270  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4272  00 00     
       04:4274  00 00     
       04:4276  00 00     
       04:4278  00 00     
       04:427A  00 00     
       04:427C  00 00     
       04:427E  00 00     
  230                     
  231  04:4280            bp_font_K:
  232  04:4280  C6 00         db  %11000110,0
  233  04:4282  CC 00         db  %11001100,0
  234  04:4284  D8 00         db  %11011000,0
  235  04:4286  F0 00         db  %11110000,0
  236  04:4288  F8 00         db  %11111000,0
  237  04:428A  DC 00         db  %11011100,0
  238  04:428C  CE 00         db  %11001110,0
  239  04:428E  00 00         db  %00000000,0
  240  04:4290  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4292  00 00     
       04:4294  00 00     
       04:4296  00 00     
       04:4298  00 00     
       04:429A  00 00     
       04:429C  00 00     
       04:429E  00 00     
  241                     
  242  04:42A0            bp_font_L:
  243  04:42A0  C0 00         db  %11000000,0
  244  04:42A2  C0 00         db  %11000000,0
  245  04:42A4  C0 00         db  %11000000,0
  246  04:42A6  C0 00         db  %11000000,0
  247  04:42A8  C0 00         db  %11000000,0
  248  04:42AA  C0 00         db  %11000000,0
  249  04:42AC  FE 00         db  %11111110,0
  250  04:42AE  00 00         db  %00000000,0
  251  04:42B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:42B2  00 00     
       04:42B4  00 00     
       04:42B6  00 00     
       04:42B8  00 00     
       04:42BA  00 00     
       04:42BC  00 00     
       04:42BE  00 00     
  252                     
  253  04:42C0            bp_font_M:
  254  04:42C0  C6 00         db  %11000110,0
  255  04:42C2  EE 00         db  %11101110,0
  256  04:42C4  FE 00         db  %11111110,0
  257  04:42C6  FE 00         db  %11111110,0
  258  04:42C8  D6 00         db  %11010110,0
  259  04:42CA  C6 00         db  %11000110,0
  260  04:42CC  C6 00         db  %11000110,0
  261  04:42CE  00 00         db  %00000000,0
  262  04:42D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:42D2  00 00     
       04:42D4  00 00     
       04:42D6  00 00     
       04:42D8  00 00     
       04:42DA  00 00     
       04:42DC  00 00     
       04:42DE  00 00     
  263                     
  264  04:42E0            bp_font_N:
  265  04:42E0  C6 00         db  %11000110,0
  266  04:42E2  E6 00         db  %11100110,0
  267  04:42E4  F6 00         db  %11110110,0
  268  04:42E6  FE 00         db  %11111110,0
  269  04:42E8  DE 00         db  %11011110,0
  270  04:42EA  CE 00         db  %11001110,0
  271  04:42EC  C6 00         db  %11000110,0
  272  04:42EE  00 00         db  %00000000,0
  273  04:42F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:42F2  00 00     
       04:42F4  00 00     
       04:42F6  00 00     
       04:42F8  00 00     
       04:42FA  00 00     
       04:42FC  00 00     
       04:42FE  00 00     
  274                     
  275  04:4300            bp_font_O:
  276  04:4300  7C 00         db  %01111100,0
  277  04:4302  C6 00         db  %11000110,0
  278  04:4304  C6 00         db  %11000110,0
  279  04:4306  C6 00         db  %11000110,0
  280  04:4308  C6 00         db  %11000110,0
  281  04:430A  C6 00         db  %11000110,0
  282  04:430C  7C 00         db  %01111100,0
  283  04:430E  00 00         db  %00000000,0
  284  04:4310  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4312  00 00     
       04:4314  00 00     
       04:4316  00 00     
       04:4318  00 00     
       04:431A  00 00     
       04:431C  00 00     
       04:431E  00 00     
  285                     
  286  04:4320            bp_font_P:
  287  04:4320  FC 00         db  %11111100,0
  288  04:4322  C6 00         db  %11000110,0
  289  04:4324  C6 00         db  %11000110,0
  290  04:4326  C6 00         db  %11000110,0
  291  04:4328  FC 00         db  %11111100,0
  292  04:432A  C0 00         db  %11000000,0
  293  04:432C  C0 00         db  %11000000,0
  294  04:432E  00 00         db  %00000000,0
  295  04:4330  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4332  00 00     
       04:4334  00 00     
       04:4336  00 00     
       04:4338  00 00     
       04:433A  00 00     
       04:433C  00 00     
       04:433E  00 00     
  296                     
  297  04:4340            bp_font_Q:
  298  04:4340  7C 00         db  %01111100,0
  299  04:4342  C6 00         db  %11000110,0
  300  04:4344  C6 00         db  %11000110,0
  301  04:4346  C6 00         db  %11000110,0
  302  04:4348  DE 00         db  %11011110,0
  303  04:434A  CC 00         db  %11001100,0
  304  04:434C  7A 00         db  %01111010,0
  305  04:434E  00 00         db  %00000000,0
  306  04:4350  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4352  00 00     
       04:4354  00 00     
       04:4356  00 00     
       04:4358  00 00     
       04:435A  00 00     
       04:435C  00 00     
       04:435E  00 00     
  307                     
  308  04:4360            bp_font_R:
  309  04:4360  FC 00         db  %11111100,0
  310  04:4362  C6 00         db  %11000110,0
  311  04:4364  C6 00         db  %11000110,0
  312  04:4366  CE 00         db  %11001110,0
  313  04:4368  F8 00         db  %11111000,0
  314  04:436A  DC 00         db  %11011100,0
  315  04:436C  CE 00         db  %11001110,0
  316  04:436E  00 00         db  %00000000,0
  317  04:4370  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4372  00 00     
       04:4374  00 00     
       04:4376  00 00     
       04:4378  00 00     
       04:437A  00 00     
       04:437C  00 00     
       04:437E  00 00     
  318                     
  319  04:4380            bp_font_S:
  320  04:4380  7C 00         db  %01111100,0
  321  04:4382  C6 00         db  %11000110,0
  322  04:4384  C0 00         db  %11000000,0
  323  04:4386  7C 00         db  %01111100,0
  324  04:4388  06 00         db  %00000110,0
  325  04:438A  C6 00         db  %11000110,0
  326  04:438C  7C 00         db  %01111100,0
  327  04:438E  00 00         db  %00000000,0
  328  04:4390  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4392  00 00     
       04:4394  00 00     
       04:4396  00 00     
       04:4398  00 00     
       04:439A  00 00     
       04:439C  00 00     
       04:439E  00 00     
  329                     
  330  04:43A0            bp_font_T:
  331  04:43A0  FC 00         db  %11111100,0
  332  04:43A2  30 00         db  %00110000,0
  333  04:43A4  30 00         db  %00110000,0
  334  04:43A6  30 00         db  %00110000,0
  335  04:43A8  30 00         db  %00110000,0
  336  04:43AA  30 00         db  %00110000,0
  337  04:43AC  30 00         db  %00110000,0
  338  04:43AE  00 00         db  %00000000,0
  339  04:43B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:43B2  00 00     
       04:43B4  00 00     
       04:43B6  00 00     
       04:43B8  00 00     
       04:43BA  00 00     
       04:43BC  00 00     
       04:43BE  00 00     
  340                     
  341  04:43C0            bp_font_U:
  342  04:43C0  C6 00         db  %11000110,0
  343  04:43C2  C6 00         db  %11000110,0
  344  04:43C4  C6 00         db  %11000110,0
  345  04:43C6  C6 00         db  %11000110,0
  346  04:43C8  C6 00         db  %11000110,0
  347  04:43CA  C6 00         db  %11000110,0
  348  04:43CC  7C 00         db  %01111100,0
  349  04:43CE  00 00         db  %00000000,0
  350  04:43D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:43D2  00 00     
       04:43D4  00 00     
       04:43D6  00 00     
       04:43D8  00 00     
       04:43DA  00 00     
       04:43DC  00 00     
       04:43DE  00 00     
  351                     
  352  04:43E0            bp_font_V:
  353  04:43E0  C6 00         db  %11000110,0
  354  04:43E2  C6 00         db  %11000110,0
  355  04:43E4  C6 00         db  %11000110,0
  356  04:43E6  EE 00         db  %11101110,0
  357  04:43E8  7C 00         db  %01111100,0
  358  04:43EA  38 00         db  %00111000,0
  359  04:43EC  10 00         db  %00010000,0
  360  04:43EE  00 00         db  %00000000,0
  361  04:43F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:43F2  00 00     
       04:43F4  00 00     
       04:43F6  00 00     
       04:43F8  00 00     
       04:43FA  00 00     
       04:43FC  00 00     
       04:43FE  00 00     
  362                     
  363  04:4400            bp_font_W:
  364  04:4400  C6 00         db  %11000110,0
  365  04:4402  C6 00         db  %11000110,0
  366  04:4404  D6 00         db  %11010110,0
  367  04:4406  FE 00         db  %11111110,0
  368  04:4408  FE 00         db  %11111110,0
  369  04:440A  EE 00         db  %11101110,0
  370  04:440C  C6 00         db  %11000110,0
  371  04:440E  00 00         db  %00000000,0
  372  04:4410  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4412  00 00     
       04:4414  00 00     
       04:4416  00 00     
       04:4418  00 00     
       04:441A  00 00     
       04:441C  00 00     
       04:441E  00 00     
  373                     
  374  04:4420            bp_font_X:
  375  04:4420  C6 00         db  %11000110,0
  376  04:4422  EE 00         db  %11101110,0
  377  04:4424  7C 00         db  %01111100,0
  378  04:4426  38 00         db  %00111000,0
  379  04:4428  7C 00         db  %01111100,0
  380  04:442A  EE 00         db  %11101110,0
  381  04:442C  C6 00         db  %11000110,0
  382  04:442E  00 00         db  %00000000,0
  383  04:4430  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4432  00 00     
       04:4434  00 00     
       04:4436  00 00     
       04:4438  00 00     
       04:443A  00 00     
       04:443C  00 00     
       04:443E  00 00     
  384                     
  385  04:4440            bp_font_Y:
  386  04:4440  CC 00         db  %11001100,0
  387  04:4442  CC 00         db  %11001100,0
  388  04:4444  CC 00         db  %11001100,0
  389  04:4446  78 00         db  %01111000,0
  390  04:4448  30 00         db  %00110000,0
  391  04:444A  30 00         db  %00110000,0
  392  04:444C  30 00         db  %00110000,0
  393  04:444E  00 00         db  %00000000,0
  394  04:4450  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4452  00 00     
       04:4454  00 00     
       04:4456  00 00     
       04:4458  00 00     
       04:445A  00 00     
       04:445C  00 00     
       04:445E  00 00     
  395                     
  396  04:4460            bp_font_Z:
  397  04:4460  FE 00         db  %11111110,0
  398  04:4462  0E 00         db  %00001110,0
  399  04:4464  1C 00         db  %00011100,0
  400  04:4466  38 00         db  %00111000,0
  401  04:4468  70 00         db  %01110000,0
  402  04:446A  E0 00         db  %11100000,0
  403  04:446C  FE 00         db  %11111110,0
  404  04:446E  00 00         db  %00000000,0
  405  04:4470  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4472  00 00     
       04:4474  00 00     
       04:4476  00 00     
       04:4478  00 00     
       04:447A  00 00     
       04:447C  00 00     
       04:447E  00 00     
  406                     
  407  04:4480            bp_font_comma:
  408  04:4480  00 00         db  %00000000,0
  409  04:4482  00 00         db  %00000000,0
  410  04:4484  00 00         db  %00000000,0
  411  04:4486  00 00         db  %00000000,0
  412  04:4488  00 00         db  %00000000,0
  413  04:448A  30 00         db  %00110000,0
  414  04:448C  30 00         db  %00110000,0
  415  04:448E  10 00         db  %00010000,0
  416  04:4490  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4492  00 00     
       04:4494  00 00     
       04:4496  00 00     
       04:4498  00 00     
       04:449A  00 00     
       04:449C  00 00     
       04:449E  00 00     
  417                     
  418  04:44A0            bp_font_player1_0:
  419  04:44A0  F4 00         db  %11110100,0
  420  04:44A2  94 00         db  %10010100,0
  421  04:44A4  F4 00         db  %11110100,0
  422  04:44A6  84 00         db  %10000100,0
  423  04:44A8  84 00         db  %10000100,0
  424  04:44AA  84 00         db  %10000100,0
  425  04:44AC  87 00         db  %10000111,0
  426  04:44AE  00 00         db  %00000000,0
  427  04:44B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:44B2  00 00     
       04:44B4  00 00     
       04:44B6  00 00     
       04:44B8  00 00     
       04:44BA  00 00     
       04:44BC  00 00     
       04:44BE  00 00     
  428                     
  429  04:44C0            bp_font_player1_1:
  430  04:44C0  25 00         db  %00100101,0
  431  04:44C2  55 00         db  %01010101,0
  432  04:44C4  55 00         db  %01010101,0
  433  04:44C6  72 00         db  %01110010,0
  434  04:44C8  52 00         db  %01010010,0
  435  04:44CA  52 00         db  %01010010,0
  436  04:44CC  52 00         db  %01010010,0
  437  04:44CE  00 00         db  %00000000,0
  438  04:44D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:44D2  00 00     
       04:44D4  00 00     
       04:44D6  00 00     
       04:44D8  00 00     
       04:44DA  00 00     
       04:44DC  00 00     
       04:44DE  00 00     
  439                     
  440  04:44E0            bp_font_player1_2:
  441  04:44E0  77 00         db  %01110111,0
  442  04:44E2  45 00         db  %01000101,0
  443  04:44E4  47 00         db  %01000111,0
  444  04:44E6  66 00         db  %01100110,0
  445  04:44E8  45 00         db  %01000101,0
  446  04:44EA  45 00         db  %01000101,0
  447  04:44EC  75 00         db  %01110101,0
  448  04:44EE  00 00         db  %00000000,0
  449  04:44F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:44F2  00 00     
       04:44F4  00 00     
       04:44F6  00 00     
       04:44F8  00 00     
       04:44FA  00 00     
       04:44FC  00 00     
       04:44FE  00 00     
  450                     
  451  04:4500            bp_font_player1_3:
  452  04:4500  10 00         db  %00010000,0
  453  04:4502  30 00         db  %00110000,0
  454  04:4504  10 00         db  %00010000,0
  455  04:4506  10 00         db  %00010000,0
  456  04:4508  10 00         db  %00010000,0
  457  04:450A  10 00         db  %00010000,0
  458  04:450C  38 00         db  %00111000,0
  459  04:450E  00 00         db  %00000000,0
  460  04:4510  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4512  00 00     
       04:4514  00 00     
       04:4516  00 00     
       04:4518  00 00     
       04:451A  00 00     
       04:451C  00 00     
       04:451E  00 00     
  461                     
  462  04:4520            bp_font_hiscore_0:
  463  04:4520  AE 00         db  %10101110,0
  464  04:4522  A4 00         db  %10100100,0
  465  04:4524  A4 00         db  %10100100,0
  466  04:4526  E4 00         db  %11100100,0
  467  04:4528  A4 00         db  %10100100,0
  468  04:452A  A4 00         db  %10100100,0
  469  04:452C  AE 00         db  %10101110,0
  470  04:452E  00 00         db  %00000000,0
  471  04:4530  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4532  00 00     
       04:4534  00 00     
       04:4536  00 00     
       04:4538  00 00     
       04:453A  00 00     
       04:453C  00 00     
       04:453E  00 00     
  472                     
  473  04:4540            bp_font_hiscore_1:
  474  04:4540  22 00         db  %00100010,0
  475  04:4542  55 00         db  %01010101,0
  476  04:4544  44 00         db  %01000100,0
  477  04:4546  24 00         db  %00100100,0
  478  04:4548  14 00         db  %00010100,0
  479  04:454A  55 00         db  %01010101,0
  480  04:454C  22 00         db  %00100010,0
  481  04:454E  00 00         db  %00000000,0
  482  04:4550  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4552  00 00     
       04:4554  00 00     
       04:4556  00 00     
       04:4558  00 00     
       04:455A  00 00     
       04:455C  00 00     
       04:455E  00 00     
  483                     
  484  04:4560            bp_font_hiscore_2:
  485  04:4560  27 00         db  %00100111,0
  486  04:4562  55 00         db  %01010101,0
  487  04:4564  57 00         db  %01010111,0
  488  04:4566  56 00         db  %01010110,0
  489  04:4568  55 00         db  %01010101,0
  490  04:456A  55 00         db  %01010101,0
  491  04:456C  25 00         db  %00100101,0
  492  04:456E  00 00         db  %00000000,0
  493  04:4570  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4572  00 00     
       04:4574  00 00     
       04:4576  00 00     
       04:4578  00 00     
       04:457A  00 00     
       04:457C  00 00     
       04:457E  00 00     
  494                     
  495  04:4580            bp_font_hiscore_3:
  496  04:4580  70 00         db  %01110000,0
  497  04:4582  40 00         db  %01000000,0
  498  04:4584  40 00         db  %01000000,0
  499  04:4586  60 00         db  %01100000,0
  500  04:4588  40 00         db  %01000000,0
  501  04:458A  40 00         db  %01000000,0
  502  04:458C  70 00         db  %01110000,0
  503  04:458E  00 00         db  %00000000,0
  504  04:4590  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4592  00 00     
       04:4594  00 00     
       04:4596  00 00     
       04:4598  00 00     
       04:459A  00 00     
       04:459C  00 00     
       04:459E  00 00     
  505                     
  506  04:45A0            bp_font_left_0:
  507  04:45A0  8E 00         db  %10001110,0
  508  04:45A2  88 00         db  %10001000,0
  509  04:45A4  88 00         db  %10001000,0
  510  04:45A6  8C 00         db  %10001100,0
  511  04:45A8  88 00         db  %10001000,0
  512  04:45AA  88 00         db  %10001000,0
  513  04:45AC  EE 00         db  %11101110,0
  514  04:45AE  00 00         db  %00000000,0
  515  04:45B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:45B2  00 00     
       04:45B4  00 00     
       04:45B6  00 00     
       04:45B8  00 00     
       04:45BA  00 00     
       04:45BC  00 00     
       04:45BE  00 00     
  516                     
  517  04:45C0            bp_font_left_1:
  518  04:45C0  EE 00         db  %11101110,0
  519  04:45C2  84 00         db  %10000100,0
  520  04:45C4  84 00         db  %10000100,0
  521  04:45C6  C4 00         db  %11000100,0
  522  04:45C8  84 00         db  %10000100,0
  523  04:45CA  84 00         db  %10000100,0
  524  04:45CC  84 00         db  %10000100,0
  525  04:45CE  00 00         db  %00000000,0
  526  04:45D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:45D2  00 00     
       04:45D4  00 00     
       04:45D6  00 00     
       04:45D8  00 00     
       04:45DA  00 00     
       04:45DC  00 00     
       04:45DE  00 00     
  527                     
  528  04:45E0            bp_font_space:
  529  04:45E0  00 00         dw $00,$00,$00,$00,$00,$00,$00,$00
       04:45E2  00 00     
       04:45E4  00 00     
       04:45E6  00 00     
       04:45E8  00 00     
       04:45EA  00 00     
       04:45EC  00 00     
       04:45EE  00 00     
  530  04:45F0  00 00         dw $00,$00,$00,$00,$00,$00,$00,$00
       04:45F2  00 00     
       04:45F4  00 00     
       04:45F6  00 00     
       04:45F8  00 00     
       04:45FA  00 00     
       04:45FC  00 00     
       04:45FE  00 00     
  531                     
  532                     
  533                     ;
  534                     ;
  535                     ;
  536                     
  537  04:4600            bp_blank:
  538  04:4600  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4602  00 00     
       04:4604  00 00     
       04:4606  00 00     
       04:4608  00 00     
       04:460A  00 00     
       04:460C  00 00     
       04:460E  00 00     
  539  04:4610  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4612  00 00     
       04:4614  00 00     
       04:4616  00 00     
       04:4618  00 00     
       04:461A  00 00     
       04:461C  00 00     
       04:461E  00 00     
  540  04:4620            bp_wall_ul:
  541  04:4620  FF 00             dw $ff,$ff,$c0,$c0,$c0,$c0,$c0,$c0
       04:4622  FF 00     
       04:4624  C0 00     
       04:4626  C0 00     
       04:4628  C0 00     
       04:462A  C0 00     
       04:462C  C0 00     
       04:462E  C0 00     
  542  04:4630  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4632  00 00     
       04:4634  00 00     
       04:4636  00 00     
       04:4638  00 00     
       04:463A  00 00     
       04:463C  00 00     
       04:463E  00 00     
  543  04:4640            bp_wall_ur:
  544  04:4640  FF 00             dw $ff,$ff,$03,$03,$03,$03,$03,$03
       04:4642  FF 00     
       04:4644  03 00     
       04:4646  03 00     
       04:4648  03 00     
       04:464A  03 00     
       04:464C  03 00     
       04:464E  03 00     
  545  04:4650  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4652  00 00     
       04:4654  00 00     
       04:4656  00 00     
       04:4658  00 00     
       04:465A  00 00     
       04:465C  00 00     
       04:465E  00 00     
  546  04:4660            bp_wall_dl:
  547  04:4660  C0 00             dw $c0,$c0,$c0,$c0,$c0,$c0,$ff,$ff
       04:4662  C0 00     
       04:4664  C0 00     
       04:4666  C0 00     
       04:4668  C0 00     
       04:466A  C0 00     
       04:466C  FF 00     
       04:466E  FF 00     
  548  04:4670  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4672  00 00     
       04:4674  00 00     
       04:4676  00 00     
       04:4678  00 00     
       04:467A  00 00     
       04:467C  00 00     
       04:467E  00 00     
  549  04:4680            bp_wall_dr:
  550  04:4680  03 00             dw $03,$03,$03,$03,$03,$03,$ff,$ff
       04:4682  03 00     
       04:4684  03 00     
       04:4686  03 00     
       04:4688  03 00     
       04:468A  03 00     
       04:468C  FF 00     
       04:468E  FF 00     
  551  04:4690  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4692  00 00     
       04:4694  00 00     
       04:4696  00 00     
       04:4698  00 00     
       04:469A  00 00     
       04:469C  00 00     
       04:469E  00 00     
  552  04:46A0            bp_wall_l:
  553  04:46A0  C0 00             dw $c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0
       04:46A2  C0 00     
       04:46A4  C0 00     
       04:46A6  C0 00     
       04:46A8  C0 00     
       04:46AA  C0 00     
       04:46AC  C0 00     
       04:46AE  C0 00     
  554  04:46B0  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:46B2  00 00     
       04:46B4  00 00     
       04:46B6  00 00     
       04:46B8  00 00     
       04:46BA  00 00     
       04:46BC  00 00     
       04:46BE  00 00     
  555  04:46C0            bp_wall_r:
  556  04:46C0  03 00             dw $03,$03,$03,$03,$03,$03,$03,$03
       04:46C2  03 00     
       04:46C4  03 00     
       04:46C6  03 00     
       04:46C8  03 00     
       04:46CA  03 00     
       04:46CC  03 00     
       04:46CE  03 00     
  557  04:46D0  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:46D2  00 00     
       04:46D4  00 00     
       04:46D6  00 00     
       04:46D8  00 00     
       04:46DA  00 00     
       04:46DC  00 00     
       04:46DE  00 00     
  558  04:46E0            bp_wall_u:
  559  04:46E0  FF 00             dw $ff,$ff,$00,$00,$00,$00,$00,$00
       04:46E2  FF 00     
       04:46E4  00 00     
       04:46E6  00 00     
       04:46E8  00 00     
       04:46EA  00 00     
       04:46EC  00 00     
       04:46EE  00 00     
  560  04:46F0  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:46F2  00 00     
       04:46F4  00 00     
       04:46F6  00 00     
       04:46F8  00 00     
       04:46FA  00 00     
       04:46FC  00 00     
       04:46FE  00 00     
  561  04:4700            bp_wall_d:
  562  04:4700  00 00             dw $00,$00,$00,$00,$00,$00,$ff,$ff
       04:4702  00 00     
       04:4704  00 00     
       04:4706  00 00     
       04:4708  00 00     
       04:470A  00 00     
       04:470C  FF 00     
       04:470E  FF 00     
  563  04:4710  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4712  00 00     
       04:4714  00 00     
       04:4716  00 00     
       04:4718  00 00     
       04:471A  00 00     
       04:471C  00 00     
       04:471E  00 00     
  564  04:4720            bp_wall_blank_ul:
  565  04:4720  C0 00             dw $c0,$80,$00,$00,$00,$00,$00,$00
       04:4722  80 00     
       04:4724  00 00     
       04:4726  00 00     
       04:4728  00 00     
       04:472A  00 00     
       04:472C  00 00     
       04:472E  00 00     
  566  04:4730  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4732  00 00     
       04:4734  00 00     
       04:4736  00 00     
       04:4738  00 00     
       04:473A  00 00     
       04:473C  00 00     
       04:473E  00 00     
  567  04:4740            bp_wall_blank_ur:
  568  04:4740  03 00             dw $03,$01,$00,$00,$00,$00,$00,$00
       04:4742  01 00     
       04:4744  00 00     
       04:4746  00 00     
       04:4748  00 00     
       04:474A  00 00     
       04:474C  00 00     
       04:474E  00 00     
  569  04:4750  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4752  00 00     
       04:4754  00 00     
       04:4756  00 00     
       04:4758  00 00     
       04:475A  00 00     
       04:475C  00 00     
       04:475E  00 00     
  570  04:4760            bp_wall_blank_dl:
  571  04:4760  00 00             dw $00,$00,$00,$00,$00,$00,$80,$c0
       04:4762  00 00     
       04:4764  00 00     
       04:4766  00 00     
       04:4768  00 00     
       04:476A  00 00     
       04:476C  80 00     
       04:476E  C0 00     
  572  04:4770  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4772  00 00     
       04:4774  00 00     
       04:4776  00 00     
       04:4778  00 00     
       04:477A  00 00     
       04:477C  00 00     
       04:477E  00 00     
  573  04:4780            bp_wall_blank_dr:
  574  04:4780  00 00             dw $00,$00,$00,$00,$00,$00,$01,$03
       04:4782  00 00     
       04:4784  00 00     
       04:4786  00 00     
       04:4788  00 00     
       04:478A  00 00     
       04:478C  01 00     
       04:478E  03 00     
  575  04:4790  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4792  00 00     
       04:4794  00 00     
       04:4796  00 00     
       04:4798  00 00     
       04:479A  00 00     
       04:479C  00 00     
       04:479E  00 00     
  576                     
  577  04:47A0            bp_dot:
  578  04:47A0  00 00             dw $00,$7e,$7e,$7e,$7e,$7e,$7e,$00
       04:47A2  7E 00     
       04:47A4  7E 00     
       04:47A6  7E 00     
       04:47A8  7E 00     
       04:47AA  7E 00     
       04:47AC  7E 00     
       04:47AE  00 00     
  579  04:47B0  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:47B2  00 00     
       04:47B4  00 00     
       04:47B6  00 00     
       04:47B8  00 00     
       04:47BA  00 00     
       04:47BC  00 00     
       04:47BE  00 00     
  580                     
  581  04:47C0            bp_body_l:
  582  04:47C0  FF 00             dw $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
       04:47C2  FF 00     
       04:47C4  FF 00     
       04:47C6  FF 00     
       04:47C8  FF 00     
       04:47CA  FF 00     
       04:47CC  FF 00     
       04:47CE  FF 00     
  583  04:47D0  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:47D2  00 00     
       04:47D4  00 00     
       04:47D6  00 00     
       04:47D8  00 00     
       04:47DA  00 00     
       04:47DC  00 00     
       04:47DE  00 00     
  584                     
  585  04:47E0            BgPattern_end:
  586           07E0      BgPattern_size  equ BgPattern_end-BgPattern
  587                     
  588                     ; ‚îå‚îÄ‚îê
  589                     ; ‚îÇ ‚îÇ
  590                     ; ‚îî‚îÄ‚îò
  591                     
  592  04:47E0            BgPalette:
  593  04:47E0  00 00             dw $0000,$ffff,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:47E2  FF FF     
       04:47E4  20 01     
       04:47E6  00 00     
       04:47E8  00 00     
       04:47EA  00 00     
       04:47EC  00 00     
       04:47EE  00 00     
       04:47F0  07 01     
       04:47F2  C7 01     
       04:47F4  00 00     
       04:47F6  00 00     
       04:47F8  00 00     
       04:47FA  00 00     
       04:47FC  00 00     
       04:47FE  00 00     
  594  04:4800  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4802  B6 01     
       04:4804  20 01     
       04:4806  00 00     
       04:4808  00 00     
       04:480A  00 00     
       04:480C  00 00     
       04:480E  00 00     
       04:4810  07 01     
       04:4812  C7 01     
       04:4814  00 00     
       04:4816  00 00     
       04:4818  00 00     
       04:481A  00 00     
       04:481C  00 00     
       04:481E  00 00     
  595  04:4820  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4822  B6 01     
       04:4824  20 01     
       04:4826  00 00     
       04:4828  00 00     
       04:482A  00 00     
       04:482C  00 00     
       04:482E  00 00     
       04:4830  07 01     
       04:4832  C7 01     
       04:4834  00 00     
       04:4836  00 00     
       04:4838  00 00     
       04:483A  00 00     
       04:483C  00 00     
       04:483E  00 00     
  596  04:4840  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4842  B6 01     
       04:4844  20 01     
       04:4846  00 00     
       04:4848  00 00     
       04:484A  00 00     
       04:484C  00 00     
       04:484E  00 00     
       04:4850  07 01     
       04:4852  C7 01     
       04:4854  00 00     
       04:4856  00 00     
       04:4858  00 00     
       04:485A  00 00     
       04:485C  00 00     
       04:485E  00 00     
  597  04:4860  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4862  B6 01     
       04:4864  20 01     
       04:4866  00 00     
       04:4868  00 00     
       04:486A  00 00     
       04:486C  00 00     
       04:486E  00 00     
       04:4870  07 01     
       04:4872  C7 01     
       04:4874  00 00     
       04:4876  00 00     
       04:4878  00 00     
       04:487A  00 00     
       04:487C  00 00     
       04:487E  00 00     
  598  04:4880  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4882  B6 01     
       04:4884  20 01     
       04:4886  00 00     
       04:4888  00 00     
       04:488A  00 00     
       04:488C  00 00     
       04:488E  00 00     
       04:4890  07 01     
       04:4892  C7 01     
       04:4894  00 00     
       04:4896  00 00     
       04:4898  00 00     
       04:489A  00 00     
       04:489C  00 00     
       04:489E  00 00     
  599  04:48A0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:48A2  B6 01     
       04:48A4  20 01     
       04:48A6  00 00     
       04:48A8  00 00     
       04:48AA  00 00     
       04:48AC  00 00     
       04:48AE  00 00     
       04:48B0  07 01     
       04:48B2  C7 01     
       04:48B4  00 00     
       04:48B6  00 00     
       04:48B8  00 00     
       04:48BA  00 00     
       04:48BC  00 00     
       04:48BE  00 00     
  600  04:48C0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:48C2  B6 01     
       04:48C4  20 01     
       04:48C6  00 00     
       04:48C8  00 00     
       04:48CA  00 00     
       04:48CC  00 00     
       04:48CE  00 00     
       04:48D0  07 01     
       04:48D2  C7 01     
       04:48D4  00 00     
       04:48D6  00 00     
       04:48D8  00 00     
       04:48DA  00 00     
       04:48DC  00 00     
       04:48DE  00 00     
  601  04:48E0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:48E2  B6 01     
       04:48E4  20 01     
       04:48E6  00 00     
       04:48E8  00 00     
       04:48EA  00 00     
       04:48EC  00 00     
       04:48EE  00 00     
       04:48F0  07 01     
       04:48F2  C7 01     
       04:48F4  00 00     
       04:48F6  00 00     
       04:48F8  00 00     
       04:48FA  00 00     
       04:48FC  00 00     
       04:48FE  00 00     
  602  04:4900  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4902  B6 01     
       04:4904  20 01     
       04:4906  00 00     
       04:4908  00 00     
       04:490A  00 00     
       04:490C  00 00     
       04:490E  00 00     
       04:4910  07 01     
       04:4912  C7 01     
       04:4914  00 00     
       04:4916  00 00     
       04:4918  00 00     
       04:491A  00 00     
       04:491C  00 00     
       04:491E  00 00     
  603  04:4920  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4922  B6 01     
       04:4924  20 01     
       04:4926  00 00     
       04:4928  00 00     
       04:492A  00 00     
       04:492C  00 00     
       04:492E  00 00     
       04:4930  07 01     
       04:4932  C7 01     
       04:4934  00 00     
       04:4936  00 00     
       04:4938  00 00     
       04:493A  00 00     
       04:493C  00 00     
       04:493E  00 00     
  604  04:4940  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4942  B6 01     
       04:4944  20 01     
       04:4946  00 00     
       04:4948  00 00     
       04:494A  00 00     
       04:494C  00 00     
       04:494E  00 00     
       04:4950  07 01     
       04:4952  C7 01     
       04:4954  00 00     
       04:4956  00 00     
       04:4958  00 00     
       04:495A  00 00     
       04:495C  00 00     
       04:495E  00 00     
  605  04:4960  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4962  B6 01     
       04:4964  20 01     
       04:4966  00 00     
       04:4968  00 00     
       04:496A  00 00     
       04:496C  00 00     
       04:496E  00 00     
       04:4970  07 01     
       04:4972  C7 01     
       04:4974  00 00     
       04:4976  00 00     
       04:4978  00 00     
       04:497A  00 00     
       04:497C  00 00     
       04:497E  00 00     
  606  04:4980  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:4982  B6 01     
       04:4984  20 01     
       04:4986  00 00     
       04:4988  00 00     
       04:498A  00 00     
       04:498C  00 00     
       04:498E  00 00     
       04:4990  07 01     
       04:4992  C7 01     
       04:4994  00 00     
       04:4996  00 00     
       04:4998  00 00     
       04:499A  00 00     
       04:499C  00 00     
       04:499E  00 00     
  607  04:49A0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:49A2  B6 01     
       04:49A4  20 01     
       04:49A6  00 00     
       04:49A8  00 00     
       04:49AA  00 00     
       04:49AC  00 00     
       04:49AE  00 00     
       04:49B0  07 01     
       04:49B2  C7 01     
       04:49B4  00 00     
       04:49B6  00 00     
       04:49B8  00 00     
       04:49BA  00 00     
       04:49BC  00 00     
       04:49BE  00 00     
  608  04:49C0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       04:49C2  B6 01     
       04:49C4  20 01     
       04:49C6  00 00     
       04:49C8  00 00     
       04:49CA  00 00     
       04:49CC  00 00     
       04:49CE  00 00     
       04:49D0  07 01     
       04:49D2  C7 01     
       04:49D4  00 00     
       04:49D6  00 00     
       04:49D8  00 00     
       04:49DA  00 00     
       04:49DC  00 00     
       04:49DE  00 00     
#[1]   nibbler.asm
#[2]   sprpattern.asm
   27                             .include "sprpattern.asm"
    1           49E0              .code
    2                     ;        .bank   MAIN_BANK+3
    3           0005              .bank   SPRPATTERN_BANK
    4           6000              org     $6000
    5                     
    6  05:6000            SpPattern:
    7                     
    8  05:6000            sp_head:
    9  05:6000  FF FF             dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6002  FF FF     
       05:6004  FF FF     
       05:6006  FF FF     
       05:6008  FF FF     
       05:600A  FF FF     
       05:600C  FF FF     
       05:600E  FF FF     
   10  05:6010  FF FF             dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6012  FF FF     
       05:6014  FF FF     
       05:6016  FF FF     
       05:6018  FF FF     
       05:601A  FF FF     
       05:601C  FF FF     
       05:601E  FF FF     
   11  05:6020  00 00             dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6022  00 00     
       05:6024  00 00     
       05:6026  00 00     
       05:6028  00 00     
       05:602A  00 00     
       05:602C  00 00     
       05:602E  00 00     
   12  05:6030  00 00             dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6032  00 00     
       05:6034  00 00     
       05:6036  00 00     
       05:6038  00 00     
       05:603A  00 00     
       05:603C  00 00     
       05:603E  00 00     
   13  05:6040  00 00             dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6042  00 00     
       05:6044  00 00     
       05:6046  00 00     
       05:6048  00 00     
       05:604A  00 00     
       05:604C  00 00     
       05:604E  00 00     
   14  05:6050  00 00             dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6052  00 00     
       05:6054  00 00     
       05:6056  00 00     
       05:6058  00 00     
       05:605A  00 00     
       05:605C  00 00     
       05:605E  00 00     
   15  05:6060  00 00             dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6062  00 00     
       05:6064  00 00     
       05:6066  00 00     
       05:6068  00 00     
       05:606A  00 00     
       05:606C  00 00     
       05:606E  00 00     
   16  05:6070  00 00             dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6072  00 00     
       05:6074  00 00     
       05:6076  00 00     
       05:6078  00 00     
       05:607A  00 00     
       05:607C  00 00     
       05:607E  00 00     
   17                     
   18  05:6080            SpPattern_end:
   19                     
   20           0080      SpPattern_size  equ     SpPattern_end-SpPattern
   21                     
   22                     
   23  05:6080            SpPalette:
   24  05:6080  00 00             dw $0000,$0038,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6082  38 00     
       05:6084  20 01     
       05:6086  00 00     
       05:6088  00 00     
       05:608A  00 00     
       05:608C  00 00     
       05:608E  00 00     
       05:6090  07 01     
       05:6092  C7 01     
       05:6094  00 00     
       05:6096  00 00     
       05:6098  00 00     
       05:609A  00 00     
       05:609C  00 00     
       05:609E  00 00     
   25  05:60A0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:60A2  B6 01     
       05:60A4  20 01     
       05:60A6  00 00     
       05:60A8  00 00     
       05:60AA  00 00     
       05:60AC  00 00     
       05:60AE  00 00     
       05:60B0  07 01     
       05:60B2  C7 01     
       05:60B4  00 00     
       05:60B6  00 00     
       05:60B8  00 00     
       05:60BA  00 00     
       05:60BC  00 00     
       05:60BE  00 00     
   26  05:60C0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:60C2  B6 01     
       05:60C4  20 01     
       05:60C6  00 00     
       05:60C8  00 00     
       05:60CA  00 00     
       05:60CC  00 00     
       05:60CE  00 00     
       05:60D0  07 01     
       05:60D2  C7 01     
       05:60D4  00 00     
       05:60D6  00 00     
       05:60D8  00 00     
       05:60DA  00 00     
       05:60DC  00 00     
       05:60DE  00 00     
   27  05:60E0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:60E2  B6 01     
       05:60E4  20 01     
       05:60E6  00 00     
       05:60E8  00 00     
       05:60EA  00 00     
       05:60EC  00 00     
       05:60EE  00 00     
       05:60F0  07 01     
       05:60F2  C7 01     
       05:60F4  00 00     
       05:60F6  00 00     
       05:60F8  00 00     
       05:60FA  00 00     
       05:60FC  00 00     
       05:60FE  00 00     
   28  05:6100  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6102  B6 01     
       05:6104  20 01     
       05:6106  00 00     
       05:6108  00 00     
       05:610A  00 00     
       05:610C  00 00     
       05:610E  00 00     
       05:6110  07 01     
       05:6112  C7 01     
       05:6114  00 00     
       05:6116  00 00     
       05:6118  00 00     
       05:611A  00 00     
       05:611C  00 00     
       05:611E  00 00     
   29  05:6120  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6122  B6 01     
       05:6124  20 01     
       05:6126  00 00     
       05:6128  00 00     
       05:612A  00 00     
       05:612C  00 00     
       05:612E  00 00     
       05:6130  07 01     
       05:6132  C7 01     
       05:6134  00 00     
       05:6136  00 00     
       05:6138  00 00     
       05:613A  00 00     
       05:613C  00 00     
       05:613E  00 00     
   30  05:6140  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6142  B6 01     
       05:6144  20 01     
       05:6146  00 00     
       05:6148  00 00     
       05:614A  00 00     
       05:614C  00 00     
       05:614E  00 00     
       05:6150  07 01     
       05:6152  C7 01     
       05:6154  00 00     
       05:6156  00 00     
       05:6158  00 00     
       05:615A  00 00     
       05:615C  00 00     
       05:615E  00 00     
   31  05:6160  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6162  B6 01     
       05:6164  20 01     
       05:6166  00 00     
       05:6168  00 00     
       05:616A  00 00     
       05:616C  00 00     
       05:616E  00 00     
       05:6170  07 01     
       05:6172  C7 01     
       05:6174  00 00     
       05:6176  00 00     
       05:6178  00 00     
       05:617A  00 00     
       05:617C  00 00     
       05:617E  00 00     
   32  05:6180  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6182  B6 01     
       05:6184  20 01     
       05:6186  00 00     
       05:6188  00 00     
       05:618A  00 00     
       05:618C  00 00     
       05:618E  00 00     
       05:6190  07 01     
       05:6192  C7 01     
       05:6194  00 00     
       05:6196  00 00     
       05:6198  00 00     
       05:619A  00 00     
       05:619C  00 00     
       05:619E  00 00     
   33  05:61A0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:61A2  B6 01     
       05:61A4  20 01     
       05:61A6  00 00     
       05:61A8  00 00     
       05:61AA  00 00     
       05:61AC  00 00     
       05:61AE  00 00     
       05:61B0  07 01     
       05:61B2  C7 01     
       05:61B4  00 00     
       05:61B6  00 00     
       05:61B8  00 00     
       05:61BA  00 00     
       05:61BC  00 00     
       05:61BE  00 00     
   34  05:61C0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:61C2  B6 01     
       05:61C4  20 01     
       05:61C6  00 00     
       05:61C8  00 00     
       05:61CA  00 00     
       05:61CC  00 00     
       05:61CE  00 00     
       05:61D0  07 01     
       05:61D2  C7 01     
       05:61D4  00 00     
       05:61D6  00 00     
       05:61D8  00 00     
       05:61DA  00 00     
       05:61DC  00 00     
       05:61DE  00 00     
   35  05:61E0  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:61E2  B6 01     
       05:61E4  20 01     
       05:61E6  00 00     
       05:61E8  00 00     
       05:61EA  00 00     
       05:61EC  00 00     
       05:61EE  00 00     
       05:61F0  07 01     
       05:61F2  C7 01     
       05:61F4  00 00     
       05:61F6  00 00     
       05:61F8  00 00     
       05:61FA  00 00     
       05:61FC  00 00     
       05:61FE  00 00     
   36  05:6200  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6202  B6 01     
       05:6204  20 01     
       05:6206  00 00     
       05:6208  00 00     
       05:620A  00 00     
       05:620C  00 00     
       05:620E  00 00     
       05:6210  07 01     
       05:6212  C7 01     
       05:6214  00 00     
       05:6216  00 00     
       05:6218  00 00     
       05:621A  00 00     
       05:621C  00 00     
       05:621E  00 00     
   37  05:6220  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6222  B6 01     
       05:6224  20 01     
       05:6226  00 00     
       05:6228  00 00     
       05:622A  00 00     
       05:622C  00 00     
       05:622E  00 00     
       05:6230  07 01     
       05:6232  C7 01     
       05:6234  00 00     
       05:6236  00 00     
       05:6238  00 00     
       05:623A  00 00     
       05:623C  00 00     
       05:623E  00 00     
   38  05:6240  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6242  B6 01     
       05:6244  20 01     
       05:6246  00 00     
       05:6248  00 00     
       05:624A  00 00     
       05:624C  00 00     
       05:624E  00 00     
       05:6250  07 01     
       05:6252  C7 01     
       05:6254  00 00     
       05:6256  00 00     
       05:6258  00 00     
       05:625A  00 00     
       05:625C  00 00     
       05:625E  00 00     
   39  05:6260  00 00             dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
       05:6262  B6 01     
       05:6264  20 01     
       05:6266  00 00     
       05:6268  00 00     
       05:626A  00 00     
       05:626C  00 00     
       05:626E  00 00     
       05:6270  07 01     
       05:6272  C7 01     
       05:6274  00 00     
       05:6276  00 00     
       05:6278  00 00     
       05:627A  00 00     
       05:627C  00 00     
       05:627E  00 00     
   40                     
#[1]   nibbler.asm
#[2]   map.asm
   28                             .include "map.asm"
    1           6280          .code
    2           0001          .bank   MAIN_BANK
    3                     
    4                     ;
    5                     ;   WaveÊèèÁîª
    6                     ;
    7                     ;   @args       zwave = waveÁï™Âè∑
    8                     ;   @saveregs   „Å™„Åó
    9                     ;   @return     „Å™„Åó
   10  01:C492            DrawWave:
   11           200A      .arg_wavemap_l  equ zarg0   ;wave„Éû„ÉÉ„Éó„Éá„Éº„Çø„Ç¢„Éâ„É¨„Çπ
   12           200B      .arg_wavemap_h  equ zarg1
   13           2003      .tmp_mul_h  equ ztmp0
   14                     
   15                                                 ;zwave*81 „ÅÆË®àÁÆó
   16  01:C492  64 03         stz <.tmp_mul_h
   17  01:C494  A5 16         lda <zwave
   18  01:C496  0A            asl a
   19  01:C497  26 03         rol <.tmp_mul_h
   20  01:C499  0A            asl a
   21  01:C49A  26 03         rol <.tmp_mul_h
   22  01:C49C  0A            asl a
   23  01:C49D  26 03         rol <.tmp_mul_h
   24  01:C49F  0A            asl a
   25  01:C4A0  26 03         rol <.tmp_mul_h
   26                                                 ;zwave*16 „Çí‰∏ÄÊó¶‰øùÂ≠ò
   27  01:C4A2  85 0A         sta <.arg_wavemap_l
   28  01:C4A4  A6 03         ldx <.tmp_mul_h
   29  01:C4A6  86 0B         stx <.arg_wavemap_h
   30                     
   31  01:C4A8  0A            asl a
   32  01:C4A9  26 03         rol <.tmp_mul_h
   33  01:C4AB  0A            asl a
   34  01:C4AC  26 03         rol <.tmp_mul_h
   35                                                 ;arg = zwave*16+zwave*64 = zwave*80
   36  01:C4AE  18            clc
   37  01:C4AF  65 0A         adc <.arg_wavemap_l
   38  01:C4B1  85 0A         sta <.arg_wavemap_l
   39  01:C4B3  A5 0B         lda <.arg_wavemap_h
   40  01:C4B5  65 03         adc <.tmp_mul_h
   41  01:C4B7  85 0B         sta <.arg_wavemap_h
   42                                                 ;arg = zwave*80 + zwave = zwave*81
   43  01:C4B9  A5 0A         lda <.arg_wavemap_l
   44  01:C4BB  18            clc
   45  01:C4BC  65 16         adc <zwave
   46  01:C4BE  85 0A         sta <.arg_wavemap_l
   47  01:C4C0  A5 0B         lda <.arg_wavemap_h
   48  01:C4C2  69 00         adc #0
   49  01:C4C4  85 0B         sta <.arg_wavemap_h
   50                                                 ;arg = zwave*81 + WaveMap
   51  01:C4C6  A5 0A         lda <.arg_wavemap_l
   52  01:C4C8  18            clc
   53  01:C4C9  69 00         adc #LOW(WaveMap)
   54  01:C4CB  85 0A         sta <.arg_wavemap_l
   55  01:C4CD  A5 0B         lda <.arg_wavemap_h
   56  01:C4CF  69 80         adc #HIGH(WaveMap)
   57  01:C4D1  85 0B         sta <.arg_wavemap_h
   58                     
   59  01:C4D3  20 D7 C4      jsr DrawWaveByWaveMapAdr
   60  01:C4D6  60            rts
   61                     
   62                     ;
   63                     ;   WaveÊèèÁîª
   64                     ;
   65                     ;   @args       zarg0,1 = Wave„Éû„ÉÉ„Éó„Ç¢„Éâ„É¨„Çπ
   66                     ;   @saveregs   „Å™„Åó
   67                     ;   @return     „Å™„Åó
   68  01:C4D7            DrawWaveByWaveMapAdr:
   69           200A      .arg_wavemap_l  equ zarg0   ;„Éû„ÉÉ„Éó„Éá„Éº„Çø„Ç¢„Éâ„É¨„Çπ
   70           200B      .arg_wavemap_h  equ zarg1
   71                     
   72           200C      .tmp_vram_l     equ zarg2   ;vram(BAT)„Ç¢„Éâ„É¨„Çπ
   73           200D      .tmp_vram_h     equ zarg3
   74           200E      .tmp_vmap_ptr_l equ zarg4   ;‰ªÆÊÉ≥vram„Ç¢„Éâ„É¨„Çπ
   75           200F      .tmp_vmap_ptr_h equ zarg5
   76                     
   77  01:C4D7  64 15         stz <zdotnum
   78                     
   79  01:C4D9  64 0C         stz <.tmp_vram_l
   80  01:C4DB  64 0D         stz <.tmp_vram_h
   81                     
   82  01:C4DD  A9 04         lda #LOW(VMap)
   83  01:C4DF  85 0E         sta <.tmp_vmap_ptr_l
   84  01:C4E1  A9 24         lda #HIGH(VMap)
   85  01:C4E3  85 0F         sta <.tmp_vmap_ptr_h
   86                     
   87  01:C4E5  C2            cly                 ;y=„Éû„ÉÉ„Éó„Éá„Éº„Çø„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
   88  01:C4E6            .loop_nextrow:
   89  01:C4E6  A2 09         ldx #9              ;x=Ë°å„Ç´„Ç¶„É≥„Çø
   90  01:C4E8            .loop_nextgrid:
   91                                             ;gridÊèèÁîª
   92  01:C4E8  DA            phx
   93  01:C4E9  5A            phy
   94  01:C4EA  B1 0A         lda [.arg_wavemap_l],y
   95  01:C4EC  20 32 C5      jsr DrawMapGrid
   96  01:C4EF  7A            ply
   97  01:C4F0  FA            plx
   98                                             ;ÂÖ®gridÊ∏à„Å™„ÇâÁµÇ‰∫Ü
   99  01:C4F1  C8            iny
  100  01:C4F2  C0 51         cpy #9*9
  101  01:C4F4  F0 3B         beq .loop_end
  102                                             ;1Ë°åÁµÇ‰∫ÜÔºü
  103  01:C4F6  CA            dex
  104  01:C4F7  F0 1C         beq .nextrow
  105                                             ;Âêå‰∏ÄË°å„ÅÆÂè≥Èö£„Å´ÁßªÂãï
  106  01:C4F9  A5 0C         lda <.tmp_vram_l
  107  01:C4FB  18            clc
  108  01:C4FC  69 03         adc #3
  109  01:C4FE  85 0C         sta <.tmp_vram_l
  110  01:C500  A5 0D         lda <.tmp_vram_h
  111  01:C502  69 00         adc #0
  112  01:C504  85 0D         sta <.tmp_vram_h
  113                     
  114  01:C506  A5 0E         lda <.tmp_vmap_ptr_l
  115  01:C508  18            clc
  116  01:C509  69 03         adc #3
  117  01:C50B  85 0E         sta <.tmp_vmap_ptr_l
  118  01:C50D  A5 0F         lda <.tmp_vmap_ptr_h
  119  01:C50F  69 00         adc #0
  120  01:C511  85 0F         sta <.tmp_vmap_ptr_h
  121                     
  122  01:C513  80 D3         bra .loop_nextgrid
  123                     
  124                                             ;Ê¨°„ÅÆË°å„ÅÆÂ∑¶Á´Ø„Å´ÁßªÂãï
  125  01:C515            .nextrow:
  126  01:C515  A5 0C         lda <.tmp_vram_l
  127  01:C517  18            clc
  128  01:C518  69 48         adc #3*32-3*8
  129  01:C51A  85 0C         sta <.tmp_vram_l
  130  01:C51C  A5 0D         lda <.tmp_vram_h
  131  01:C51E  69 00         adc #0
  132  01:C520  85 0D         sta <.tmp_vram_h
  133                     
  134  01:C522  A5 0E         lda <.tmp_vmap_ptr_l
  135  01:C524  18            clc
  136  01:C525  69 48         adc #3*32-3*8
  137  01:C527  85 0E         sta <.tmp_vmap_ptr_l
  138  01:C529  A5 0F         lda <.tmp_vmap_ptr_h
  139  01:C52B  69 00         adc #0
  140  01:C52D  85 0F         sta <.tmp_vmap_ptr_h
  141                     
  142  01:C52F  80 B5         bra .loop_nextrow
  143                     
  144  01:C531            .loop_end:
  145  01:C531  60            rts
  146                     
  147                     
  148                     
  149                     ;
  150                     ;   Wave„Éû„ÉÉ„Éó„ÅÆÔºë„Ç∞„É™„ÉÉ„ÉâÂàÜÔºà3*3„Ç≠„É£„É©„ÇØ„ÇøÔºâ„ÅÆÊèèÁîª
  151                     ;
  152                     ;   @args       A = „Ç∞„É™„ÉÉ„ÉâÁï™Âè∑
  153                     ;               zarg2,3 = BAT address
  154                     ;               zarg4,5 = Virtual Map address
  155                     ;   @saveregs   „Å™„Åó
  156                     ;   @return     „Å™„Åó
  157  01:C532            DrawMapGrid:
  158           200C      .arg_vram_l     equ zarg2   ;vram(BAT)„Ç¢„Éâ„É¨„Çπ
  159           200D      .arg_vram_h     equ zarg3
  160           200E      .arg_vmap_ptr_l equ zarg4   ;‰ªÆÊÉ≥vram„Ç¢„Éâ„É¨„Çπ
  161           200F      .arg_vmap_ptr_h equ zarg5
  162                     
  163           2003      .tmp_x9         equ ztmp0   ;9ÂÄçË®àÁÆóÁî®„ÉØ„Éº„ÇØ
  164           2003      .tmp_vram_l     equ ztmp0   ;vram(BAT)„Ç¢„Éâ„É¨„Çπ
  165           2004      .tmp_vram_h     equ ztmp1
  166           2005      .tmp_looprow    equ ztmp2   ;Ë°å„Ç´„Ç¶„É≥„Çø
  167           2006      .tmp_loopchar   equ ztmp3   ;
  168           2007      .tmp_dotcombi   equ ztmp4
  169           2008      .tmp_vmap_value equ ztmp5
  170                     
  171  01:C532  A8            tay
  172                                             ;x=grid„Éá„Éº„Çø„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  173                                             ;gridÁï™Âè∑x9
  174  01:C533  29 0F         and #$0f
  175  01:C535  85 03         sta <.tmp_x9
  176  01:C537  0A            asl a
  177  01:C538  0A            asl a
  178  01:C539  0A            asl a
  179  01:C53A  65 03         adc <.tmp_x9
  180  01:C53C  AA            tax
  181                                             ;„Éâ„ÉÉ„ÉàÈÖçÁΩÆ
  182  01:C53D  98            tya
  183  01:C53E  4A            lsr a
  184  01:C53F  4A            lsr a
  185  01:C540  4A            lsr a
  186  01:C541  4A            lsr a
  187  01:C542  A8            tay
  188  01:C543  B9 EC C6      lda DotCombination,y
  189  01:C546  85 07         sta <.tmp_dotcombi
  190                     
  191                                             ;vram(BAT)„Ç¢„Éâ„É¨„ÇπÂàùÊúüÂÄ§
  192  01:C548  A5 0C         lda <.arg_vram_l
  193  01:C54A  85 03         sta <.tmp_vram_l
  194  01:C54C  A5 0D         lda <.arg_vram_h
  195  01:C54E  85 04         sta <.tmp_vram_h
  196                     
  197  01:C550  C2            cly                 ;y=‰ªÆÊÉ≥vram„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  198                                             ;grid„ÅÆË°åÊï∞
  199  01:C551  A9 03         lda #3
  200  01:C553  85 05         sta <.tmp_looprow
  201                     
  202  01:C555            .loop_row:
  203                                             ;vram(BAT)„Ç¢„Éâ„É¨„Çπ„Çª„ÉÉ„Éà
  204  01:C555  03 00         st0 #0
  205  01:C557  A5 03         lda <.tmp_vram_l
  206  01:C559  8D 02 00      sta VdcDataL
  207  01:C55C  A5 04         lda <.tmp_vram_h
  208  01:C55E  8D 03 00      sta VdcDataH
  209  01:C561  03 02         st0 #2
  210                                             ;grid„ÅÆÊ∞¥Âπ≥ÊñπÂêë„ÅÆ„Ç≠„É£„É©Êï∞
  211  01:C563  A9 03         lda #3
  212  01:C565  85 06         sta <.tmp_loopchar
  213  01:C567            .loop_char:
  214  01:C567  BD 5C C6      lda VMapGrids,x
  215  01:C56A  85 08         sta <.tmp_vmap_value
  216                     
  217  01:C56C  BD CC C5      lda MapGrids,x
  218  01:C56F  D0 0B         bne .setchar
  219                                                 ;Á©∫ÁôΩ„Åã„Å§„Éâ„ÉÉ„Éà„ÅåÈÖçÁΩÆ„Åï„Çå„Å¶„ÅÑ„Çã„Å™„Çâ„Éâ„ÉÉ„Éà„ÅÆ„Çø„Ç§„É´„Çí„Çª„ÉÉ„Éà
  220  01:C571  7F 07 08      bbr7    <.tmp_dotcombi,.setchar
  221                     
  222  01:C574  E6 15         inc <zdotnum            ;„Éâ„ÉÉ„ÉàÊï∞„ÇíÂ¢óÂä†
  223                     
  224  01:C576  A9 0F         lda #$0f
  225  01:C578  04 08         tsb <.tmp_vmap_value
  226  01:C57A  A9 1A         lda #$0d*2                  ;TODO: „Éâ„ÉÉ„Éà„ÅÆ„Çø„Ç§„É´Áï™Âè∑
  227                     
  228  01:C57C            .setchar
  229                                             ;„Çø„Ç§„É´„Çívram(BAT)„Å´Êõ∏„ÅçËæº„Åø
  230  01:C57C  5A            phy
  231  01:C57D  A8            tay
  232  01:C57E  B9 B0 C5      lda MapPartsTiles,y
  233  01:C581  8D 02 00      sta VdcDataL
  234  01:C584  B9 B1 C5      lda MapPartsTiles+1,y
  235  01:C587  8D 03 00      sta VdcDataH
  236  01:C58A  7A            ply
  237                                             ;‰ªÆÊÉ≥vram„Å´Êõ∏„ÅçËæº„Åø
  238  01:C58B  A5 08         lda <.tmp_vmap_value
  239  01:C58D  91 0E         sta [.arg_vmap_ptr_l],y
  240                     
  241  01:C58F  06 07         asl <.tmp_dotcombi
  242  01:C591  E8            inx
  243  01:C592  C8            iny
  244                     
  245  01:C593  C6 06         dec <.tmp_loopchar
  246  01:C595  D0 D0         bne .loop_char
  247                     
  248  01:C597  C6 05         dec <.tmp_looprow
  249  01:C599  F0 14         beq .end_loop
  250                                             ;Ê¨°„ÅÆË°å„Å´vram„Ç¢„Éâ„É¨„Çπ„ÇíÁßªÂãï
  251  01:C59B  A5 03         lda <.tmp_vram_l
  252  01:C59D  18            clc
  253  01:C59E  69 20         adc #32
  254  01:C5A0  85 03         sta <.tmp_vram_l
  255  01:C5A2  A5 04         lda <.tmp_vram_h
  256  01:C5A4  69 00         adc #0
  257  01:C5A6  85 04         sta <.tmp_vram_h
  258                                             ;Ê¨°„ÅÆË°å„Å´‰ªÆÊÉ≥vram„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíÁßªÂãï
  259  01:C5A8  98            tya
  260  01:C5A9  18            clc
  261  01:C5AA  69 1D         adc #32-3
  262  01:C5AC  A8            tay
  263                     
  264  01:C5AD  80 A6         bra .loop_row
  265                     
  266  01:C5AF            .end_loop:
  267  01:C5AF  60            rts
  268                     
  269                     
  270                     ;
  271                     ;
  272                     
  273           2404          .bss
  274                         
  275                     ;   „Éï„Ç£„Éº„É´„Éâ„Éû„ÉÉ„Éó
  276                     ;   ÂøÖË¶Å„Å™„ÅÆ„ÅØ 27*27 „Å†„Åå„ÄÅ„Ç¢„Éâ„É¨„ÇπË®àÁÆó„ÅåÈù¢ÂÄí„Å™„ÅÆ„Åß 32*27 „Å®„Åô„Çã
  277  --:2404            VMap:   ds  32*27
#[1]   nibbler.asm
#[2]   mapdata.asm
   29                             .include "mapdata.asm"
    1           C5B0          .code
    2           0001          .bank   MAIN_BANK
    3                     
    4                     
    5                     
    6                     ;
    7                     ;   grid„ÇíÊßãÊàê„Åô„Çã„Çø„Ç§„É´„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„ÉºÁï™Âè∑ÔºàBAT„ÅÆ‰∏ã12„Éì„ÉÉ„Éà„ÅÆÂÄ§Ôºâ
    8                     ;
    9           1300      MapPartsPatternAddress  equ $1000+48*16
   10  01:C5B0            MapPartsTiles:
   11  01:C5B0  30 01         dw  (MapPartsPatternAddress+$00*16)/16  ;Á©∫ÁôΩ
   12  01:C5B2  31 01         dw  (MapPartsPatternAddress+$01*16)/16  ;Â∑¶‰∏ä‚îå
   13  01:C5B4  32 01         dw  (MapPartsPatternAddress+$02*16)/16  ;Âè≥‰∏ä‚îê
   14  01:C5B6  33 01         dw  (MapPartsPatternAddress+$03*16)/16  ;Â∑¶‰∏ã‚îî
   15  01:C5B8  34 01         dw  (MapPartsPatternAddress+$04*16)/16  ;Âè≥‰∏ã‚îê
   16  01:C5BA  35 01         dw  (MapPartsPatternAddress+$05*16)/16  ;Â∑¶‚îÇ
   17  01:C5BC  36 01         dw  (MapPartsPatternAddress+$06*16)/16  ;Âè≥‚îÇ
   18  01:C5BE  37 01         dw  (MapPartsPatternAddress+$07*16)/16  ;‰∏ä‚îÄ
   19  01:C5C0  38 01         dw  (MapPartsPatternAddress+$08*16)/16  ;‰∏ã‚îÄ
   20  01:C5C2  39 01         dw  (MapPartsPatternAddress+$09*16)/16  ;Â∑¶‰∏ä„Éª
   21  01:C5C4  3A 01         dw  (MapPartsPatternAddress+$0a*16)/16  ;Âè≥‰∏ä„Éª
   22  01:C5C6  3B 01         dw  (MapPartsPatternAddress+$0b*16)/16  ;Â∑¶‰∏ã„Éª
   23  01:C5C8  3C 01         dw  (MapPartsPatternAddress+$0c*16)/16  ;Âè≥‰∏ã„Éª
   24  01:C5CA  3D 01         dw  (MapPartsPatternAddress+$0d*16)/16  ;„Éâ„ÉÉ„Éà
   25                     
   26                     ;
   27                     ;   „Éû„ÉÉ„Éó„ÅÆgrid„ÅÆ‰∏≠Ë∫´
   28                     ;   grid„ÅØ3x3„ÅÆ„Çø„Ç§„É´„ÅßÊßãÊàê„Åï„Çå„ÄÅÂêÑ„Çø„Ç§„É´„Çí1„Éê„Ç§„Éà„ÅßË°®Áèæ
   29                     ;   „Çø„Ç§„É´„ÅÆÂÄ§„ÅØ MapPartsTiles „ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
   30                     ;
   31                     MapGridData .macro
   32                         db  \1*2,\2*2,\3*2
   33                         .endm
   34                     
   35  01:C5CC            MapGrids:
   36  01:C5CC            MapGrid_00:
   37                         MapGridData  $01,$07,$02
       01:C5CC  02 0E 04      db  $01*2,$07*2,$02*2
   38                         MapGridData  $05,$00,$06
       01:C5CF  0A 00 0C      db  $05*2,$00*2,$06*2
   39                         MapGridData  $03,$08,$04
       01:C5D2  06 10 08      db  $03*2,$08*2,$04*2
   40  01:C5D5            MapGrid_01:
   41                         MapGridData  $05,$00,$06
       01:C5D5  0A 00 0C      db  $05*2,$00*2,$06*2
   42                         MapGridData  $05,$00,$06
       01:C5D8  0A 00 0C      db  $05*2,$00*2,$06*2
   43                         MapGridData  $03,$08,$04
       01:C5DB  06 10 08      db  $03*2,$08*2,$04*2
   44  01:C5DE            MapGrid_02:
   45                         MapGridData  $01,$07,$07
       01:C5DE  02 0E 0E      db  $01*2,$07*2,$07*2
   46                         MapGridData  $05,$00,$00
       01:C5E1  0A 00 00      db  $05*2,$00*2,$00*2
   47                         MapGridData  $03,$08,$08
       01:C5E4  06 10 10      db  $03*2,$08*2,$08*2
   48  01:C5E7            MapGrid_03:
   49                         MapGridData  $05,$00,$0a
       01:C5E7  0A 00 14      db  $05*2,$00*2,$0a*2
   50                         MapGridData  $05,$00,$00
       01:C5EA  0A 00 00      db  $05*2,$00*2,$00*2
   51                         MapGridData  $03,$08,$08
       01:C5ED  06 10 10      db  $03*2,$08*2,$08*2
   52  01:C5F0            MapGrid_04:
   53                         MapGridData  $01,$07,$02
       01:C5F0  02 0E 04      db  $01*2,$07*2,$02*2
   54                         MapGridData  $05,$00,$06
       01:C5F3  0A 00 0C      db  $05*2,$00*2,$06*2
   55                         MapGridData  $05,$00,$06
       01:C5F6  0A 00 0C      db  $05*2,$00*2,$06*2
   56  01:C5F9            MapGrid_05:
   57                         MapGridData  $05,$00,$06
       01:C5F9  0A 00 0C      db  $05*2,$00*2,$06*2
   58                         MapGridData  $05,$00,$06
       01:C5FC  0A 00 0C      db  $05*2,$00*2,$06*2
   59                         MapGridData  $05,$00,$06
       01:C5FF  0A 00 0C      db  $05*2,$00*2,$06*2
   60  01:C602            MapGrid_06:
   61                         MapGridData  $01,$07,$07
       01:C602  02 0E 0E      db  $01*2,$07*2,$07*2
   62                         MapGridData  $05,$00,$00
       01:C605  0A 00 00      db  $05*2,$00*2,$00*2
   63                         MapGridData  $05,$00,$0c
       01:C608  0A 00 18      db  $05*2,$00*2,$0c*2
   64  01:C60B            MapGrid_07:
   65                         MapGridData  $05,$00,$0a
       01:C60B  0A 00 14      db  $05*2,$00*2,$0a*2
   66                         MapGridData  $05,$00,$00
       01:C60E  0A 00 00      db  $05*2,$00*2,$00*2
   67                         MapGridData  $05,$00,$0c
       01:C611  0A 00 18      db  $05*2,$00*2,$0c*2
   68  01:C614            MapGrid_08:
   69                         MapGridData  $07,$07,$02
       01:C614  0E 0E 04      db  $07*2,$07*2,$02*2
   70                         MapGridData  $00,$00,$06
       01:C617  00 00 0C      db  $00*2,$00*2,$06*2
   71                         MapGridData  $08,$08,$04
       01:C61A  10 10 08      db  $08*2,$08*2,$04*2
   72  01:C61D            MapGrid_09:
   73                         MapGridData  $09,$00,$06
       01:C61D  12 00 0C      db  $09*2,$00*2,$06*2
   74                         MapGridData  $00,$00,$06
       01:C620  00 00 0C      db  $00*2,$00*2,$06*2
   75                         MapGridData  $08,$08,$04
       01:C623  10 10 08      db  $08*2,$08*2,$04*2
   76  01:C626            MapGrid_0a:
   77                         MapGridData  $07,$07,$07
       01:C626  0E 0E 0E      db  $07*2,$07*2,$07*2
   78                         MapGridData  $00,$00,$00
       01:C629  00 00 00      db  $00*2,$00*2,$00*2
   79                         MapGridData  $08,$08,$08
       01:C62C  10 10 10      db  $08*2,$08*2,$08*2
   80  01:C62F            MapGrid_0b:
   81                         MapGridData  $09,$00,$0a
       01:C62F  12 00 14      db  $09*2,$00*2,$0a*2
   82                         MapGridData  $00,$00,$00
       01:C632  00 00 00      db  $00*2,$00*2,$00*2
   83                         MapGridData  $08,$08,$08
       01:C635  10 10 10      db  $08*2,$08*2,$08*2
   84  01:C638            MapGrid_0c:
   85                         MapGridData  $07,$07,$02
       01:C638  0E 0E 04      db  $07*2,$07*2,$02*2
   86                         MapGridData  $00,$00,$06
       01:C63B  00 00 0C      db  $00*2,$00*2,$06*2
   87                         MapGridData  $0b,$00,$06
       01:C63E  16 00 0C      db  $0b*2,$00*2,$06*2
   88  01:C641            MapGrid_0d:
   89                         MapGridData  $09,$00,$06
       01:C641  12 00 0C      db  $09*2,$00*2,$06*2
   90                         MapGridData  $00,$00,$06
       01:C644  00 00 0C      db  $00*2,$00*2,$06*2
   91                         MapGridData  $0b,$00,$06
       01:C647  16 00 0C      db  $0b*2,$00*2,$06*2
   92  01:C64A            MapGrid_0e:
   93                         MapGridData  $07,$07,$07
       01:C64A  0E 0E 0E      db  $07*2,$07*2,$07*2
   94                         MapGridData  $00,$00,$00
       01:C64D  00 00 00      db  $00*2,$00*2,$00*2
   95                         MapGridData  $0b,$00,$0c
       01:C650  16 00 18      db  $0b*2,$00*2,$0c*2
   96  01:C653            MapGrid_0f:
   97                         MapGridData  $09,$00,$0a
       01:C653  12 00 14      db  $09*2,$00*2,$0a*2
   98                         MapGridData  $00,$00,$00
       01:C656  00 00 00      db  $00*2,$00*2,$00*2
   99                         MapGridData  $0b,$00,$0c
       01:C659  16 00 18      db  $0b*2,$00*2,$0c*2
  100                     
  101                     ;
  102                     ;   „Éû„ÉÉ„Éó„ÅÆgrid„ÅÆ‰∏≠Ë∫´Ôºà‰ªÆÊÉ≥vramÁî®Ôºâ
  103                     ;   grid„ÅØ3x3„ÅÆ„Çø„Ç§„É´„ÅßÊßãÊàê„Åï„Çå„ÄÅÂêÑ„Çø„Ç§„É´„Çí1„Éê„Ç§„Éà„ÅßË°®Áèæ
  104                     ;   „Çø„Ç§„É´„ÅÆÂÄ§„ÅØ„ÄÅ‰∏ã‰Ωç4„Éì„ÉÉ„Éà„ÅåÁßªÂãïÂèØËÉΩÊñπÂêë„ÄÅ‰∏ä‰Ωç4„Éì„ÉÉ„Éà„ÅØ„Éï„É©„Ç∞
  105                     ;
  106                     
  107                     VMapGridData .macro
  108                         db  \1*16,\2*16,\3*16
  109                         .endm
  110                     
  111  01:C65C            VMapGrids:
  112  01:C65C            VMapGrid_00:
  113                         VMapGridData  %0000,%0000,%0000
       01:C65C  00 00 00      db  %0000*16,%0000*16,%0000*16
  114                         VMapGridData  %0000,%0000,%0000
       01:C65F  00 00 00      db  %0000*16,%0000*16,%0000*16
  115                         VMapGridData  %0000,%0000,%0000
       01:C662  00 00 00      db  %0000*16,%0000*16,%0000*16
  116  01:C665            VMapGrid_01:
  117                         VMapGridData  %0000,%0101,%0000
       01:C665  00 50 00      db  %0000*16,%0101*16,%0000*16
  118                         VMapGridData  %0000,%0001,%0000
       01:C668  00 10 00      db  %0000*16,%0001*16,%0000*16
  119                         VMapGridData  %0000,%0000,%0000
       01:C66B  00 00 00      db  %0000*16,%0000*16,%0000*16
  120  01:C66E            VMapGrid_02:
  121                         VMapGridData  %0000,%0000,%0000
       01:C66E  00 00 00      db  %0000*16,%0000*16,%0000*16
  122                         VMapGridData  %0000,%0010,%1010
       01:C671  00 20 A0      db  %0000*16,%0010*16,%1010*16
  123                         VMapGridData  %0000,%0000,%0000
       01:C674  00 00 00      db  %0000*16,%0000*16,%0000*16
  124  01:C677            VMapGrid_03:
  125                         VMapGridData  %0000,%0101,%0000
       01:C677  00 50 00      db  %0000*16,%0101*16,%0000*16
  126                         VMapGridData  %0000,%0011,%1010
       01:C67A  00 30 A0      db  %0000*16,%0011*16,%1010*16
  127                         VMapGridData  %0000,%0000,%0000
       01:C67D  00 00 00      db  %0000*16,%0000*16,%0000*16
  128  01:C680            VMapGrid_04:
  129                         VMapGridData  %0000,%0000,%0000
       01:C680  00 00 00      db  %0000*16,%0000*16,%0000*16
  130                         VMapGridData  %0000,%0100,%0000
       01:C683  00 40 00      db  %0000*16,%0100*16,%0000*16
  131                         VMapGridData  %0000,%0101,%0000
       01:C686  00 50 00      db  %0000*16,%0101*16,%0000*16
  132  01:C689            VMapGrid_05:
  133                         VMapGridData  %0000,%0101,%0000
       01:C689  00 50 00      db  %0000*16,%0101*16,%0000*16
  134                         VMapGridData  %0000,%0101,%0000
       01:C68C  00 50 00      db  %0000*16,%0101*16,%0000*16
  135                         VMapGridData  %0000,%0101,%0000
       01:C68F  00 50 00      db  %0000*16,%0101*16,%0000*16
  136  01:C692            VMapGrid_06:
  137                         VMapGridData  %0000,%0000,%0000
       01:C692  00 00 00      db  %0000*16,%0000*16,%0000*16
  138                         VMapGridData  %0000,%0110,%1010
       01:C695  00 60 A0      db  %0000*16,%0110*16,%1010*16
  139                         VMapGridData  %0000,%0101,%0000
       01:C698  00 50 00      db  %0000*16,%0101*16,%0000*16
  140  01:C69B            VMapGrid_07:
  141                         VMapGridData  %0000,%0101,%0000
       01:C69B  00 50 00      db  %0000*16,%0101*16,%0000*16
  142                         VMapGridData  %0000,%0111,%1010
       01:C69E  00 70 A0      db  %0000*16,%0111*16,%1010*16
  143                         VMapGridData  %0000,%0101,%0000
       01:C6A1  00 50 00      db  %0000*16,%0101*16,%0000*16
  144  01:C6A4            VMapGrid_08:
  145                         VMapGridData  %0000,%0000,%0000
       01:C6A4  00 00 00      db  %0000*16,%0000*16,%0000*16
  146                         VMapGridData  %1010,%1000,%0000
       01:C6A7  A0 80 00      db  %1010*16,%1000*16,%0000*16
  147                         VMapGridData  %0000,%0000,%0000
       01:C6AA  00 00 00      db  %0000*16,%0000*16,%0000*16
  148  01:C6AD            VMapGrid_09:
  149                         VMapGridData  %0000,%0101,%0000
       01:C6AD  00 50 00      db  %0000*16,%0101*16,%0000*16
  150                         VMapGridData  %1010,%1001,%0000
       01:C6B0  A0 90 00      db  %1010*16,%1001*16,%0000*16
  151                         VMapGridData  %0000,%0000,%0000
       01:C6B3  00 00 00      db  %0000*16,%0000*16,%0000*16
  152  01:C6B6            VMapGrid_0a:
  153                         VMapGridData  %0000,%0000,%0000
       01:C6B6  00 00 00      db  %0000*16,%0000*16,%0000*16
  154                         VMapGridData  %1010,%1010,%1010
       01:C6B9  A0 A0 A0      db  %1010*16,%1010*16,%1010*16
  155                         VMapGridData  %0000,%0000,%0000
       01:C6BC  00 00 00      db  %0000*16,%0000*16,%0000*16
  156  01:C6BF            VMapGrid_0b:
  157                         VMapGridData  %0000,%0101,%0000
       01:C6BF  00 50 00      db  %0000*16,%0101*16,%0000*16
  158                         VMapGridData  %1010,%1011,%1010
       01:C6C2  A0 B0 A0      db  %1010*16,%1011*16,%1010*16
  159                         VMapGridData  %0000,%0000,%0000
       01:C6C5  00 00 00      db  %0000*16,%0000*16,%0000*16
  160  01:C6C8            VMapGrid_0c:
  161                         VMapGridData  %0000,%0000,%0000
       01:C6C8  00 00 00      db  %0000*16,%0000*16,%0000*16
  162                         VMapGridData  %1010,%1100,%0000
       01:C6CB  A0 C0 00      db  %1010*16,%1100*16,%0000*16
  163                         VMapGridData  %0000,%0101,%0000
       01:C6CE  00 50 00      db  %0000*16,%0101*16,%0000*16
  164  01:C6D1            VMapGrid_0d:
  165                         VMapGridData  %0000,%0101,%0000
       01:C6D1  00 50 00      db  %0000*16,%0101*16,%0000*16
  166                         VMapGridData  %1010,%1101,%0000
       01:C6D4  A0 D0 00      db  %1010*16,%1101*16,%0000*16
  167                         VMapGridData  %0000,%0101,%0000
       01:C6D7  00 50 00      db  %0000*16,%0101*16,%0000*16
  168  01:C6DA            VMapGrid_0e:
  169                         VMapGridData  %0000,%0000,%0000
       01:C6DA  00 00 00      db  %0000*16,%0000*16,%0000*16
  170                         VMapGridData  %1010,%1110,%1010
       01:C6DD  A0 E0 A0      db  %1010*16,%1110*16,%1010*16
  171                         VMapGridData  %0000,%0101,%0000
       01:C6E0  00 50 00      db  %0000*16,%0101*16,%0000*16
  172  01:C6E3            VMapGrid_0f:
  173                         VMapGridData  %0000,%0101,%0000
       01:C6E3  00 50 00      db  %0000*16,%0101*16,%0000*16
  174                         VMapGridData  %1010,%1111,%1010
       01:C6E6  A0 F0 A0      db  %1010*16,%1111*16,%1010*16
  175                         VMapGridData  %0000,%0101,%0000
       01:C6E9  00 50 00      db  %0000*16,%0101*16,%0000*16
  176                     
  177                     
  178                     ;
  179                     ;   grid‰∏≠„ÅÆ„Éâ„ÉÉ„Éà„ÅÆÊúâÁÑ°„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ
  180                     ;   Â∑¶„ÅÆ„Éì„ÉÉ„Éà„Åã„ÇâÈ†Ü„Å´„ÄÄÂ∑¶‰∏ä„ÄÅ‰∏ä„ÄÅÂè≥‰∏ä„ÄÅÂ∑¶„ÄÅ‰∏≠Â§Æ„ÄÅÂè≥„ÄÅÂ∑¶‰∏ã„ÄÅ‰∏ã„ÄÄ„ÅÆ‰ΩçÁΩÆ„Å´ÂØæÂøú
  181                     ;   Âè≥‰∏ã„Å´ÂØæÂøú„Åô„Çã„Éì„ÉÉ„Éà„Åå„Å™„ÅÑ„Åå„ÄÅÂè≥‰∏ã„Å´„Éâ„ÉÉ„Éà„ÅåÁΩÆ„Åã„Çå„Çã„Åì„Å®„ÅØ„Å™„ÅÑ„ÅÆ„ÅßÊúâÁÑ°„ÇíË°®„Åô„Éì„ÉÉ„Éà„ÇíÁî
  182                     ;   Â∑¶‰∏ä„ÄÅÂè≥‰∏ä„ÄÅÂ∑¶‰∏ã„ÇÇ„Éâ„ÉÉ„Éà„ÅåÁΩÆ„Åã„Çå„Çã„Åì„Å®„ÅØ„Å™„ÅÑ„Åå„ÄÅ„Éû„ÉÉ„ÉóÊèèÁîªÂá¶ÁêÜ„ÅÆÈÉΩÂêà‰∏ä„ÄÅÂØæÂøú„Åô„Çã„Éì„ÉÉ„É
  183                     ;
  184  01:C6EC            DotCombination:
  185  01:C6EC  00            db  %00000000   ;0
  186  01:C6ED  08            db  %00001000   ;1„ÄÄ‰∏≠Â§Æ
  187  01:C6EE  40            db  %01000000   ;2„ÄÄ‰∏ä
  188  01:C6EF  01            db  %00000001   ;3„ÄÄ‰∏ã
  189  01:C6F0  10            db  %00010000   ;4„ÄÄÂ∑¶
  190  01:C6F1  04            db  %00000100   ;5„ÄÄÂè≥
  191  01:C6F2  41            db  %01000001   ;6„ÄÄ‰∏ä‰∏ã
  192  01:C6F3  14            db  %00010100   ;7„ÄÄÂ∑¶Âè≥
  193                     
  194                     
  195                     ;
  196                     ;   waveÔºà„Çπ„ÉÜ„Éº„Ç∏Ôºâ„ÅÆ„Éû„ÉÉ„Éó
  197                     ;   1wave„Åß81„Éê„Ç§„Éà
  198                     ;   „Éû„ÉÉ„Éó„ÅØ9x9„ÅÆÊ†ºÂ≠ê„Åß„Åß„Åç„Å¶„Åä„Çä„ÄÅÂêÑÊ†ºÂ≠ê„ÅØ1„Éê„Ç§„Éà„ÅßË°®Áèæ
  199                     ;   Ê†ºÂ≠ê„Éê„Ç§„Éà„ÅÆ‰∏ä4„Éì„ÉÉ„Éà„ÅØ„Éâ„ÉÉ„ÉàÈÖçÁΩÆ„ÄÅ‰∏ã4„Éì„ÉÉ„Éà„ÅØÂ£Å„ÅÆÈÖçÁΩÆ
  200                     ;   „Éâ„ÉÉ„ÉàÈÖçÁΩÆ„ÅØ DotCombination „ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  201                     ;   Â£ÅÈÖçÁΩÆ„ÅØ MapGrids „ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
  202                     ;
  203           C6F4          .code
  204           0006          .bank   WAVEMAP_BANK
  205           8000          org $8000   
  206                     
  207  06:8000            WaveMap:
  208  06:8000            WaveMap_01:
  209  06:8000  06 1A 0E      db  $06,$1a,$0e,$1e,$0a,$1e,$0e,$1a,$0c
       06:8003  1E 0A 1E  
       06:8006  0E 1A 0C  
  210  06:8009  15 00 15      db  $15,$00,$15,$07,$0e,$0d,$15,$00,$15
       06:800C  07 0E 0D  
       06:800F  15 00 15  
  211  06:8012  07 0A 09      db  $07,$0a,$09,$15,$05,$15,$03,$0a,$0d
       06:8015  15 05 15  
       06:8018  03 0A 0D  
  212  06:801B  15 06 4A      db  $15,$06,$4a,$0b,$0f,$0b,$5a,$0c,$15
       06:801E  0B 0F 0B  
       06:8021  5A 0C 15  
  213  06:8024  07 0B 4A      db  $07,$0b,$4a,$0e,$2b,$0e,$5a,$0b,$0d
       06:8027  0E 2B 0E  
       06:802A  5A 0B 0D  
  214  06:802D  07 1A 0E      db  $07,$1a,$0e,$0d,$00,$07,$0e,$1a,$0d
       06:8030  0D 00 07  
       06:8033  0E 1A 0D  
  215  06:8036  05 00 05      db  $05,$00,$05,$07,$1a,$0d,$05,$00,$05
       06:8039  07 1A 0D  
       06:803C  05 00 05  
  216  06:803F  67 0A 29      db  $67,$0a,$29,$25,$00,$25,$23,$0a,$6d
       06:8042  25 00 25  
       06:8045  23 0A 6D  
  217  06:8048  03 0A 0A      db  $03,$0a,$0a,$0b,$0a,$0b,$0a,$0a,$09
       06:804B  0B 0A 0B  
       06:804E  0A 0A 09  
  218  06:8051            WaveMap_10:
  219  06:8051  06 1A 0E      db  $06,$1a,$0e,$0e,$1a,$0e,$0e,$1a,$0c
       06:8054  0E 1A 0E  
       06:8057  0E 1A 0C  
  220  06:805A  07 1A 0D      db  $07,$1a,$0d,$27,$1a,$2d,$07,$1a,$0d
       06:805D  27 1A 2D  
       06:8060  07 1A 0D  
  221  06:8063  15 16 0B      db  $15,$16,$0b,$0f,$1a,$0f,$0b,$1c,$15
       06:8066  0F 1A 0F  
       06:8069  0B 1C 15  
  222  06:806C  07 0D 06      db  $07,$0d,$06,$2d,$00,$27,$0c,$07,$0d
       06:806F  2D 00 27  
       06:8072  0C 07 0D  
  223  06:8075  07 0F 1D      db  $07,$0f,$1d,$07,$1a,$0d,$17,$0f,$0d
       06:8078  07 1A 0D  
       06:807B  17 0F 0D  
  224  06:807E  07 0D 03      db  $07,$0d,$03,$3d,$00,$37,$09,$07,$0d
       06:8081  3D 00 37  
       06:8084  09 07 0D  
  225  06:8087  15 03 3E      db  $15,$03,$3e,$0f,$1a,$0f,$3e,$09,$15
       06:808A  0F 1A 0F  
       06:808D  3E 09 15  
  226  06:8090  07 1A 0D      db  $07,$1a,$0d,$07,$1a,$0d,$07,$1a,$0d
       06:8093  07 1A 0D  
       06:8096  07 1A 0D  
  227  06:8099  03 0A 0B      db  $03,$0a,$0b,$0b,$0a,$0b,$0b,$0a,$09
       06:809C  0B 0A 0B  
       06:809F  0B 0A 09  
#[1]   nibbler.asm
#[2]   vqueue.asm
   30                             .include "vqueue.asm"
    1                     ;   VRAMÈÉ®ÂàÜÊõ∏„ÅçÊèõ„Åà
    2                     ;
    3                     ;   Êõ∏„ÅçÊèõ„ÅàÂÜÖÂÆπ„Çí„Ç≠„É•„Éº„Å´‰øùÁÆ°„Åó„ÄÅvblank‰∏≠„Å´Êõ∏„ÅçÊèõ„Åà„Çã„ÄÇ
    4                     
    5           0010      VQ_MAX_QUQUE_SIZE   equ 16  ;„Ç≠„É•„Éº„ÅÆ„Çµ„Ç§„Ç∫
    6                     
    7           2029          .zp
    8  --:2029            zvqIndex:   ds  1
    9                     
   10           2764          .bss
   11  --:2764            vqArea:
   12  --:2764            vqDstL: ds  VQ_MAX_QUQUE_SIZE   ;VRAM„Ç¢„Éâ„É¨„Çπ
   13  --:2774            vqDstH: ds  VQ_MAX_QUQUE_SIZE
   14  --:2784            vqSrcL: ds  VQ_MAX_QUQUE_SIZE   ;„ÇΩ„Éº„Çπ„Éá„Éº„Çø„Ç¢„Éâ„É¨„Çπ
   15  --:2794            vqSrcH: ds  VQ_MAX_QUQUE_SIZE
   16  --:27A4            vqWLen: ds  VQ_MAX_QUQUE_SIZE   ;„Éá„Éº„ÇøÈï∑Ôºà„ÉØ„Éº„ÉâÂçò‰ΩçÔºâ
   17                     
   18  --:27B4            vqArea_end:
   19           0050      vqArea_size equ vqArea_end-vqArea
   20                     
   21           80A2          .code
   22           0001          .bank   MAIN_BANK
   23                     
   24                     ;   „Ç≠„É•„Éº„ÇíÂàùÊúüÂåñ
   25                     ;   @args       „Å™„Åó
   26                     ;   @saveregs   „Å™„Åó
   27                     ;   @return     „Å™„Åó
   28  01:C6F4            vqInit:
   29                                             ;„Ç≠„É•„Éº„Çí„ÇØ„É™„Ç¢
   30  01:C6F4  9C 64 27      stz vqArea
   31  01:C6F7  73 64 27      tii vqArea,vqArea+1,vqArea_size-1
       01:C6FA  65 27 4F  
       01:C6FD  00        
   32  01:C6FE  64 29         stz <zvqIndex
   33  01:C700  60            rts
   34                     
   35                     ;   „Ç≠„É•„Éº„Å´„Éá„Éº„Çø„ÇíËøΩÂä†
   36                     ;   @args       zarg0,1 = vram„Ç¢„Éâ„É¨„Çπ
   37                     ;               zarg2,3 = „Éá„Éº„Çø
   38                     ;               zarg4   = Èï∑„Åï
   39                     ;   @saveregs   x
   40                     ;   @return     „Å™„Åó
   41  01:C701            vqPush:
   42           200A      .tmp_vramadr_l  equ zarg0
   43           200B      .tmp_vramadr_h  equ zarg1
   44           200C      .tmp_src_l      equ zarg2
   45           200D      .tmp_src_h      equ zarg3
   46           200E      .tmp_len        equ zarg4
   47  01:C701  A4 29         ldy <zvqIndex
   48                     
   49  01:C703  AD 0A 20      lda .tmp_vramadr_l
   50  01:C706  99 64 27      sta vqDstL,y
   51  01:C709  AD 0B 20      lda .tmp_vramadr_h
   52  01:C70C  99 74 27      sta vqDstH,y
   53                     
   54  01:C70F  AD 0C 20      lda .tmp_src_l
   55  01:C712  99 84 27      sta vqSrcL,y
   56  01:C715  AD 0D 20      lda .tmp_src_h
   57  01:C718  99 94 27      sta vqSrcH,y
   58                     
   59  01:C71B  AD 0E 20      lda .tmp_len
   60  01:C71E  99 A4 27      sta vqWLen,y
   61                     
   62  01:C721  C8            iny
   63  01:C722  84 29         sty <zvqIndex
   64                     
   65  01:C724  60            rts
   66                     
   67                     ;   „Ç≠„É•„Éº„ÅÆÂÜÖÂÆπ„ÇíÊèèÁîª
   68                     ;   VRAM„ÇíÊõ¥Êñ∞„Åô„Çã„ÅÆ„Åßvblank‰∏≠„Å´Âëº„Å≥Âá∫„Åô„Åì„Å®
   69                     ;   @args       „Å™„Åó
   70                     ;   @saveregs   „Å™„Åó
   71                     ;   @return     „Å™„Åó
   72  01:C725            vqDraw:
   73           2003      .tmp_src_l  equ ztmp0
   74           2004      .tmp_src_h  equ ztmp1
   75                     
   76  01:C725  A6 29         ldx <zvqIndex
   77  01:C727  D0 01         bne .loop_queue
   78  01:C729  60            rts
   79                     
   80  01:C72A            .loop_queue:
   81  01:C72A  CA            dex
   82                     
   83  01:C72B  03 00         st0 #0
   84  01:C72D  BD 64 27      lda vqDstL,x
   85  01:C730  8D 02 00      sta VdcDataL
   86  01:C733  BD 74 27      lda vqDstH,x
   87  01:C736  8D 03 00      sta VdcDataH
   88                     
   89  01:C739  BD 84 27      lda vqSrcL,x
   90  01:C73C  85 03         sta <.tmp_src_l
   91  01:C73E  BD 94 27      lda vqSrcH,x
   92  01:C741  85 04         sta <.tmp_src_h
   93                     
   94  01:C743  03 02         st0 #2
   95  01:C745  C2            cly
   96                     
   97  01:C746            .loop_copy:
   98  01:C746  B1 03         lda [.tmp_src_l],y
   99  01:C748  8D 02 00      sta VdcDataL
  100  01:C74B  C8            iny
  101  01:C74C  B1 03         lda [.tmp_src_l],y
  102  01:C74E  8D 03 00      sta VdcDataH
  103  01:C751  C8            iny
  104                     
  105  01:C752  DE A4 27      dec vqWLen,x
  106  01:C755  D0 EF         bne .loop_copy
  107                     
  108  01:C757  E0 00         cpx #0
  109  01:C759  D0 CF         bne .loop_queue
  110                     
  111  01:C75B  64 29         stz <zvqIndex
  112  01:C75D  60            rts
#[1]   nibbler.asm
#[2]   digits.asm
   31                         .include "digits.asm"
    1           C75E          .code
    2           0001          .bank   MAIN_BANK
    3                     
    4                     ;
    5                     ;   Êï∞ÂÄ§ÊèèÁîª
    6                     ;
    7                     ;   @args       zarg0,1 = BAT address
    8                     ;               zarg2,3 = Êï∞ÂÄ§„Éá„Éº„Çø„Ç¢„Éâ„É¨„Çπ
    9                     ;               zarg4   = Êï∞ÂÄ§„Éá„Éº„Çø„ÅÆÈï∑„ÅïÔºà„Éê„Ç§„ÉàÔºâ
   10                     ;   @saveregs   „Å™„Åó
   11                     ;   @return     „Å™„Åó
   12  01:C75E            drawDigits:
   13           200A      .arg_batadr_l   equ zarg0
   14           200B      .arg_batadr_h   equ zarg1
   15           200C      .arg_adr_l  equ zarg2
   16           200D      .arg_adr_h  equ zarg3
   17           200E      .arg_len    equ zarg4
   18                                             ;BCD„Çí1„Éê„Ç§„Éà1Ê°Å„ÅÆÊñáÂ≠óÂàó„Å´Â§âÊèõ
   19  01:C75E  A4 0E         ldy <.arg_len
   20  01:C760  88            dey                 ;Y = Êï∞ÂÄ§„Éá„Éº„Çø„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
   21  01:C761  82            clx                 ;X = ÊèèÁîª„Éá„Éº„Çø„Éê„ÉÉ„Éï„Ç°„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ
   22                     
   23                                             ;‰∏ä‰Ωç„ÅÆÊ°Å„Åå0„ÅÆÂ†¥Âêà„ÅØ0„Åß„ÅØ„Å™„ÅèÁ©∫ÁôΩ„ÇíÊèèÁîª
   24  01:C762            .blankloop:
   25                                             ;BCD„ÅÆ‰∏ä‰ΩçÊ°Å
   26  01:C762  B1 0C         lda [.arg_adr_l],y
   27  01:C764  4A            lsr a
   28  01:C765  4A            lsr a
   29  01:C766  4A            lsr a
   30  01:C767  4A            lsr a
   31  01:C768  D0 1F         bne .drawh
   32  01:C76A  A9 30         lda #48             ;TODO: Á©∫ÁôΩ„Åå48
   33  01:C76C  9D B4 27      sta dgBuffer,x
   34  01:C76F  E8            inx
   35                                             ;BCD„ÅÆ‰∏ã‰ΩçÊ°Å
   36  01:C770  B1 0C         lda [.arg_adr_l],y
   37  01:C772  29 0F         and #$0f
   38  01:C774  D0 1B         bne .drawl
   39  01:C776  A9 30         lda #48             ;TODO: Á©∫ÁôΩ„Åå48
   40  01:C778  9D B4 27      sta dgBuffer,x
   41  01:C77B  E8            inx
   42                     
   43  01:C77C  C0 00         cpy #0
   44  01:C77E  F0 1C         beq .convert
   45  01:C780  88            dey
   46  01:C781  80 DF         bra .blankloop
   47                     
   48                                             ;Êï∞ÂÄ§„ÅÆÊèèÁîª
   49  01:C783            .drawloop:
   50                                             ;BCD„ÅÆ‰∏ä‰ΩçÊ°Å
   51  01:C783  B1 0C         lda [.arg_adr_l],y
   52  01:C785  4A            lsr a
   53  01:C786  4A            lsr a
   54  01:C787  4A            lsr a
   55  01:C788  4A            lsr a
   56  01:C789            .drawh:
   57  01:C789  9D B4 27      sta dgBuffer,x
   58  01:C78C  E8            inx
   59                                             ;BCD„ÅÆ‰∏ã‰ΩçÊ°Å
   60  01:C78D  B1 0C         lda [.arg_adr_l],y
   61  01:C78F  29 0F         and #$0f
   62  01:C791            .drawl:
   63  01:C791  9D B4 27      sta dgBuffer,x
   64  01:C794  E8            inx
   65  01:C795  C0 00         cpy #0
   66  01:C797  F0 03         beq .convert
   67  01:C799  88            dey
   68  01:C79A  80 E7         bra .drawloop
   69                     
   70                                             ;ÊñáÂ≠óÂàó„ÇíBAT„Éá„Éº„Çø„Å´Â§âÊèõ
   71  01:C79C            .convert:
   72  01:C79C  A5 0E         lda <.arg_len
   73  01:C79E  0A            asl a
   74  01:C79F  AA            tax
   75  01:C7A0  0A            asl a
   76  01:C7A1  A8            tay
   77  01:C7A2            .convloop:
   78  01:C7A2  88            dey
   79  01:C7A3  88            dey
   80  01:C7A4  CA            dex
   81                                             ;TODO: Êï∞Â≠ó„ÅÆVRAM„Ç¢„Éâ„É¨„Çπ„Åå $1000„Äú „Åß„ÅÇ„Çã„Åì„Å®
   82  01:C7A5  BD B4 27      lda dgBuffer,x
   83  01:C7A8  99 B4 27      sta dgBuffer,y
   84  01:C7AB  A9 01         lda #1
   85  01:C7AD  99 B5 27      sta dgBuffer+1,y
   86                     
   87  01:C7B0  E0 00         cpx #0
   88  01:C7B2  D0 EE         bne .convloop
   89                     
   90  01:C7B4  A9 B4         lda #LOW(dgBuffer)
   91  01:C7B6  85 0C         sta <zarg2
   92  01:C7B8  A9 27         lda #HIGH(dgBuffer)
   93  01:C7BA  85 0D         sta <zarg3
   94  01:C7BC  06 0E         asl <.arg_len
   95  01:C7BE  20 01 C7      jsr vqPush
   96                     
   97  01:C7C1  60            rts
   98                     
   99           27B4          .bss
  100  --:27B4            dgBuffer    ds  16
  101                     
  102           C7C2          .code
#[1]   nibbler.asm
   32                             
   33                             
   34                             
   35                             
