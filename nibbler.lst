#[1]   nibbler.asm
    5           0001      MAIN_BANK       equ 1
    6           0004      BGPATTERN_BANK  equ 4
    7           0005      SPRPATTERN_BANK equ 5
    8           0006      WAVEMAP_BANK    equ 6
    9                     
#[2]   pce.asm
   10                             .include "pce.asm"        
    1                     ;       鮫！鮫！鮫！(Fire Shark) 勝手移植版 for PCEngine
    2                     ;       2020/12/09
    3                     ;
    4                     ;       common definitions
    5                     ;
    6                     ;       VDC
    7                     ;
    8           0000      VdcPort         .equ    $0000
    9           0000      VdcReg          .equ    VdcPort
   10           0000      VdcStatus       .equ    VdcPort
   11           0002      VdcData         .equ    VdcPort+2
   12           0002      VdcDataL        .equ    VdcData
   13           0003      VdcDataH        .equ    VdcData+1
   14                     ;
   15                     ;       VCE
   16                     ;
   17           0400      VcePort         .equ    $0400
   18           0400      VceCtrl         .equ    VcePort
   19           0402      VceIndex        .equ    VcePort+2
   20           0402      VceIndexL       .equ    VceIndex
   21           0403      VceIndexH       .equ    VceIndex+1
   22           0404      VceData         .equ    VcePort+4
   23           0404      VceDataL        .equ    VceData
   24           0405      VceDataH        .equ    VceData+1
   25                     ;
   26                     ;       PSG
   27                     ;
   28           0800      PsgPort         .equ    $0800
   29           0800      PsgChannel      .equ    PsgPort
   30           0801      PsgMainVol      .equ    PsgPort+1
   31           0802      PsgFreqL        .equ    PsgPort+2
   32           0803      PsgFreqH        .equ    PsgPort+3
   33           0804      PsgCtrl         .equ    PsgPort+4
   34           0805      PsgChVol        .equ    PsgPort+5
   35           0806      PsgWave         .equ    PsgPort+6
   36           0807      PsgNoise        .equ    PsgPort+7
   37           0808      PsgLfoFreq      .equ    PsgPort+8
   38           0809      PsgLfoCtrl      .equ    PsgPort+9
   39                     ;
   40                     ;       timer
   41                     ;
   42           0C00      TimerPort       .equ    $0c00
   43           0C00      TimerCounter    .equ    TimerPort
   44           0C01      TimerCtrl       .equ    TimerPort+1
   45                     ;
   46                     ;       interrupt
   47                     ;
   48           1402      IntCtrlPort     .equ    $1402
   49           1402      IntCtrlMask     .equ    IntCtrlPort
   50           1403      IntCtrlState    .equ    IntCtrlPort+1
   51                     ;
   52                     ;       control pad
   53                     ;
   54           1000      PadPort         .equ    $1000
   55                     
#[1]   nibbler.asm
#[2]   task.inc
   11                             .include "task.inc"
    1                     tkChangeTask_   .macro
    2                         lda #LOW(\1)
    3                         sta <ztkChgTask
    4                         lda #HIGH(\1)
    5                         sta <ztkChgTask+1
    6                         .endm
    7                     
    8                     tkYield_    .macro
    9                         jsr tkYield
   10                         .endm
#[1]   nibbler.asm
#[2]   script.inc
   12                             .include "script.inc"
    1                     scrEnd_   .macro
    2                         db  0
    3                         .endm
    4                     
    5                     scrWait_    .macro
    6                         db  2
    7                         .endm
    8                     
    9                     scrSetInterval_ .macro
   10                         db  4
   11                         db  \1
   12                         .endm
   13                     
   14                     scrSetSprite_    .macro
   15                         db  6
   16                         db  \1
   17                         dw  \2,\3,\4,\5
   18                         .endm
   19                     
   20                     scrSetSpritePosition_    .macro
   21                         db  8
   22                         db  \1
   23                         dw  \2,\3
   24                         .endm
   25                     
   26                     scrSetSpritePattern_    .macro
   27                         db  10
   28                         db  \1
   29                         dw  \2
   30                         .endm
   31                     
   32                     scrSetSpriteAttribute_    .macro
   33                         db  12
   34                         db  \1
   35                         dw  \2
   36                         .endm
   37                     
   38                     scrSetBG_   .macro
   39                         db  14
   40                         dw  \1,\2
   41                         db  \3
   42                         .endm
#[1]   nibbler.asm
   13                             
   14                             
#[2]   bank0.asm
   15                             .include "bank0.asm"
    1                     ;       鮫！鮫！鮫！(Fire Shark) 勝手移植版 for PCEngine
    2                     ;       2020/12/09
    3                     ;
    4                     ;       バンク０に配置すべきコード
    5                     ;       割り込みベクタ・割り込みハンドラ（RESET）
    6                     ;       アドレスは $e000-$ffff
    7                     
    8           0000      BANK0_BANK .equ 0
    9                     
   10           E000              .code
   11           0000              .bank BANK0_BANK
   12                     ;
   13                     ;       interrupt vectors
   14                     ;
   15           FFF6              .org $fff6
   16  00:FFF6  00 E0             .dw     interrupt_dummy         ;$fff6 IRQ2/BRK
   17  00:FFF8  01 E0             .dw     interrupt_dummy2         ;$fff8 IRQ1
   18  00:FFFA  02 E0             .dw     interrupt_dummy3         ;$fffa timer
   19  00:FFFC  03 E0             .dw     interrupt_dummy4         ;$fffc NMI
   20  00:FFFE  04 E0             .dw     interrupt_reset         ;$fffe RESET
   21                     ;
   22                     ;       interrupt handlers
   23                     ;
   24           E000              .org $e000
   25                     ;
   26                     ;       dummy handler
   27                     ;
   28  00:E000            interrupt_dummy:
   29  00:E000  40                rti
   30                     
   31  00:E001            interrupt_dummy2:
   32  00:E001  40                rti
   33                     
   34  00:E002            interrupt_dummy3:
   35  00:E002  40                rti
   36                     
   37  00:E003            interrupt_dummy4:
   38  00:E003  40                rti
   39                     ;
   40                     ;       RESET interrupt handler
   41                     ;
   42  00:E004            interrupt_reset:
   43  00:E004  78                sei                             ; disable interrupt
   44  00:E005  D4                csh                             ; high speed mode
   45  00:E006  D8                cld                             ; 
   46                     
   47  00:E007  A2 FF             ldx     #$ff                    ; initialize stack pointer
   48  00:E009  9A                txs
   49                     
   50  00:E00A  A9 FF             lda     #$ff                    ; map i/o bank
   51  00:E00C  53 01             tam0
   52  00:E00E  A9 F8             lda     #$f8                    ; map ram bank
   53  00:E010  53 02             tam1
   54                     
   55  00:E012  9C 00 20          stz     $2000                   ; clear ram
   56  00:E015  73 00 20          tii     $2000,$2001,$1fff
       00:E018  01 20 FF  
       00:E01B  1F        
   57                             
   58  00:E01C  9C 01 0C          stz     TimerCtrl               ; stop timer
   59                     
   60  00:E01F  20 3E E0          jsr     initPsg
   61  00:E022  20 62 E0          jsr     initVdc
   62  00:E025  20 BA E0          jsr     initPad
   63                     
   64  00:E028  9C 02 14          stz     IntCtrlMask             ; disable interrupt
   65                     
   66  00:E02B  A9 05             lda     #5
   67  00:E02D  8D 00 00          sta     VdcReg
   68  00:E030  A9 C8             lda     #$c8                    ; enable sprite & bg / disable interrupt
   69  00:E032  8D 02 00          sta     VdcDataL
   70  00:E035  23 00             st2     #0                      ; auto increment +1
   71                     
   72                     ;       jump to main
   73  00:E037  A9 01             lda     #BANK(main)
   74  00:E039  53 40             tam     #PAGE(main)
   75  00:E03B  4C 07 C0          jmp     main
   76                     ;
   77                     ;       initialize psg
   78                     ;
   79  00:E03E            initPsg:
   80  00:E03E  9C 01 08          stz     PsgMainVol
   81  00:E041  9C 09 08          stz     PsgLfoCtrl
   82                     
   83                     ;       disable all channels
   84  00:E044  A9 05             lda     #5
   85  00:E046  8D 00 08  .loop:  sta     PsgChannel
   86  00:E049  9C 01 08          stz     PsgMainVol
   87  00:E04C  9C 04 08          stz     PsgCtrl
   88  00:E04F  3A                dec     a
   89  00:E050  10 F4             bpl     .loop
   90                     
   91                     ;       disable noise(channel 4/5)
   92  00:E052  A9 04             lda     #4
   93  00:E054  8D 00 08          sta     PsgChannel
   94  00:E057  9C 07 08          stz     PsgNoise
   95  00:E05A  1A                inc     a
   96  00:E05B  8D 00 08          sta     PsgChannel
   97  00:E05E  9C 07 08          stz     PsgNoise
   98                     
   99  00:E061  60                rts
  100                     ;
  101                     ;       initialize VDC,VCE
  102                     ;       TODO: 解像度が横336ドット限定の設定になっている
  103                     
  104                     ; ----
  105                     ; HSR(xres)
  106                     ; ----
  107                     ; macros to calculate the value of the HSR VDC register
  108                     ; ----
  109                     ; IN :  xres, horizontal screen resolution
  110                     ; ----
  111                     
  112                     HSR     .macro
  113                              .if (\1 <= 272)
  114                               ; low res
  115                               .db $02
  116                               .db (18 - (((\1 / 8) - 1) / 2))
  117                              .else
  118                               ; high res
  119                               .db $03
  120                               .db (24 - (((\1 / 8) - 1) / 2))
  121                              .endif
  122                             .endm
  123                     
  124                     
  125                     ; ----
  126                     ; HDR(xres)
  127                     ; ----
  128                     ; macros to calculate the value of the HDR VDC register
  129                     ; ----
  130                     ; IN :  xres, horizontal screen resolution
  131                     ; ----
  132                     
  133                     HDR     .macro
  134                              .db ((\1 / 8) - 1)
  135                              .if (\1 <= 272)
  136                               ; low res
  137                               .db (38 - ((18 - (((\1 / 8) - 1) / 2)) + (\1 / 8)))
  138                              .else
  139                               ; high res
  140                               .db (54 - ((24 - (((\1 / 8) - 1) / 2)) + (\1 / 8)))
  141                              .endif
  142                             .endm
  143                     
  144                     
  145  00:E062            initVdc:
  146                     ;       set VDC registers from .table
  147  00:E062  82                clx
  148  00:E063            .loop:
  149  00:E063  BD 95 E0          lda     .table,x
  150  00:E066  F0 14             beq     .endloop
  151  00:E068  8D 00 00          sta     VdcReg
  152  00:E06B  E8                inx
  153  00:E06C  BD 95 E0          lda     .table,x
  154  00:E06F  8D 02 00          sta     VdcDataL
  155  00:E072  E8                inx
  156  00:E073  BD 95 E0          lda     .table,x
  157  00:E076  8D 03 00          sta     VdcDataH
  158  00:E079  E8                inx
  159  00:E07A  80 E7             bra     .loop
  160  00:E07C            .endloop:
  161                     
  162                     ;       init vce
  163                     ;        lda     #1              ;horizontal resolution >272!!!!!!
  164                     ;        sta     VceCtrl
  165  00:E07C  9C 00 04          stz     VceCtrl
  166                     
  167                     ;       clear vram
  168  00:E07F  03 00             st0     #0
  169  00:E081  13 00             st1     #0
  170  00:E083  23 00             st2     #0
  171  00:E085  03 02             st0     #2
  172                     
  173  00:E087  A2 80             ldx     #128
  174  00:E089  C2        .cl2:   cly
  175  00:E08A  13 00     .cl1:   st1     #0
  176  00:E08C  23 00             st2     #0
  177  00:E08E  88                dey
  178  00:E08F  D0 F9             bne     .cl1
  179  00:E091  CA                dex
  180  00:E092  D0 F5             bne     .cl2
  181                     
  182  00:E094  60                rts
  183                     
  184                     ;       resolution      256x240
  185                     ;       bat size        32x32
  186                     ;       satb copy       $7f00
  187  00:E095            .table:
  188  00:E095  05 00 00          .db     $05,$00,$00     ;control register
  189  00:E098  06 00 00          .db     $06,$00,$00     ;raster counter register
  190  00:E09B  07 00 00          .db     $07,$00,$00     ;x scroll register
  191  00:E09E  08 00 00          .db     $08,$00,$00     ;y scroll register
  192  00:E0A1  09 00 00          .db     $09,$00,$00     ;memory access width register
  193  00:E0A4  0A                .db     $0a             ;horizontal synchro register
  194  00:C0A5                    HSR     256
  195  00:E0A7  0B                .db     $0b             ;horizontal display register
  196  00:C0A8                    HDR     256
  197  00:E0AA  0C 02 0F          .db     $0c,$02,$0f     ;vertical synchro register
  198  00:E0AD  0D EF 00          .db     $0d,$ef,$00     ;vertical display register
  199  00:E0B0  0E 03 00          .db     $0e,$03,$00     ;vertical display end position register
  200  00:E0B3  0F 10 00          .db     $0f,$10,$00     ;dma control register
  201  00:E0B6  13 00 7F          .db     $13,$00,$7f     ;vram-satb source address register
  202  00:E0B9  00                .db     $00             ;end of table
  203                     ;
  204                     ;       initialize pad
  205                     ;
  206  00:E0BA            initPad:
  207  00:E0BA  64 00             stz     <zpad
  208  00:E0BC  64 02             stz     <zpadold
  209  00:E0BE  64 01             stz     <zpaddelta
  210  00:E0C0  60                rts
  211                     ;
  212                     ;       read pad
  213                     ;       TODO: support multi tap
  214  00:E0C1            readPad:
  215  00:E0C1  A9 01             lda     #1
  216  00:E0C3  8D 00 10          sta     PadPort
  217  00:E0C6  A9 03             lda     #3
  218  00:E0C8  8D 00 10          sta     PadPort
  219                     
  220  00:E0CB  A5 00             lda     <zpad
  221  00:E0CD  49 FF             eor     #$ff
  222  00:E0CF  85 02             sta     <zpadold
  223                     
  224  00:E0D1  A9 01             lda     #1
  225  00:E0D3  8D 00 10          sta     PadPort
  226  00:E0D6  22                sax                     ;wait 10 cycles
  227  00:E0D7  22                sax
  228  00:E0D8  EA                nop
  229  00:E0D9  EA                nop
  230  00:E0DA  AD 00 10          lda     PadPort
  231  00:E0DD  0A                asl     a
  232  00:E0DE  0A                asl     a
  233  00:E0DF  0A                asl     a
  234  00:E0E0  0A                asl     a
  235  00:E0E1  85 00             sta     <zpad
  236                     
  237  00:E0E3  9C 00 10          stz     PadPort
  238  00:E0E6  22                sax                     ;wait 10 cycles
  239  00:E0E7  22                sax
  240  00:E0E8  EA                nop
  241  00:E0E9  EA                nop
  242  00:E0EA  AD 00 10          lda     PadPort
  243  00:E0ED  29 0F             and     #$0f
  244  00:E0EF  05 00             ora     <zpad
  245  00:E0F1  49 FF             eor     #$ff
  246  00:E0F3  85 00             sta     <zpad
  247                     
  248  00:E0F5  25 02             and     <zpadold
  249  00:E0F7  85 01             sta     <zpaddelta
  250                     
  251  00:E0F9  60                rts
  252                     ;
  253           2000              .zp
  254  --:2000            zpad:          .ds 1   ;pad status
  255  --:2001            zpaddelta      .ds 1   ;pad status(delta)
  256  --:2002            zpadold        .ds 1   ;pad status(previous)
  257                     
#[1]   nibbler.asm
#[2]   main.asm
   16                             .include "main.asm"
    1                     ; Zero-page variables
    2                     
    3           2003              .zp
    4                     
    5  --:2003            ztmp0:  ds      1
    6  --:2004            ztmp1:  ds      1
    7  --:2005            ztmp2:  ds      1
    8  --:2006            ztmp3:  ds      1
    9  --:2007            ztmp4:  ds      1
   10  --:2008            ztmp5:  ds      1
   11  --:2009            ztmp6:  ds      1
   12                     
   13  --:200A            zarg0:  ds      1
   14  --:200B            zarg1:  ds      1
   15  --:200C            zarg2:  ds      1
   16  --:200D            zarg3:  ds      1
   17  --:200E            zarg4:  ds      1
   18  --:200F            zarg5:  ds      1
   19  --:2010            zarg6:  ds      1
   20  --:2011            zarg7:  ds      1
   21  --:2012            zarg8:  ds      1
   22                     
   23                     
   24                             ;; scroll counter
   25  --:2013            scrx:   .ds     2
   26  --:2015            scry:   .ds     2
   27                     
   28  --:2017            zframe: .ds     1
   29                     
   30                     
   31  --:2018            zdotnum:        ds      1
   32  --:2019            zwave:  ds      1
   33  --:201A            zdotpoint:      ds      2
   34  --:201C            ztime:  ds      2
   35                     
   36  --:201E            zscore: ds      5
   37  --:2023            zhiscore:       ds      5
   38                     
   39  --:2028            zhiscoreflg:    ds      1
   40                     
   41  --:2029            zleft:  ds      1
   42                     
   43                     
   44                     
   45                     ;--- CODE area ----------
   46                     
   47           E0FA              .code
   48           0001              .bank MAIN_BANK
   49           C000              .org  $C000
   50                     
   51                     ;       wait VSync (polling)
   52  01:C000            waitVsync:
   53  01:C000            .wait:
   54  01:C000  93 20 00          tst     #$20,VdcStatus
       01:C003  00        
   55  01:C004  F0 FA         beq     .wait
   56  01:C006  60            rts
   57                     
   58                     
   59                     
   60                     ;
   61                     ;       main
   62                     ;
   63  01:C007            main:   
   64  01:C007  A9 04             lda     #BANK(BgPattern)
   65  01:C009  53 04             tam     #PAGE(BgPattern)
   66                     
   67  01:C00B  A9 05             lda     #BANK(SpPattern)
   68  01:C00D  53 08             tam     #PAGE(SpPattern)
   69                     
   70  01:C00F  A9 06             lda     #BANK(WaveMap)
   71  01:C011  53 10             tam     #PAGE(WaveMap)
   72                     
   73                             ; set bg pattern
   74                     
   75  01:C013  03 00             st0     #0
   76  01:C015  A9 00             lda     #$00
   77  01:C017  8D 02 00          sta     VdcDataL
   78  01:C01A  A9 10             lda     #$10
   79  01:C01C  8D 03 00          sta     VdcDataH
   80  01:C01F  03 02             st0     #2
   81  01:C021  E3 00 40          tia     BgPattern,VdcData,BgPattern_size
       01:C024  02 00 40  
       01:C027  09        
   82                     
   83                             ; set bg palette
   84  01:C028  A9 00             lda     #LOW(0*16)
   85  01:C02A  8D 02 04          sta     VceIndexL
   86  01:C02D  A9 00             lda     #HIGH(0*16)
   87  01:C02F  8D 03 04          sta     VceIndexH
   88  01:C032  E3 40 4A          tia     BgPalette,VceData,16*16*2
       01:C035  04 04 00  
       01:C038  02        
   89                     
   90                             
   91                             ; set sprite pattern
   92  01:C039  03 00             st0     #0
   93  01:C03B  A9 00             lda     #$00
   94  01:C03D  8D 02 00          sta     VdcDataL
   95  01:C040  A9 40             lda     #$40
   96  01:C042  8D 03 00          sta     VdcDataH
   97  01:C045  03 02             st0     #2
   98  01:C047  E3 00 60          tia     SpPattern,VdcData,SpPattern_size
       01:C04A  02 00 00  
       01:C04D  09        
   99                     
  100                             ; set sprite palette
  101  01:C04E  A9 00             lda     #LOW(16*16)
  102  01:C050  8D 02 04          sta     VceIndexL
  103  01:C053  A9 01             lda     #HIGH(16*16)
  104  01:C055  8D 03 04          sta     VceIndexH
  105  01:C058  E3 00 69          tia     SpPalette,VceData,16*16*2
       01:C05B  04 04 00  
       01:C05E  02        
  106                     
  107                             ;vsync                  ; vsync to avoid snow
  108  01:C05F  20 00 C0          jsr     waitVsync
  109                     
  110                     
  111  01:C062  20 67 C5          jsr     spr_init
  112  01:C065  20 B4 C5          jsr     spr_update
  113                     
  114  01:C068  20 B5 C9          jsr     vqInit
  115                     
  116  01:C06B  20 D4 C4          jsr     initPsgTest
  117                     
  118  01:C06E  20 C4 C5          jsr     tkInit
  119                     
  120                     
  121                     
  122                     
  123  01:C071  20 85 C0          jsr     initGameParms
  124                     
  125  01:8074                    tkChangeTask_   tklInitWave
  126                     
  127                     
  128                             ;; initialize sprite
  129                     ;       jsr     plInit
  130                     
  131  01:C07C            mainloop:
  132  01:C07C  20 16 C6          jsr     tkDispatch
  133  01:C07F  20 3B C6          jsr     tkChangeTasks
  134  01:C082  4C 7C C0          jmp     mainloop
  135                     
  136  01:C085            initGameParms:
  137  01:C085  64 19             stz     <zwave
  138                     
  139  01:C087  A9 10             lda     #$10
  140  01:C089  85 1A             sta     <zdotpoint
  141  01:C08B  64 1B             stz     <zdotpoint+1
  142                     
  143  01:C08D  A9 00             lda     #$0
  144  01:C08F  85 1E             sta     <zscore
  145  01:C091  64 1F             stz     <zscore+1
  146  01:C093  64 20             stz     <zscore+2
  147  01:C095  64 21             stz     <zscore+3
  148  01:C097  64 22             stz     <zscore+4
  149                     
  150  01:C099  A9 10             lda     #$10
  151  01:C09B  85 23             sta     <zhiscore
  152  01:C09D  64 24             stz     <zhiscore+1
  153  01:C09F  A9 05             lda     #$05
  154  01:C0A1  64 25             stz     <zhiscore+2
  155  01:C0A3  64 26             stz     <zhiscore+3
  156  01:C0A5  64 27             stz     <zhiscore+4
  157                     
  158  01:C0A7  64 28             stz     <zhiscoreflg
  159                     
  160  01:C0A9  A9 02             lda     #2
  161  01:C0AB  85 29             sta     <zleft
  162                     
  163  01:C0AD  A9 02             lda     #2
  164  01:C0AF  85 41             sta     <zplspeed
  165                     
  166  01:C0B1  60                rts
  167                     
  168  01:C0B2            initWaveParms:
  169  01:C0B2  20 A6 CA          jsr     plInit
  170                     
  171  01:C0B5  A9 90             lda     #$90
  172  01:C0B7  85 1C             sta     <ztime
  173  01:C0B9  A9 09             lda     #$9
  174  01:C0BB  85 1D             sta     <ztime+1
  175  01:C0BD  20 D5 C0          jsr     DrawStatusString
  176                     
  177  01:C0C0  60                rts
  178                     
  179  01:C0C1            DrawWaveTask:
  180  01:C0C1  20 B2 C0          jsr     initWaveParms
  181  01:C0C4  20 50 C7          jsr     DrawWaveMap
  182                     ;       jsr     plInit
  183                     
  184                     ;       lda     #$90
  185                     ;       sta     <ztime
  186                     ;       lda     #$9
  187                     ;       sta     <ztime+1
  188                     ;       jsr     DrawStatusString
  189                     
  190  01:80C7                    tkYield_
  191                     
  192                     ;       tkChangeTask_   tklGameMain
  193  01:80CA                    tkChangeTask_   tklAppear
  194  01:80D2                    tkYield_
  195                     ;       bra     DrawWaveTask
  196                     
  197  01:C0D5            DrawStatusString:
  198                                                                     ;PLAYER1
  199  01:C0D5  A9 C0             lda #LOW(0+30*32)
  200  01:C0D7  85 0A         sta <zarg0
  201  01:C0D9  A9 03         lda #HIGH(0+30*32)
  202  01:C0DB  85 0B         sta <zarg1
  203  01:C0DD  A9 55             lda     #LOW(.player1)
  204  01:C0DF  85 0C             sta     <zarg2
  205  01:C0E1  A9 C1             lda     #HIGH(.player1)
  206  01:C0E3  85 0D             sta     <zarg3
  207  01:C0E5  A9 04             lda     #4
  208  01:C0E7  85 0E             sta     <zarg4
  209  01:C0E9  20 C2 C9          jsr     vqPush
  210                                                                     ;HISCORE
  211  01:C0EC  A9 E0             lda #LOW(0+31*32)
  212  01:C0EE  85 0A         sta <zarg0
  213  01:C0F0  A9 03         lda #HIGH(0+31*32)
  214  01:C0F2  85 0B         sta <zarg1
  215  01:C0F4  A9 5D             lda     #LOW(.hiscore)
  216  01:C0F6  85 0C             sta     <zarg2
  217  01:C0F8  A9 C1             lda     #HIGH(.hiscore)
  218  01:C0FA  85 0D             sta     <zarg3
  219  01:C0FC  A9 04             lda     #4
  220  01:C0FE  85 0E             sta     <zarg4
  221  01:C100  20 C2 C9          jsr     vqPush
  222                                                                     ;LEFT
  223  01:C103  A9 D6             lda #LOW(22+30*32)
  224  01:C105  85 0A         sta <zarg0
  225  01:C107  A9 03         lda #HIGH(22+30*32)
  226  01:C109  85 0B         sta <zarg1
  227  01:C10B  A9 65             lda     #LOW(.left)
  228  01:C10D  85 0C             sta     <zarg2
  229  01:C10F  A9 C1             lda     #HIGH(.left)
  230  01:C111  85 0D             sta     <zarg3
  231  01:C113  A9 02             lda     #2
  232  01:C115  85 0E             sta     <zarg4
  233  01:C117  20 C2 C9          jsr     vqPush
  234                                                                     ;TIME
  235  01:C11A  A9 F3             lda #LOW(19+31*32)
  236  01:C11C  85 0A         sta <zarg0
  237  01:C11E  A9 03         lda #HIGH(19+31*32)
  238  01:C120  85 0B         sta <zarg1
  239  01:C122  A9 71             lda     #LOW(strTime_yellow)
  240  01:C124  85 0C             sta     <zarg2
  241  01:C126  A9 C1             lda     #HIGH(strTime_yellow)
  242  01:C128  85 0D             sta     <zarg3
  243  01:C12A  A9 04             lda     #4
  244  01:C12C  85 0E             sta     <zarg4
  245  01:C12E  20 C2 C9          jsr     vqPush
  246                                                                     ;WAVE
  247  01:C131  A9 6A             lda #LOW(10+27*32)
  248  01:C133  85 0A         sta <zarg0
  249  01:C135  A9 03         lda #HIGH(10+27*32)
  250  01:C137  85 0B         sta <zarg1
  251  01:C139  A9 69             lda     #LOW(.wave)
  252  01:C13B  85 0C             sta     <zarg2
  253  01:C13D  A9 C1             lda     #HIGH(.wave)
  254  01:C13F  85 0D             sta     <zarg3
  255  01:C141  A9 04             lda     #4
  256  01:C143  85 0E             sta     <zarg4
  257  01:C145  20 C2 C9          jsr     vqPush
  258                     
  259  01:C148  20 16 C2          jsr     drawScore
  260  01:C14B  20 97 C2          jsr     drawHighScore
  261  01:C14E  20 71 C2          jsr     drawLeft
  262  01:C151  20 F0 C1          jsr     drawTime
  263                     
  264  01:C154  60                rts
  265  01:C155  26 E1     .player1:       dw      ($100+38)|BGPAL_YELLOW,($100+39)|BGPAL_YELLOW,($100+40)|BGPAL_YELLOW,($100+41)|BGPAL_YELLOW
       01:C157  27 E1     
       01:C159  28 E1     
       01:C15B  29 E1     
  266  01:C15D  2A A1     .hiscore:       dw      ($100+42)|BGPAL_RED   ,($100+43)|BGPAL_RED   ,($100+44)|BGPAL_RED   ,($100+45)|BGPAL_RED
       01:C15F  2B A1     
       01:C161  2C A1     
       01:C163  2D A1     
  267  01:C165  2E E1     .left:          dw      ($100+46)|BGPAL_YELLOW,($100+47)|BGPAL_YELLOW
       01:C167  2F E1     
  268                     ;.time:         dw      ($100+29)|BGPAL_YELLOW,($100+18)|BGPAL_YELLOW,($100+22)|BGPAL_YELLOW,($100+14)|BGPAL_YELLOW
  269  01:C169  20 F1     .wave:          dw      ($100+32)|BGPAL_WHITE ,($100+10)|BGPAL_WHITE ,($100+31)|BGPAL_WHITE ,($100+14)|BGPAL_WHITE 
       01:C16B  0A F1     
       01:C16D  1F F1     
       01:C16F  0E F1     
  270                     
  271  01:C171            strTime_yellow:
  272  01:C171  1D E1                     dw      ($100+29)|BGPAL_YELLOW,($100+18)|BGPAL_YELLOW,($100+22)|BGPAL_YELLOW,($100+14)|BGPAL_YELLOW
       01:C173  12 E1     
       01:C175  16 E1     
       01:C177  0E E1     
  273  01:C179            strTime_blue:
  274  01:C179  1D 91                     dw      ($100+29)|BGPAL_BLUE,($100+18)|BGPAL_BLUE,($100+22)|BGPAL_BLUE,($100+14)|BGPAL_BLUE
       01:C17B  12 91     
       01:C17D  16 91     
       01:C17F  0E 91     
  275                     
  276  01:C181            WaveClearTask:
  277                                                                     ;TIME->BONUS 書き換え
  278  01:C181  A9 F3             lda #LOW(19+31*32)
  279  01:C183  85 0A         sta <zarg0
  280  01:C185  A9 03         lda #HIGH(19+31*32)
  281  01:C187  85 0B         sta <zarg1
  282  01:C189  A9 E8             lda     #LOW(.bonus)
  283  01:C18B  85 0C             sta     <zarg2
  284  01:C18D  A9 C1             lda     #HIGH(.bonus)
  285  01:C18F  85 0D             sta     <zarg3
  286  01:C191  A9 04             lda     #4
  287  01:C193  85 0E             sta     <zarg4
  288  01:C195  20 C2 C9          jsr     vqPush
  289                     
  290                                                                     ;点数
  291                     ;       lda     #$10
  292  01:C198  A5 1A             lda     <zdotpoint
  293  01:C19A  85 2A             sta     <zpoint
  294  01:C19C  A5 1B             lda     <zdotpoint+1
  295  01:C19E  85 2B             sta     <zpoint+1
  296                                                                     ;残りタイムをスコアに加算する
  297  01:C1A0            .bonusloop:
  298  01:C1A0  F8                sed
  299                     
  300  01:C1A1  A5 1C             lda     <ztime
  301  01:C1A3  D0 0A             bne     .count
  302  01:C1A5  A5 1D             lda     <ztime+1
  303  01:C1A7  F0 1A             beq     .endtime
  304                             
  305  01:C1A9  38                sec
  306  01:C1AA  E9 01             sbc     #1
  307  01:C1AC  85 1D             sta     <ztime+1
  308  01:C1AE  62                cla
  309  01:C1AF            .count:
  310  01:C1AF  38                sec
  311  01:C1B0  E9 0A             sbc     #10
  312  01:C1B2  85 1C             sta     <ztime
  313                     
  314  01:C1B4  D8                cld
  315                     
  316  01:C1B5  20 1D C3          jsr     addScore
  317                     
  318  01:C1B8  20 F0 C1          jsr     drawTime
  319  01:C1BB  20 16 C2          jsr     drawScore
  320                     
  321  01:81BE                    tkYield_
  322  01:C1C1  80 DD             bra     .bonusloop
  323                     
  324                                                                     ;終了
  325  01:C1C3            .endtime:
  326  01:C1C3  D8                cld
  327                     
  328  01:C1C4  A5 19             lda     <zwave
  329  01:C1C6  1A                inc     a
  330  01:C1C7  C9 64             cmp     #100
  331  01:C1C9  30 01             bmi     .set
  332  01:C1CB  62                cla
  333  01:C1CC            .set:
  334  01:C1CC  85 19             sta     <zwave
  335                     
  336                                                                     ;素点を増やす
  337  01:C1CE  F8                sed
  338  01:C1CF  A5 1A             lda     <zdotpoint
  339  01:C1D1  18                clc
  340  01:C1D2  69 10             adc     #$10
  341  01:C1D4  85 1A             sta     <zdotpoint
  342  01:C1D6  A5 1B             lda     <zdotpoint+1
  343  01:C1D8  69 00             adc     #0
  344  01:C1DA  85 1B             sta     <zdotpoint+1
  345  01:C1DC  D8                cld
  346                     
  347  01:81DD                    tkChangeTask_   tklInitWave
  348  01:81E5                    tkYield_
  349                     
  350  01:C1E8  33 E1     .bonus:         dw      BG_SPACE|BGPAL_YELLOW,BG_BONUS|BGPAL_YELLOW,(BG_BONUS+1)|BGPAL_YELLOW,(BG_BONUS+2)|BGPAL_YELLOW
       01:C1EA  30 E1     
       01:C1EC  31 E1     
       01:C1EE  32 E1     
  351                     
  352                     
  353  01:C1F0            drawTime:
  354  01:C1F0  A9 F7             lda #LOW(23+31*32)
  355  01:C1F2  85 0A         sta <zarg0
  356  01:C1F4  A9 03         lda #HIGH(23+31*32)
  357  01:C1F6  85 0B         sta <zarg1
  358  01:C1F8  A9 00             lda     #LOW(timerBuffer)
  359  01:C1FA  85 0C             sta     <zarg2
  360  01:C1FC  A9 22             lda     #HIGH(timerBuffer)
  361  01:C1FE  85 0D             sta     <zarg3
  362  01:C200  A9 02             lda     #2
  363  01:C202  85 0E             sta     <zarg4
  364  01:C204  A9 1C             lda     #LOW(ztime)
  365  01:C206  85 0F             sta     <zarg5
  366  01:C208  A9 20             lda     #HIGH(ztime)
  367  01:C20A  85 10             sta     <zarg6
  368  01:C20C  64 11             stz     <zarg7
  369  01:C20E  A9 F0             lda     #HIGH(BGPAL_WHITE)
  370  01:C210  85 12             sta     <zarg8
  371  01:C212  20 1F CA          jsr     drawDigits
  372                     
  373  01:C215  60                rts
  374                     
  375  01:C216            drawScore:
  376  01:C216  A9 C5             lda #LOW(5+30*32)
  377  01:C218  85 0A         sta <zarg0
  378  01:C21A  A9 03         lda #HIGH(5+30*32)
  379  01:C21C  85 0B         sta <zarg1
  380  01:C21E  A9 0C             lda     #LOW(scoreBuffer)
  381  01:C220  85 0C             sta     <zarg2
  382  01:C222  A9 22             lda     #HIGH(scoreBuffer)
  383  01:C224  85 0D             sta     <zarg3
  384  01:C226  A9 05             lda     #5
  385  01:C228  85 0E             sta     <zarg4
  386  01:C22A  A9 1E             lda     #LOW(zscore)
  387  01:C22C  85 0F             sta     <zarg5
  388  01:C22E  A9 20             lda     #HIGH(zscore)
  389  01:C230  85 10             sta     <zarg6
  390  01:C232  A9 03             lda     #3
  391  01:C234  85 11             sta     <zarg7
  392  01:C236  A9 F0             lda     #HIGH(BGPAL_WHITE)
  393  01:C238  85 12             sta     <zarg8
  394  01:C23A  20 1F CA          jsr     drawDigits
  395                     
  396                                                                     ;ハイスコアの場合はハイスコアも描画
  397  01:C23D  83 FF 28          tst     #$ff,<zhiscoreflg
  398  01:C240  F0 2E             beq     .ret
  399                     
  400  01:C242  C2                cly
  401  01:C243            .loop:
  402  01:C243  B9 0C 22          lda     scoreBuffer,y
  403  01:C246  99 26 22          sta     hiscoreBuffer,y
  404  01:C249  C8                iny
  405  01:C24A  B9 0C 22          lda     scoreBuffer,y
  406  01:C24D  29 0F             and     #$0f
  407  01:C24F  09 D0             ora     #HIGH(BGPAL_CYAN)
  408  01:C251  99 26 22          sta     hiscoreBuffer,y
  409  01:C254  C8                iny
  410  01:C255  C0 1A             cpy     #13*2
  411  01:C257  30 EA             bmi     .loop
  412                     
  413  01:C259  A9 E5             lda #LOW(5+31*32)
  414  01:C25B  85 0A         sta <zarg0
  415  01:C25D  A9 03         lda #HIGH(5+31*32)
  416  01:C25F  85 0B         sta <zarg1
  417  01:C261  A9 26             lda     #LOW(hiscoreBuffer)
  418  01:C263  85 0C             sta     <zarg2
  419  01:C265  A9 22             lda     #HIGH(hiscoreBuffer)
  420  01:C267  85 0D             sta     <zarg3
  421  01:C269  A9 0D             lda     #13
  422  01:C26B  85 0E             sta     <zarg4
  423  01:C26D  20 C2 C9          jsr     vqPush
  424                     ;       lda     #5
  425                     ;       sta     <zarg4
  426                     ;       lda     #LOW(zscore)
  427                     ;       sta     <zarg5
  428                     ;       lda     #HIGH(zscore)
  429                     ;       sta     <zarg6
  430                     ;       lda     #3
  431                     ;       sta     <zarg7
  432                     ;       lda     #HIGH(BGPAL_CYAN)
  433                     ;       sta     <zarg8
  434                     ;       jsr     drawDigits
  435                     
  436  01:C270            .ret:
  437  01:C270  60                rts
  438                     
  439  01:C271            drawLeft:
  440  01:C271  A9 D9             lda #LOW(25+30*32)
  441  01:C273  85 0A         sta <zarg0
  442  01:C275  A9 03         lda #HIGH(25+30*32)
  443  01:C277  85 0B         sta <zarg1
  444  01:C279  A9 08             lda     #LOW(leftBuffer)
  445  01:C27B  85 0C             sta     <zarg2
  446  01:C27D  A9 22             lda     #HIGH(leftBuffer)
  447  01:C27F  85 0D             sta     <zarg3
  448  01:C281  A9 01             lda     #1
  449  01:C283  85 0E             sta     <zarg4
  450  01:C285  A9 29             lda     #LOW(zleft)
  451  01:C287  85 0F             sta     <zarg5
  452  01:C289  A9 20             lda     #HIGH(zleft)
  453  01:C28B  85 10             sta     <zarg6
  454  01:C28D  64 11             stz     <zarg7
  455  01:C28F  A9 F0             lda     #HIGH(BGPAL_WHITE)
  456  01:C291  85 12             sta     <zarg8
  457  01:C293  20 1F CA          jsr     drawDigits
  458                     
  459  01:C296  60                rts
  460                     
  461  01:C297            drawHighScore:
  462  01:C297  83 FF 28          tst     #$ff,<zhiscoreflg
  463  01:C29A  D0 0A             bne     .top
  464  01:C29C  A9 23             lda     #LOW(zhiscore)
  465  01:C29E  85 0F             sta     <zarg5
  466  01:C2A0  A9 20             lda     #HIGH(zhiscore)
  467  01:C2A2  85 10             sta     <zarg6
  468  01:C2A4  80 08             bra     .d
  469  01:C2A6            .top:
  470  01:C2A6  A9 1E             lda     #LOW(zscore)
  471  01:C2A8  85 0F             sta     <zarg5
  472  01:C2AA  A9 20             lda     #HIGH(zscore)
  473  01:C2AC  85 10             sta     <zarg6
  474  01:C2AE            .d:
  475  01:C2AE  A9 E5             lda #LOW(5+31*32)
  476  01:C2B0  85 0A         sta <zarg0
  477  01:C2B2  A9 03         lda #HIGH(5+31*32)
  478  01:C2B4  85 0B         sta <zarg1
  479  01:C2B6  A9 26             lda     #LOW(hiscoreBuffer)
  480  01:C2B8  85 0C             sta     <zarg2
  481  01:C2BA  A9 22             lda     #HIGH(hiscoreBuffer)
  482  01:C2BC  85 0D             sta     <zarg3
  483  01:C2BE  A9 05             lda     #5
  484  01:C2C0  85 0E             sta     <zarg4
  485  01:C2C2  A9 03             lda     #3
  486  01:C2C4  85 11             sta     <zarg7
  487  01:C2C6  A9 D0             lda     #HIGH(BGPAL_CYAN)
  488  01:C2C8  85 12             sta     <zarg8
  489  01:C2CA  20 1F CA          jsr     drawDigits
  490                     
  491  01:C2CD  60                rts
  492                     
  493  01:C2CE            StatusTask:
  494                                                             ;TODO: タイマーの減少間隔調整
  495  01:C2CE  A5 17             lda     <zframe
  496  01:C2D0  29 1F             and     #32-1
  497  01:C2D2  D0 12             bne     .string
  498                     
  499  01:C2D4  F8                sed
  500  01:C2D5  A5 1C             lda     <ztime
  501  01:C2D7  38                sec
  502  01:C2D8  E9 0A             sbc     #10
  503  01:C2DA  85 1C             sta     <ztime
  504  01:C2DC  A5 1D             lda     <ztime+1
  505  01:C2DE  E9 00             sbc     #0
  506  01:C2E0  85 1D             sta     <ztime+1
  507  01:C2E2  D8                cld
  508                     
  509  01:C2E3  20 F0 C1          jsr     drawTime
  510                     
  511  01:C2E6            .string:
  512  01:C2E6  A5 17             lda     <zframe
  513  01:C2E8  29 0F             and     #16-1
  514  01:C2EA  D0 24             bne     .score
  515                     
  516  01:C2EC  4F 17 0A          bbr4    <zframe,.yellow
  517  01:C2EF  A9 79             lda     #LOW(strTime_blue)
  518  01:C2F1  85 0C             sta     <zarg2
  519  01:C2F3  A9 C1             lda     #HIGH(strTime_blue)
  520  01:C2F5  85 0D             sta     <zarg3
  521  01:C2F7  80 08             bra     .write
  522  01:C2F9            .yellow:
  523  01:C2F9  A9 71             lda     #LOW(strTime_yellow)
  524  01:C2FB  85 0C             sta     <zarg2
  525  01:C2FD  A9 C1             lda     #HIGH(strTime_yellow)
  526  01:C2FF  85 0D             sta     <zarg3
  527  01:C301            .write
  528  01:C301  A9 F3             lda #LOW(19+31*32)
  529  01:C303  85 0A         sta <zarg0
  530  01:C305  A9 03         lda #HIGH(19+31*32)
  531  01:C307  85 0B         sta <zarg1
  532  01:C309  A9 04             lda     #4
  533  01:C30B  85 0E             sta     <zarg4
  534  01:C30D  20 C2 C9          jsr     vqPush
  535                     
  536  01:C310            .score:
  537  01:C310  83 0F 17          tst     #$0f,<zframe
  538  01:C313  D0 03             bne     .yield
  539                     
  540  01:C315  20 16 C2          jsr     drawScore
  541  01:C318            .yield:
  542  01:8318                    tkYield_
  543  01:C31B  80 B1             bra     StatusTask
  544                     
  545                     
  546                     ;
  547                     ;       スコア加算
  548                     ;
  549                     ;       @args           zpoint = 加算する点数（2バイト、1000点の桁まで）
  550                     ;       @saveregs       x,y
  551                     ;       @return         なし
  552                     
  553  01:C31D            addScore:
  554           200A      .arg_scoreptr   equ     zarg0
  555                     
  556  01:C31D  F8                sed
  557                     
  558  01:C31E  A5 1E             lda     <zscore
  559  01:C320  18                clc
  560  01:C321  65 2A             adc     <zpoint
  561  01:C323  85 1E             sta     <zscore
  562  01:C325  A5 1F             lda     <zscore+1
  563  01:C327  65 2B             adc     <zpoint+1
  564  01:C329  85 1F             sta     <zscore+1
  565  01:C32B  A5 20             lda     <zscore+2
  566  01:C32D  69 00             adc     #0
  567  01:C32F  85 20             sta     <zscore+2
  568  01:C331  A5 21             lda     <zscore+3
  569  01:C333  69 00             adc     #0
  570  01:C335  85 21             sta     <zscore+3
  571  01:C337  A5 22             lda     <zscore+4
  572  01:C339  69 00             adc     #0
  573  01:C33B  85 22             sta     <zscore+4
  574                     
  575  01:C33D  D8                cld
  576                     
  577  01:C33E  20 42 C3          jsr     checkHighScore
  578  01:C341  60                rts
  579                     
  580                     ;
  581                     ;       ハイスコアを超えているか調べる
  582                     ;
  583  01:C342            checkHighScore:
  584  01:C342  83 FF 28          tst     #$ff,<zhiscoreflg
  585  01:C345  D0 20             bne     .ret
  586                     
  587  01:C347  A5 22             lda     <zscore+4
  588  01:C349  C5 27             cmp     <zhiscore+4
  589  01:C34B  30 1A             bmi     .ret
  590  01:C34D  A5 21             lda     <zscore+3
  591  01:C34F  C5 26             cmp     <zhiscore+3
  592  01:C351  30 14             bmi     .ret
  593  01:C353  A5 20             lda     <zscore+2
  594  01:C355  C5 25             cmp     <zhiscore+2
  595  01:C357  30 0E             bmi     .ret
  596  01:C359  A5 1F             lda     <zscore+1
  597  01:C35B  C5 24             cmp     <zhiscore+1
  598  01:C35D  30 08             bmi     .ret
  599  01:C35F  A5 1E             lda     <zscore+0
  600  01:C361  C5 23             cmp     <zhiscore+0
  601  01:C363  30 02             bmi     .ret
  602                     
  603  01:C365  E6 28             inc     <zhiscoreflg
  604                     
  605  01:C367            .ret:
  606  01:C367  60                rts
  607                     
  608                     
  609           202A              .zp
  610  --:202A            zpoint  ds      5
  611                     
  612                     
  613                     
  614                     
  615           2200              .bss
  616  --:2200            timerBuffer     ds      4*2
  617  --:2208            leftBuffer      ds      2*2
  618  --:220C            scoreBuffer     ds      (10+3)*2
  619  --:2226            hiscoreBuffer   ds      (10+3)*2
  620                     
  621           C368              .code
  622                     
  623                     ;
  624                     ;       vsync
  625                     ;
  626  01:C368            VSyncTask:
  627  01:C368  20 B4 C5      jsr spr_update
  628  01:C36B  20 00 C0      jsr waitVsync
  629                     
  630  01:C36E  20 E6 C9          jsr     vqDraw
  631                     
  632                     ;       scroll
  633  01:C371  03 07             st0     #7
  634  01:C373  9C 02 00          stz     VdcDataL
  635  01:C376  9C 03 00          stz     VdcDataH
  636                     
  637  01:C379  03 08             st0     #8
  638  01:C37B  A9 EF             lda     #$ef
  639  01:C37D  8D 02 00          sta     VdcDataL
  640  01:C380  A9 FF             lda     #$ff
  641  01:C382  8D 03 00          sta     VdcDataH
  642                     
  643  01:C385  20 C1 E0      jsr readPad
  644                     
  645  01:C388  E6 17             inc     <zframe
  646                             
  647  01:C38A  20 28 C6          jsr     tkYield
  648  01:C38D  80 D9             bra     VSyncTask
  649                     
  650                     ;
  651                     ;       nibbler出現時のアニメーション
  652                     ;
  653  01:C38F            NibblerAppearTask:
  654  01:C38F  A9 B6             lda     #LOW(.script)
  655  01:C391  85 0A             sta     <zarg0
  656  01:C393  A9 C3             lda     #HIGH(.script)
  657  01:C395  85 0B             sta     <zarg1
  658  01:C397  A9 02             lda     #2
  659  01:C399  85 0C             sta     <zarg2
  660  01:C39B  20 93 C6          jsr     scrInit
  661  01:C39E            .loop:
  662  01:C39E  20 A2 C6          jsr     scrExecute
  663  01:C3A1  B0 05             bcs     .end
  664  01:83A3                    tkYield_
  665  01:C3A6  80 F6             bra     .loop
  666                     
  667  01:C3A8            .end:
  668  01:C3A8  20 B2 C0          jsr     initWaveParms
  669                     
  670  01:83AB                    tkChangeTask_   tklGameMain
  671  01:83B3                    tkYield_
  672                     
  673                             ; nibbler出現時のアニメーションスクリプト
  674  01:C3B6            .script:
  675  01:83B6                    scrSetInterval_ 2
  676                             ; クロスハッチ用スプライト配置
  677  01:83B8                    scrSetSprite_   0,(11*3+1)*8+4,(4*3+1)*8+16*0,(SpritePatternAddress+08*64)/32,$82
  678  01:83C2                    scrSetSprite_   1,(11*3+1)*8+4,(4*3+1)*8+16*1,(SpritePatternAddress+08*64)/32,$82
  679  01:83CC                    scrSetSprite_   2,(11*3+1)*8+4,(4*3+1)*8+16*2,(SpritePatternAddress+08*64)/32,$82
  680  01:83D6                    scrSetSprite_   3,(11*3+1)*8+4,(4*3+1)*8+16*3,(SpritePatternAddress+08*64)/32,$82
  681  01:83E0                    scrSetSprite_   4,(11*3+1)*8+4,(4*3+1)*8+16*4,(SpritePatternAddress+08*64)/32,$82
  682  01:83EA                    scrWait_
  683                             ; クロスハッチを左から右に表示
  684  01:83EB                    scrSetSpritePattern_    0,(SpritePatternAddress+09*64)/32
  685  01:83EF                    scrWait_
  686  01:83F0                    scrSetSpritePattern_    0,(SpritePatternAddress+10*64)/32
  687  01:83F4                    scrWait_
  688                     
  689  01:83F5                    scrSetSpritePattern_    1,(SpritePatternAddress+09*64)/32
  690  01:83F9                    scrWait_
  691  01:83FA                    scrSetSpritePattern_    1,(SpritePatternAddress+10*64)/32
  692  01:83FE                    scrWait_
  693                     
  694  01:83FF                    scrSetSpritePattern_    2,(SpritePatternAddress+09*64)/32
  695  01:8403                    scrWait_
  696  01:8404                    scrSetSpritePattern_    2,(SpritePatternAddress+10*64)/32
  697  01:8408                    scrWait_
  698                     
  699  01:8409                    scrSetSpritePattern_    3,(SpritePatternAddress+09*64)/32
  700  01:840D                    scrWait_
  701  01:840E                    scrSetSpritePattern_    3,(SpritePatternAddress+10*64)/32
  702  01:8412                    scrWait_
  703                     
  704  01:8413                    scrSetSpritePattern_    4,(SpritePatternAddress+09*64)/32
  705  01:8417                    scrWait_
  706  01:8418                    scrSetSpritePattern_    4,(SpritePatternAddress+10*64)/32
  707  01:841C                    scrWait_
  708                             ; ヘビの体を表示
  709  01:841D                    scrSetBG_       11+25*32,.BodyParts_blue,6
  710  01:8423                    scrSetSprite_   5,(11*3+1)*8+4,(4*3+1)*8,(SpritePatternAddress+06*64)/32,$01
  711  01:842D                    scrSetSprite_   6,(11*3+1)*8+4,(4*3+1)*8+16+16+16+8,(SpritePatternAddress+01*64)/32,$81
  712  01:8437                    scrWait_
  713                             ; クロスハッチを左から右に消去
  714  01:8438                    scrSetSpritePattern_    0,(SpritePatternAddress+11*64)/32
  715  01:843C                    scrWait_
  716  01:843D                    scrSetSpritePattern_    0,(SpritePatternAddress+08*64)/32
  717  01:8441                    scrWait_
  718                     
  719  01:8442                    scrSetSpritePattern_    1,(SpritePatternAddress+11*64)/32
  720  01:8446                    scrWait_
  721  01:8447                    scrSetSpritePattern_    1,(SpritePatternAddress+08*64)/32
  722  01:844B                    scrWait_
  723                     
  724  01:844C                    scrSetSpritePattern_    2,(SpritePatternAddress+11*64)/32
  725  01:8450                    scrWait_
  726  01:8451                    scrSetSpritePattern_    2,(SpritePatternAddress+08*64)/32
  727  01:8455                    scrWait_
  728                     
  729  01:8456                    scrSetSpritePattern_    3,(SpritePatternAddress+11*64)/32
  730  01:845A                    scrWait_
  731  01:845B                    scrSetSpritePattern_    3,(SpritePatternAddress+08*64)/32
  732  01:845F                    scrWait_
  733                     
  734  01:8460                    scrSetSpritePattern_    4,(SpritePatternAddress+11*64)/32
  735  01:8464                    scrWait_
  736  01:8465                    scrSetSpritePattern_    4,(SpritePatternAddress+08*64)/32
  737  01:8469                    scrWait_
  738                             ; ヘビの体の色を左から右に変化
  739  01:846A                    scrSetSpriteAttribute_  5,$00
  740  01:846E                    scrWait_
  741  01:846F                    scrSetBG_       11+25*32,.BodyParts_red,1
  742  01:8475                    scrWait_
  743  01:8476                    scrSetBG_       12+25*32,.BodyParts_red,1
  744  01:847C                    scrWait_
  745  01:847D                    scrSetBG_       13+25*32,.BodyParts_red,1
  746  01:8483                    scrWait_
  747  01:8484                    scrSetBG_       14+25*32,.BodyParts_red,1
  748  01:848A                    scrWait_
  749  01:848B                    scrSetBG_       15+25*32,.BodyParts_red,1
  750  01:8491                    scrWait_
  751  01:8492                    scrSetBG_       16+25*32,.BodyParts_red,1
  752  01:8498                    scrWait_
  753  01:8499                    scrSetSpriteAttribute_  6,$00
  754  01:849D                    scrWait_
  755  01:849E                    scrWait_
  756                             ; スプライトの後始末
  757  01:849F                    scrSetSpriteAttribute_  0,$80   ;頭　スプライト優先
  758  01:84A3                    scrSetSpriteAttribute_  1,$00   ;尻尾
  759  01:84A7                    scrSetSpritePosition_   2,0,0
  760  01:84AD                    scrSetSpritePosition_   3,0,0
  761  01:84B3                    scrSetSpritePosition_   4,0,0
  762  01:84B9                    scrSetSpritePosition_   5,0,0
  763  01:84BF                    scrSetSpritePosition_   6,0,0
  764                     
  765  01:84C5                    scrEnd_
  766                     
  767                             ; 胴体表示データ（青）
  768  01:C4C6            .BodyParts_blue:
  769  01:C4C6  44 31             dw      BG_BODY_R | $3000
  770  01:C4C8  44 31             dw      BG_BODY_R | $3000
  771  01:C4CA  44 31             dw      BG_BODY_R | $3000
  772  01:C4CC  44 31             dw      BG_BODY_R | $3000
  773  01:C4CE  44 31             dw      BG_BODY_R | $3000
  774  01:C4D0  44 31             dw      BG_BODY_R | $3000
  775                     
  776                             ; 胴体表示データ（赤）
  777  01:C4D2            .BodyParts_red:
  778  01:C4D2  44 21             dw      BG_BODY_R | $2000
  779                     
  780                     
  781                     ;       psg test        
  782  01:C4D4            initPsgTest:
  783  01:C4D4  A9 00             lda     #0
  784  01:C4D6  8D 00 08          sta     PsgChannel
  785                     
  786                     ;       write wave data
  787  01:C4D9  A9 40             lda     #$40
  788  01:C4DB  8D 04 08          sta     PsgCtrl
  789  01:C4DE  9C 04 08          stz     PsgCtrl
  790                     
  791  01:C4E1  82                clx
  792  01:C4E2  BD 04 C5  .loop:  lda     .wave,x
  793  01:C4E5  C9 FF             cmp     #$ff
  794  01:C4E7  F0 06             beq     .loopend
  795  01:C4E9  8D 06 08          sta     PsgWave
  796  01:C4EC  E8                inx
  797  01:C4ED  80 F3             bra     .loop
  798                     
  799  01:C4EF            .loopend:
  800                     ;       set frequency
  801  01:C4EF  A9 FE             lda     #$fe
  802  01:C4F1  8D 02 08          sta     PsgFreqL
  803  01:C4F4  9C 03 08          stz     PsgFreqH
  804                     
  805                     ;       set volume
  806                             ;lda    #$ff
  807  01:C4F7  62                cla
  808  01:C4F8  8D 05 08          sta     PsgChVol
  809  01:C4FB  8D 01 08          sta     PsgMainVol
  810                     
  811  01:C4FE  A9 8F             lda     #$8f
  812  01:C500  8D 04 08          sta     PsgCtrl
  813                     
  814  01:C503  60                rts
  815                     
  816  01:C504            .wave:
  817  01:C504  1F 1D 1B          .db     $1f,$1d,$1b,$19,$17,$15,$13,$11
       01:C507  19 17 15  
       01:C50A  13 11     
  818  01:C50C  0F 0D 0B          .db     $0f,$0d,$0b,$09,$07,$05,$03,$01
       01:C50F  09 07 05  
       01:C512  03 01     
  819  01:C514  1F 1D 1B          .db     $1f,$1d,$1b,$19,$17,$15,$13,$11
       01:C517  19 17 15  
       01:C51A  13 11     
  820  01:C51C  0F 0D 0B          .db     $0f,$0d,$0b,$09,$07,$05,$03,$01
       01:C51F  09 07 05  
       01:C522  03 01     
  821  01:C524  FF                .db     $ff     
  822                     
  823  01:C525  1F 1F 1F          .db     $1f,$1f,$1f,$1f,$1f,$1f,$1f,$1f
       01:C528  1F 1F 1F  
       01:C52B  1F 1F     
  824  01:C52D  00 00 00          .db     $00,$00,$00,$00,$00,$00,$00,$00
       01:C530  00 00 00  
       01:C533  00 00     
  825  01:C535  00 00 00          .db     $00,$00,$00,$00,$00,$00,$00,$00
       01:C538  00 00 00  
       01:C53B  00 00     
  826  01:C53D  00 00 00          .db     $00,$00,$00,$00,$00,$00,$00,$00
       01:C540  00 00 00  
       01:C543  00 00     
  827  01:C545  FF                .db     $ff
  828                     
  829  01:C546  0F 12 15          .db     $0f,$12,$15,$17,$19,$1b,$1d,$1E
       01:C549  17 19 1B  
       01:C54C  1D 1E     
  830  01:C54E  1E 1E 1D          .db     $1e,$1e,$1d,$1b,$19,$17,$15,$12
       01:C551  1B 19 17  
       01:C554  15 12     
  831  01:C556  0F 0C 09          .db     $0f,$0c,$09,$07,$05,$03,$01,$00
       01:C559  07 05 03  
       01:C55C  01 00     
  832  01:C55E  00 00 01          .db     $00,$00,$01,$03,$05,$07,$09,$0c
       01:C561  03 05 07  
       01:C564  09 0C     
  833  01:C566  FF                .db     $ff     
  834                     
  835                     
  836  01:C567            spr_init:
  837                     
  838                             ;; clear satb
  839  01:C567  9C 40 22          stz     satb
  840  01:C56A  73 40 22          tii     satb,satb+1,512-1
       01:C56D  41 22 FF  
       01:C570  01        
  841                     
  842                             ;; set satb 0
  843  01:C571  A9 40             lda     #$40
  844  01:C573  8D 40 22          sta     satb+0
  845  01:C576  9C 41 22          stz     satb+1
  846                     
  847  01:C579  A9 20             lda     #$20
  848  01:C57B  8D 42 22          sta     satb+2
  849  01:C57E  9C 43 22          stz     satb+3
  850                     
  851  01:C581  9C 44 22          stz     satb+4
  852  01:C584  A9 02             lda     #$2             ;vram address = $4000 -> $200
  853  01:C586  8D 45 22          sta     satb+5
  854                     
  855  01:C589  A9 80             lda     #$80            ;priority  & color=0
  856  01:C58B  8D 46 22          sta     satb+6
  857  01:C58E  9C 47 22          stz     satb+7
  858                     
  859                     
  860                             ;; set satb 1
  861  01:C591  A9 40             lda     #$40
  862  01:C593  8D 48 22          sta     satb+8
  863  01:C596  9C 49 22          stz     satb+9
  864                     
  865  01:C599  A9 20             lda     #$20
  866  01:C59B  8D 4A 22          sta     satb+10
  867  01:C59E  9C 4B 22          stz     satb+11
  868                     
  869  01:C5A1  A9 04             lda     #4
  870  01:C5A3  8D 4C 22          sta     satb+12
  871  01:C5A6  A9 02             lda     #$2             ;vram address = $4000 -> $200
  872  01:C5A8  8D 4D 22          sta     satb+13
  873                     
  874  01:C5AB  A9 80             lda     #$80            ;priority  & color=0
  875  01:C5AD  8D 4E 22          sta     satb+14
  876  01:C5B0  9C 4F 22          stz     satb+15
  877                     
  878  01:C5B3  60                rts
  879                     
  880                     
  881  01:C5B4            spr_update:
  882  01:C5B4  03 00             st0     #0
  883  01:C5B6  13 00             st1     #$00
  884  01:C5B8  23 7F             st2     #$7f
  885  01:C5BA  03 02             st0     #2
  886  01:C5BC  E3 40 22          tia     satb,VdcDataL,512
       01:C5BF  02 00 00  
       01:C5C2  02        
  887  01:C5C3  60                rts
  888                     
  889                     
  890                     
  891                             ;...
  892                             ;; satb
  893           2240              .bss
  894  --:2240            satb    .ds 512 ; the local SATB
#[1]   nibbler.asm
#[2]   task.asm
   17                             .include "task.asm"
    1                     
    2                     
    3           0004      TK_MAX_TASK equ 4               ;タスク数
    4           0010      TK_TASK_STACK_SIZE  equ 16      ;タスクあたりのスタックサイズ
    5           2100      TK_STACK_AREA   equ $2100       ;スタック開始アドレス
    6                     
    7           202F          .zp
    8  --:202F            ztkTaskNum: ds  1
    9  --:2030            ztkSaveSp:  ds  1               ;tkDispatch 実行時のsp保存
   10  --:2031            ztkCurTask: ds  1               ;tkDispatch 実行中のタスク番号
   11  --:2032            ztkChgTask: ds  2
   12                     
   13           2440          .bss
   14                     
   15  --:2440            tkSp:   ds  TK_MAX_TASK         ;タスクのsp
   16                     
   17           C5C4          .code
   18           0001          .bank   MAIN_BANK
   19                     
   20                     
   21                     ;
   22                     ;   タスク初期化
   23                     ;   @args           なし
   24                     ;   @saveregs       なし
   25                     ;   @return         なし
   26                     ;
   27                                     ;pレジスタも保管すると、割り込み状態も変わってしまって予期せぬ動きに繋がりかね
   28                                     ;実際、禁止していた割り込みが勝手にかかってしまい、おかしな動きになってしまっ
   29  01:C5C4            tkInit:
   30  01:C5C4  9C 2F 20      stz ztkTaskNum
   31                     
   32  01:C5C7  A9 71         lda #LOW(tklNone)
   33  01:C5C9  85 0C         sta <zarg2
   34  01:C5CB  A9 C6         lda #HIGH(tklNone)
   35  01:C5CD  85 0D         sta <zarg3
   36  01:C5CF  20 FB C5      jsr tkSetAllTasks
   37                     
   38  01:85D2                tkChangeTask_   0
   39  01:C5DA  60            rts
   40                     
   41                     ;
   42                     ;   タスク変更
   43                     ;   @args           zarg0,1 = タスク開始アドレス
   44                     ;                   x = タスク番号
   45                     ;   @saveregs       x
   46                     ;   @return         なし
   47                     ;
   48  01:C5DB            tkSetTask:
   49  01:C5DB  DA            phx
   50                     
   51  01:C5DC  8A            txa
   52  01:C5DD  1A            inc a
   53           0001          .if TK_TASK_STACK_SIZE=16
   54  01:C5DE  0A            asl a
   55  01:C5DF  0A            asl a
   56  01:C5E0  0A            asl a
   57  01:C5E1  0A            asl a
   58                         .else
   60                         .endif
   61  01:C5E2  9D 40 24      sta tkSp,x
   62                     
   63  01:C5E5  AA            tax
   64  01:C5E6  9E 01 21      stz TK_STACK_AREA+1,x
   65  01:C5E9  9E 02 21      stz TK_STACK_AREA+2,x
   66  01:C5EC  9E 03 21      stz TK_STACK_AREA+3,x
   67  01:C5EF  A5 0A         lda <zarg0
   68  01:C5F1  9D 04 21      sta TK_STACK_AREA+4,x
   69  01:C5F4  A5 0B         lda <zarg1
   70  01:C5F6  9D 05 21      sta TK_STACK_AREA+5,x
   71                     
   72  01:C5F9  FA            plx
   73  01:C5FA  60            rts
   74                     
   75                     ;
   76                     ;   全てのタスク変更
   77                     ;   @args           zarg2,3 = タスクリストアドレス
   78                     ;   @saveregs       なし
   79                     ;   @return         なし
   80                     ;
   81  01:C5FB            tkSetAllTasks:
   82  01:C5FB  82            clx
   83  01:C5FC  C2            cly
   84                     
   85  01:C5FD            .loop:
   86  01:C5FD  B1 0C         lda [zarg2],y
   87  01:C5FF  85 0A         sta <zarg0
   88  01:C601  C8            iny
   89  01:C602  11 0C         ora [zarg2],y
   90  01:C604  F0 0D         beq .taskend
   91                     
   92  01:C606  B1 0C         lda [zarg2],y
   93  01:C608  85 0B         sta <zarg1
   94  01:C60A  20 DB C5      jsr tkSetTask
   95                     
   96  01:C60D  C8            iny
   97  01:C60E  E8            inx
   98  01:C60F  E0 04         cpx #TK_MAX_TASK
   99  01:C611  D0 EA         bne .loop
  100  01:C613            .taskend:
  101  01:C613  86 2F         stx <ztkTaskNum
  102                     
  103  01:C615  60            rts
  104                     
  105                     
  106                     
  107                     ;
  108                     ;   タスクの実行
  109                     ;   @args           なし
  110                     ;   @saveregs       なし
  111                     ;   @return         なし
  112                     ;
  113  01:C616            tkDispatch:
  114                                         ;タスクがない場合
  115  01:C616  A5 2F         lda <ztkTaskNum
  116  01:C618  F0 20         beq tkDispatch_end
  117                     
  118                                         ;このルーチン開始時のspを保管
  119  01:C61A  BA            tsx
  120  01:C61B  86 30         stx <ztkSaveSp
  121                     
  122  01:C61D  C2            cly             ;y=タスク番号
  123                     
  124  01:C61E            tkDispatch_loop:
  125                                         ;タスクを実行
  126                                         ;タスクのspを復元
  127  01:C61E  BE 40 24      ldx tkSp,y
  128  01:C621  9A            txs
  129  01:C622  84 31         sty <ztkCurTask ;現在のタスク番号を保管
  130                                         ;タスクのレジスタを復元
  131  01:C624  7A            ply
  132  01:C625  FA            plx
  133  01:C626  68            pla
  134  01:C627  60            rts             ;タスクの実行アドレスにジャンプ
  135                     
  136                                         ;タスク切り替え
  137  01:C628            tkYield:
  138                                         ;タスクのレジスタを保管
  139  01:C628  48            pha
  140  01:C629  DA            phx
  141  01:C62A  5A            phy
  142                                         ;タスクのspを保管
  143  01:C62B  A4 31         ldy <ztkCurTask ;y=現在のタスク番号
  144  01:C62D  BA            tsx
  145  01:C62E  8A            txa
  146  01:C62F  99 40 24      sta tkSp,y      
  147                                         ;次のタスク
  148  01:C632            tkNextTask:
  149  01:C632  C8            iny
  150                     ;    cpy #TK_MAX_TASK
  151  01:C633  C4 2F         cpy <ztkTaskNum
  152  01:C635  D0 E7         bne tkDispatch_loop
  153                                         ;tkDispatch開始時のspを復元
  154  01:C637  A6 30         ldx <ztkSaveSp
  155  01:C639  9A            txs
  156                     
  157  01:C63A            tkDispatch_end:
  158  01:C63A  60            rts
  159                     
  160                     ;
  161                     ;
  162                     ;
  163  01:C63B            tkChangeTasks:
  164  01:C63B  A5 32         lda <ztkChgTask
  165                     ;    bit <ztkChgTask+1
  166  01:C63D  05 33         ora <ztkChgTask+1
  167  01:C63F  D0 01         bne .chg
  168  01:C641  60            rts
  169  01:C642            .chg:
  170  01:C642  A5 32         lda <ztkChgTask
  171  01:C644  85 0C         sta <zarg2
  172  01:C646  A5 33         lda <ztkChgTask+1
  173  01:C648  85 0D         sta <zarg3
  174  01:C64A  20 FB C5      jsr tkSetAllTasks
  175                     
  176  01:864D                tkChangeTask_   0
  177  01:C655  60            rts
  178                     ;
  179                     ;   実行中のタスクの変更
  180                     ;   ※タスク内からの呼び出し専用
  181                     ;   @args           zarg0,1 = タスク開始アドレス
  182                     ;   @saveregs       なし
  183                     ;   @return         なし
  184                     ;
  185  01:C656            tkLink:
  186                                         ;タスクのレジスタを保管
  187  01:C656  48            pha
  188  01:C657  DA            phx
  189  01:C658  5A            phy
  190                                         ;タスクのspを保管
  191  01:C659  A4 31         ldy <ztkCurTask ;y=現在のタスク番号
  192  01:C65B  BA            tsx
  193  01:C65C  8A            txa
  194  01:C65D  99 40 24      sta tkSp,y      
  195                                         ;タスクの開始アドレスを変更
  196  01:C660  A5 0A         lda <zarg0
  197  01:C662  9D 04 21      sta TK_STACK_AREA+4,x
  198  01:C665  A5 0B         lda <zarg1
  199  01:C667  9D 05 21      sta TK_STACK_AREA+5,x
  200                     
  201  01:C66A  80 C6         bra tkNextTask
  202                     
  203                     
  204                     
  205                     
  206                     ;
  207                     ;   何もしないタスク
  208                     ;
  209  01:C66C            tkDummyTask:
  210  01:C66C  20 28 C6      jsr tkYield
  211  01:C66F  80 FB         bra tkDummyTask
  212                     
  213                     
  214                     
  215                     ;
  216                     ;   タスクリスト
  217                     ;
  218                     ;
  219                     tkTaskAddress_  .macro
  220                     ;    .if \1!=0
  221                         dw  \1-1
  222                     ;    .else
  223                     ;    dw  0
  224                     ;    .endif
  225                         .endm
  226                     
  227                     tkEndTaskList_  .macro
  228                         dw  0
  229                         .endm
  230                     
  231                     
  232  01:C671            tklNone:
  233  01:8671                tkEndTaskList_
  234                     
  235  01:C673            tklInitWave:
  236  01:8673                tkTaskAddress_  DrawWaveTask
  237  01:8675                tkTaskAddress_  VSyncTask
  238  01:8677                tkEndTaskList_
  239                     
  240  01:C679            tklAppear:
  241  01:8679                tkTaskAddress_  NibblerAppearTask
  242  01:867B                tkTaskAddress_  VSyncTask
  243  01:867D                tkEndTaskList_
  244                     
  245  01:C67F            tklGameMain:
  246  01:867F                tkTaskAddress_  plTask
  247  01:8681                tkTaskAddress_  StatusTask
  248  01:8683                tkTaskAddress_  VSyncTask
  249  01:8685                tkEndTaskList_
  250                     
  251  01:C687            tklDead:
  252  01:8687                tkTaskAddress_  plDeadTask
  253  01:8689                tkTaskAddress_  VSyncTask
  254  01:868B                tkEndTaskList_
  255                     
  256  01:C68D            tklClearWave:
  257  01:868D                tkTaskAddress_  WaveClearTask
  258  01:868F                tkTaskAddress_  VSyncTask
  259  01:8691                tkEndTaskList_
#[1]   nibbler.asm
#[2]   script.asm
   18                         .include "script.asm"
    1           2034          .zp
    2  --:2034            zscrptr:    ds  2
    3  --:2036            zscrcounter:    ds  1
    4  --:2037            zscrinterval:   ds  1   
    5                     
    6           C693          .code
    7           0001          .bank   MAIN_BANK
    8                     
    9  01:C693            scrInit:
   10           200A      .arg_script equ zarg0
   11           200B      .arg_interval   equ zarg1
   12  01:C693  A5 0A         lda <zarg0
   13  01:C695  85 34         sta <zscrptr
   14  01:C697  A5 0B         lda <zarg1
   15  01:C699  85 35         sta <zscrptr+1
   16  01:C69B  A5 0C         lda <zarg2
   17  01:C69D  85 37         sta <zscrinterval
   18  01:C69F  85 36         sta <zscrcounter
   19                     
   20  01:C6A1  60            rts
   21                     
   22  01:C6A2            scrExecute:
   23  01:C6A2  83 FF 36      tst #$ff,<zscrcounter
   24  01:C6A5  F0 04         beq .go
   25                     
   26  01:C6A7  C6 36         dec <zscrcounter
   27  01:C6A9  18            clc
   28  01:C6AA  60            rts
   29                     
   30  01:C6AB            .go:
   31  01:C6AB  A5 37         lda <zscrinterval
   32  01:C6AD  85 36         sta <zscrcounter
   33                     
   34  01:C6AF  C2            cly
   35  01:C6B0            scrExecute_next:
   36  01:C6B0  B1 34         lda [zscrptr],y
   37  01:C6B2  C8            iny
   38  01:C6B3  AA            tax
   39  01:C6B4  7C B7 C6      jmp [.jmptbl,x]
   40                     
   41  01:C6B7            .jmptbl:
   42  01:C6B7  C7 C6         dw  scrcmd_end
   43  01:C6B9  C9 C6         dw  scrcmd_wait
   44  01:C6BB  D7 C6         dw  scrcmd_setinterval
   45  01:C6BD  E1 C6         dw  scrcmd_setsprite
   46  01:C6BF  FD C6         dw  scrcmd_setsprite_position
   47  01:C6C1  05 C7         dw  scrcmd_setsprite_pattern
   48  01:C6C3  0F C7         dw  scrcmd_setsprite_attribute
   49  01:C6C5  19 C7         dw  scrcmd_setbg
   50                     
   51  01:C6C7            scrcmd_end:
   52  01:C6C7  38            sec
   53  01:C6C8  60            rts
   54                     
   55  01:C6C9            scrcmd_wait:
   56  01:C6C9  98            tya
   57  01:C6CA  18            clc
   58  01:C6CB  65 34         adc <zscrptr
   59  01:C6CD  85 34         sta <zscrptr
   60  01:C6CF  A5 35         lda <zscrptr+1
   61  01:C6D1  69 00         adc #0
   62  01:C6D3  85 35         sta <zscrptr+1
   63                     
   64  01:C6D5  18            clc
   65  01:C6D6  60            rts
   66                     
   67  01:C6D7            scrcmd_setinterval:
   68  01:C6D7  B1 34         lda [zscrptr],y
   69  01:C6D9  C8            iny
   70  01:C6DA  85 37         sta <zscrinterval
   71  01:C6DC  85 36         sta <zscrcounter
   72  01:C6DE  4C B0 C6      jmp scrExecute_next
   73                     
   74  01:C6E1            scrcmd_setsprite:
   75  01:C6E1  64 03         stz <ztmp0
   76  01:C6E3  A9 08         lda #8
   77  01:C6E5  85 04         sta <ztmp1
   78                     
   79  01:C6E7            scrcmd_setsprite_loop:
   80  01:C6E7  B1 34         lda [zscrptr],y
   81  01:C6E9  C8            iny
   82  01:C6EA  0A            asl a
   83  01:C6EB  0A            asl a
   84  01:C6EC  0A            asl a
   85  01:C6ED  65 03         adc <ztmp0
   86  01:C6EF  AA            tax
   87  01:C6F0            .loop:
   88  01:C6F0  B1 34         lda [zscrptr],y
   89  01:C6F2  C8            iny
   90  01:C6F3  9D 40 22      sta satb,x
   91  01:C6F6  E8            inx
   92                     
   93  01:C6F7  C6 04         dec <ztmp1
   94  01:C6F9  D0 F5         bne .loop
   95                     
   96  01:C6FB  80 B3         bra scrExecute_next
   97                     
   98  01:C6FD            scrcmd_setsprite_position:
   99  01:C6FD  64 03         stz <ztmp0
  100  01:C6FF  A9 04         lda #4
  101  01:C701  85 04         sta <ztmp1
  102  01:C703  80 E2         bra scrcmd_setsprite_loop
  103                     
  104  01:C705            scrcmd_setsprite_pattern:
  105  01:C705  A9 04         lda #4
  106  01:C707  85 03         sta <ztmp0
  107  01:C709  A9 02         lda #2
  108  01:C70B  85 04         sta <ztmp1
  109  01:C70D  80 D8         bra scrcmd_setsprite_loop
  110                     
  111  01:C70F            scrcmd_setsprite_attribute:
  112  01:C70F  A9 06         lda #6
  113  01:C711  85 03         sta <ztmp0
  114  01:C713  A9 02         lda #2
  115  01:C715  85 04         sta <ztmp1
  116  01:C717  80 CE         bra scrcmd_setsprite_loop
  117                     
  118  01:C719            scrcmd_setbg:
  119  01:C719  B1 34         lda [zscrptr],y
  120  01:C71B  C8            iny
  121  01:C71C  85 0A         sta <zarg0
  122  01:C71E  B1 34         lda [zscrptr],y
  123  01:C720  C8            iny
  124  01:C721  85 0B         sta <zarg1
  125  01:C723  B1 34         lda [zscrptr],y
  126  01:C725  C8            iny
  127  01:C726  85 0C         sta <zarg2
  128  01:C728  B1 34         lda [zscrptr],y
  129  01:C72A  C8            iny
  130  01:C72B  85 0D         sta <zarg3
  131  01:C72D  B1 34         lda [zscrptr],y
  132  01:C72F  C8            iny
  133  01:C730  85 0E         sta <zarg4
  134  01:C732  5A            phy
  135  01:C733  20 C2 C9      jsr vqPush
  136  01:C736  7A            ply
  137                     
  138  01:C737  4C B0 C6      jmp scrExecute_next
#[1]   nibbler.asm
   19                     ;        .include "chrdriver.asm"
   20                     ;        .include "pbullet.asm"
   21                     ;        .include "direction.asm"
   22                     ;        .include "enemy.asm"
   23                     ;        .include "ebullet.asm"
   24                     ;        .include "collision.asm"
   25                     ;        .include "effect.asm"
   26                      ;       .include        "sprpattern.asm"
   27                     
#[2]   bgpattern.asm
   28                             .include "bgpattern.asm"
    1           C73A              .code
    2                     ;        .bank   MAIN_BANK+3
    3           0004          .bank   BGPATTERN_BANK
    4           4000              .org    $4000
    5                     
    6  04:4000            BgPattern:
    7                     
    8                     ;
    9                     ;   フォント 0-9,A-Z ,
   10                     ;
   11  04:4000            bp_font_0:
   12  04:4000  38 00         db  %00111000,0
   13  04:4002  4C 00         db  %01001100,0
   14  04:4004  C6 00         db  %11000110,0
   15  04:4006  C6 00         db  %11000110,0
   16  04:4008  C6 00         db  %11000110,0
   17  04:400A  64 00         db  %01100100,0
   18  04:400C  38 00         db  %00111000,0
   19  04:400E  00 00         db  %00000000,0
   20  04:4010  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4012  00 00     
       04:4014  00 00     
       04:4016  00 00     
       04:4018  00 00     
       04:401A  00 00     
       04:401C  00 00     
       04:401E  00 00     
   21                     
   22  04:4020            bp_font_1:
   23  04:4020  30 00         db  %00110000,0
   24  04:4022  70 00         db  %01110000,0
   25  04:4024  30 00         db  %00110000,0
   26  04:4026  30 00         db  %00110000,0
   27  04:4028  30 00         db  %00110000,0
   28  04:402A  30 00         db  %00110000,0
   29  04:402C  FC 00         db  %11111100,0
   30  04:402E  00 00         db  %00000000,0
   31  04:4030  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4032  00 00     
       04:4034  00 00     
       04:4036  00 00     
       04:4038  00 00     
       04:403A  00 00     
       04:403C  00 00     
       04:403E  00 00     
   32                     
   33  04:4040            bp_font_2:
   34  04:4040  7C 00         db  %01111100,0
   35  04:4042  C6 00         db  %11000110,0
   36  04:4044  0E 00         db  %00001110,0
   37  04:4046  3C 00         db  %00111100,0
   38  04:4048  78 00         db  %01111000,0
   39  04:404A  E0 00         db  %11100000,0
   40  04:404C  FE 00         db  %11111110,0
   41  04:404E  00 00         db  %00000000,0
   42  04:4050  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4052  00 00     
       04:4054  00 00     
       04:4056  00 00     
       04:4058  00 00     
       04:405A  00 00     
       04:405C  00 00     
       04:405E  00 00     
   43                     
   44  04:4060            bp_font_3:
   45  04:4060  FE 00         db  %11111110,0
   46  04:4062  0C 00         db  %00001100,0
   47  04:4064  18 00         db  %00011000,0
   48  04:4066  3C 00         db  %00111100,0
   49  04:4068  06 00         db  %00000110,0
   50  04:406A  C6 00         db  %11000110,0
   51  04:406C  7C 00         db  %01111100,0
   52  04:406E  00 00         db  %00000000,0
   53  04:4070  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4072  00 00     
       04:4074  00 00     
       04:4076  00 00     
       04:4078  00 00     
       04:407A  00 00     
       04:407C  00 00     
       04:407E  00 00     
   54                     
   55  04:4080            bp_font_4:
   56  04:4080  1C 00         db  %00011100,0
   57  04:4082  3C 00         db  %00111100,0
   58  04:4084  6C 00         db  %01101100,0
   59  04:4086  CC 00         db  %11001100,0
   60  04:4088  FE 00         db  %11111110,0
   61  04:408A  0C 00         db  %00001100,0
   62  04:408C  0C 00         db  %00001100,0
   63  04:408E  00 00         db  %00000000,0
   64  04:4090  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4092  00 00     
       04:4094  00 00     
       04:4096  00 00     
       04:4098  00 00     
       04:409A  00 00     
       04:409C  00 00     
       04:409E  00 00     
   65                     
   66  04:40A0            bp_font_5:
   67  04:40A0  FC 00         db  %11111100,0
   68  04:40A2  C0 00         db  %11000000,0
   69  04:40A4  FC 00         db  %11111100,0
   70  04:40A6  06 00         db  %00000110,0
   71  04:40A8  06 00         db  %00000110,0
   72  04:40AA  C6 00         db  %11000110,0
   73  04:40AC  7C 00         db  %01111100,0
   74  04:40AE  00 00         db  %00000000,0
   75  04:40B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:40B2  00 00     
       04:40B4  00 00     
       04:40B6  00 00     
       04:40B8  00 00     
       04:40BA  00 00     
       04:40BC  00 00     
       04:40BE  00 00     
   76                     
   77  04:40C0            bp_font_6:
   78  04:40C0  3C 00         db  %00111100,0
   79  04:40C2  60 00         db  %01100000,0
   80  04:40C4  C0 00         db  %11000000,0
   81  04:40C6  FC 00         db  %11111100,0
   82  04:40C8  C6 00         db  %11000110,0
   83  04:40CA  C6 00         db  %11000110,0
   84  04:40CC  7C 00         db  %01111100,0
   85  04:40CE  00 00         db  %00000000,0
   86  04:40D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:40D2  00 00     
       04:40D4  00 00     
       04:40D6  00 00     
       04:40D8  00 00     
       04:40DA  00 00     
       04:40DC  00 00     
       04:40DE  00 00     
   87                     
   88  04:40E0            bp_font_7:
   89  04:40E0  FE 00         db  %11111110,0
   90  04:40E2  C6 00         db  %11000110,0
   91  04:40E4  0C 00         db  %00001100,0
   92  04:40E6  18 00         db  %00011000,0
   93  04:40E8  30 00         db  %00110000,0
   94  04:40EA  30 00         db  %00110000,0
   95  04:40EC  30 00         db  %00110000,0
   96  04:40EE  00 00         db  %00000000,0
   97  04:40F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:40F2  00 00     
       04:40F4  00 00     
       04:40F6  00 00     
       04:40F8  00 00     
       04:40FA  00 00     
       04:40FC  00 00     
       04:40FE  00 00     
   98                     
   99  04:4100            bp_font_8:
  100  04:4100  78 00         db  %01111000,0
  101  04:4102  C4 00         db  %11000100,0
  102  04:4104  E4 00         db  %11100100,0
  103  04:4106  78 00         db  %01111000,0
  104  04:4108  9E 00         db  %10011110,0
  105  04:410A  86 00         db  %10000110,0
  106  04:410C  7C 00         db  %01111100,0
  107  04:410E  00 00         db  %00000000,0
  108  04:4110  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4112  00 00     
       04:4114  00 00     
       04:4116  00 00     
       04:4118  00 00     
       04:411A  00 00     
       04:411C  00 00     
       04:411E  00 00     
  109                     
  110  04:4120            bp_font_9:
  111  04:4120  7C 00         db  %01111100,0
  112  04:4122  C6 00         db  %11000110,0
  113  04:4124  C6 00         db  %11000110,0
  114  04:4126  7E 00         db  %01111110,0
  115  04:4128  06 00         db  %00000110,0
  116  04:412A  0C 00         db  %00001100,0
  117  04:412C  78 00         db  %01111000,0
  118  04:412E  00 00         db  %00000000,0
  119  04:4130  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4132  00 00     
       04:4134  00 00     
       04:4136  00 00     
       04:4138  00 00     
       04:413A  00 00     
       04:413C  00 00     
       04:413E  00 00     
  120                     
  121  04:4140            bp_font_A:
  122  04:4140  38 00         db  %00111000,0
  123  04:4142  6C 00         db  %01101100,0
  124  04:4144  C6 00         db  %11000110,0
  125  04:4146  C6 00         db  %11000110,0
  126  04:4148  FE 00         db  %11111110,0
  127  04:414A  C6 00         db  %11000110,0
  128  04:414C  C6 00         db  %11000110,0
  129  04:414E  00 00         db  %00000000,0
  130  04:4150  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4152  00 00     
       04:4154  00 00     
       04:4156  00 00     
       04:4158  00 00     
       04:415A  00 00     
       04:415C  00 00     
       04:415E  00 00     
  131                     
  132  04:4160            bp_font_B:
  133  04:4160  FC 00         db  %11111100,0
  134  04:4162  C6 00         db  %11000110,0
  135  04:4164  C6 00         db  %11000110,0
  136  04:4166  FC 00         db  %11111100,0
  137  04:4168  C6 00         db  %11000110,0
  138  04:416A  C6 00         db  %11000110,0
  139  04:416C  FC 00         db  %11111100,0
  140  04:416E  00 00         db  %00000000,0
  141  04:4170  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4172  00 00     
       04:4174  00 00     
       04:4176  00 00     
       04:4178  00 00     
       04:417A  00 00     
       04:417C  00 00     
       04:417E  00 00     
  142                     
  143  04:4180            bp_font_C:
  144  04:4180  3C 00         db  %00111100,0
  145  04:4182  66 00         db  %01100110,0
  146  04:4184  C0 00         db  %11000000,0
  147  04:4186  C0 00         db  %11000000,0
  148  04:4188  C0 00         db  %11000000,0
  149  04:418A  66 00         db  %01100110,0
  150  04:418C  3C 00         db  %00111100,0
  151  04:418E  00 00         db  %00000000,0
  152  04:4190  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4192  00 00     
       04:4194  00 00     
       04:4196  00 00     
       04:4198  00 00     
       04:419A  00 00     
       04:419C  00 00     
       04:419E  00 00     
  153                     
  154  04:41A0            bp_font_D:
  155  04:41A0  F8 00         db  %11111000,0
  156  04:41A2  CC 00         db  %11001100,0
  157  04:41A4  C6 00         db  %11000110,0
  158  04:41A6  C6 00         db  %11000110,0
  159  04:41A8  C6 00         db  %11000110,0
  160  04:41AA  CC 00         db  %11001100,0
  161  04:41AC  F8 00         db  %11111000,0
  162  04:41AE  00 00         db  %00000000,0
  163  04:41B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:41B2  00 00     
       04:41B4  00 00     
       04:41B6  00 00     
       04:41B8  00 00     
       04:41BA  00 00     
       04:41BC  00 00     
       04:41BE  00 00     
  164                     
  165  04:41C0            bp_font_E:
  166  04:41C0  FC 00         db  %11111100,0
  167  04:41C2  C0 00         db  %11000000,0
  168  04:41C4  C0 00         db  %11000000,0
  169  04:41C6  F8 00         db  %11111000,0
  170  04:41C8  C0 00         db  %11000000,0
  171  04:41CA  C0 00         db  %11000000,0
  172  04:41CC  FC 00         db  %11111100,0
  173  04:41CE  00 00         db  %00000000,0
  174  04:41D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:41D2  00 00     
       04:41D4  00 00     
       04:41D6  00 00     
       04:41D8  00 00     
       04:41DA  00 00     
       04:41DC  00 00     
       04:41DE  00 00     
  175                     
  176  04:41E0            bp_font_F:
  177  04:41E0  FC 00         db  %11111100,0
  178  04:41E2  C0 00         db  %11000000,0
  179  04:41E4  C0 00         db  %11000000,0
  180  04:41E6  F8 00         db  %11111000,0
  181  04:41E8  C0 00         db  %11000000,0
  182  04:41EA  C0 00         db  %11000000,0
  183  04:41EC  C0 00         db  %11000000,0
  184  04:41EE  00 00         db  %00000000,0
  185  04:41F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:41F2  00 00     
       04:41F4  00 00     
       04:41F6  00 00     
       04:41F8  00 00     
       04:41FA  00 00     
       04:41FC  00 00     
       04:41FE  00 00     
  186                     
  187  04:4200            bp_font_G:
  188  04:4200  3E 00         db  %00111110,0
  189  04:4202  60 00         db  %01100000,0
  190  04:4204  C0 00         db  %11000000,0
  191  04:4206  CE 00         db  %11001110,0
  192  04:4208  C6 00         db  %11000110,0
  193  04:420A  66 00         db  %01100110,0
  194  04:420C  3E 00         db  %00111110,0
  195  04:420E  00 00         db  %00000000,0
  196  04:4210  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4212  00 00     
       04:4214  00 00     
       04:4216  00 00     
       04:4218  00 00     
       04:421A  00 00     
       04:421C  00 00     
       04:421E  00 00     
  197                     
  198  04:4220            bp_font_H:
  199  04:4220  C6 00         db  %11000110,0
  200  04:4222  C6 00         db  %11000110,0
  201  04:4224  C6 00         db  %11000110,0
  202  04:4226  FE 00         db  %11111110,0
  203  04:4228  C6 00         db  %11000110,0
  204  04:422A  C6 00         db  %11000110,0
  205  04:422C  C6 00         db  %11000110,0
  206  04:422E  00 00         db  %00000000,0
  207  04:4230  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4232  00 00     
       04:4234  00 00     
       04:4236  00 00     
       04:4238  00 00     
       04:423A  00 00     
       04:423C  00 00     
       04:423E  00 00     
  208                     
  209  04:4240            bp_font_I:
  210  04:4240  FC 00         db  %11111100,0
  211  04:4242  30 00         db  %00110000,0
  212  04:4244  30 00         db  %00110000,0
  213  04:4246  30 00         db  %00110000,0
  214  04:4248  30 00         db  %00110000,0
  215  04:424A  30 00         db  %00110000,0
  216  04:424C  FC 00         db  %11111100,0
  217  04:424E  00 00         db  %00000000,0
  218  04:4250  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4252  00 00     
       04:4254  00 00     
       04:4256  00 00     
       04:4258  00 00     
       04:425A  00 00     
       04:425C  00 00     
       04:425E  00 00     
  219                     
  220  04:4260            bp_font_J:
  221  04:4260  06 00         db  %00000110,0
  222  04:4262  06 00         db  %00000110,0
  223  04:4264  06 00         db  %00000110,0
  224  04:4266  06 00         db  %00000110,0
  225  04:4268  06 00         db  %00000110,0
  226  04:426A  C6 00         db  %11000110,0
  227  04:426C  7C 00         db  %01111100,0
  228  04:426E  00 00         db  %00000000,0
  229  04:4270  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4272  00 00     
       04:4274  00 00     
       04:4276  00 00     
       04:4278  00 00     
       04:427A  00 00     
       04:427C  00 00     
       04:427E  00 00     
  230                     
  231  04:4280            bp_font_K:
  232  04:4280  C6 00         db  %11000110,0
  233  04:4282  CC 00         db  %11001100,0
  234  04:4284  D8 00         db  %11011000,0
  235  04:4286  F0 00         db  %11110000,0
  236  04:4288  F8 00         db  %11111000,0
  237  04:428A  DC 00         db  %11011100,0
  238  04:428C  CE 00         db  %11001110,0
  239  04:428E  00 00         db  %00000000,0
  240  04:4290  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4292  00 00     
       04:4294  00 00     
       04:4296  00 00     
       04:4298  00 00     
       04:429A  00 00     
       04:429C  00 00     
       04:429E  00 00     
  241                     
  242  04:42A0            bp_font_L:
  243  04:42A0  C0 00         db  %11000000,0
  244  04:42A2  C0 00         db  %11000000,0
  245  04:42A4  C0 00         db  %11000000,0
  246  04:42A6  C0 00         db  %11000000,0
  247  04:42A8  C0 00         db  %11000000,0
  248  04:42AA  C0 00         db  %11000000,0
  249  04:42AC  FE 00         db  %11111110,0
  250  04:42AE  00 00         db  %00000000,0
  251  04:42B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:42B2  00 00     
       04:42B4  00 00     
       04:42B6  00 00     
       04:42B8  00 00     
       04:42BA  00 00     
       04:42BC  00 00     
       04:42BE  00 00     
  252                     
  253  04:42C0            bp_font_M:
  254  04:42C0  C6 00         db  %11000110,0
  255  04:42C2  EE 00         db  %11101110,0
  256  04:42C4  FE 00         db  %11111110,0
  257  04:42C6  FE 00         db  %11111110,0
  258  04:42C8  D6 00         db  %11010110,0
  259  04:42CA  C6 00         db  %11000110,0
  260  04:42CC  C6 00         db  %11000110,0
  261  04:42CE  00 00         db  %00000000,0
  262  04:42D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:42D2  00 00     
       04:42D4  00 00     
       04:42D6  00 00     
       04:42D8  00 00     
       04:42DA  00 00     
       04:42DC  00 00     
       04:42DE  00 00     
  263                     
  264  04:42E0            bp_font_N:
  265  04:42E0  C6 00         db  %11000110,0
  266  04:42E2  E6 00         db  %11100110,0
  267  04:42E4  F6 00         db  %11110110,0
  268  04:42E6  FE 00         db  %11111110,0
  269  04:42E8  DE 00         db  %11011110,0
  270  04:42EA  CE 00         db  %11001110,0
  271  04:42EC  C6 00         db  %11000110,0
  272  04:42EE  00 00         db  %00000000,0
  273  04:42F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:42F2  00 00     
       04:42F4  00 00     
       04:42F6  00 00     
       04:42F8  00 00     
       04:42FA  00 00     
       04:42FC  00 00     
       04:42FE  00 00     
  274                     
  275  04:4300            bp_font_O:
  276  04:4300  7C 00         db  %01111100,0
  277  04:4302  C6 00         db  %11000110,0
  278  04:4304  C6 00         db  %11000110,0
  279  04:4306  C6 00         db  %11000110,0
  280  04:4308  C6 00         db  %11000110,0
  281  04:430A  C6 00         db  %11000110,0
  282  04:430C  7C 00         db  %01111100,0
  283  04:430E  00 00         db  %00000000,0
  284  04:4310  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4312  00 00     
       04:4314  00 00     
       04:4316  00 00     
       04:4318  00 00     
       04:431A  00 00     
       04:431C  00 00     
       04:431E  00 00     
  285                     
  286  04:4320            bp_font_P:
  287  04:4320  FC 00         db  %11111100,0
  288  04:4322  C6 00         db  %11000110,0
  289  04:4324  C6 00         db  %11000110,0
  290  04:4326  C6 00         db  %11000110,0
  291  04:4328  FC 00         db  %11111100,0
  292  04:432A  C0 00         db  %11000000,0
  293  04:432C  C0 00         db  %11000000,0
  294  04:432E  00 00         db  %00000000,0
  295  04:4330  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4332  00 00     
       04:4334  00 00     
       04:4336  00 00     
       04:4338  00 00     
       04:433A  00 00     
       04:433C  00 00     
       04:433E  00 00     
  296                     
  297  04:4340            bp_font_Q:
  298  04:4340  7C 00         db  %01111100,0
  299  04:4342  C6 00         db  %11000110,0
  300  04:4344  C6 00         db  %11000110,0
  301  04:4346  C6 00         db  %11000110,0
  302  04:4348  DE 00         db  %11011110,0
  303  04:434A  CC 00         db  %11001100,0
  304  04:434C  7A 00         db  %01111010,0
  305  04:434E  00 00         db  %00000000,0
  306  04:4350  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4352  00 00     
       04:4354  00 00     
       04:4356  00 00     
       04:4358  00 00     
       04:435A  00 00     
       04:435C  00 00     
       04:435E  00 00     
  307                     
  308  04:4360            bp_font_R:
  309  04:4360  FC 00         db  %11111100,0
  310  04:4362  C6 00         db  %11000110,0
  311  04:4364  C6 00         db  %11000110,0
  312  04:4366  CE 00         db  %11001110,0
  313  04:4368  F8 00         db  %11111000,0
  314  04:436A  DC 00         db  %11011100,0
  315  04:436C  CE 00         db  %11001110,0
  316  04:436E  00 00         db  %00000000,0
  317  04:4370  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4372  00 00     
       04:4374  00 00     
       04:4376  00 00     
       04:4378  00 00     
       04:437A  00 00     
       04:437C  00 00     
       04:437E  00 00     
  318                     
  319  04:4380            bp_font_S:
  320  04:4380  7C 00         db  %01111100,0
  321  04:4382  C6 00         db  %11000110,0
  322  04:4384  C0 00         db  %11000000,0
  323  04:4386  7C 00         db  %01111100,0
  324  04:4388  06 00         db  %00000110,0
  325  04:438A  C6 00         db  %11000110,0
  326  04:438C  7C 00         db  %01111100,0
  327  04:438E  00 00         db  %00000000,0
  328  04:4390  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4392  00 00     
       04:4394  00 00     
       04:4396  00 00     
       04:4398  00 00     
       04:439A  00 00     
       04:439C  00 00     
       04:439E  00 00     
  329                     
  330  04:43A0            bp_font_T:
  331  04:43A0  FC 00         db  %11111100,0
  332  04:43A2  30 00         db  %00110000,0
  333  04:43A4  30 00         db  %00110000,0
  334  04:43A6  30 00         db  %00110000,0
  335  04:43A8  30 00         db  %00110000,0
  336  04:43AA  30 00         db  %00110000,0
  337  04:43AC  30 00         db  %00110000,0
  338  04:43AE  00 00         db  %00000000,0
  339  04:43B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:43B2  00 00     
       04:43B4  00 00     
       04:43B6  00 00     
       04:43B8  00 00     
       04:43BA  00 00     
       04:43BC  00 00     
       04:43BE  00 00     
  340                     
  341  04:43C0            bp_font_U:
  342  04:43C0  C6 00         db  %11000110,0
  343  04:43C2  C6 00         db  %11000110,0
  344  04:43C4  C6 00         db  %11000110,0
  345  04:43C6  C6 00         db  %11000110,0
  346  04:43C8  C6 00         db  %11000110,0
  347  04:43CA  C6 00         db  %11000110,0
  348  04:43CC  7C 00         db  %01111100,0
  349  04:43CE  00 00         db  %00000000,0
  350  04:43D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:43D2  00 00     
       04:43D4  00 00     
       04:43D6  00 00     
       04:43D8  00 00     
       04:43DA  00 00     
       04:43DC  00 00     
       04:43DE  00 00     
  351                     
  352  04:43E0            bp_font_V:
  353  04:43E0  C6 00         db  %11000110,0
  354  04:43E2  C6 00         db  %11000110,0
  355  04:43E4  C6 00         db  %11000110,0
  356  04:43E6  EE 00         db  %11101110,0
  357  04:43E8  7C 00         db  %01111100,0
  358  04:43EA  38 00         db  %00111000,0
  359  04:43EC  10 00         db  %00010000,0
  360  04:43EE  00 00         db  %00000000,0
  361  04:43F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:43F2  00 00     
       04:43F4  00 00     
       04:43F6  00 00     
       04:43F8  00 00     
       04:43FA  00 00     
       04:43FC  00 00     
       04:43FE  00 00     
  362                     
  363  04:4400            bp_font_W:
  364  04:4400  C6 00         db  %11000110,0
  365  04:4402  C6 00         db  %11000110,0
  366  04:4404  D6 00         db  %11010110,0
  367  04:4406  FE 00         db  %11111110,0
  368  04:4408  FE 00         db  %11111110,0
  369  04:440A  EE 00         db  %11101110,0
  370  04:440C  C6 00         db  %11000110,0
  371  04:440E  00 00         db  %00000000,0
  372  04:4410  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4412  00 00     
       04:4414  00 00     
       04:4416  00 00     
       04:4418  00 00     
       04:441A  00 00     
       04:441C  00 00     
       04:441E  00 00     
  373                     
  374  04:4420            bp_font_X:
  375  04:4420  C6 00         db  %11000110,0
  376  04:4422  EE 00         db  %11101110,0
  377  04:4424  7C 00         db  %01111100,0
  378  04:4426  38 00         db  %00111000,0
  379  04:4428  7C 00         db  %01111100,0
  380  04:442A  EE 00         db  %11101110,0
  381  04:442C  C6 00         db  %11000110,0
  382  04:442E  00 00         db  %00000000,0
  383  04:4430  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4432  00 00     
       04:4434  00 00     
       04:4436  00 00     
       04:4438  00 00     
       04:443A  00 00     
       04:443C  00 00     
       04:443E  00 00     
  384                     
  385  04:4440            bp_font_Y:
  386  04:4440  CC 00         db  %11001100,0
  387  04:4442  CC 00         db  %11001100,0
  388  04:4444  CC 00         db  %11001100,0
  389  04:4446  78 00         db  %01111000,0
  390  04:4448  30 00         db  %00110000,0
  391  04:444A  30 00         db  %00110000,0
  392  04:444C  30 00         db  %00110000,0
  393  04:444E  00 00         db  %00000000,0
  394  04:4450  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4452  00 00     
       04:4454  00 00     
       04:4456  00 00     
       04:4458  00 00     
       04:445A  00 00     
       04:445C  00 00     
       04:445E  00 00     
  395                     
  396  04:4460            bp_font_Z:
  397  04:4460  FE 00         db  %11111110,0
  398  04:4462  0E 00         db  %00001110,0
  399  04:4464  1C 00         db  %00011100,0
  400  04:4466  38 00         db  %00111000,0
  401  04:4468  70 00         db  %01110000,0
  402  04:446A  E0 00         db  %11100000,0
  403  04:446C  FE 00         db  %11111110,0
  404  04:446E  00 00         db  %00000000,0
  405  04:4470  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4472  00 00     
       04:4474  00 00     
       04:4476  00 00     
       04:4478  00 00     
       04:447A  00 00     
       04:447C  00 00     
       04:447E  00 00     
  406                     
  407  04:4480            bp_font_comma:
  408  04:4480  00 00         db  %00000000,0
  409  04:4482  00 00         db  %00000000,0
  410  04:4484  00 00         db  %00000000,0
  411  04:4486  00 00         db  %00000000,0
  412  04:4488  00 00         db  %00000000,0
  413  04:448A  30 00         db  %00110000,0
  414  04:448C  30 00         db  %00110000,0
  415  04:448E  10 00         db  %00010000,0
  416  04:4490  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4492  00 00     
       04:4494  00 00     
       04:4496  00 00     
       04:4498  00 00     
       04:449A  00 00     
       04:449C  00 00     
       04:449E  00 00     
  417                     
  418  04:44A0            bp_font_colon:
  419  04:44A0  00 00         db  %00000000,0
  420  04:44A2  30 00         db  %00110000,0
  421  04:44A4  30 00         db  %00110000,0
  422  04:44A6  00 00         db  %00000000,0
  423  04:44A8  00 00         db  %00000000,0
  424  04:44AA  30 00         db  %00110000,0
  425  04:44AC  30 00         db  %00110000,0
  426  04:44AE  00 00         db  %00000000,0
  427  04:44B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:44B2  00 00     
       04:44B4  00 00     
       04:44B6  00 00     
       04:44B8  00 00     
       04:44BA  00 00     
       04:44BC  00 00     
       04:44BE  00 00     
  428                     
  429  04:44C0            bp_font_player1_0:
  430  04:44C0  F4 00         db  %11110100,0
  431  04:44C2  94 00         db  %10010100,0
  432  04:44C4  F4 00         db  %11110100,0
  433  04:44C6  84 00         db  %10000100,0
  434  04:44C8  84 00         db  %10000100,0
  435  04:44CA  84 00         db  %10000100,0
  436  04:44CC  87 00         db  %10000111,0
  437  04:44CE  00 00         db  %00000000,0
  438  04:44D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:44D2  00 00     
       04:44D4  00 00     
       04:44D6  00 00     
       04:44D8  00 00     
       04:44DA  00 00     
       04:44DC  00 00     
       04:44DE  00 00     
  439                     
  440  04:44E0            bp_font_player1_1:
  441  04:44E0  25 00         db  %00100101,0
  442  04:44E2  55 00         db  %01010101,0
  443  04:44E4  55 00         db  %01010101,0
  444  04:44E6  72 00         db  %01110010,0
  445  04:44E8  52 00         db  %01010010,0
  446  04:44EA  52 00         db  %01010010,0
  447  04:44EC  52 00         db  %01010010,0
  448  04:44EE  00 00         db  %00000000,0
  449  04:44F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:44F2  00 00     
       04:44F4  00 00     
       04:44F6  00 00     
       04:44F8  00 00     
       04:44FA  00 00     
       04:44FC  00 00     
       04:44FE  00 00     
  450                     
  451  04:4500            bp_font_player1_2:
  452  04:4500  77 00         db  %01110111,0
  453  04:4502  45 00         db  %01000101,0
  454  04:4504  47 00         db  %01000111,0
  455  04:4506  66 00         db  %01100110,0
  456  04:4508  45 00         db  %01000101,0
  457  04:450A  45 00         db  %01000101,0
  458  04:450C  75 00         db  %01110101,0
  459  04:450E  00 00         db  %00000000,0
  460  04:4510  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4512  00 00     
       04:4514  00 00     
       04:4516  00 00     
       04:4518  00 00     
       04:451A  00 00     
       04:451C  00 00     
       04:451E  00 00     
  461                     
  462  04:4520            bp_font_player1_3:
  463  04:4520  10 00         db  %00010000,0
  464  04:4522  30 00         db  %00110000,0
  465  04:4524  10 00         db  %00010000,0
  466  04:4526  10 00         db  %00010000,0
  467  04:4528  10 00         db  %00010000,0
  468  04:452A  10 00         db  %00010000,0
  469  04:452C  38 00         db  %00111000,0
  470  04:452E  00 00         db  %00000000,0
  471  04:4530  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4532  00 00     
       04:4534  00 00     
       04:4536  00 00     
       04:4538  00 00     
       04:453A  00 00     
       04:453C  00 00     
       04:453E  00 00     
  472                     
  473  04:4540            bp_font_hiscore_0:
  474  04:4540  AE 00         db  %10101110,0
  475  04:4542  A4 00         db  %10100100,0
  476  04:4544  A4 00         db  %10100100,0
  477  04:4546  E4 00         db  %11100100,0
  478  04:4548  A4 00         db  %10100100,0
  479  04:454A  A4 00         db  %10100100,0
  480  04:454C  AE 00         db  %10101110,0
  481  04:454E  00 00         db  %00000000,0
  482  04:4550  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4552  00 00     
       04:4554  00 00     
       04:4556  00 00     
       04:4558  00 00     
       04:455A  00 00     
       04:455C  00 00     
       04:455E  00 00     
  483                     
  484  04:4560            bp_font_hiscore_1:
  485  04:4560  22 00         db  %00100010,0
  486  04:4562  55 00         db  %01010101,0
  487  04:4564  44 00         db  %01000100,0
  488  04:4566  24 00         db  %00100100,0
  489  04:4568  14 00         db  %00010100,0
  490  04:456A  55 00         db  %01010101,0
  491  04:456C  22 00         db  %00100010,0
  492  04:456E  00 00         db  %00000000,0
  493  04:4570  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4572  00 00     
       04:4574  00 00     
       04:4576  00 00     
       04:4578  00 00     
       04:457A  00 00     
       04:457C  00 00     
       04:457E  00 00     
  494                     
  495  04:4580            bp_font_hiscore_2:
  496  04:4580  27 00         db  %00100111,0
  497  04:4582  55 00         db  %01010101,0
  498  04:4584  57 00         db  %01010111,0
  499  04:4586  56 00         db  %01010110,0
  500  04:4588  55 00         db  %01010101,0
  501  04:458A  55 00         db  %01010101,0
  502  04:458C  25 00         db  %00100101,0
  503  04:458E  00 00         db  %00000000,0
  504  04:4590  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:4592  00 00     
       04:4594  00 00     
       04:4596  00 00     
       04:4598  00 00     
       04:459A  00 00     
       04:459C  00 00     
       04:459E  00 00     
  505                     
  506  04:45A0            bp_font_hiscore_3:
  507  04:45A0  70 00         db  %01110000,0
  508  04:45A2  40 00         db  %01000000,0
  509  04:45A4  40 00         db  %01000000,0
  510  04:45A6  60 00         db  %01100000,0
  511  04:45A8  40 00         db  %01000000,0
  512  04:45AA  40 00         db  %01000000,0
  513  04:45AC  70 00         db  %01110000,0
  514  04:45AE  00 00         db  %00000000,0
  515  04:45B0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:45B2  00 00     
       04:45B4  00 00     
       04:45B6  00 00     
       04:45B8  00 00     
       04:45BA  00 00     
       04:45BC  00 00     
       04:45BE  00 00     
  516                     
  517  04:45C0            bp_font_left_0:
  518  04:45C0  8E 00         db  %10001110,0
  519  04:45C2  88 00         db  %10001000,0
  520  04:45C4  88 00         db  %10001000,0
  521  04:45C6  8C 00         db  %10001100,0
  522  04:45C8  88 00         db  %10001000,0
  523  04:45CA  88 00         db  %10001000,0
  524  04:45CC  EE 00         db  %11101110,0
  525  04:45CE  00 00         db  %00000000,0
  526  04:45D0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:45D2  00 00     
       04:45D4  00 00     
       04:45D6  00 00     
       04:45D8  00 00     
       04:45DA  00 00     
       04:45DC  00 00     
       04:45DE  00 00     
  527                     
  528  04:45E0            bp_font_left_1:
  529  04:45E0  EE 00         db  %11101110,0
  530  04:45E2  84 00         db  %10000100,0
  531  04:45E4  84 00         db  %10000100,0
  532  04:45E6  C4 00         db  %11000100,0
  533  04:45E8  84 00         db  %10000100,0
  534  04:45EA  84 00         db  %10000100,0
  535  04:45EC  84 00         db  %10000100,0
  536  04:45EE  00 00         db  %00000000,0
  537  04:45F0  00 00         dw  $00,$00,$00,$00,$00,$00,$00,$00
       04:45F2  00 00     
       04:45F4  00 00     
       04:45F6  00 00     
       04:45F8  00 00     
       04:45FA  00 00     
       04:45FC  00 00     
       04:45FE  00 00     
  538                     
  539  04:4600            bp_font_bonus:
  540  04:4600  C4 00         dw $00c4,$00aa,$00aa,$00ca,$00aa,$00aa,$00c4,$0000
       04:4602  AA 00     
       04:4604  AA 00     
       04:4606  CA 00     
       04:4608  AA 00     
       04:460A  AA 00     
       04:460C  C4 00     
       04:460E  00 00     
  541  04:4610  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4612  00 00     
       04:4614  00 00     
       04:4616  00 00     
       04:4618  00 00     
       04:461A  00 00     
       04:461C  00 00     
       04:461E  00 00     
  542  04:4620  95 00         dw $0095,$0095,$00d5,$00d5,$00b5,$0095,$0097,$0000
       04:4622  95 00     
       04:4624  D5 00     
       04:4626  D5 00     
       04:4628  B5 00     
       04:462A  95 00     
       04:462C  97 00     
       04:462E  00 00     
  543  04:4630  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4632  00 00     
       04:4634  00 00     
       04:4636  00 00     
       04:4638  00 00     
       04:463A  00 00     
       04:463C  00 00     
       04:463E  00 00     
  544  04:4640  20 00         dw $0020,$0050,$0040,$0020,$0010,$0050,$0020,$0000
       04:4642  50 00     
       04:4644  40 00     
       04:4646  20 00     
       04:4648  10 00     
       04:464A  50 00     
       04:464C  20 00     
       04:464E  00 00     
  545  04:4650  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4652  00 00     
       04:4654  00 00     
       04:4656  00 00     
       04:4658  00 00     
       04:465A  00 00     
       04:465C  00 00     
       04:465E  00 00     
  546                     
  547                     
  548  04:4660            bp_font_space:
  549  04:4660  00 00         dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4662  00 00     
       04:4664  00 00     
       04:4666  00 00     
       04:4668  00 00     
       04:466A  00 00     
       04:466C  00 00     
       04:466E  00 00     
  550  04:4670  00 00         dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4672  00 00     
       04:4674  00 00     
       04:4676  00 00     
       04:4678  00 00     
       04:467A  00 00     
       04:467C  00 00     
       04:467E  00 00     
  551                     
  552                     
  553                     ;
  554                     ;
  555                     ;
  556                     
  557  04:4680            bp_blank:
  558  04:4680  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4682  00 00     
       04:4684  00 00     
       04:4686  00 00     
       04:4688  00 00     
       04:468A  00 00     
       04:468C  00 00     
       04:468E  00 00     
  559  04:4690  00 00             dw $00,$00,$00,$00,$00,$00,$00,$00
       04:4692  00 00     
       04:4694  00 00     
       04:4696  00 00     
       04:4698  00 00     
       04:469A  00 00     
       04:469C  00 00     
       04:469E  00 00     
  560  04:46A0            bp_wall_ul:
  561  04:46A0  19 E6         dw $e619,$807f,$8040,$00c0,$00c0,$8040,$8040,$00c0
       04:46A2  7F 80     
       04:46A4  40 80     
       04:46A6  C0 00     
       04:46A8  C0 00     
       04:46AA  40 80     
       04:46AC  40 80     
       04:46AE  C0 00     
  562  04:46B0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:46B2  00 00     
       04:46B4  00 00     
       04:46B6  00 00     
       04:46B8  00 00     
       04:46BA  00 00     
       04:46BC  00 00     
       04:46BE  00 00     
  563                     ;        dw $ff,$ff,$c0,$c0,$c0,$c0,$c0,$c0
  564                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  565  04:46C0            bp_wall_ur:
  566  04:46C0  98 67         dw $6798,$01fe,$0102,$0003,$0003,$0102,$0102,$0003
       04:46C2  FE 01     
       04:46C4  02 01     
       04:46C6  03 00     
       04:46C8  03 00     
       04:46CA  02 01     
       04:46CC  02 01     
       04:46CE  03 00     
  567  04:46D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:46D2  00 00     
       04:46D4  00 00     
       04:46D6  00 00     
       04:46D8  00 00     
       04:46DA  00 00     
       04:46DC  00 00     
       04:46DE  00 00     
  568                     ;        dw $ff,$ff,$03,$03,$03,$03,$03,$03
  569                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  570  04:46E0            bp_wall_dl:
  571  04:46E0  C0 00         dw $00c0,$8040,$8040,$00c0,$00c0,$8040,$807f,$e619
       04:46E2  40 80     
       04:46E4  40 80     
       04:46E6  C0 00     
       04:46E8  C0 00     
       04:46EA  40 80     
       04:46EC  7F 80     
       04:46EE  19 E6     
  572  04:46F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:46F2  00 00     
       04:46F4  00 00     
       04:46F6  00 00     
       04:46F8  00 00     
       04:46FA  00 00     
       04:46FC  00 00     
       04:46FE  00 00     
  573                     ;        dw $c0,$c0,$c0,$c0,$c0,$c0,$ff,$ff
  574                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  575  04:4700            bp_wall_dr:
  576  04:4700  03 00         dw $0003,$0102,$0102,$0003,$0003,$0102,$01fe,$6798
       04:4702  02 01     
       04:4704  02 01     
       04:4706  03 00     
       04:4708  03 00     
       04:470A  02 01     
       04:470C  FE 01     
       04:470E  98 67     
  577  04:4710  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4712  00 00     
       04:4714  00 00     
       04:4716  00 00     
       04:4718  00 00     
       04:471A  00 00     
       04:471C  00 00     
       04:471E  00 00     
  578                     ;        dw $03,$03,$03,$03,$03,$03,$ff,$ff
  579                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  580  04:4720            bp_wall_l:
  581  04:4720  C0 00         dw $00c0,$8040,$8040,$00c0,$00c0,$8040,$8040,$00c0
       04:4722  40 80     
       04:4724  40 80     
       04:4726  C0 00     
       04:4728  C0 00     
       04:472A  40 80     
       04:472C  40 80     
       04:472E  C0 00     
  582  04:4730  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4732  00 00     
       04:4734  00 00     
       04:4736  00 00     
       04:4738  00 00     
       04:473A  00 00     
       04:473C  00 00     
       04:473E  00 00     
  583                     ;        dw $c0,$c0,$c0,$c0,$c0,$c0,$c0,$c0
  584                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  585  04:4740            bp_wall_r:
  586  04:4740  03 00         dw $0003,$0102,$0102,$0003,$0003,$0102,$0102,$0003
       04:4742  02 01     
       04:4744  02 01     
       04:4746  03 00     
       04:4748  03 00     
       04:474A  02 01     
       04:474C  02 01     
       04:474E  03 00     
  587  04:4750  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4752  00 00     
       04:4754  00 00     
       04:4756  00 00     
       04:4758  00 00     
       04:475A  00 00     
       04:475C  00 00     
       04:475E  00 00     
  588                     ;        dw $03,$03,$03,$03,$03,$03,$03,$03
  589                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  590  04:4760            bp_wall_u:
  591  04:4760  99 66         dw $6699,$00ff,$0000,$0000,$0000,$0000,$0000,$0000
       04:4762  FF 00     
       04:4764  00 00     
       04:4766  00 00     
       04:4768  00 00     
       04:476A  00 00     
       04:476C  00 00     
       04:476E  00 00     
  592  04:4770  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4772  00 00     
       04:4774  00 00     
       04:4776  00 00     
       04:4778  00 00     
       04:477A  00 00     
       04:477C  00 00     
       04:477E  00 00     
  593                     ;        dw $ff,$ff,$00,$00,$00,$00,$00,$00
  594                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  595  04:4780            bp_wall_d:
  596  04:4780  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$00ff,$6699
       04:4782  00 00     
       04:4784  00 00     
       04:4786  00 00     
       04:4788  00 00     
       04:478A  00 00     
       04:478C  FF 00     
       04:478E  99 66     
  597  04:4790  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4792  00 00     
       04:4794  00 00     
       04:4796  00 00     
       04:4798  00 00     
       04:479A  00 00     
       04:479C  00 00     
       04:479E  00 00     
  598                     ;        dw $00,$00,$00,$00,$00,$00,$ff,$ff
  599                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  600  04:47A0            bp_wall_blank_ul:
  601  04:47A0  C0 00         dw $00c0,$0080,$0000,$0000,$0000,$0000,$0000,$0000
       04:47A2  80 00     
       04:47A4  00 00     
       04:47A6  00 00     
       04:47A8  00 00     
       04:47AA  00 00     
       04:47AC  00 00     
       04:47AE  00 00     
  602  04:47B0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:47B2  00 00     
       04:47B4  00 00     
       04:47B6  00 00     
       04:47B8  00 00     
       04:47BA  00 00     
       04:47BC  00 00     
       04:47BE  00 00     
  603                     ;        dw $c0,$80,$00,$00,$00,$00,$00,$00
  604                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  605  04:47C0            bp_wall_blank_ur:
  606  04:47C0  03 00         dw $0003,$0001,$0000,$0000,$0000,$0000,$0000,$0000
       04:47C2  01 00     
       04:47C4  00 00     
       04:47C6  00 00     
       04:47C8  00 00     
       04:47CA  00 00     
       04:47CC  00 00     
       04:47CE  00 00     
  607  04:47D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:47D2  00 00     
       04:47D4  00 00     
       04:47D6  00 00     
       04:47D8  00 00     
       04:47DA  00 00     
       04:47DC  00 00     
       04:47DE  00 00     
  608                     ;        dw $03,$01,$00,$00,$00,$00,$00,$00
  609                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  610  04:47E0            bp_wall_blank_dl:
  611  04:47E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0080,$00c0
       04:47E2  00 00     
       04:47E4  00 00     
       04:47E6  00 00     
       04:47E8  00 00     
       04:47EA  00 00     
       04:47EC  80 00     
       04:47EE  C0 00     
  612  04:47F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:47F2  00 00     
       04:47F4  00 00     
       04:47F6  00 00     
       04:47F8  00 00     
       04:47FA  00 00     
       04:47FC  00 00     
       04:47FE  00 00     
  613                     ;        dw $00,$00,$00,$00,$00,$00,$80,$c0
  614                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  615  04:4800            bp_wall_blank_dr:
  616  04:4800  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0001,$0003
       04:4802  00 00     
       04:4804  00 00     
       04:4806  00 00     
       04:4808  00 00     
       04:480A  00 00     
       04:480C  01 00     
       04:480E  03 00     
  617  04:4810  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4812  00 00     
       04:4814  00 00     
       04:4816  00 00     
       04:4818  00 00     
       04:481A  00 00     
       04:481C  00 00     
       04:481E  00 00     
  618                     ;        dw $00,$00,$00,$00,$00,$00,$01,$03
  619                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  620                     
  621  04:4820            bp_dot:
  622  04:4820  18 00         dw $0018,$0034,$006e,$df00,$bb00,$7676,$2c2c,$1818
       04:4822  34 00     
       04:4824  6E 00     
       04:4826  00 DF     
       04:4828  00 BB     
       04:482A  76 76     
       04:482C  2C 2C     
       04:482E  18 18     
  623  04:4830  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4832  00 00     
       04:4834  00 00     
       04:4836  00 00     
       04:4838  00 00     
       04:483A  00 00     
       04:483C  00 00     
       04:483E  00 00     
  624                     ;        dw $00,$7e,$7e,$7e,$7e,$7e,$7e,$00
  625                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  626                     
  627  04:4840            bp_body_l:
  628  04:4840  00 00         dw $0000,$00ff,$00ff,$10ef,$38c7,$10ef,$00ff,$00ff
       04:4842  FF 00     
       04:4844  FF 00     
       04:4846  EF 10     
       04:4848  C7 38     
       04:484A  EF 10     
       04:484C  FF 00     
       04:484E  FF 00     
  629  04:4850  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4852  00 00     
       04:4854  00 00     
       04:4856  00 00     
       04:4858  00 00     
       04:485A  00 00     
       04:485C  00 00     
       04:485E  00 00     
  630                     
  631  04:4860            bp_body_d:
  632  04:4860  FE 00         dw $00fe,$00fe,$00fe,$10ee,$38c6,$10ee,$00fe,$00fe
       04:4862  FE 00     
       04:4864  FE 00     
       04:4866  EE 10     
       04:4868  C6 38     
       04:486A  EE 10     
       04:486C  FE 00     
       04:486E  FE 00     
  633  04:4870  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4872  00 00     
       04:4874  00 00     
       04:4876  00 00     
       04:4878  00 00     
       04:487A  00 00     
       04:487C  00 00     
       04:487E  00 00     
  634                     
  635  04:4880            bp_body_r:
  636  04:4880  00 00         dw $0000,$00ff,$00ff,$10ef,$38c7,$10ef,$00ff,$00ff
       04:4882  FF 00     
       04:4884  FF 00     
       04:4886  EF 10     
       04:4888  C7 38     
       04:488A  EF 10     
       04:488C  FF 00     
       04:488E  FF 00     
  637  04:4890  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4892  00 00     
       04:4894  00 00     
       04:4896  00 00     
       04:4898  00 00     
       04:489A  00 00     
       04:489C  00 00     
       04:489E  00 00     
  638                     
  639  04:48A0            bp_body_u:
  640  04:48A0  FE 00         dw $00fe,$00fe,$00fe,$10ee,$38c6,$10ee,$00fe,$00fe
       04:48A2  FE 00     
       04:48A4  FE 00     
       04:48A6  EE 10     
       04:48A8  C6 38     
       04:48AA  EE 10     
       04:48AC  FE 00     
       04:48AE  FE 00     
  641  04:48B0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:48B2  00 00     
       04:48B4  00 00     
       04:48B6  00 00     
       04:48B8  00 00     
       04:48BA  00 00     
       04:48BC  00 00     
       04:48BE  00 00     
  642                     
  643  04:48C0            bp_body_corner_ul:
  644                     ;        dw $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
  645                     ;        dw $00,$00,$00,$00,$00,$00,$00,$00
  646                     
  647  04:48C0  00 00         dw $0000,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff
       04:48C2  FF 00     
       04:48C4  FF 00     
       04:48C6  FF 00     
       04:48C8  FF 00     
       04:48CA  FF 00     
       04:48CC  FF 00     
       04:48CE  FF 00     
  648  04:48D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:48D2  00 00     
       04:48D4  00 00     
       04:48D6  00 00     
       04:48D8  00 00     
       04:48DA  00 00     
       04:48DC  00 00     
       04:48DE  00 00     
  649                     
  650  04:48E0            bp_body_corner_ur:
  651  04:48E0  00 00         dw $0000,$00fe,$00fe,$00fe,$00fe,$00fe,$00fe,$00fe
       04:48E2  FE 00     
       04:48E4  FE 00     
       04:48E6  FE 00     
       04:48E8  FE 00     
       04:48EA  FE 00     
       04:48EC  FE 00     
       04:48EE  FE 00     
  652  04:48F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:48F2  00 00     
       04:48F4  00 00     
       04:48F6  00 00     
       04:48F8  00 00     
       04:48FA  00 00     
       04:48FC  00 00     
       04:48FE  00 00     
  653  04:4900            bp_body_corner_dl:
  654  04:4900  FE 00         dw $00fe,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff
       04:4902  FF 00     
       04:4904  FF 00     
       04:4906  FF 00     
       04:4908  FF 00     
       04:490A  FF 00     
       04:490C  FF 00     
       04:490E  FF 00     
  655  04:4910  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4912  00 00     
       04:4914  00 00     
       04:4916  00 00     
       04:4918  00 00     
       04:491A  00 00     
       04:491C  00 00     
       04:491E  00 00     
  656  04:4920            bp_body_corner_dr:
  657  04:4920  FE 00         dw $00fe,$00fe,$00fe,$00fe,$00fe,$00fe,$00fe,$00fe
       04:4922  FE 00     
       04:4924  FE 00     
       04:4926  FE 00     
       04:4928  FE 00     
       04:492A  FE 00     
       04:492C  FE 00     
       04:492E  FE 00     
  658  04:4930  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       04:4932  00 00     
       04:4934  00 00     
       04:4936  00 00     
       04:4938  00 00     
       04:493A  00 00     
       04:493C  00 00     
       04:493E  00 00     
  659                     
  660  04:4940            BgPattern_end:
  661           0940      BgPattern_size  equ BgPattern_end-BgPattern
  662                     
  663                     
  664  04:4940            BodyPatterns:
  665                     
  666  04:4940            BodyPatternL:
  667  04:4940  00 00         dw $0000,$00ff,$00ff,$807f,$c13e,$807f,$00ff,$00ff
       04:4942  FF 00     
       04:4944  FF 00     
       04:4946  7F 80     
       04:4948  3E C1     
       04:494A  7F 80     
       04:494C  FF 00     
       04:494E  FF 00     
  668  04:4950  00 00         dw $0000,$00ff,$02fd,$07f8,$8f70,$07f8,$02fd,$00ff
       04:4952  FF 00     
       04:4954  FD 02     
       04:4956  F8 07     
       04:4958  70 8F     
       04:495A  F8 07     
       04:495C  FD 02     
       04:495E  FF 00     
  669  04:4960  00 00         dw $0000,$08f7,$1ce3,$3ec1,$7f80,$3ec1,$1ce3,$08f7
       04:4962  F7 08     
       04:4964  E3 1C     
       04:4966  C1 3E     
       04:4968  80 7F     
       04:496A  C1 3E     
       04:496C  E3 1C     
       04:496E  F7 08     
  670  04:4970  00 00         dw $0000,$00ff,$20df,$708f,$f807,$708f,$20df,$00ff
       04:4972  FF 00     
       04:4974  DF 20     
       04:4976  8F 70     
       04:4978  07 F8     
       04:497A  8F 70     
       04:497C  DF 20     
       04:497E  FF 00     
  671  04:4980            BodyPatternD:
  672  04:4980  C6 38         dw $38c6,$10ee,$00fe,$00fe,$00fe,$00fe,$00fe,$10ee
       04:4982  EE 10     
       04:4984  FE 00     
       04:4986  FE 00     
       04:4988  FE 00     
       04:498A  FE 00     
       04:498C  FE 00     
       04:498E  EE 10     
  673  04:4990  EE 10         dw $10ee,$38c6,$7c82,$38c6,$10ee,$00fe,$00fe,$00fe
       04:4992  C6 38     
       04:4994  82 7C     
       04:4996  C6 38     
       04:4998  EE 10     
       04:499A  FE 00     
       04:499C  FE 00     
       04:499E  FE 00     
  674  04:49A0  FE 00         dw $00fe,$10ee,$38c6,$7c82,$fe00,$7c82,$38c6,$10ee
       04:49A2  EE 10     
       04:49A4  C6 38     
       04:49A6  82 7C     
       04:49A8  00 FE     
       04:49AA  82 7C     
       04:49AC  C6 38     
       04:49AE  EE 10     
  675  04:49B0  EE 10         dw $10ee,$00fe,$00fe,$00fe,$10ee,$38c6,$7c82,$38c6
       04:49B2  FE 00     
       04:49B4  FE 00     
       04:49B6  FE 00     
       04:49B8  EE 10     
       04:49BA  C6 38     
       04:49BC  82 7C     
       04:49BE  C6 38     
  676  04:49C0            BodyPatternR:
  677  04:49C0  00 00         dw $0000,$00ff,$00ff,$807f,$c13e,$807f,$00ff,$00ff
       04:49C2  FF 00     
       04:49C4  FF 00     
       04:49C6  7F 80     
       04:49C8  3E C1     
       04:49CA  7F 80     
       04:49CC  FF 00     
       04:49CE  FF 00     
  678  04:49D0  00 00         dw $0000,$00ff,$20df,$708f,$f807,$708f,$20df,$00ff
       04:49D2  FF 00     
       04:49D4  DF 20     
       04:49D6  8F 70     
       04:49D8  07 F8     
       04:49DA  8F 70     
       04:49DC  DF 20     
       04:49DE  FF 00     
  679  04:49E0  00 00         dw $0000,$08f7,$1ce3,$3ec1,$7f80,$3ec1,$1ce3,$08f7
       04:49E2  F7 08     
       04:49E4  E3 1C     
       04:49E6  C1 3E     
       04:49E8  80 7F     
       04:49EA  C1 3E     
       04:49EC  E3 1C     
       04:49EE  F7 08     
  680  04:49F0  00 00         dw $0000,$00ff,$02fd,$07f8,$8f70,$07f8,$02fd,$00ff
       04:49F2  FF 00     
       04:49F4  FD 02     
       04:49F6  F8 07     
       04:49F8  70 8F     
       04:49FA  F8 07     
       04:49FC  FD 02     
       04:49FE  FF 00     
  681  04:4A00            BodyPatternU:
  682  04:4A00  C6 38         dw $38c6,$10ee,$00fe,$00fe,$00fe,$00fe,$00fe,$10ee
       04:4A02  EE 10     
       04:4A04  FE 00     
       04:4A06  FE 00     
       04:4A08  FE 00     
       04:4A0A  FE 00     
       04:4A0C  FE 00     
       04:4A0E  EE 10     
  683  04:4A10  EE 10         dw $10ee,$00fe,$00fe,$00fe,$10ee,$38c6,$7c82,$38c6
       04:4A12  FE 00     
       04:4A14  FE 00     
       04:4A16  FE 00     
       04:4A18  EE 10     
       04:4A1A  C6 38     
       04:4A1C  82 7C     
       04:4A1E  C6 38     
  684  04:4A20  FE 00         dw $00fe,$10ee,$38c6,$7c82,$fe00,$7c82,$38c6,$10ee
       04:4A22  EE 10     
       04:4A24  C6 38     
       04:4A26  82 7C     
       04:4A28  00 FE     
       04:4A2A  82 7C     
       04:4A2C  C6 38     
       04:4A2E  EE 10     
  685  04:4A30  EE 10         dw $10ee,$38c6,$7c82,$38c6,$10ee,$00fe,$00fe,$00fe
       04:4A32  C6 38     
       04:4A34  82 7C     
       04:4A36  C6 38     
       04:4A38  EE 10     
       04:4A3A  FE 00     
       04:4A3C  FE 00     
       04:4A3E  FE 00     
  686                     
  687                     
  688                     BGPatternAddress    .macro
  689                     \1  equ (\2+\3*16)/16
  690                         .endm
  691                     
  692  04:8A40                BGPatternAddress    BG_0,$1000,0
  693  04:8A40                BGPatternAddress    BG_A,$1000,10
  694  04:8A40                BGPatternAddress    BG_COMMA,$1000,36
  695  04:8A40                BGPatternAddress    BG_COLON,$1000,37
  696  04:8A40                BGPatternAddress    BG_PLAYER1,$1000,38
  697  04:8A40                BGPatternAddress    BG_HIGHSCORE,$1000,42
  698  04:8A40                BGPatternAddress    BG_LEFT,$1000,46
  699  04:8A40                BGPatternAddress    BG_BONUS,$1000,48
  700  04:8A40                BGPatternAddress    BG_SPACE,$1000,51
  701  04:8A40                BGPatternAddress    BG_WALL_UL,$1000,53
  702  04:8A40                BGPatternAddress    BG_WALL_UR,$1000,54
  703  04:8A40                BGPatternAddress    BG_WALL_DL,$1000,55
  704  04:8A40                BGPatternAddress    BG_WALL_DR,$1000,56
  705  04:8A40                BGPatternAddress    BG_WALL_L,$1000,57
  706  04:8A40                BGPatternAddress    BG_WALL_R,$1000,58
  707  04:8A40                BGPatternAddress    BG_WALL_U,$1000,59
  708  04:8A40                BGPatternAddress    BG_WALL_D,$1000,60
  709  04:8A40                BGPatternAddress    BG_WALL_BLANK_UL,$1000,61
  710  04:8A40                BGPatternAddress    BG_WALL_BLANK_UR,$1000,62
  711  04:8A40                BGPatternAddress    BG_WALL_BLANK_DL,$1000,63
  712  04:8A40                BGPatternAddress    BG_WALL_BLANK_DR,$1000,64
  713  04:8A40                BGPatternAddress    BG_DOT,$1000,65
  714  04:8A40                BGPatternAddress    BG_BODY_L,$1000,66
  715  04:8A40                BGPatternAddress    BG_BODY_D,$1000,67
  716  04:8A40                BGPatternAddress    BG_BODY_R,$1000,68
  717  04:8A40                BGPatternAddress    BG_BODY_U,$1000,69
  718  04:8A40                BGPatternAddress    BG_BODY_CORNER_UL,$1000,70
  719  04:8A40                BGPatternAddress    BG_BODY_CORNER_UR,$1000,71
  720  04:8A40                BGPatternAddress    BG_BODY_CORNER_DL,$1000,72
  721  04:8A40                BGPatternAddress    BG_BODY_CORNER_DR,$1000,73
  722                     ; ┌─┐
  723                     ; │ │
  724                     ; └─┘
  725           9000      BGPAL_BLUE      equ $9000
  726           A000      BGPAL_RED       equ $a000
  727           B000      BGPAL_MAGENTA   equ $b000
  728           C000      BGPAL_GREEN     equ $c000
  729           D000      BGPAL_CYAN      equ $d000
  730           E000      BGPAL_YELLOW    equ $e000
  731           F000      BGPAL_WHITE     equ $f000
  732                     
  733  04:4A40            BgPalette:
  734  04:4A40  00 00         dw $000,$028,$03f,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4A42  28 00     
       04:4A44  3F 00     
       04:4A46  00 00     
       04:4A48  00 00     
       04:4A4A  00 00     
       04:4A4C  00 00     
       04:4A4E  00 00     
       04:4A50  00 00     
       04:4A52  00 00     
       04:4A54  00 00     
       04:4A56  00 00     
       04:4A58  00 00     
       04:4A5A  00 00     
       04:4A5C  00 00     
       04:4A5E  00 00     
  735  04:4A60  00 00         dw $000,$03f,$1ff,$1f8,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4A62  3F 00     
       04:4A64  FF 01     
       04:4A66  F8 01     
       04:4A68  00 00     
       04:4A6A  00 00     
       04:4A6C  00 00     
       04:4A6E  00 00     
       04:4A70  00 00     
       04:4A72  00 00     
       04:4A74  00 00     
       04:4A76  00 00     
       04:4A78  00 00     
       04:4A7A  00 00     
       04:4A7C  00 00     
       04:4A7E  00 00     
  736  04:4A80  00 00         dw $000,$038,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4A82  38 00     
       04:4A84  FF 01     
       04:4A86  00 00     
       04:4A88  00 00     
       04:4A8A  00 00     
       04:4A8C  00 00     
       04:4A8E  00 00     
       04:4A90  00 00     
       04:4A92  00 00     
       04:4A94  00 00     
       04:4A96  00 00     
       04:4A98  00 00     
       04:4A9A  00 00     
       04:4A9C  00 00     
       04:4A9E  00 00     
  737  04:4AA0  00 00         dw $000,$007,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4AA2  07 00     
       04:4AA4  FF 01     
       04:4AA6  00 00     
       04:4AA8  00 00     
       04:4AAA  00 00     
       04:4AAC  00 00     
       04:4AAE  00 00     
       04:4AB0  00 00     
       04:4AB2  00 00     
       04:4AB4  00 00     
       04:4AB6  00 00     
       04:4AB8  00 00     
       04:4ABA  00 00     
       04:4ABC  00 00     
       04:4ABE  00 00     
  738  04:4AC0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4AC2  00 00     
       04:4AC4  00 00     
       04:4AC6  00 00     
       04:4AC8  00 00     
       04:4ACA  00 00     
       04:4ACC  00 00     
       04:4ACE  00 00     
       04:4AD0  00 00     
       04:4AD2  00 00     
       04:4AD4  00 00     
       04:4AD6  00 00     
       04:4AD8  00 00     
       04:4ADA  00 00     
       04:4ADC  00 00     
       04:4ADE  00 00     
  739  04:4AE0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4AE2  00 00     
       04:4AE4  00 00     
       04:4AE6  00 00     
       04:4AE8  00 00     
       04:4AEA  00 00     
       04:4AEC  00 00     
       04:4AEE  00 00     
       04:4AF0  00 00     
       04:4AF2  00 00     
       04:4AF4  00 00     
       04:4AF6  00 00     
       04:4AF8  00 00     
       04:4AFA  00 00     
       04:4AFC  00 00     
       04:4AFE  00 00     
  740  04:4B00  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4B02  00 00     
       04:4B04  00 00     
       04:4B06  00 00     
       04:4B08  00 00     
       04:4B0A  00 00     
       04:4B0C  00 00     
       04:4B0E  00 00     
       04:4B10  00 00     
       04:4B12  00 00     
       04:4B14  00 00     
       04:4B16  00 00     
       04:4B18  00 00     
       04:4B1A  00 00     
       04:4B1C  00 00     
       04:4B1E  00 00     
  741  04:4B20  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4B22  00 00     
       04:4B24  00 00     
       04:4B26  00 00     
       04:4B28  00 00     
       04:4B2A  00 00     
       04:4B2C  00 00     
       04:4B2E  00 00     
       04:4B30  00 00     
       04:4B32  00 00     
       04:4B34  00 00     
       04:4B36  00 00     
       04:4B38  00 00     
       04:4B3A  00 00     
       04:4B3C  00 00     
       04:4B3E  00 00     
  742  04:4B40  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4B42  00 00     
       04:4B44  00 00     
       04:4B46  00 00     
       04:4B48  00 00     
       04:4B4A  00 00     
       04:4B4C  00 00     
       04:4B4E  00 00     
       04:4B50  00 00     
       04:4B52  00 00     
       04:4B54  00 00     
       04:4B56  00 00     
       04:4B58  00 00     
       04:4B5A  00 00     
       04:4B5C  00 00     
       04:4B5E  00 00     
  743  04:4B60  00 00         dw $000,$007,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4B62  07 00     
       04:4B64  00 00     
       04:4B66  00 00     
       04:4B68  00 00     
       04:4B6A  00 00     
       04:4B6C  00 00     
       04:4B6E  00 00     
       04:4B70  00 00     
       04:4B72  00 00     
       04:4B74  00 00     
       04:4B76  00 00     
       04:4B78  00 00     
       04:4B7A  00 00     
       04:4B7C  00 00     
       04:4B7E  00 00     
  744  04:4B80  00 00         dw $000,$038,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4B82  38 00     
       04:4B84  00 00     
       04:4B86  00 00     
       04:4B88  00 00     
       04:4B8A  00 00     
       04:4B8C  00 00     
       04:4B8E  00 00     
       04:4B90  00 00     
       04:4B92  00 00     
       04:4B94  00 00     
       04:4B96  00 00     
       04:4B98  00 00     
       04:4B9A  00 00     
       04:4B9C  00 00     
       04:4B9E  00 00     
  745  04:4BA0  00 00         dw $000,$03f,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4BA2  3F 00     
       04:4BA4  00 00     
       04:4BA6  00 00     
       04:4BA8  00 00     
       04:4BAA  00 00     
       04:4BAC  00 00     
       04:4BAE  00 00     
       04:4BB0  00 00     
       04:4BB2  00 00     
       04:4BB4  00 00     
       04:4BB6  00 00     
       04:4BB8  00 00     
       04:4BBA  00 00     
       04:4BBC  00 00     
       04:4BBE  00 00     
  746  04:4BC0  00 00         dw $000,$1c0,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4BC2  C0 01     
       04:4BC4  00 00     
       04:4BC6  00 00     
       04:4BC8  00 00     
       04:4BCA  00 00     
       04:4BCC  00 00     
       04:4BCE  00 00     
       04:4BD0  00 00     
       04:4BD2  00 00     
       04:4BD4  00 00     
       04:4BD6  00 00     
       04:4BD8  00 00     
       04:4BDA  00 00     
       04:4BDC  00 00     
       04:4BDE  00 00     
  747  04:4BE0  00 00         dw $000,$147,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4BE2  47 01     
       04:4BE4  00 00     
       04:4BE6  00 00     
       04:4BE8  00 00     
       04:4BEA  00 00     
       04:4BEC  00 00     
       04:4BEE  00 00     
       04:4BF0  00 00     
       04:4BF2  00 00     
       04:4BF4  00 00     
       04:4BF6  00 00     
       04:4BF8  00 00     
       04:4BFA  00 00     
       04:4BFC  00 00     
       04:4BFE  00 00     
  748  04:4C00  00 00         dw $000,$1f8,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4C02  F8 01     
       04:4C04  00 00     
       04:4C06  00 00     
       04:4C08  00 00     
       04:4C0A  00 00     
       04:4C0C  00 00     
       04:4C0E  00 00     
       04:4C10  00 00     
       04:4C12  00 00     
       04:4C14  00 00     
       04:4C16  00 00     
       04:4C18  00 00     
       04:4C1A  00 00     
       04:4C1C  00 00     
       04:4C1E  00 00     
  749  04:4C20  00 00         dw $000,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       04:4C22  FF 01     
       04:4C24  00 00     
       04:4C26  00 00     
       04:4C28  00 00     
       04:4C2A  00 00     
       04:4C2C  00 00     
       04:4C2E  00 00     
       04:4C30  00 00     
       04:4C32  00 00     
       04:4C34  00 00     
       04:4C36  00 00     
       04:4C38  00 00     
       04:4C3A  00 00     
       04:4C3C  00 00     
       04:4C3E  00 00     
  750                     
  751                     
  752                     ;    dw $000,$028,$03f,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
  753                     ;    dw $000,$03f,$1ff,$1f8,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
  754                     ;    dw $000,$038,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
  755                     ;    dw $000,$007,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
  756                     ;        dw $0000,$ffff,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  757                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  758                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  759                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  760                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  761                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  762                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  763                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  764                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  765                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  766                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  767                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  768                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  769                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
  770                     ;        dw $0000,$01b6,$0120,$0000,$0000,$0000,$0000,$0000,$0107,$01c7,$0000,$0000,$0000,$0000,$0000,$0000
#[1]   nibbler.asm
#[2]   sprpattern.asm
   29                             .include "sprpattern.asm"
    1           4C40              .code
    2                     ;        .bank   MAIN_BANK+3
    3           0005              .bank   SPRPATTERN_BANK
    4           6000              org     $6000
    5                     
    6  05:6000            SpPattern:
    7                     
    8  05:6000            sp_head:
    9  05:6000  00 00         dw $0000,$07c0,$1ef0,$1c70,$3ef8,$3ff8,$3ff8,$0fe0
       05:6002  C0 07     
       05:6004  F0 1E     
       05:6006  70 1C     
       05:6008  F8 3E     
       05:600A  F8 3F     
       05:600C  F8 3F     
       05:600E  E0 0F     
   10  05:6010  D8 37         dw $37d8,$37d8,$07c0,$0fe0,$3ff8,$3ff8,$0fe0,$0000
       05:6012  D8 37     
       05:6014  C0 07     
       05:6016  E0 0F     
       05:6018  F8 3F     
       05:601A  F8 3F     
       05:601C  E0 0F     
       05:601E  00 00     
   11  05:6020  00 00         dw $0000,$0000,$0100,$0380,$0100,$0000,$0000,$701c
       05:6022  00 00     
       05:6024  00 01     
       05:6026  80 03     
       05:6028  00 01     
       05:602A  00 00     
       05:602C  00 00     
       05:602E  1C 70     
   12  05:6030  3E F8         dw $f83e,$f83e,$f83e,$701c,$0000,$0000,$0000,$0000
       05:6032  3E F8     
       05:6034  3E F8     
       05:6036  1C 70     
       05:6038  00 00     
       05:603A  00 00     
       05:603C  00 00     
       05:603E  00 00     
   13  05:6040  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6042  00 00     
       05:6044  00 00     
       05:6046  00 00     
       05:6048  00 00     
       05:604A  00 00     
       05:604C  00 00     
       05:604E  00 00     
   14  05:6050  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6052  00 00     
       05:6054  00 00     
       05:6056  00 00     
       05:6058  00 00     
       05:605A  00 00     
       05:605C  00 00     
       05:605E  00 00     
   15  05:6060  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6062  00 00     
       05:6064  00 00     
       05:6066  00 00     
       05:6068  00 00     
       05:606A  00 00     
       05:606C  00 00     
       05:606E  00 00     
   16  05:6070  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6072  00 00     
       05:6074  00 00     
       05:6076  00 00     
       05:6078  00 00     
       05:607A  00 00     
       05:607C  00 00     
       05:607E  00 00     
   17  05:6080  00 00         dw $0000,$0000,$0000,$3370,$337c,$78fc,$7ffe,$7ff6
       05:6082  00 00     
       05:6084  00 00     
       05:6086  70 33     
       05:6088  7C 33     
       05:608A  FC 78     
       05:608C  FE 7F     
       05:608E  F6 7F     
   18  05:6090  E2 7F         dw $7fe2,$7ff6,$7ffe,$78fc,$337c,$3370,$0000,$0000
       05:6092  F6 7F     
       05:6094  FE 7F     
       05:6096  FC 78     
       05:6098  7C 33     
       05:609A  70 33     
       05:609C  00 00     
       05:609E  00 00     
   19  05:60A0  00 00         dw $0000,$0700,$0f80,$0f80,$0f80,$0700,$0000,$0008
       05:60A2  00 07     
       05:60A4  80 0F     
       05:60A6  80 0F     
       05:60A8  80 0F     
       05:60AA  00 07     
       05:60AC  00 00     
       05:60AE  08 00     
   20  05:60B0  1C 00         dw $001c,$0008,$0000,$0700,$0f80,$0f80,$0f80,$0700
       05:60B2  08 00     
       05:60B4  00 00     
       05:60B6  00 07     
       05:60B8  80 0F     
       05:60BA  80 0F     
       05:60BC  80 0F     
       05:60BE  00 07     
   21  05:60C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:60C2  00 00     
       05:60C4  00 00     
       05:60C6  00 00     
       05:60C8  00 00     
       05:60CA  00 00     
       05:60CC  00 00     
       05:60CE  00 00     
   22  05:60D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:60D2  00 00     
       05:60D4  00 00     
       05:60D6  00 00     
       05:60D8  00 00     
       05:60DA  00 00     
       05:60DC  00 00     
       05:60DE  00 00     
   23  05:60E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:60E2  00 00     
       05:60E4  00 00     
       05:60E6  00 00     
       05:60E8  00 00     
       05:60EA  00 00     
       05:60EC  00 00     
       05:60EE  00 00     
   24  05:60F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:60F2  00 00     
       05:60F4  00 00     
       05:60F6  00 00     
       05:60F8  00 00     
       05:60FA  00 00     
       05:60FC  00 00     
       05:60FE  00 00     
   25  05:6100  00 00         dw $0000,$0fe0,$3ff8,$3ff8,$0fe0,$07c0,$37d8,$37d8
       05:6102  E0 0F     
       05:6104  F8 3F     
       05:6106  F8 3F     
       05:6108  E0 0F     
       05:610A  C0 07     
       05:610C  D8 37     
       05:610E  D8 37     
   26  05:6110  E0 0F         dw $0fe0,$3ff8,$3ff8,$3ef8,$1c70,$1ef0,$07c0,$0000
       05:6112  F8 3F     
       05:6114  F8 3F     
       05:6116  F8 3E     
       05:6118  70 1C     
       05:611A  F0 1E     
       05:611C  C0 07     
       05:611E  00 00     
   27  05:6120  00 00         dw $0000,$0000,$0000,$0000,$701c,$f83e,$f83e,$f83e
       05:6122  00 00     
       05:6124  00 00     
       05:6126  00 00     
       05:6128  1C 70     
       05:612A  3E F8     
       05:612C  3E F8     
       05:612E  3E F8     
   28  05:6130  1C 70         dw $701c,$0000,$0000,$0100,$0380,$0100,$0000,$0000
       05:6132  00 00     
       05:6134  00 00     
       05:6136  00 01     
       05:6138  80 03     
       05:613A  00 01     
       05:613C  00 00     
       05:613E  00 00     
   29  05:6140  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6142  00 00     
       05:6144  00 00     
       05:6146  00 00     
       05:6148  00 00     
       05:614A  00 00     
       05:614C  00 00     
       05:614E  00 00     
   30  05:6150  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6152  00 00     
       05:6154  00 00     
       05:6156  00 00     
       05:6158  00 00     
       05:615A  00 00     
       05:615C  00 00     
       05:615E  00 00     
   31  05:6160  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6162  00 00     
       05:6164  00 00     
       05:6166  00 00     
       05:6168  00 00     
       05:616A  00 00     
       05:616C  00 00     
       05:616E  00 00     
   32  05:6170  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6172  00 00     
       05:6174  00 00     
       05:6176  00 00     
       05:6178  00 00     
       05:617A  00 00     
       05:617C  00 00     
       05:617E  00 00     
   33  05:6180  00 00         dw $0000,$0000,$0000,$0ecc,$3ecc,$3f1e,$7ffe,$6ffe
       05:6182  00 00     
       05:6184  00 00     
       05:6186  CC 0E     
       05:6188  CC 3E     
       05:618A  1E 3F     
       05:618C  FE 7F     
       05:618E  FE 6F     
   34  05:6190  FE 47         dw $47fe,$6ffe,$7ffe,$3f1e,$3ecc,$0ecc,$0000,$0000
       05:6192  FE 6F     
       05:6194  FE 7F     
       05:6196  1E 3F     
       05:6198  CC 3E     
       05:619A  CC 0E     
       05:619C  00 00     
       05:619E  00 00     
   35  05:61A0  00 00         dw $0000,$00e0,$01f0,$01f0,$01f0,$00e0,$0000,$1000
       05:61A2  E0 00     
       05:61A4  F0 01     
       05:61A6  F0 01     
       05:61A8  F0 01     
       05:61AA  E0 00     
       05:61AC  00 00     
       05:61AE  00 10     
   36  05:61B0  00 38         dw $3800,$1000,$0000,$00e0,$01f0,$01f0,$01f0,$00e0
       05:61B2  00 10     
       05:61B4  00 00     
       05:61B6  E0 00     
       05:61B8  F0 01     
       05:61BA  F0 01     
       05:61BC  F0 01     
       05:61BE  E0 00     
   37  05:61C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:61C2  00 00     
       05:61C4  00 00     
       05:61C6  00 00     
       05:61C8  00 00     
       05:61CA  00 00     
       05:61CC  00 00     
       05:61CE  00 00     
   38  05:61D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:61D2  00 00     
       05:61D4  00 00     
       05:61D6  00 00     
       05:61D8  00 00     
       05:61DA  00 00     
       05:61DC  00 00     
       05:61DE  00 00     
   39  05:61E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:61E2  00 00     
       05:61E4  00 00     
       05:61E6  00 00     
       05:61E8  00 00     
       05:61EA  00 00     
       05:61EC  00 00     
       05:61EE  00 00     
   40  05:61F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:61F2  00 00     
       05:61F4  00 00     
       05:61F6  00 00     
       05:61F8  00 00     
       05:61FA  00 00     
       05:61FC  00 00     
       05:61FE  00 00     
   41                     
   42                     
   43                     
   44                     ;    dw $0000,$0000,$0ecc,$3ecc,$3f1e,$7ffe,$6ffe,$47fe
   45                     ;    dw $6ffe,$7ffe,$3f1e,$3ecc,$0ecc,$0000,$0000,$0000
   46                     ;    dw $00e0,$01f0,$01f0,$01f0,$00e0,$0000,$1000,$3800
   47                     ;    dw $1000,$0000,$00e0,$01f0,$01f0,$01f0,$00e0,$0000
   48                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   49                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   50                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   51                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   52                     ;        dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
   53                     ;        dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
   54                     ;        dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   55                     ;        dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   56                     ;        dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   57                     ;        dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   58                     ;        dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   59                     ;        dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
   60                     
   61  05:6200            sp_tail:
   62  05:6200  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6202  FF FF     
       05:6204  FF FF     
       05:6206  FF FF     
       05:6208  FF FF     
       05:620A  FF FF     
       05:620C  FF FF     
       05:620E  FF FF     
   63  05:6210  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6212  FF FF     
       05:6214  FF FF     
       05:6216  FF FF     
       05:6218  FF FF     
       05:621A  FF FF     
       05:621C  FF FF     
       05:621E  FF FF     
   64  05:6220  1F F0         dw $f01f,$f83f,$f83f,$f83f,$f83f,$f83f,$f83f,$fc7f
       05:6222  3F F8     
       05:6224  3F F8     
       05:6226  3F F8     
       05:6228  3F F8     
       05:622A  3F F8     
       05:622C  3F F8     
       05:622E  7F FC     
   65  05:6230  7F FC         dw $fc7f,$fc7f,$fc7f,$fc7f,$fc7f,$feff,$feff,$feff
       05:6232  7F FC     
       05:6234  7F FC     
       05:6236  7F FC     
       05:6238  7F FC     
       05:623A  FF FE     
       05:623C  FF FE     
       05:623E  FF FE     
   66  05:6240  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6242  00 00     
       05:6244  00 00     
       05:6246  00 00     
       05:6248  00 00     
       05:624A  00 00     
       05:624C  00 00     
       05:624E  00 00     
   67  05:6250  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6252  00 00     
       05:6254  00 00     
       05:6256  00 00     
       05:6258  00 00     
       05:625A  00 00     
       05:625C  00 00     
       05:625E  00 00     
   68  05:6260  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6262  00 00     
       05:6264  00 00     
       05:6266  00 00     
       05:6268  00 00     
       05:626A  00 00     
       05:626C  00 00     
       05:626E  00 00     
   69  05:6270  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6272  00 00     
       05:6274  00 00     
       05:6276  00 00     
       05:6278  00 00     
       05:627A  00 00     
       05:627C  00 00     
       05:627E  00 00     
   70  05:6280  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6282  FF FF     
       05:6284  FF FF     
       05:6286  FF FF     
       05:6288  FF FF     
       05:628A  FF FF     
       05:628C  FF FF     
       05:628E  FF FF     
   71  05:6290  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6292  FF FF     
       05:6294  FF FF     
       05:6296  FF FF     
       05:6298  FF FF     
       05:629A  FF FF     
       05:629C  FF FF     
       05:629E  FF FF     
   72  05:62A0  1F F0         dw $f01f,$f83f,$f83f,$f83f,$fc3f,$fc7f,$fc7f,$fe7f
       05:62A2  3F F8     
       05:62A4  3F F8     
       05:62A6  3F F8     
       05:62A8  3F FC     
       05:62AA  7F FC     
       05:62AC  7F FC     
       05:62AE  7F FE     
   73  05:62B0  7F FE         dw $fe7f,$fe3f,$ff3f,$ff3f,$ffbf,$ff9f,$ffdf,$ffff
       05:62B2  3F FE     
       05:62B4  3F FF     
       05:62B6  3F FF     
       05:62B8  BF FF     
       05:62BA  9F FF     
       05:62BC  DF FF     
       05:62BE  FF FF     
   74  05:62C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:62C2  00 00     
       05:62C4  00 00     
       05:62C6  00 00     
       05:62C8  00 00     
       05:62CA  00 00     
       05:62CC  00 00     
       05:62CE  00 00     
   75  05:62D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:62D2  00 00     
       05:62D4  00 00     
       05:62D6  00 00     
       05:62D8  00 00     
       05:62DA  00 00     
       05:62DC  00 00     
       05:62DE  00 00     
   76  05:62E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:62E2  00 00     
       05:62E4  00 00     
       05:62E6  00 00     
       05:62E8  00 00     
       05:62EA  00 00     
       05:62EC  00 00     
       05:62EE  00 00     
   77  05:62F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:62F2  00 00     
       05:62F4  00 00     
       05:62F6  00 00     
       05:62F8  00 00     
       05:62FA  00 00     
       05:62FC  00 00     
       05:62FE  00 00     
   78  05:6300  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6302  FF FF     
       05:6304  FF FF     
       05:6306  FF FF     
       05:6308  FF FF     
       05:630A  FF FF     
       05:630C  FF FF     
       05:630E  FF FF     
   79  05:6310  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6312  FF FF     
       05:6314  FF FF     
       05:6316  FF FF     
       05:6318  FF FF     
       05:631A  FF FF     
       05:631C  FF FF     
       05:631E  FF FF     
   80  05:6320  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$fffe,$ff80,$e000
       05:6322  FF FF     
       05:6324  FF FF     
       05:6326  FF FF     
       05:6328  FF FF     
       05:632A  FE FF     
       05:632C  80 FF     
       05:632E  00 E0     
   81  05:6330  00 00         dw $0000,$e000,$ff80,$fffe,$ffff,$ffff,$ffff,$ffff
       05:6332  00 E0     
       05:6334  80 FF     
       05:6336  FE FF     
       05:6338  FF FF     
       05:633A  FF FF     
       05:633C  FF FF     
       05:633E  FF FF     
   82  05:6340  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6342  00 00     
       05:6344  00 00     
       05:6346  00 00     
       05:6348  00 00     
       05:634A  00 00     
       05:634C  00 00     
       05:634E  00 00     
   83  05:6350  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6352  00 00     
       05:6354  00 00     
       05:6356  00 00     
       05:6358  00 00     
       05:635A  00 00     
       05:635C  00 00     
       05:635E  00 00     
   84  05:6360  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6362  00 00     
       05:6364  00 00     
       05:6366  00 00     
       05:6368  00 00     
       05:636A  00 00     
       05:636C  00 00     
       05:636E  00 00     
   85  05:6370  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6372  00 00     
       05:6374  00 00     
       05:6376  00 00     
       05:6378  00 00     
       05:637A  00 00     
       05:637C  00 00     
       05:637E  00 00     
   86  05:6380  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6382  FF FF     
       05:6384  FF FF     
       05:6386  FF FF     
       05:6388  FF FF     
       05:638A  FF FF     
       05:638C  FF FF     
       05:638E  FF FF     
   87  05:6390  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6392  FF FF     
       05:6394  FF FF     
       05:6396  FF FF     
       05:6398  FF FF     
       05:639A  FF FF     
       05:639C  FF FF     
       05:639E  FF FF     
   88  05:63A0  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$fffe,$fff0,$ff80
       05:63A2  FF FF     
       05:63A4  FF FF     
       05:63A6  FF FF     
       05:63A8  FF FF     
       05:63AA  FE FF     
       05:63AC  F0 FF     
       05:63AE  80 FF     
   89  05:63B0  00 FC         dw $fc00,$f000,$c1e0,$9ffe,$ffff,$ffff,$ffff,$ffff
       05:63B2  00 F0     
       05:63B4  E0 C1     
       05:63B6  FE 9F     
       05:63B8  FF FF     
       05:63BA  FF FF     
       05:63BC  FF FF     
       05:63BE  FF FF     
   90  05:63C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:63C2  00 00     
       05:63C4  00 00     
       05:63C6  00 00     
       05:63C8  00 00     
       05:63CA  00 00     
       05:63CC  00 00     
       05:63CE  00 00     
   91  05:63D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:63D2  00 00     
       05:63D4  00 00     
       05:63D6  00 00     
       05:63D8  00 00     
       05:63DA  00 00     
       05:63DC  00 00     
       05:63DE  00 00     
   92  05:63E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:63E2  00 00     
       05:63E4  00 00     
       05:63E6  00 00     
       05:63E8  00 00     
       05:63EA  00 00     
       05:63EC  00 00     
       05:63EE  00 00     
   93  05:63F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:63F2  00 00     
       05:63F4  00 00     
       05:63F6  00 00     
       05:63F8  00 00     
       05:63FA  00 00     
       05:63FC  00 00     
       05:63FE  00 00     
   94                     
   95                     
   96                     
   97                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
   98                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
   99                     ;    dw $f01f,$f83f,$f83f,$f83f,$f83f,$f83f,$f83f,$fc7f
  100                     ;    dw $fc7f,$fc7f,$fc7f,$fc7f,$fc7f,$feff,$feff,$feff
  101                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  102                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  103                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  104                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  105                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
  106                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
  107                     ;    dw $f01f,$f83f,$f83f,$f83f,$fc3f,$fc7f,$fc7f,$fe7f
  108                     ;    dw $fe7f,$fe3f,$ff3f,$ff3f,$ffbf,$ff9f,$ffdf,$ffff
  109                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  110                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  111                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  112                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  113                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
  114                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
  115                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$fffe,$ff80,$e000
  116                     ;    dw $0000,$e000,$ff80,$fffe,$ffff,$ffff,$ffff,$ffff
  117                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  118                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  119                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  120                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  121                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
  122                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
  123                     ;    dw $ffff,$ffff,$ffff,$ffff,$ffff,$fffe,$fff0,$ff80
  124                     ;    dw $fc00,$f000,$c1e0,$9ffe,$ffff,$ffff,$ffff,$ffff
  125                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  126                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  127                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  128                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  129                     
  130                     
  131                     
  132                     
  133                     ;    dw $0fe0,$07c0,$07c0,$07c0,$07c0,$07c0,$07c0,$0380
  134                     ;    dw $0380,$0380,$0380,$0380,$0380,$0100,$0100,$0100
  135                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  136                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  137                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  138                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  139                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  140                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  141                     ;    dw $0fe0,$07c0,$07c0,$07c0,$03c0,$0380,$0380,$0180
  142                     ;    dw $0180,$01c0,$00c0,$00c0,$0040,$0060,$0020,$0000
  143                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  144                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  145                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  146                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  147                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  148                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  149                     ;    dw $0000,$0000,$0000,$0000,$0001,$007f,$1fff,$ffff
  150                     ;    dw $1fff,$007f,$0001,$0000,$0000,$0000,$0000,$0000
  151                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  152                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  153                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  154                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  155                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  156                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  157                     ;    dw $0000,$0000,$0000,$0000,$0001,$000f,$007f,$03ff
  158                     ;    dw $0fff,$3e1f,$6001,$0000,$0000,$0000,$0000,$0000
  159                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  160                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  161                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  162                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  163                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  164                     ;    dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
  165                     
  166  05:6400            sp_tile:
  167  05:6400  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6402  00 00     
       05:6404  00 00     
       05:6406  00 00     
       05:6408  00 00     
       05:640A  00 00     
       05:640C  00 00     
       05:640E  00 00     
  168  05:6410  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6412  00 00     
       05:6414  00 00     
       05:6416  00 00     
       05:6418  00 00     
       05:641A  00 00     
       05:641C  00 00     
       05:641E  00 00     
  169  05:6420  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6422  00 00     
       05:6424  00 00     
       05:6426  00 00     
       05:6428  00 00     
       05:642A  00 00     
       05:642C  00 00     
       05:642E  00 00     
  170  05:6430  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6432  00 00     
       05:6434  00 00     
       05:6436  00 00     
       05:6438  00 00     
       05:643A  00 00     
       05:643C  00 00     
       05:643E  00 00     
  171  05:6440  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6442  00 00     
       05:6444  00 00     
       05:6446  00 00     
       05:6448  00 00     
       05:644A  00 00     
       05:644C  00 00     
       05:644E  00 00     
  172  05:6450  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6452  00 00     
       05:6454  00 00     
       05:6456  00 00     
       05:6458  00 00     
       05:645A  00 00     
       05:645C  00 00     
       05:645E  00 00     
  173  05:6460  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6462  00 00     
       05:6464  00 00     
       05:6466  00 00     
       05:6468  00 00     
       05:646A  00 00     
       05:646C  00 00     
       05:646E  00 00     
  174  05:6470  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6472  00 00     
       05:6474  00 00     
       05:6476  00 00     
       05:6478  00 00     
       05:647A  00 00     
       05:647C  00 00     
       05:647E  00 00     
  175  05:6480  00 FF         dw $ff00,$ff00,$ff00,$ff00,$ff00,$ff00,$ff00,$ff00
       05:6482  00 FF     
       05:6484  00 FF     
       05:6486  00 FF     
       05:6488  00 FF     
       05:648A  00 FF     
       05:648C  00 FF     
       05:648E  00 FF     
  176  05:6490  00 FF         dw $ff00,$ff00,$ff00,$ff00,$ff00,$ff00,$ff00,$ff00
       05:6492  00 FF     
       05:6494  00 FF     
       05:6496  00 FF     
       05:6498  00 FF     
       05:649A  00 FF     
       05:649C  00 FF     
       05:649E  00 FF     
  177  05:64A0  00 00         dw $0000,$7700,$7700,$7700,$0000,$7700,$7700,$7700
       05:64A2  00 77     
       05:64A4  00 77     
       05:64A6  00 77     
       05:64A8  00 00     
       05:64AA  00 77     
       05:64AC  00 77     
       05:64AE  00 77     
  178  05:64B0  00 00         dw $0000,$7700,$7700,$7700,$0000,$7700,$7700,$7700
       05:64B2  00 77     
       05:64B4  00 77     
       05:64B6  00 77     
       05:64B8  00 00     
       05:64BA  00 77     
       05:64BC  00 77     
       05:64BE  00 77     
  179  05:64C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:64C2  00 00     
       05:64C4  00 00     
       05:64C6  00 00     
       05:64C8  00 00     
       05:64CA  00 00     
       05:64CC  00 00     
       05:64CE  00 00     
  180  05:64D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:64D2  00 00     
       05:64D4  00 00     
       05:64D6  00 00     
       05:64D8  00 00     
       05:64DA  00 00     
       05:64DC  00 00     
       05:64DE  00 00     
  181  05:64E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:64E2  00 00     
       05:64E4  00 00     
       05:64E6  00 00     
       05:64E8  00 00     
       05:64EA  00 00     
       05:64EC  00 00     
       05:64EE  00 00     
  182  05:64F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:64F2  00 00     
       05:64F4  00 00     
       05:64F6  00 00     
       05:64F8  00 00     
       05:64FA  00 00     
       05:64FC  00 00     
       05:64FE  00 00     
  183  05:6500  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6502  FF FF     
       05:6504  FF FF     
       05:6506  FF FF     
       05:6508  FF FF     
       05:650A  FF FF     
       05:650C  FF FF     
       05:650E  FF FF     
  184  05:6510  FF FF         dw $ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff,$ffff
       05:6512  FF FF     
       05:6514  FF FF     
       05:6516  FF FF     
       05:6518  FF FF     
       05:651A  FF FF     
       05:651C  FF FF     
       05:651E  FF FF     
  185  05:6520  00 00         dw $0000,$7777,$7777,$7777,$0000,$7777,$7777,$7777
       05:6522  77 77     
       05:6524  77 77     
       05:6526  77 77     
       05:6528  00 00     
       05:652A  77 77     
       05:652C  77 77     
       05:652E  77 77     
  186  05:6530  00 00         dw $0000,$7777,$7777,$7777,$0000,$7777,$7777,$7777
       05:6532  77 77     
       05:6534  77 77     
       05:6536  77 77     
       05:6538  00 00     
       05:653A  77 77     
       05:653C  77 77     
       05:653E  77 77     
  187  05:6540  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6542  00 00     
       05:6544  00 00     
       05:6546  00 00     
       05:6548  00 00     
       05:654A  00 00     
       05:654C  00 00     
       05:654E  00 00     
  188  05:6550  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6552  00 00     
       05:6554  00 00     
       05:6556  00 00     
       05:6558  00 00     
       05:655A  00 00     
       05:655C  00 00     
       05:655E  00 00     
  189  05:6560  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6562  00 00     
       05:6564  00 00     
       05:6566  00 00     
       05:6568  00 00     
       05:656A  00 00     
       05:656C  00 00     
       05:656E  00 00     
  190  05:6570  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6572  00 00     
       05:6574  00 00     
       05:6576  00 00     
       05:6578  00 00     
       05:657A  00 00     
       05:657C  00 00     
       05:657E  00 00     
  191  05:6580  FF 00         dw $00ff,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff
       05:6582  FF 00     
       05:6584  FF 00     
       05:6586  FF 00     
       05:6588  FF 00     
       05:658A  FF 00     
       05:658C  FF 00     
       05:658E  FF 00     
  192  05:6590  FF 00         dw $00ff,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff,$00ff
       05:6592  FF 00     
       05:6594  FF 00     
       05:6596  FF 00     
       05:6598  FF 00     
       05:659A  FF 00     
       05:659C  FF 00     
       05:659E  FF 00     
  193  05:65A0  00 00         dw $0000,$0077,$0077,$0077,$0000,$0077,$0077,$0077
       05:65A2  77 00     
       05:65A4  77 00     
       05:65A6  77 00     
       05:65A8  00 00     
       05:65AA  77 00     
       05:65AC  77 00     
       05:65AE  77 00     
  194  05:65B0  00 00         dw $0000,$0077,$0077,$0077,$0000,$0077,$0077,$0077
       05:65B2  77 00     
       05:65B4  77 00     
       05:65B6  77 00     
       05:65B8  00 00     
       05:65BA  77 00     
       05:65BC  77 00     
       05:65BE  77 00     
  195  05:65C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:65C2  00 00     
       05:65C4  00 00     
       05:65C6  00 00     
       05:65C8  00 00     
       05:65CA  00 00     
       05:65CC  00 00     
       05:65CE  00 00     
  196  05:65D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:65D2  00 00     
       05:65D4  00 00     
       05:65D6  00 00     
       05:65D8  00 00     
       05:65DA  00 00     
       05:65DC  00 00     
       05:65DE  00 00     
  197  05:65E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:65E2  00 00     
       05:65E4  00 00     
       05:65E6  00 00     
       05:65E8  00 00     
       05:65EA  00 00     
       05:65EC  00 00     
       05:65EE  00 00     
  198  05:65F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:65F2  00 00     
       05:65F4  00 00     
       05:65F6  00 00     
       05:65F8  00 00     
       05:65FA  00 00     
       05:65FC  00 00     
       05:65FE  00 00     
  199  05:6600  00 80         dw $8000,$8000,$8000,$8000,$8000,$8000,$8000,$8000
       05:6602  00 80     
       05:6604  00 80     
       05:6606  00 80     
       05:6608  00 80     
       05:660A  00 80     
       05:660C  00 80     
       05:660E  00 80     
  200  05:6610  00 80         dw $8000,$8000,$8000,$8000,$8000,$8000,$8000,$8000
       05:6612  00 80     
       05:6614  00 80     
       05:6616  00 80     
       05:6618  00 80     
       05:661A  00 80     
       05:661C  00 80     
       05:661E  00 80     
  201  05:6620  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6622  00 00     
       05:6624  00 00     
       05:6626  00 00     
       05:6628  00 00     
       05:662A  00 00     
       05:662C  00 00     
       05:662E  00 00     
  202  05:6630  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6632  00 00     
       05:6634  00 00     
       05:6636  00 00     
       05:6638  00 00     
       05:663A  00 00     
       05:663C  00 00     
       05:663E  00 00     
  203  05:6640  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6642  00 00     
       05:6644  00 00     
       05:6646  00 00     
       05:6648  00 00     
       05:664A  00 00     
       05:664C  00 00     
       05:664E  00 00     
  204  05:6650  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6652  00 00     
       05:6654  00 00     
       05:6656  00 00     
       05:6658  00 00     
       05:665A  00 00     
       05:665C  00 00     
       05:665E  00 00     
  205  05:6660  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6662  00 00     
       05:6664  00 00     
       05:6666  00 00     
       05:6668  00 00     
       05:666A  00 00     
       05:666C  00 00     
       05:666E  00 00     
  206  05:6670  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6672  00 00     
       05:6674  00 00     
       05:6676  00 00     
       05:6678  00 00     
       05:667A  00 00     
       05:667C  00 00     
       05:667E  00 00     
  207  05:6680  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6682  00 00     
       05:6684  00 00     
       05:6686  00 00     
       05:6688  00 00     
       05:668A  00 00     
       05:668C  00 00     
       05:668E  00 00     
  208  05:6690  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6692  00 00     
       05:6694  00 00     
       05:6696  00 00     
       05:6698  00 00     
       05:669A  00 00     
       05:669C  00 00     
       05:669E  00 00     
  209  05:66A0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:66A2  00 00     
       05:66A4  00 00     
       05:66A6  00 00     
       05:66A8  00 00     
       05:66AA  00 00     
       05:66AC  00 00     
       05:66AE  00 00     
  210  05:66B0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:66B2  00 00     
       05:66B4  00 00     
       05:66B6  00 00     
       05:66B8  00 00     
       05:66BA  00 00     
       05:66BC  00 00     
       05:66BE  00 00     
  211  05:66C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:66C2  00 00     
       05:66C4  00 00     
       05:66C6  00 00     
       05:66C8  00 00     
       05:66CA  00 00     
       05:66CC  00 00     
       05:66CE  00 00     
  212  05:66D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:66D2  00 00     
       05:66D4  00 00     
       05:66D6  00 00     
       05:66D8  00 00     
       05:66DA  00 00     
       05:66DC  00 00     
       05:66DE  00 00     
  213  05:66E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:66E2  00 00     
       05:66E4  00 00     
       05:66E6  00 00     
       05:66E8  00 00     
       05:66EA  00 00     
       05:66EC  00 00     
       05:66EE  00 00     
  214  05:66F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:66F2  00 00     
       05:66F4  00 00     
       05:66F6  00 00     
       05:66F8  00 00     
       05:66FA  00 00     
       05:66FC  00 00     
       05:66FE  00 00     
  215  05:6700  00 FF         dw $ff00,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6702  00 00     
       05:6704  00 00     
       05:6706  00 00     
       05:6708  00 00     
       05:670A  00 00     
       05:670C  00 00     
       05:670E  00 00     
  216  05:6710  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6712  00 00     
       05:6714  00 00     
       05:6716  00 00     
       05:6718  00 00     
       05:671A  00 00     
       05:671C  00 00     
       05:671E  00 00     
  217  05:6720  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6722  00 00     
       05:6724  00 00     
       05:6726  00 00     
       05:6728  00 00     
       05:672A  00 00     
       05:672C  00 00     
       05:672E  00 00     
  218  05:6730  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6732  00 00     
       05:6734  00 00     
       05:6736  00 00     
       05:6738  00 00     
       05:673A  00 00     
       05:673C  00 00     
       05:673E  00 00     
  219  05:6740  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6742  00 00     
       05:6744  00 00     
       05:6746  00 00     
       05:6748  00 00     
       05:674A  00 00     
       05:674C  00 00     
       05:674E  00 00     
  220  05:6750  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6752  00 00     
       05:6754  00 00     
       05:6756  00 00     
       05:6758  00 00     
       05:675A  00 00     
       05:675C  00 00     
       05:675E  00 00     
  221  05:6760  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6762  00 00     
       05:6764  00 00     
       05:6766  00 00     
       05:6768  00 00     
       05:676A  00 00     
       05:676C  00 00     
       05:676E  00 00     
  222  05:6770  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6772  00 00     
       05:6774  00 00     
       05:6776  00 00     
       05:6778  00 00     
       05:677A  00 00     
       05:677C  00 00     
       05:677E  00 00     
  223  05:6780  FF FF         dw $ffff,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6782  00 00     
       05:6784  00 00     
       05:6786  00 00     
       05:6788  00 00     
       05:678A  00 00     
       05:678C  00 00     
       05:678E  00 00     
  224  05:6790  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6792  00 00     
       05:6794  00 00     
       05:6796  00 00     
       05:6798  00 00     
       05:679A  00 00     
       05:679C  00 00     
       05:679E  00 00     
  225  05:67A0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:67A2  00 00     
       05:67A4  00 00     
       05:67A6  00 00     
       05:67A8  00 00     
       05:67AA  00 00     
       05:67AC  00 00     
       05:67AE  00 00     
  226  05:67B0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:67B2  00 00     
       05:67B4  00 00     
       05:67B6  00 00     
       05:67B8  00 00     
       05:67BA  00 00     
       05:67BC  00 00     
       05:67BE  00 00     
  227  05:67C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:67C2  00 00     
       05:67C4  00 00     
       05:67C6  00 00     
       05:67C8  00 00     
       05:67CA  00 00     
       05:67CC  00 00     
       05:67CE  00 00     
  228  05:67D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:67D2  00 00     
       05:67D4  00 00     
       05:67D6  00 00     
       05:67D8  00 00     
       05:67DA  00 00     
       05:67DC  00 00     
       05:67DE  00 00     
  229  05:67E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:67E2  00 00     
       05:67E4  00 00     
       05:67E6  00 00     
       05:67E8  00 00     
       05:67EA  00 00     
       05:67EC  00 00     
       05:67EE  00 00     
  230  05:67F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:67F2  00 00     
       05:67F4  00 00     
       05:67F6  00 00     
       05:67F8  00 00     
       05:67FA  00 00     
       05:67FC  00 00     
       05:67FE  00 00     
  231  05:6800  FF 00         dw $00ff,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6802  00 00     
       05:6804  00 00     
       05:6806  00 00     
       05:6808  00 00     
       05:680A  00 00     
       05:680C  00 00     
       05:680E  00 00     
  232  05:6810  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6812  00 00     
       05:6814  00 00     
       05:6816  00 00     
       05:6818  00 00     
       05:681A  00 00     
       05:681C  00 00     
       05:681E  00 00     
  233  05:6820  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6822  00 00     
       05:6824  00 00     
       05:6826  00 00     
       05:6828  00 00     
       05:682A  00 00     
       05:682C  00 00     
       05:682E  00 00     
  234  05:6830  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6832  00 00     
       05:6834  00 00     
       05:6836  00 00     
       05:6838  00 00     
       05:683A  00 00     
       05:683C  00 00     
       05:683E  00 00     
  235  05:6840  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6842  00 00     
       05:6844  00 00     
       05:6846  00 00     
       05:6848  00 00     
       05:684A  00 00     
       05:684C  00 00     
       05:684E  00 00     
  236  05:6850  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6852  00 00     
       05:6854  00 00     
       05:6856  00 00     
       05:6858  00 00     
       05:685A  00 00     
       05:685C  00 00     
       05:685E  00 00     
  237  05:6860  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6862  00 00     
       05:6864  00 00     
       05:6866  00 00     
       05:6868  00 00     
       05:686A  00 00     
       05:686C  00 00     
       05:686E  00 00     
  238  05:6870  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6872  00 00     
       05:6874  00 00     
       05:6876  00 00     
       05:6878  00 00     
       05:687A  00 00     
       05:687C  00 00     
       05:687E  00 00     
  239  05:6880  00 80         dw $8000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6882  00 00     
       05:6884  00 00     
       05:6886  00 00     
       05:6888  00 00     
       05:688A  00 00     
       05:688C  00 00     
       05:688E  00 00     
  240  05:6890  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:6892  00 00     
       05:6894  00 00     
       05:6896  00 00     
       05:6898  00 00     
       05:689A  00 00     
       05:689C  00 00     
       05:689E  00 00     
  241  05:68A0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:68A2  00 00     
       05:68A4  00 00     
       05:68A6  00 00     
       05:68A8  00 00     
       05:68AA  00 00     
       05:68AC  00 00     
       05:68AE  00 00     
  242  05:68B0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:68B2  00 00     
       05:68B4  00 00     
       05:68B6  00 00     
       05:68B8  00 00     
       05:68BA  00 00     
       05:68BC  00 00     
       05:68BE  00 00     
  243  05:68C0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:68C2  00 00     
       05:68C4  00 00     
       05:68C6  00 00     
       05:68C8  00 00     
       05:68CA  00 00     
       05:68CC  00 00     
       05:68CE  00 00     
  244  05:68D0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:68D2  00 00     
       05:68D4  00 00     
       05:68D6  00 00     
       05:68D8  00 00     
       05:68DA  00 00     
       05:68DC  00 00     
       05:68DE  00 00     
  245  05:68E0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:68E2  00 00     
       05:68E4  00 00     
       05:68E6  00 00     
       05:68E8  00 00     
       05:68EA  00 00     
       05:68EC  00 00     
       05:68EE  00 00     
  246  05:68F0  00 00         dw $0000,$0000,$0000,$0000,$0000,$0000,$0000,$0000
       05:68F2  00 00     
       05:68F4  00 00     
       05:68F6  00 00     
       05:68F8  00 00     
       05:68FA  00 00     
       05:68FC  00 00     
       05:68FE  00 00     
  247                     
  248                     
  249  05:6900            SpPattern_end:
  250                     
  251           0900      SpPattern_size  equ     SpPattern_end-SpPattern
  252                     
  253                     
  254  05:6900            SpPalette:
  255  05:6900  00 00         dw $000,$038,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6902  38 00     
       05:6904  FF 01     
       05:6906  00 00     
       05:6908  00 00     
       05:690A  00 00     
       05:690C  00 00     
       05:690E  00 00     
       05:6910  00 00     
       05:6912  00 00     
       05:6914  00 00     
       05:6916  00 00     
       05:6918  00 00     
       05:691A  00 00     
       05:691C  00 00     
       05:691E  00 00     
  256  05:6920  00 00         dw $000,$007,$1ff,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6922  07 00     
       05:6924  FF 01     
       05:6926  00 00     
       05:6928  00 00     
       05:692A  00 00     
       05:692C  00 00     
       05:692E  00 00     
       05:6930  00 00     
       05:6932  00 00     
       05:6934  00 00     
       05:6936  00 00     
       05:6938  00 00     
       05:693A  00 00     
       05:693C  00 00     
       05:693E  00 00     
  257  05:6940  00 00         dw $000,$1f8,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6942  F8 01     
       05:6944  00 00     
       05:6946  00 00     
       05:6948  00 00     
       05:694A  00 00     
       05:694C  00 00     
       05:694E  00 00     
       05:6950  00 00     
       05:6952  00 00     
       05:6954  00 00     
       05:6956  00 00     
       05:6958  00 00     
       05:695A  00 00     
       05:695C  00 00     
       05:695E  00 00     
  258  05:6960  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6962  00 00     
       05:6964  00 00     
       05:6966  00 00     
       05:6968  00 00     
       05:696A  00 00     
       05:696C  00 00     
       05:696E  00 00     
       05:6970  00 00     
       05:6972  00 00     
       05:6974  00 00     
       05:6976  00 00     
       05:6978  00 00     
       05:697A  00 00     
       05:697C  00 00     
       05:697E  00 00     
  259  05:6980  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6982  00 00     
       05:6984  00 00     
       05:6986  00 00     
       05:6988  00 00     
       05:698A  00 00     
       05:698C  00 00     
       05:698E  00 00     
       05:6990  00 00     
       05:6992  00 00     
       05:6994  00 00     
       05:6996  00 00     
       05:6998  00 00     
       05:699A  00 00     
       05:699C  00 00     
       05:699E  00 00     
  260  05:69A0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:69A2  00 00     
       05:69A4  00 00     
       05:69A6  00 00     
       05:69A8  00 00     
       05:69AA  00 00     
       05:69AC  00 00     
       05:69AE  00 00     
       05:69B0  00 00     
       05:69B2  00 00     
       05:69B4  00 00     
       05:69B6  00 00     
       05:69B8  00 00     
       05:69BA  00 00     
       05:69BC  00 00     
       05:69BE  00 00     
  261  05:69C0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:69C2  00 00     
       05:69C4  00 00     
       05:69C6  00 00     
       05:69C8  00 00     
       05:69CA  00 00     
       05:69CC  00 00     
       05:69CE  00 00     
       05:69D0  00 00     
       05:69D2  00 00     
       05:69D4  00 00     
       05:69D6  00 00     
       05:69D8  00 00     
       05:69DA  00 00     
       05:69DC  00 00     
       05:69DE  00 00     
  262  05:69E0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:69E2  00 00     
       05:69E4  00 00     
       05:69E6  00 00     
       05:69E8  00 00     
       05:69EA  00 00     
       05:69EC  00 00     
       05:69EE  00 00     
       05:69F0  00 00     
       05:69F2  00 00     
       05:69F4  00 00     
       05:69F6  00 00     
       05:69F8  00 00     
       05:69FA  00 00     
       05:69FC  00 00     
       05:69FE  00 00     
  263  05:6A00  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6A02  00 00     
       05:6A04  00 00     
       05:6A06  00 00     
       05:6A08  00 00     
       05:6A0A  00 00     
       05:6A0C  00 00     
       05:6A0E  00 00     
       05:6A10  00 00     
       05:6A12  00 00     
       05:6A14  00 00     
       05:6A16  00 00     
       05:6A18  00 00     
       05:6A1A  00 00     
       05:6A1C  00 00     
       05:6A1E  00 00     
  264  05:6A20  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6A22  00 00     
       05:6A24  00 00     
       05:6A26  00 00     
       05:6A28  00 00     
       05:6A2A  00 00     
       05:6A2C  00 00     
       05:6A2E  00 00     
       05:6A30  00 00     
       05:6A32  00 00     
       05:6A34  00 00     
       05:6A36  00 00     
       05:6A38  00 00     
       05:6A3A  00 00     
       05:6A3C  00 00     
       05:6A3E  00 00     
  265  05:6A40  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6A42  00 00     
       05:6A44  00 00     
       05:6A46  00 00     
       05:6A48  00 00     
       05:6A4A  00 00     
       05:6A4C  00 00     
       05:6A4E  00 00     
       05:6A50  00 00     
       05:6A52  00 00     
       05:6A54  00 00     
       05:6A56  00 00     
       05:6A58  00 00     
       05:6A5A  00 00     
       05:6A5C  00 00     
       05:6A5E  00 00     
  266  05:6A60  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6A62  00 00     
       05:6A64  00 00     
       05:6A66  00 00     
       05:6A68  00 00     
       05:6A6A  00 00     
       05:6A6C  00 00     
       05:6A6E  00 00     
       05:6A70  00 00     
       05:6A72  00 00     
       05:6A74  00 00     
       05:6A76  00 00     
       05:6A78  00 00     
       05:6A7A  00 00     
       05:6A7C  00 00     
       05:6A7E  00 00     
  267  05:6A80  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6A82  00 00     
       05:6A84  00 00     
       05:6A86  00 00     
       05:6A88  00 00     
       05:6A8A  00 00     
       05:6A8C  00 00     
       05:6A8E  00 00     
       05:6A90  00 00     
       05:6A92  00 00     
       05:6A94  00 00     
       05:6A96  00 00     
       05:6A98  00 00     
       05:6A9A  00 00     
       05:6A9C  00 00     
       05:6A9E  00 00     
  268  05:6AA0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6AA2  00 00     
       05:6AA4  00 00     
       05:6AA6  00 00     
       05:6AA8  00 00     
       05:6AAA  00 00     
       05:6AAC  00 00     
       05:6AAE  00 00     
       05:6AB0  00 00     
       05:6AB2  00 00     
       05:6AB4  00 00     
       05:6AB6  00 00     
       05:6AB8  00 00     
       05:6ABA  00 00     
       05:6ABC  00 00     
       05:6ABE  00 00     
  269  05:6AC0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6AC2  00 00     
       05:6AC4  00 00     
       05:6AC6  00 00     
       05:6AC8  00 00     
       05:6ACA  00 00     
       05:6ACC  00 00     
       05:6ACE  00 00     
       05:6AD0  00 00     
       05:6AD2  00 00     
       05:6AD4  00 00     
       05:6AD6  00 00     
       05:6AD8  00 00     
       05:6ADA  00 00     
       05:6ADC  00 00     
       05:6ADE  00 00     
  270  05:6AE0  00 00         dw $000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000,$000
       05:6AE2  00 00     
       05:6AE4  00 00     
       05:6AE6  00 00     
       05:6AE8  00 00     
       05:6AEA  00 00     
       05:6AEC  00 00     
       05:6AEE  00 00     
       05:6AF0  00 00     
       05:6AF2  00 00     
       05:6AF4  00 00     
       05:6AF6  00 00     
       05:6AF8  00 00     
       05:6AFA  00 00     
       05:6AFC  00 00     
       05:6AFE  00 00     
#[1]   nibbler.asm
#[2]   map.asm
   30                             .include "map.asm"
    1           6B00          .code
    2           0001          .bank   MAIN_BANK
    3                     
    4                     ;
    5                     ;   BATクリア
    6                     ;
    7                     ;   @args       なし
    8                     ;   @saveregs   なし
    9                     ;   @return     なし
   10                     
   11  01:C73A            clearBAT:
   12  01:C73A  03 00         st0     #0
   13  01:C73C  13 00         st1     #0
   14  01:C73E  23 00         st2     #0
   15  01:C740  03 02         st0     #2
   16                     
   17  01:C742  A2 10         ldx     #16
   18  01:C744            .cl2:
   19  01:C744  C2            cly
   20  01:C745            .cl1:
   21  01:C745  13 33         st1     #LOW(BG_SPACE)
   22  01:C747  23 01         st2     #HIGH(BG_SPACE)
   23  01:C749  88            dey
   24  01:C74A  D0 F9         bne     .cl1
   25  01:C74C  CA            dex
   26  01:C74D  D0 F5         bne     .cl2
   27                     
   28  01:C74F  60            rts
   29                     
   30                     ;
   31                     ;   Wave描画
   32                     ;
   33                     ;   @args       zwave = wave番号
   34                     ;   @saveregs   なし
   35                     ;   @return     なし
   36  01:C750            DrawWaveMap:
   37           200A      .arg_wavemap_l  equ zarg0   ;waveマップデータアドレス
   38           200B      .arg_wavemap_h  equ zarg1
   39           2003      .tmp_mul_h  equ ztmp0
   40                     
   41  01:C750  20 3A C7      jsr clearBAT
   42                                                 ;zwave*81 の計算
   43  01:C753  64 03         stz <.tmp_mul_h
   44  01:C755  A5 19         lda <zwave
   45  01:C757  0A            asl a
   46  01:C758  26 03         rol <.tmp_mul_h
   47  01:C75A  0A            asl a
   48  01:C75B  26 03         rol <.tmp_mul_h
   49  01:C75D  0A            asl a
   50  01:C75E  26 03         rol <.tmp_mul_h
   51  01:C760  0A            asl a
   52  01:C761  26 03         rol <.tmp_mul_h
   53                                                 ;zwave*16 を一旦保存
   54  01:C763  85 0A         sta <.arg_wavemap_l
   55  01:C765  A6 03         ldx <.tmp_mul_h
   56  01:C767  86 0B         stx <.arg_wavemap_h
   57                     
   58  01:C769  0A            asl a
   59  01:C76A  26 03         rol <.tmp_mul_h
   60  01:C76C  0A            asl a
   61  01:C76D  26 03         rol <.tmp_mul_h
   62                                                 ;arg = zwave*16+zwave*64 = zwave*80
   63  01:C76F  18            clc
   64  01:C770  65 0A         adc <.arg_wavemap_l
   65  01:C772  85 0A         sta <.arg_wavemap_l
   66  01:C774  A5 0B         lda <.arg_wavemap_h
   67  01:C776  65 03         adc <.tmp_mul_h
   68  01:C778  85 0B         sta <.arg_wavemap_h
   69                                                 ;arg = zwave*80 + zwave = zwave*81
   70  01:C77A  A5 0A         lda <.arg_wavemap_l
   71  01:C77C  18            clc
   72  01:C77D  65 19         adc <zwave
   73  01:C77F  85 0A         sta <.arg_wavemap_l
   74  01:C781  A5 0B         lda <.arg_wavemap_h
   75  01:C783  69 00         adc #0
   76  01:C785  85 0B         sta <.arg_wavemap_h
   77                                                 ;arg = zwave*81 + WaveMap
   78  01:C787  A5 0A         lda <.arg_wavemap_l
   79  01:C789  18            clc
   80  01:C78A  69 00         adc #LOW(WaveMap)
   81  01:C78C  85 0A         sta <.arg_wavemap_l
   82  01:C78E  A5 0B         lda <.arg_wavemap_h
   83  01:C790  69 80         adc #HIGH(WaveMap)
   84  01:C792  85 0B         sta <.arg_wavemap_h
   85                     
   86  01:C794  20 98 C7      jsr DrawWaveByWaveMapAdr
   87  01:C797  60            rts
   88                     
   89                     ;
   90                     ;   Wave描画
   91                     ;
   92                     ;   @args       zarg0,1 = Waveマップアドレス
   93                     ;   @saveregs   なし
   94                     ;   @return     なし
   95  01:C798            DrawWaveByWaveMapAdr:
   96           200A      .arg_wavemap_l  equ zarg0   ;マップデータアドレス
   97           200B      .arg_wavemap_h  equ zarg1
   98                     
   99           200C      .tmp_vram_l     equ zarg2   ;vram(BAT)アドレス
  100           200D      .tmp_vram_h     equ zarg3
  101           200E      .tmp_vmap_ptr_l equ zarg4   ;仮想vramアドレス
  102           200F      .tmp_vmap_ptr_h equ zarg5
  103                     
  104  01:C798  64 18         stz <zdotnum
  105                     
  106  01:C79A  64 0C         stz <.tmp_vram_l
  107  01:C79C  64 0D         stz <.tmp_vram_h
  108                     
  109  01:C79E  A9 44         lda #LOW(VMap)
  110  01:C7A0  85 0E         sta <.tmp_vmap_ptr_l
  111  01:C7A2  A9 24         lda #HIGH(VMap)
  112  01:C7A4  85 0F         sta <.tmp_vmap_ptr_h
  113                     
  114  01:C7A6  C2            cly                 ;y=マップデータのインデックス
  115  01:C7A7            .loop_nextrow:
  116  01:C7A7  A2 09         ldx #9              ;x=行カウンタ
  117  01:C7A9            .loop_nextgrid:
  118                                             ;grid描画
  119  01:C7A9  DA            phx
  120  01:C7AA  5A            phy
  121  01:C7AB  B1 0A         lda [.arg_wavemap_l],y
  122  01:C7AD  20 F3 C7      jsr DrawMapGrid
  123  01:C7B0  7A            ply
  124  01:C7B1  FA            plx
  125                                             ;全grid済なら終了
  126  01:C7B2  C8            iny
  127  01:C7B3  C0 51         cpy #9*9
  128  01:C7B5  F0 3B         beq .loop_end
  129                                             ;1行終了？
  130  01:C7B7  CA            dex
  131  01:C7B8  F0 1C         beq .nextrow
  132                                             ;同一行の右隣に移動
  133  01:C7BA  A5 0C         lda <.tmp_vram_l
  134  01:C7BC  18            clc
  135  01:C7BD  69 03         adc #3
  136  01:C7BF  85 0C         sta <.tmp_vram_l
  137  01:C7C1  A5 0D         lda <.tmp_vram_h
  138  01:C7C3  69 00         adc #0
  139  01:C7C5  85 0D         sta <.tmp_vram_h
  140                     
  141  01:C7C7  A5 0E         lda <.tmp_vmap_ptr_l
  142  01:C7C9  18            clc
  143  01:C7CA  69 03         adc #3
  144  01:C7CC  85 0E         sta <.tmp_vmap_ptr_l
  145  01:C7CE  A5 0F         lda <.tmp_vmap_ptr_h
  146  01:C7D0  69 00         adc #0
  147  01:C7D2  85 0F         sta <.tmp_vmap_ptr_h
  148                     
  149  01:C7D4  80 D3         bra .loop_nextgrid
  150                     
  151                                             ;次の行の左端に移動
  152  01:C7D6            .nextrow:
  153  01:C7D6  A5 0C         lda <.tmp_vram_l
  154  01:C7D8  18            clc
  155  01:C7D9  69 48         adc #3*32-3*8
  156  01:C7DB  85 0C         sta <.tmp_vram_l
  157  01:C7DD  A5 0D         lda <.tmp_vram_h
  158  01:C7DF  69 00         adc #0
  159  01:C7E1  85 0D         sta <.tmp_vram_h
  160                     
  161  01:C7E3  A5 0E         lda <.tmp_vmap_ptr_l
  162  01:C7E5  18            clc
  163  01:C7E6  69 48         adc #3*32-3*8
  164  01:C7E8  85 0E         sta <.tmp_vmap_ptr_l
  165  01:C7EA  A5 0F         lda <.tmp_vmap_ptr_h
  166  01:C7EC  69 00         adc #0
  167  01:C7EE  85 0F         sta <.tmp_vmap_ptr_h
  168                     
  169  01:C7F0  80 B5         bra .loop_nextrow
  170                     
  171  01:C7F2            .loop_end:
  172  01:C7F2  60            rts
  173                     
  174                     
  175                     
  176                     ;
  177                     ;   Waveマップの１グリッド分（3*3キャラクタ）の描画
  178                     ;
  179                     ;   @args       A = グリッド番号
  180                     ;               zarg2,3 = BAT address
  181                     ;               zarg4,5 = Virtual Map address
  182                     ;   @saveregs   なし
  183                     ;   @return     なし
  184  01:C7F3            DrawMapGrid:
  185           200C      .arg_vram_l     equ zarg2   ;vram(BAT)アドレス
  186           200D      .arg_vram_h     equ zarg3
  187           200E      .arg_vmap_ptr_l equ zarg4   ;仮想vramアドレス
  188           200F      .arg_vmap_ptr_h equ zarg5
  189                     
  190           2003      .tmp_x9         equ ztmp0   ;9倍計算用ワーク
  191           2003      .tmp_vram_l     equ ztmp0   ;vram(BAT)アドレス
  192           2004      .tmp_vram_h     equ ztmp1
  193           2005      .tmp_looprow    equ ztmp2   ;行カウンタ
  194           2006      .tmp_loopchar   equ ztmp3   ;
  195           2007      .tmp_dotcombi   equ ztmp4
  196           2008      .tmp_vmap_value equ ztmp5
  197                     
  198  01:C7F3  A8            tay
  199                                             ;x=gridデータのインデックス
  200                                             ;grid番号x9
  201  01:C7F4  29 0F         and #$0f
  202  01:C7F6  85 03         sta <.tmp_x9
  203  01:C7F8  0A            asl a
  204  01:C7F9  0A            asl a
  205  01:C7FA  0A            asl a
  206  01:C7FB  65 03         adc <.tmp_x9
  207  01:C7FD  AA            tax
  208                                             ;ドット配置
  209  01:C7FE  98            tya
  210  01:C7FF  4A            lsr a
  211  01:C800  4A            lsr a
  212  01:C801  4A            lsr a
  213  01:C802  4A            lsr a
  214  01:C803  A8            tay
  215  01:C804  B9 AD C9      lda DotCombination,y
  216  01:C807  85 07         sta <.tmp_dotcombi
  217                     
  218                                             ;vram(BAT)アドレス初期値
  219  01:C809  A5 0C         lda <.arg_vram_l
  220  01:C80B  85 03         sta <.tmp_vram_l
  221  01:C80D  A5 0D         lda <.arg_vram_h
  222  01:C80F  85 04         sta <.tmp_vram_h
  223                     
  224  01:C811  C2            cly                 ;y=仮想vramのインデックス
  225                                             ;gridの行数
  226  01:C812  A9 03         lda #3
  227  01:C814  85 05         sta <.tmp_looprow
  228                     
  229  01:C816            .loop_row:
  230                                             ;vram(BAT)アドレスセット
  231  01:C816  03 00         st0 #0
  232  01:C818  A5 03         lda <.tmp_vram_l
  233  01:C81A  8D 02 00      sta VdcDataL
  234  01:C81D  A5 04         lda <.tmp_vram_h
  235  01:C81F  8D 03 00      sta VdcDataH
  236  01:C822  03 02         st0 #2
  237                                             ;gridの水平方向のキャラ数
  238  01:C824  A9 03         lda #3
  239  01:C826  85 06         sta <.tmp_loopchar
  240  01:C828            .loop_char:
  241  01:C828  BD 1D C9      lda VMapGrids,x
  242  01:C82B  85 08         sta <.tmp_vmap_value
  243                     
  244  01:C82D  BD 8D C8      lda MapGrids,x
  245  01:C830  D0 0B         bne .setchar
  246                                                 ;空白かつドットが配置されているならドットのタイルをセット
  247  01:C832  7F 07 08      bbr7    <.tmp_dotcombi,.setchar
  248                     
  249  01:C835  E6 18         inc <zdotnum            ;ドット数を増加
  250                     ;    lda #1
  251                     ;    sta <zdotnum
  252                     
  253  01:C837  A9 0F         lda #$0f
  254  01:C839  04 08         tsb <.tmp_vmap_value
  255  01:C83B  A9 1A         lda #$0d*2                  ;TODO: ドットのタイル番号
  256                     
  257  01:C83D            .setchar
  258                                             ;タイルをvram(BAT)に書き込み
  259  01:C83D  5A            phy
  260  01:C83E  A8            tay
  261  01:C83F  B9 71 C8      lda MapPartsTiles,y
  262  01:C842  8D 02 00      sta VdcDataL
  263  01:C845  B9 72 C8      lda MapPartsTiles+1,y
  264  01:C848  8D 03 00      sta VdcDataH
  265  01:C84B  7A            ply
  266                                             ;仮想vramに書き込み
  267  01:C84C  A5 08         lda <.tmp_vmap_value
  268  01:C84E  91 0E         sta [.arg_vmap_ptr_l],y
  269                     
  270  01:C850  06 07         asl <.tmp_dotcombi
  271  01:C852  E8            inx
  272  01:C853  C8            iny
  273                     
  274  01:C854  C6 06         dec <.tmp_loopchar
  275  01:C856  D0 D0         bne .loop_char
  276                     
  277  01:C858  C6 05         dec <.tmp_looprow
  278  01:C85A  F0 14         beq .end_loop
  279                                             ;次の行にvramアドレスを移動
  280  01:C85C  A5 03         lda <.tmp_vram_l
  281  01:C85E  18            clc
  282  01:C85F  69 20         adc #32
  283  01:C861  85 03         sta <.tmp_vram_l
  284  01:C863  A5 04         lda <.tmp_vram_h
  285  01:C865  69 00         adc #0
  286  01:C867  85 04         sta <.tmp_vram_h
  287                                             ;次の行に仮想vramインデックスを移動
  288  01:C869  98            tya
  289  01:C86A  18            clc
  290  01:C86B  69 1D         adc #32-3
  291  01:C86D  A8            tay
  292                     
  293  01:C86E  80 A6         bra .loop_row
  294                     
  295  01:C870            .end_loop:
  296  01:C870  60            rts
  297                     
  298                     
  299                     ;
  300                     ;
  301                     
  302           2444          .bss
  303                         
  304                     ;   フィールドマップ
  305                     ;   必要なのは 27*27 だが、アドレス計算が面倒なので 32*27 とする
  306  --:2444            VMap:   ds  32*27
#[1]   nibbler.asm
#[2]   mapdata.asm
   31                             .include "mapdata.asm"
    1           C871          .code
    2           0001          .bank   MAIN_BANK
    3                     
    4                     
    5                     
    6                     ;
    7                     ;   gridを構成するタイルのキャラクター番号（BATの下12ビットの値）
    8                     ;
    9           1340      MapPartsPatternAddress  equ $1000+52*16
   10  01:C871            MapPartsTiles:
   11  01:C871  34 01         dw  (MapPartsPatternAddress+$00*16)/16  ;空白
   12  01:C873  35 01         dw  (MapPartsPatternAddress+$01*16)/16  ;左上┌
   13  01:C875  36 01         dw  (MapPartsPatternAddress+$02*16)/16  ;右上┐
   14  01:C877  37 01         dw  (MapPartsPatternAddress+$03*16)/16  ;左下└
   15  01:C879  38 01         dw  (MapPartsPatternAddress+$04*16)/16  ;右下┐
   16  01:C87B  39 01         dw  (MapPartsPatternAddress+$05*16)/16  ;左│
   17  01:C87D  3A 01         dw  (MapPartsPatternAddress+$06*16)/16  ;右│
   18  01:C87F  3B 01         dw  (MapPartsPatternAddress+$07*16)/16  ;上─
   19  01:C881  3C 01         dw  (MapPartsPatternAddress+$08*16)/16  ;下─
   20  01:C883  3D 01         dw  (MapPartsPatternAddress+$09*16)/16  ;左上・
   21  01:C885  3E 01         dw  (MapPartsPatternAddress+$0a*16)/16  ;右上・
   22  01:C887  3F 01         dw  (MapPartsPatternAddress+$0b*16)/16  ;左下・
   23  01:C889  40 01         dw  (MapPartsPatternAddress+$0c*16)/16  ;右下・
   24  01:C88B  41 11         dw  (MapPartsPatternAddress+$0d*16)/16 + $1000  ;ドット
   25                     
   26                     ;
   27                     ;   マップのgridの中身
   28                     ;   gridは3x3のタイルで構成され、各タイルを1バイトで表現
   29                     ;   タイルの値は MapPartsTiles のインデックス
   30                     ;
   31                     MapGridData .macro
   32                         db  \1*2,\2*2,\3*2
   33                         .endm
   34                     
   35  01:C88D            MapGrids:
   36  01:C88D            MapGrid_00:
   37  01:888D                MapGridData  $01,$07,$02
   38  01:8890                MapGridData  $05,$00,$06
   39  01:8893                MapGridData  $03,$08,$04
   40  01:C896            MapGrid_01:
   41  01:8896                MapGridData  $05,$00,$06
   42  01:8899                MapGridData  $05,$00,$06
   43  01:889C                MapGridData  $03,$08,$04
   44  01:C89F            MapGrid_02:
   45  01:889F                MapGridData  $01,$07,$07
   46  01:88A2                MapGridData  $05,$00,$00
   47  01:88A5                MapGridData  $03,$08,$08
   48  01:C8A8            MapGrid_03:
   49  01:88A8                MapGridData  $05,$00,$0a
   50  01:88AB                MapGridData  $05,$00,$00
   51  01:88AE                MapGridData  $03,$08,$08
   52  01:C8B1            MapGrid_04:
   53  01:88B1                MapGridData  $01,$07,$02
   54  01:88B4                MapGridData  $05,$00,$06
   55  01:88B7                MapGridData  $05,$00,$06
   56  01:C8BA            MapGrid_05:
   57  01:88BA                MapGridData  $05,$00,$06
   58  01:88BD                MapGridData  $05,$00,$06
   59  01:88C0                MapGridData  $05,$00,$06
   60  01:C8C3            MapGrid_06:
   61  01:88C3                MapGridData  $01,$07,$07
   62  01:88C6                MapGridData  $05,$00,$00
   63  01:88C9                MapGridData  $05,$00,$0c
   64  01:C8CC            MapGrid_07:
   65  01:88CC                MapGridData  $05,$00,$0a
   66  01:88CF                MapGridData  $05,$00,$00
   67  01:88D2                MapGridData  $05,$00,$0c
   68  01:C8D5            MapGrid_08:
   69  01:88D5                MapGridData  $07,$07,$02
   70  01:88D8                MapGridData  $00,$00,$06
   71  01:88DB                MapGridData  $08,$08,$04
   72  01:C8DE            MapGrid_09:
   73  01:88DE                MapGridData  $09,$00,$06
   74  01:88E1                MapGridData  $00,$00,$06
   75  01:88E4                MapGridData  $08,$08,$04
   76  01:C8E7            MapGrid_0a:
   77  01:88E7                MapGridData  $07,$07,$07
   78  01:88EA                MapGridData  $00,$00,$00
   79  01:88ED                MapGridData  $08,$08,$08
   80  01:C8F0            MapGrid_0b:
   81  01:88F0                MapGridData  $09,$00,$0a
   82  01:88F3                MapGridData  $00,$00,$00
   83  01:88F6                MapGridData  $08,$08,$08
   84  01:C8F9            MapGrid_0c:
   85  01:88F9                MapGridData  $07,$07,$02
   86  01:88FC                MapGridData  $00,$00,$06
   87  01:88FF                MapGridData  $0b,$00,$06
   88  01:C902            MapGrid_0d:
   89  01:8902                MapGridData  $09,$00,$06
   90  01:8905                MapGridData  $00,$00,$06
   91  01:8908                MapGridData  $0b,$00,$06
   92  01:C90B            MapGrid_0e:
   93  01:890B                MapGridData  $07,$07,$07
   94  01:890E                MapGridData  $00,$00,$00
   95  01:8911                MapGridData  $0b,$00,$0c
   96  01:C914            MapGrid_0f:
   97  01:8914                MapGridData  $09,$00,$0a
   98  01:8917                MapGridData  $00,$00,$00
   99  01:891A                MapGridData  $0b,$00,$0c
  100                     
  101                     ;
  102                     ;   マップのgridの中身（仮想vram用）
  103                     ;   gridは3x3のタイルで構成され、各タイルを1バイトで表現
  104                     ;   タイルの値は、下位4ビットが移動可能方向、上位4ビットはフラグ
  105                     ;
  106                     
  107                     VMapGridData .macro
  108                         db  \1*16,\2*16,\3*16
  109                         .endm
  110                     
  111  01:C91D            VMapGrids:
  112  01:C91D            VMapGrid_00:
  113  01:891D                VMapGridData  %0000,%0000,%0000
  114  01:8920                VMapGridData  %0000,%0000,%0000
  115  01:8923                VMapGridData  %0000,%0000,%0000
  116  01:C926            VMapGrid_01:
  117  01:8926                VMapGridData  %0000,%0101,%0000
  118  01:8929                VMapGridData  %0000,%0001,%0000
  119  01:892C                VMapGridData  %0000,%0000,%0000
  120  01:C92F            VMapGrid_02:
  121  01:892F                VMapGridData  %0000,%0000,%0000
  122  01:8932                VMapGridData  %0000,%0010,%1010
  123  01:8935                VMapGridData  %0000,%0000,%0000
  124  01:C938            VMapGrid_03:
  125  01:8938                VMapGridData  %0000,%0101,%0000
  126  01:893B                VMapGridData  %0000,%0011,%1010
  127  01:893E                VMapGridData  %0000,%0000,%0000
  128  01:C941            VMapGrid_04:
  129  01:8941                VMapGridData  %0000,%0000,%0000
  130  01:8944                VMapGridData  %0000,%0100,%0000
  131  01:8947                VMapGridData  %0000,%0101,%0000
  132  01:C94A            VMapGrid_05:
  133  01:894A                VMapGridData  %0000,%0101,%0000
  134  01:894D                VMapGridData  %0000,%0101,%0000
  135  01:8950                VMapGridData  %0000,%0101,%0000
  136  01:C953            VMapGrid_06:
  137  01:8953                VMapGridData  %0000,%0000,%0000
  138  01:8956                VMapGridData  %0000,%0110,%1010
  139  01:8959                VMapGridData  %0000,%0101,%0000
  140  01:C95C            VMapGrid_07:
  141  01:895C                VMapGridData  %0000,%0101,%0000
  142  01:895F                VMapGridData  %0000,%0111,%1010
  143  01:8962                VMapGridData  %0000,%0101,%0000
  144  01:C965            VMapGrid_08:
  145  01:8965                VMapGridData  %0000,%0000,%0000
  146  01:8968                VMapGridData  %1010,%1000,%0000
  147  01:896B                VMapGridData  %0000,%0000,%0000
  148  01:C96E            VMapGrid_09:
  149  01:896E                VMapGridData  %0000,%0101,%0000
  150  01:8971                VMapGridData  %1010,%1001,%0000
  151  01:8974                VMapGridData  %0000,%0000,%0000
  152  01:C977            VMapGrid_0a:
  153  01:8977                VMapGridData  %0000,%0000,%0000
  154  01:897A                VMapGridData  %1010,%1010,%1010
  155  01:897D                VMapGridData  %0000,%0000,%0000
  156  01:C980            VMapGrid_0b:
  157  01:8980                VMapGridData  %0000,%0101,%0000
  158  01:8983                VMapGridData  %1010,%1011,%1010
  159  01:8986                VMapGridData  %0000,%0000,%0000
  160  01:C989            VMapGrid_0c:
  161  01:8989                VMapGridData  %0000,%0000,%0000
  162  01:898C                VMapGridData  %1010,%1100,%0000
  163  01:898F                VMapGridData  %0000,%0101,%0000
  164  01:C992            VMapGrid_0d:
  165  01:8992                VMapGridData  %0000,%0101,%0000
  166  01:8995                VMapGridData  %1010,%1101,%0000
  167  01:8998                VMapGridData  %0000,%0101,%0000
  168  01:C99B            VMapGrid_0e:
  169  01:899B                VMapGridData  %0000,%0000,%0000
  170  01:899E                VMapGridData  %1010,%1110,%1010
  171  01:89A1                VMapGridData  %0000,%0101,%0000
  172  01:C9A4            VMapGrid_0f:
  173  01:89A4                VMapGridData  %0000,%0101,%0000
  174  01:89A7                VMapGridData  %1010,%1111,%1010
  175  01:89AA                VMapGridData  %0000,%0101,%0000
  176                     
  177                     
  178                     ;
  179                     ;   grid中のドットの有無の組み合わせ
  180                     ;   左のビットから順に　左上、上、右上、左、中央、右、左下、下　の位置に対応
  181                     ;   右下に対応するビットがないが、右下にドットが置かれることはないので有無を表すビットを
  182                     ;   左上、右上、左下もドットが置かれることはないが、マップ描画処理の都合上、対応するビッ
  183                     ;
  184  01:C9AD            DotCombination:
  185  01:C9AD  00            db  %00000000   ;0
  186  01:C9AE  08            db  %00001000   ;1　中央
  187  01:C9AF  40            db  %01000000   ;2　上
  188  01:C9B0  01            db  %00000001   ;3　下
  189  01:C9B1  10            db  %00010000   ;4　左
  190  01:C9B2  04            db  %00000100   ;5　右
  191  01:C9B3  41            db  %01000001   ;6　上下
  192  01:C9B4  14            db  %00010100   ;7　左右
  193                     
  194                     
  195                     ;
  196                     ;   wave（ステージ）のマップ
  197                     ;   1waveで81バイト
  198                     ;   マップは9x9の格子でできており、各格子は1バイトで表現
  199                     ;   格子バイトの上4ビットはドット配置、下4ビットは壁の配置
  200                     ;   ドット配置は DotCombination のインデックス
  201                     ;   壁配置は MapGrids のインデックス
  202                     ;
  203           C9B5          .code
  204           0006          .bank   WAVEMAP_BANK
  205           8000          org $8000   
  206                     
  207  06:8000            WaveMap:
  208  06:8000            WaveMap_01:
  209  06:8000  06 1A 0E      db  $06,$1a,$0e,$1e,$0a,$1e,$0e,$1a,$0c
       06:8003  1E 0A 1E  
       06:8006  0E 1A 0C  
  210  06:8009  15 00 15      db  $15,$00,$15,$07,$0e,$0d,$15,$00,$15
       06:800C  07 0E 0D  
       06:800F  15 00 15  
  211  06:8012  07 0A 09      db  $07,$0a,$09,$15,$05,$15,$03,$0a,$0d
       06:8015  15 05 15  
       06:8018  03 0A 0D  
  212  06:801B  15 06 4A      db  $15,$06,$4a,$0b,$0f,$0b,$5a,$0c,$15
       06:801E  0B 0F 0B  
       06:8021  5A 0C 15  
  213  06:8024  07 0B 4A      db  $07,$0b,$4a,$0e,$2b,$0e,$5a,$0b,$0d
       06:8027  0E 2B 0E  
       06:802A  5A 0B 0D  
  214  06:802D  07 1A 0E      db  $07,$1a,$0e,$0d,$00,$07,$0e,$1a,$0d
       06:8030  0D 00 07  
       06:8033  0E 1A 0D  
  215  06:8036  05 00 05      db  $05,$00,$05,$07,$1a,$0d,$05,$00,$05
       06:8039  07 1A 0D  
       06:803C  05 00 05  
  216  06:803F  67 0A 29      db  $67,$0a,$29,$25,$00,$25,$23,$0a,$6d
       06:8042  25 00 25  
       06:8045  23 0A 6D  
  217  06:8048  03 0A 0A      db  $03,$0a,$0a,$0b,$0a,$0b,$0a,$0a,$09
       06:804B  0B 0A 0B  
       06:804E  0A 0A 09  
  218  06:8051            WaveMap_10:
  219  06:8051  06 1A 0E      db  $06,$1a,$0e,$0e,$1a,$0e,$0e,$1a,$0c
       06:8054  0E 1A 0E  
       06:8057  0E 1A 0C  
  220  06:805A  07 1A 0D      db  $07,$1a,$0d,$27,$1a,$2d,$07,$1a,$0d
       06:805D  27 1A 2D  
       06:8060  07 1A 0D  
  221  06:8063  15 16 0B      db  $15,$16,$0b,$0f,$1a,$0f,$0b,$1c,$15
       06:8066  0F 1A 0F  
       06:8069  0B 1C 15  
  222  06:806C  07 0D 06      db  $07,$0d,$06,$2d,$00,$27,$0c,$07,$0d
       06:806F  2D 00 27  
       06:8072  0C 07 0D  
  223  06:8075  07 0F 1D      db  $07,$0f,$1d,$07,$1a,$0d,$17,$0f,$0d
       06:8078  07 1A 0D  
       06:807B  17 0F 0D  
  224  06:807E  07 0D 03      db  $07,$0d,$03,$3d,$00,$37,$09,$07,$0d
       06:8081  3D 00 37  
       06:8084  09 07 0D  
  225  06:8087  15 03 3E      db  $15,$03,$3e,$0f,$1a,$0f,$3e,$09,$15
       06:808A  0F 1A 0F  
       06:808D  3E 09 15  
  226  06:8090  07 1A 0D      db  $07,$1a,$0d,$07,$1a,$0d,$07,$1a,$0d
       06:8093  07 1A 0D  
       06:8096  07 1A 0D  
  227  06:8099  03 0A 0B      db  $03,$0a,$0b,$0b,$0a,$0b,$0b,$0a,$09
       06:809C  0B 0A 0B  
       06:809F  0B 0A 09  
#[1]   nibbler.asm
#[2]   vqueue.asm
   32                             .include "vqueue.asm"
    1                     ;   VRAM部分書き換え
    2                     ;
    3                     ;   書き換え内容をキューに保管し、vblank中に書き換える。
    4                     
    5           0010      VQ_MAX_QUQUE_SIZE   equ 16  ;キューのサイズ
    6                     
    7           2038          .zp
    8  --:2038            zvqIndex:   ds  1
    9                     
   10           27A4          .bss
   11  --:27A4            vqArea:
   12  --:27A4            vqDstL: ds  VQ_MAX_QUQUE_SIZE   ;VRAMアドレス
   13  --:27B4            vqDstH: ds  VQ_MAX_QUQUE_SIZE
   14  --:27C4            vqSrcL: ds  VQ_MAX_QUQUE_SIZE   ;ソースデータアドレス
   15  --:27D4            vqSrcH: ds  VQ_MAX_QUQUE_SIZE
   16  --:27E4            vqWLen: ds  VQ_MAX_QUQUE_SIZE   ;データ長（ワード単位）
   17                     
   18  --:27F4            vqArea_end:
   19           0050      vqArea_size equ vqArea_end-vqArea
   20                     
   21           80A2          .code
   22           0001          .bank   MAIN_BANK
   23                     
   24                     ;   キューを初期化
   25                     ;   @args       なし
   26                     ;   @saveregs   なし
   27                     ;   @return     なし
   28  01:C9B5            vqInit:
   29                                             ;キューをクリア
   30  01:C9B5  9C A4 27      stz vqArea
   31  01:C9B8  73 A4 27      tii vqArea,vqArea+1,vqArea_size-1
       01:C9BB  A5 27 4F  
       01:C9BE  00        
   32  01:C9BF  64 38         stz <zvqIndex
   33  01:C9C1  60            rts
   34                     
   35                     ;   キューにデータを追加
   36                     ;   @args       zarg0,1 = vramアドレス
   37                     ;               zarg2,3 = データ
   38                     ;               zarg4   = 長さ
   39                     ;   @saveregs   x
   40                     ;   @return     なし
   41  01:C9C2            vqPush:
   42           200A      .tmp_vramadr_l  equ zarg0
   43           200B      .tmp_vramadr_h  equ zarg1
   44           200C      .tmp_src_l      equ zarg2
   45           200D      .tmp_src_h      equ zarg3
   46           200E      .tmp_len        equ zarg4
   47  01:C9C2  A4 38         ldy <zvqIndex
   48                     
   49  01:C9C4  AD 0A 20      lda .tmp_vramadr_l
   50  01:C9C7  99 A4 27      sta vqDstL,y
   51  01:C9CA  AD 0B 20      lda .tmp_vramadr_h
   52  01:C9CD  99 B4 27      sta vqDstH,y
   53                     
   54  01:C9D0  AD 0C 20      lda .tmp_src_l
   55  01:C9D3  99 C4 27      sta vqSrcL,y
   56  01:C9D6  AD 0D 20      lda .tmp_src_h
   57  01:C9D9  99 D4 27      sta vqSrcH,y
   58                     
   59  01:C9DC  AD 0E 20      lda .tmp_len
   60  01:C9DF  99 E4 27      sta vqWLen,y
   61                     
   62  01:C9E2  C8            iny
   63  01:C9E3  84 38         sty <zvqIndex
   64                     
   65  01:C9E5  60            rts
   66                     
   67                     ;   キューの内容を描画
   68                     ;   VRAMを更新するのでvblank中に呼び出すこと
   69                     ;   @args       なし
   70                     ;   @saveregs   なし
   71                     ;   @return     なし
   72  01:C9E6            vqDraw:
   73           2003      .tmp_src_l  equ ztmp0
   74           2004      .tmp_src_h  equ ztmp1
   75                     
   76  01:C9E6  A6 38         ldx <zvqIndex
   77  01:C9E8  D0 01         bne .loop_queue
   78  01:C9EA  60            rts
   79                     
   80  01:C9EB            .loop_queue:
   81  01:C9EB  CA            dex
   82                     
   83  01:C9EC  03 00         st0 #0
   84  01:C9EE  BD A4 27      lda vqDstL,x
   85  01:C9F1  8D 02 00      sta VdcDataL
   86  01:C9F4  BD B4 27      lda vqDstH,x
   87  01:C9F7  8D 03 00      sta VdcDataH
   88                     
   89  01:C9FA  BD C4 27      lda vqSrcL,x
   90  01:C9FD  85 03         sta <.tmp_src_l
   91  01:C9FF  BD D4 27      lda vqSrcH,x
   92  01:CA02  85 04         sta <.tmp_src_h
   93                     
   94  01:CA04  03 02         st0 #2
   95  01:CA06  C2            cly
   96                     
   97  01:CA07            .loop_copy:
   98  01:CA07  B1 03         lda [.tmp_src_l],y
   99  01:CA09  8D 02 00      sta VdcDataL
  100  01:CA0C  C8            iny
  101  01:CA0D  B1 03         lda [.tmp_src_l],y
  102  01:CA0F  8D 03 00      sta VdcDataH
  103  01:CA12  C8            iny
  104                     
  105  01:CA13  DE E4 27      dec vqWLen,x
  106  01:CA16  D0 EF         bne .loop_copy
  107                     
  108  01:CA18  E0 00         cpx #0
  109  01:CA1A  D0 CF         bne .loop_queue
  110                     
  111  01:CA1C  64 38         stz <zvqIndex
  112  01:CA1E  60            rts
#[1]   nibbler.asm
#[2]   digits.asm
   33                         .include "digits.asm"
    1           CA1F          .code
    2           0001          .bank   MAIN_BANK
    3                     
    4                     ;
    5                     ;   BCD数値描画
    6                     ;   上位桁の0は空白で表示
    7                     ;
    8                     ;   @args       zarg0,1 = BAT address
    9                     ;               zarg2,3 = 表示データアドレス
   10                     ;               zarg4   = 数値データの長さ（バイト）
   11                     ;               zarg5,6 = 数値データアドレス
   12                     ;               zarg7   = カンマの間隔（なしなら 0）
   13                     ;               zarg8   = パレット
   14                     ;   @saveregs   なし
   15                     ;   @return     なし
   16  01:CA1F            drawDigits:
   17           200A      .arg_batadr_l   equ zarg0
   18           200B      .arg_batadr_h   equ zarg1
   19           200C      .arg_bufadr_l   equ zarg2
   20           200D      .arg_bufadr_h   equ zarg3
   21           200E      .arg_len        equ zarg4
   22           200F      .arg_bcdadr_l   equ zarg5
   23           2010      .arg_bcdadr_h   equ zarg6
   24           2011      .arg_comma_count    equ zarg7
   25           2012      .arg_palette    equ zarg8
   26                     
   27                     
   28           2003      .tmp_comma_count    equ ztmp0
   29                     
   30  01:CA1F  9C 03 20      stz .tmp_comma_count
   31  01:CA22  83 FF 11      tst #$ff,<.arg_comma_count
   32  01:CA25  F0 04         beq .nocomma
   33  01:CA27  A9 04         lda #4
   34  01:CA29  85 03         sta <.tmp_comma_count
   35  01:CA2B            .nocomma:
   36                     
   37  01:CA2B  A5 0E         lda <.arg_len
   38  01:CA2D  0A            asl a
   39  01:CA2E  65 11         adc <.arg_comma_count
   40  01:CA30  0A            asl a
   41  01:CA31  A8            tay
   42                     
   43                                             ;表示データの各桁の上位1バイト1をセットしておく
   44  01:CA32  88            dey
   45                     ;    lda #1
   46  01:CA33  A5 12         lda <.arg_palette
   47  01:CA35  09 01         ora #1              ;BGパターンは $1xx （xx はBCD）とする
   48  01:CA37            .clearloop:
   49  01:CA37  91 0C         sta [.arg_bufadr_l],y
   50  01:CA39  C0 01         cpy #1
   51  01:CA3B  F0 04         beq .draw
   52  01:CA3D  88            dey
   53  01:CA3E  88            dey
   54  01:CA3F  80 F6         bra .clearloop
   55                     
   56  01:CA41            .draw:
   57                                             ;BCDを1バイト1桁の文字列に変換
   58  01:CA41  C2            cly                 ;Y = 数値データのインデックス
   59  01:CA42  A5 0E         lda <.arg_len
   60  01:CA44  0A            asl a
   61  01:CA45  65 11         adc <.arg_comma_count
   62  01:CA47  0A            asl a
   63  01:CA48  3A            dec a
   64  01:CA49  3A            dec a
   65  01:CA4A  AA            tax                 ;X = 描画データバッファのインデックス
   66                     
   67                                             ;数値の描画
   68  01:CA4B            .drawloop:
   69                                             ;BCDの下位桁
   70  01:CA4B  B1 0F         lda [.arg_bcdadr_l],y
   71  01:CA4D  02            sxy
   72  01:CA4E  48            pha
   73                     
   74  01:CA4F  C6 03         dec <.tmp_comma_count
   75  01:CA51  D0 0C         bne .drawl
   76  01:CA53  48            pha
   77                     ;    lda #36
   78  01:CA54  A9 24         lda #LOW(BG_COMMA)
   79  01:CA56  91 0C         sta [.arg_bufadr_l],y
   80  01:CA58  88            dey
   81  01:CA59  88            dey
   82  01:CA5A  A9 03         lda #3
   83  01:CA5C  85 03         sta <.tmp_comma_count
   84  01:CA5E  68            pla
   85                         
   86  01:CA5F            .drawl:
   87                     
   88  01:CA5F  29 0F         and #$0f
   89  01:CA61  91 0C         sta [.arg_bufadr_l],y
   90  01:CA63  88            dey
   91  01:CA64  88            dey
   92                     
   93  01:CA65  C6 03         dec <.tmp_comma_count
   94  01:CA67  D0 0A         bne .drawh
   95                     ;    pha
   96                     ;    lda #36             ; TODO: カンマのコード
   97  01:CA69  A9 24         lda #LOW(BG_COMMA)
   98  01:CA6B  91 0C         sta [.arg_bufadr_l],y
   99  01:CA6D  88            dey
  100  01:CA6E  88            dey
  101  01:CA6F  A9 03         lda #3
  102  01:CA71  85 03         sta <.tmp_comma_count
  103                     ;    pla
  104                                             ;BCDの上位桁
  105  01:CA73            .drawh:
  106  01:CA73  68            pla
  107  01:CA74  4A            lsr a
  108  01:CA75  4A            lsr a
  109  01:CA76  4A            lsr a
  110  01:CA77  4A            lsr a
  111  01:CA78  91 0C         sta [.arg_bufadr_l],y
  112  01:CA7A  88            dey
  113  01:CA7B  88            dey
  114                     
  115  01:CA7C  02            sxy
  116  01:CA7D  C8            iny
  117  01:CA7E  C4 0E         cpy <.arg_len
  118  01:CA80  D0 C9         bne .drawloop
  119                     
  120                                             ;先頭の0を表示しない
  121  01:CA82  A5 0E         lda <.arg_len
  122  01:CA84  0A            asl a
  123  01:CA85  65 11         adc <.arg_comma_count
  124  01:CA87  3A            dec a               ;最後の桁の0は表示したい
  125  01:CA88  AA            tax
  126  01:CA89  C2            cly
  127                     
  128  01:CA8A            .zeroloop:
  129  01:CA8A  B1 0C         lda [.arg_bufadr_l],y
  130  01:CA8C  F0 04         beq .next
  131  01:CA8E  C9 24         cmp #36
  132  01:CA90  D0 09         bne .push
  133  01:CA92            .next:
  134                     ;    lda #52             ; TOOD: スペースのコード
  135  01:CA92  A9 33         lda #LOW(BG_SPACE)
  136  01:CA94  91 0C         sta [.arg_bufadr_l],y
  137  01:CA96  C8            iny
  138  01:CA97  C8            iny
  139  01:CA98  CA            dex
  140  01:CA99  D0 EF         bne .zeroloop
  141                     
  142                     
  143  01:CA9B            .push:
  144  01:CA9B  A5 0E         lda <zarg4
  145  01:CA9D  0A            asl a
  146  01:CA9E  65 11         adc <.arg_comma_count
  147  01:CAA0  85 0E         sta <zarg4
  148  01:CAA2  20 C2 C9      jsr vqPush
  149                     
  150  01:CAA5  60            rts
  151                     
  152                     
  153                     ;    .bss
  154                     ;                        ;BCD変換バッファ
  155                     ;dgBuffer    ds  64
  156                     
  157           CAA6          .code
#[1]   nibbler.asm
   34                         
#[2]   player.asm
   35                             .include "player.asm"
    1                     
    2           27F4              .bss
    3                     
    4           2039              .zp
    5                                         ;キャラクタ配列
    6  --:2039            zplx:   ds  2       ;x座標
    7  --:203B            zply:   ds  2       ;y座標
    8  --:203D            zpldir: ds  2       ;移動方向(LDRU----)
    9  --:203F            zpldirr:    ds  2   ;移動方向の逆方向(LDRU----)
   10  --:2041            zplspeed:   ds  2   ;移動速度
   11                     
   12  --:2043            zpldirnum:  ds  2   ;移動方向(0=U 1=R 2=D 3=L)
   13                     
   14  --:2045            zplbodytilel:   ds  2   ;胴体のキャラクタ番号を保存したアドレス（下位8ビット）
   15  --:2047            zplbodytileh:   ds  2   ;胴体のキャラクタ番号を保存したアドレス（上位8ビット）
   16                     
   17  --:2049            zplprevdir: ds  2       ;過去の移動方向(----LDRU)
   18  --:204B            zplbodycornertilel: ds  2   ;胴体の曲がった箇所のキャラクタ番号を保存したアドレス（下位8ビット）
   19  --:204D            zplbodycornertileh: ds  2   ;胴体の曲がった箇所のキャラクタ番号を保存したアドレス（上位8ビット）
   20                     
   21  --:204F            zplheadtilel: ds  2   ;頭のキャラクタ番号を保存したアドレス（下位8ビット）
   22  --:2051            zplheadtileh: ds  2   ;頭のキャラクタ番号を保存したアドレス（上位8ビット）
   23                     
   24  --:2053            zplTailStop:    ds  1   ;尻尾を停止させる
   25  --:2054            zplTailPriority:    ds  1   ;尻尾の表示プライオリティ
   26                     
   27  --:2055            zplcount:       ds  2
   28                     
   29           CAA6          .code
   30           0001          .bank   MAIN_BANK
   31                     
   32                     ;
   33                     ;   初期化
   34                     ;
   35                     ;   @args       なし
   36                     ;   @saveregs   なし
   37                     ;   @return     なし
   38  01:CAA6            plInit:
   39           200C      .tmp_fldadr_l   equ     zarg2       ;フィールドアドレス
   40           200D      .tmp_fldadr_h   equ     zarg3
   41                     
   42  01:CAA6  64 53         stz <zplTailStop
   43  01:CAA8  64 55         stz <zplcount
   44  01:CAAA  64 56         stz <zplcount+1
   45                     
   46  01:CAAC  A9 80         lda #%10000000
   47  01:CAAE  85 54         sta <zplTailPriority
   48                     
   49                                             ;頭の座標
   50  01:CAB0  82            clx
   51  01:CAB1  A9 80         lda     #(5*3+1)*8
   52  01:CAB3  85 39         sta     <zplx
   53  01:CAB5  A9 C8         lda     #(8*3+1)*8
   54  01:CAB7  85 3B         sta     <zply
   55                     ;    lda     #4
   56                     ;    sta     <zplspeed
   57  01:CAB9  A9 20         lda     #%00100000
   58  01:CABB  20 E1 CA      jsr     plSetDir
   59                                             ;尻尾の座標
   60  01:CABE  A2 01         ldx #1
   61  01:CAC0  A9 50         lda     #(3*3+1)*8
   62  01:CAC2  95 39         sta     <zplx,x
   63  01:CAC4  A9 C8         lda     #(8*3+1)*8
   64  01:CAC6  95 3B         sta     <zply,x
   65                     ;    lda     #4
   66                     ;    sta     <zplspeed,x
   67  01:CAC8  A9 20         lda     #%00100000
   68  01:CACA  20 E1 CA      jsr     plSetDir
   69                                             ;胴体
   70                                             ;TODO: 胴体の絵を描いてない
   71  01:CACD  20 64 CB      jsr plGetBatFldAdr
   72  01:CAD0  C2            cly
   73  01:CAD1            .loop:
   74  01:CAD1  B1 0C         lda [.tmp_fldadr_l],y
   75  01:CAD3  09 02         ora #%00000010
   76  01:CAD5  91 0C         sta [.tmp_fldadr_l],y
   77  01:CAD7  C8            iny
   78  01:CAD8  C0 06         cpy #6
   79  01:CADA  D0 F5         bne .loop
   80                                             ;尻尾の速度を頭に合わせる
   81  01:CADC  A5 41         lda <zplspeed
   82  01:CADE  85 42         sta <zplspeed+1
   83                     
   84  01:CAE0  60            rts
   85                     
   86                     ;
   87                     ;   移動方向（とその逆方向）をセット
   88                     ;
   89                     ;   @args       a = 移動方向(LDRU----)
   90                     ;               x = キャラクタインデックス
   91                     ;   @saveregs   x
   92                     ;   @return     なし
   93  01:CAE1            plSetDir:
   94                     
   95  01:CAE1  29 F0         and     #$f0        ;下位4ビットは必ずクリアしておく（方向転換判定で誤判定の元となる）
   96  01:CAE3  95 3D         sta     <zpldir,x
   97                     
   98  01:CAE5  48            pha
   99                     
  100  01:CAE6  89 A0         bit     #%10100000
  101  01:CAE8  F0 04         beq     .du
  102  01:CAEA  49 A0         eor     #%10100000
  103  01:CAEC  80 02         bra     .set
  104  01:CAEE            .du:
  105  01:CAEE  49 50         eor     #%01010000
  106  01:CAF0            .set:
  107  01:CAF0  95 3F         sta     <zpldirr,x
  108                     
  109  01:CAF2  68            pla
  110                     
  111  01:CAF3  4A            lsr a
  112  01:CAF4  4A            lsr a
  113  01:CAF5  4A            lsr a
  114  01:CAF6  4A            lsr a
  115  01:CAF7  48            pha
  116  01:CAF8  A8            tay
  117  01:CAF9  B9 33 CB      lda .dir2num,y
  118  01:CAFC  95 43         sta <zpldirnum,x
  119                                             ;胴体のキャラクタを求めておく
  120                     ;    lsr a
  121                     ;    lsr a
  122                     ;    lsr a
  123                     ;    lsr a
  124                     ;    tay
  125                     ;    lda .dir2index,y
  126                     
  127  01:CAFE  0A            asl a
  128  01:CAFF  48            pha
  129                     
  130  01:CB00  69 4C         adc #LOW(.BodyPartsTiles)
  131  01:CB02  95 45         sta <zplbodytilel,x
  132  01:CB04  A9 CB         lda #HIGH(.BodyPartsTiles)
  133  01:CB06  69 00         adc #0
  134  01:CB08  95 47         sta <zplbodytileh,x
  135                     
  136                     ;    phy
  137                     ;    lda .dir2index,y
  138                     ;    tay
  139  01:CB0A  7A            ply
  140  01:CB0B  B9 5C CB      lda .HeadPartsTiles,y
  141  01:CB0E  95 4F         sta <zplheadtilel,x
  142  01:CB10  B9 5D CB      lda .HeadPartsTiles+1,y
  143  01:CB13  95 51         sta <zplheadtileh,x
  144                     ;    ply
  145                     
  146                     ;
  147                     ;   胴体の曲がった箇所のキャラクタ番号
  148                     ;   オリジナルは胴体幅が7ドットなので、曲がる向きに応じてキャラクタを使い分けないと綺麗に
  149                     ;
  150                     ; 0123
  151                     ; ┌┐└┘
  152                     ;
  153                     ; 3210
  154                     ; LDRU
  155                     ;
  156                     ; L8 -> D 12 0  U 9 2
  157                     ; D4 -> L 12 3  R 6 2
  158                     ; R2 -> D  6 1  U 3 3
  159                     ; U1 -> L  9 1  R 3 0
  160                     ;
  161                     ; x=pd|nd を求める
  162                     ; xをyに変換
  163                     ;   x 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f
  164                     ;   y  -  -  -  3  -  -  1  -  -  2  -  -  0  -  -  -
  165                     ; pdがUかDなら、yをビット反転
  166                     ;   y = 0123
  167                     ;       ┌┐└┘
  168                     ; y*2をtilesのアドレスに加算 -> 表示するタイルのアドレス
  169                     ;
  170                     
  171                     ;    tya
  172  01:CB15  68            pla
  173  01:CB16  48            pha
  174                     
  175  01:CB17  15 49         ora <zplprevdir,x
  176  01:CB19  A8            tay
  177  01:CB1A  B9 3C CB      lda .dir2corner,y
  178  01:CB1D  A3 05 49      tst #%0101,<zplprevdir,x
  179  01:CB20  F0 02         beq .LR
  180  01:CB22  49 03         eor #%11
  181  01:CB24            .LR:
  182  01:CB24  0A            asl a
  183  01:CB25  69 54         adc #LOW(.BodyCornerPartsTiles)
  184  01:CB27  95 4B         sta <zplbodycornertilel,x
  185  01:CB29  A9 CB         lda #HIGH(.BodyCornerPartsTiles)
  186  01:CB2B  69 00         adc #0
  187  01:CB2D  95 4D         sta <zplbodycornertileh,x
  188                     
  189  01:CB2F  68            pla
  190  01:CB30  95 49         sta <zplprevdir,x
  191                     
  192  01:CB32  60            rts
  193                     
  194  01:CB33            .dir2num:
  195  01:CB33  00            db  0
  196  01:CB34  00            db  0   ;U
  197  01:CB35  01            db  1   ;R
  198  01:CB36  00            db  0
  199  01:CB37  02            db  2   ;D
  200  01:CB38  00            db  0
  201  01:CB39  00            db  0
  202  01:CB3A  00            db  0
  203  01:CB3B  03            db  3   ;L
  204                     
  205                                                     ;方向のビット(LDRU)を .BodyPartsTiles のインデックスに変換
  206                                                     ;ビットは1つしかセットされてないことが前提
  207                     ;.dir2index:
  208                     ;    db  0
  209                     ;    db  0   ;U
  210                     ;    db  2   ;R
  211                     ;    db  0
  212                     ;    db  4   ;D
  213                     ;    db  0
  214                     ;    db  0
  215                     ;    db  0
  216                     ;    db  6   ;L
  217                     
  218                     ;   x 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f
  219                     ;   y  -  -  -  3  -  -  1  -  -  2  -  -  0  -  -  -
  220  01:CB3C            .dir2corner:
  221  01:CB3C  00 00 00      db  0,0,0,3
       01:CB3F  03        
  222  01:CB40  00 00 01      db  0,0,1,0
       01:CB43  00        
  223  01:CB44  00 02 00      db  0,2,0,0
       01:CB47  00        
  224  01:CB48  00 00 00      db  0,0,0,0
       01:CB4B  00        
  225                     
  226                                                     ;胴体のキャラクタ番号
  227           1000      PatternAddress  equ $1000
  228                     ;BodyPartsL  equ (PatternAddress+66*16)/16
  229                     ;BodyPartsL  equ BG_BODY_L
  230                     ;BodyPartsD  equ (PatternAddress+67*16)/16
  231                     ;BodyPartsR  equ (PatternAddress+68*16)/16
  232                     ;BodyPartsU  equ (PatternAddress+69*16)/16
  233                     
  234                     ;BodyPartsLU equ (PatternAddress+70*16)/16
  235                     ;BodyPartsRU equ (PatternAddress+71*16)/16
  236                     ;BodyPartsLD equ (PatternAddress+72*16)/16
  237                     ;BodyPartsRD equ (PatternAddress+73*16)/16
  238                     
  239  01:CB4C            .BodyPartsTiles:
  240  01:CB4C  45 21         dw  BG_BODY_U | $2000
  241  01:CB4E  44 21         dw  BG_BODY_R | $2000
  242  01:CB50  43 21         dw  BG_BODY_D | $2000
  243  01:CB52  42 21         dw  BG_BODY_L | $2000
  244                     ;    dw  BodyPartsU | $2000
  245                     ;    dw  BodyPartsR | $2000
  246                     ;    dw  BodyPartsD | $2000
  247                     ;    dw  BodyPartsL | $2000
  248                     
  249  01:CB54            .BodyCornerPartsTiles:
  250  01:CB54  46 21         dw  BG_BODY_CORNER_UL | $2000
  251  01:CB56  47 21         dw  BG_BODY_CORNER_UR | $2000
  252  01:CB58  48 21         dw  BG_BODY_CORNER_DL | $2000
  253  01:CB5A  49 21         dw  BG_BODY_CORNER_DR | $2000
  254                     ;    dw  (PatternAddress+70*16)/16 | $2000
  255                     ;    dw  (PatternAddress+71*16)/16 | $2000
  256                     ;    dw  (PatternAddress+72*16)/16 | $2000
  257                     ;    dw  (PatternAddress+73*16)/16 | $2000
  258                     
  259           4000      SpritePatternAddress  equ $4000
  260  01:CB5C            .HeadPartsTiles:
  261  01:CB5C  00 02         dw  (SpritePatternAddress+00*64)/32
  262  01:CB5E  02 02         dw  (SpritePatternAddress+01*64)/32
  263  01:CB60  04 02         dw  (SpritePatternAddress+02*64)/32
  264  01:CB62  06 02         dw  (SpritePatternAddress+03*64)/32
  265                     ;
  266                     ;   BATアドレス&フィールドアドレス
  267                     ;
  268                     ;   @args       x = キャラクタインデックス
  269                     ;   @saveregs   x
  270                     ;   @return     zarg0,1 = BATアドレス
  271                     ;               zarg2,3 = フィールドアドレス
  272  01:CB64            plGetBatFldAdr:
  273           200A      .arg_batadr_l     equ     zarg0
  274           200B      .arg_batadr_h     equ     zarg1
  275           200C      .arg_fldadr_l     equ     zarg2
  276           200D      .arg_fldadr_h     equ     zarg3
  277                     
  278  01:CB64  B5 39         lda     <zplx,x
  279  01:CB66  4A            lsr     a
  280  01:CB67  4A            lsr     a
  281  01:CB68  4A            lsr     a
  282  01:CB69  85 0A         sta     <.arg_batadr_l
  283  01:CB6B  64 0B         stz     <.arg_batadr_h
  284  01:CB6D  B5 3B         lda     <zply,x
  285  01:CB6F  29 F8         and     #$f8
  286  01:CB71  0A            asl     a
  287  01:CB72  26 0B         rol     <.arg_batadr_h
  288  01:CB74  0A            asl     a
  289  01:CB75  26 0B         rol     <.arg_batadr_h
  290  01:CB77  04 0A         tsb     <.arg_batadr_l
  291                     
  292  01:CB79  A5 0A         lda <.arg_batadr_l
  293  01:CB7B  18            clc
  294  01:CB7C  69 44         adc #LOW(VMap)
  295  01:CB7E  85 0C         sta <.arg_fldadr_l
  296  01:CB80  A5 0B         lda <.arg_batadr_h
  297  01:CB82  69 24         adc #HIGH(VMap)
  298  01:CB84  85 0D         sta <.arg_fldadr_h
  299                     
  300  01:CB86  60            rts
  301                     
  302                     ;
  303                     ;       ヘビの頭の動き
  304                     ;
  305                     ;       @args           x = キャラクタインデックス
  306                     ;       @saveregs       x
  307                     ;       @return         その場で停止すべき時は cf=1
  308  01:CB87            plHeadAction:
  309           2003      .tmp_fldadr_l   equ     ztmp0       ;フィールドアドレス
  310           2004      .tmp_fldadr_h   equ     ztmp1
  311           2005      .tmp_fldv       equ     ztmp2       ;フィールド上の値
  312           2006      .tmp_pad        equ     ztmp3       ;コントローラーの値
  313                     
  314           2003      .tmp_dead_flg   equ ztmp0
  315                     
  316                                             ;グリッドの中間にいる場合は何もしない
  317  01:CB87  A3 07 55      tst #$7,<zplcount,x
  318  01:CB8A  F0 03         beq .act
  319  01:CB8C  4C 3A CC      jmp .move           ;branchだと届かない
  320                                             ;尻尾を停止しているなら解除
  321  01:CB8F            .act:
  322  01:CB8F  A5 53         lda <zplTailStop
  323  01:CB91  F0 03         beq .act2
  324  01:CB93  3A            dec a
  325  01:CB94  85 53         sta <zplTailStop
  326  01:CB96            .act2:
  327  01:CB96  20 64 CB      jsr plGetBatFldAdr
  328                                             ;zarg2,3 の値をコピーしておく（他のサブルーチン呼び出しで競合することがある
  329  01:CB99  A5 0C         lda <zarg2
  330  01:CB9B  85 03         sta <.tmp_fldadr_l
  331  01:CB9D  A5 0D         lda <zarg3
  332  01:CB9F  85 04         sta <.tmp_fldadr_h
  333                                             ;フィールド上の現在位置の値
  334  01:CBA1  B2 03         lda     [.tmp_fldadr_l]
  335  01:CBA3  85 05         sta     <.tmp_fldv
  336                     
  337  01:CBA5  29 0F         and #$0f
  338  01:CBA7  F0 1A         beq .controller
  339                                             ;現在位置に尻尾があったら死亡
  340  01:CBA9  C9 09         cmp #9
  341                     ;    bmi .dead
  342  01:CBAB  10 03         bpl .notdead        ;bmi だと届かない
  343  01:CBAD  4C 51 CC      jmp .dead
  344  01:CBB0            .notdead:
  345  01:CBB0  C9 0F         cmp #$0f
  346  01:CBB2  D0 0F         bne .controller
  347                                             ;現在位置にドットがあるなら尻尾を停止させる（胴体を伸ばす）
  348  01:CBB4  E6 53         inc <zplTailStop
  349                     
  350  01:CBB6  C6 18         dec <zdotnum        ;ドット数減少
  351                                             ;点数
  352  01:CBB8  A5 1A         lda <zdotpoint
  353  01:CBBA  85 2A         sta <zpoint
  354  01:CBBC  A5 1B         lda <zdotpoint+1
  355  01:CBBE  85 2B         sta <zpoint+1
  356  01:CBC0  20 1D C3      jsr addScore
  357                     
  358  01:CBC3            .controller:
  359                                             ;
  360                                             ;コントローラーが押されている場合の方向転換判定 ldru
  361  01:CBC3  A5 00         lda     <zpad
  362  01:CBC5  29 F0         and     #$f0
  363                                             ;押されていない
  364  01:CBC7  F0 10         beq     .notpushed
  365                                             ;移動方向および逆方向が押されていても押されていないとみなす
  366  01:CBC9  85 06         sta     <.tmp_pad
  367  01:CBCB  B5 3D         lda     <zpldir,x
  368  01:CBCD  15 3F         ora     <zpldirr,x
  369  01:CBCF  14 06         trb     <.tmp_pad
  370  01:CBD1  F0 06         beq     .notpushed
  371                                             ;移動方向以外かつ逆方向以外が押されていて、そっちに移動可能なら変更
  372  01:CBD3  A5 06         lda     <.tmp_pad
  373  01:CBD5  24 05         bit     <.tmp_fldv
  374  01:CBD7  D0 1A         bne     .changed
  375                                             ;コントローラーが押されていない場合の方向転換判定
  376  01:CBD9            .notpushed:
  377                                             ;直進可能ならそのまま進む
  378  01:CBD9  A5 05         lda     <.tmp_fldv
  379  01:CBDB  34 3D         bit     <zpldir,x
  380  01:CBDD  D0 21         bne     .notchanged
  381                                             ;直進と後退以外の移動可能方向？
  382  01:CBDF  4A            lsr     a
  383  01:CBE0  4A            lsr     a
  384  01:CBE1  4A            lsr     a
  385  01:CBE2  4A            lsr     a
  386  01:CBE3  A8            tay
  387  01:CBE4  B9 57 CC      lda     .DirCountTbl,y
  388                                             ;直角
  389  01:CBE7  C9 02         cmp     #2
  390  01:CBE9  F0 04         beq     .dc2
  391                                             ;この時点で移動可能方向は3以外はありえない
  392                                             ;直進できないので移動可能方向は1,2,3のいずれか
  393                                             ;2の場合は分岐しており、1（つまり行き止まり）は存在しない
  394                                             ;よって3のみ（つまり丁字路で直進方向が塞がっている状態）
  395                     ;    cmp     #3
  396                     ;    bne     .notchanged
  397                     
  398  01:CBEB  38            sec                 ;丁字路の場合は一時停止
  399  01:CBEC  64 03         stz <.tmp_dead_flg  ;死んでいない
  400  01:CBEE  60            rts
  401                                             ;直角に曲がる
  402  01:CBEF            .dc2:
  403  01:CBEF  A5 05         lda     <.tmp_fldv
  404  01:CBF1  55 3F         eor     <zpldirr,x  ;2方向のうち進行方向の逆を打ち消して残った方向が進むべき方向
  405                     
  406                                             ;進行方向を変更
  407  01:CBF3            .changed:
  408  01:CBF3  20 E1 CA      jsr     plSetDir
  409                                             ;胴体のキャラクタ
  410  01:CBF6  B5 4B         lda <zplbodycornertilel,x
  411  01:CBF8  85 0C         sta <zarg2
  412  01:CBFA  B5 4D         lda <zplbodycornertileh,x
  413  01:CBFC  85 0D         sta <zarg3
  414  01:CBFE  80 08         bra .draw
  415                                             ;進行方向はそのまま
  416  01:CC00            .notchanged:
  417                                             ;胴体のキャラクタ
  418  01:CC00  B5 45         lda <zplbodytilel,x
  419  01:CC02  85 0C         sta <zarg2
  420  01:CC04  B5 47         lda <zplbodytileh,x
  421  01:CC06  85 0D         sta <zarg3
  422                                             ;胴体の描画
  423  01:CC08            .draw:
  424  01:CC08  A9 01         lda #1
  425  01:CC0A  85 0E         sta <zarg4
  426  01:CC0C  20 C2 C9      jsr vqPush
  427                                             ;フィールドに胴体フラグをセット
  428  01:CC0F  A9 0F         lda #$0f
  429  01:CC11  14 05         trb <.tmp_fldv
  430  01:CC13  B5 3D         lda <zpldir,x
  431  01:CC15  4A            lsr a
  432  01:CC16  4A            lsr a
  433  01:CC17  4A            lsr a
  434  01:CC18  4A            lsr a
  435  01:CC19  05 05         ora <.tmp_fldv
  436  01:CC1B  92 03         sta [.tmp_fldadr_l]
  437                     
  438                     ;.move:
  439                                                 ;移動先に尻尾があったら死亡
  440                                                 ;nibblerの動画を見ると完全に重なった時でなく口先が触れただけで死んでいる
  441                                                 ;移動先のvmapアドレスを求める
  442  01:CC1D  B5 43         lda <zpldirnum,x
  443  01:CC1F  0A            asl a
  444  01:CC20  A8            tay
  445  01:CC21  A5 03         lda <.tmp_fldadr_l
  446  01:CC23  18            clc
  447  01:CC24  79 49 CC      adc .dirnum2vmapdiff,y
  448  01:CC27  85 03         sta <.tmp_fldadr_l
  449  01:CC29  A5 04         lda <.tmp_fldadr_h
  450  01:CC2B  79 4A CC      adc .dirnum2vmapdiff+1,y
  451  01:CC2E  85 04         sta <.tmp_fldadr_h
  452                                                 ;胴体有無判定
  453  01:CC30  B2 03         lda [.tmp_fldadr_l]
  454  01:CC32  29 0F         and #$0f
  455  01:CC34  F0 04         beq .move
  456  01:CC36  C9 09         cmp #9
  457  01:CC38  30 17         bmi .dead
  458                     
  459  01:CC3A            .move:
  460                     ;    clc                 ;指定方向に進行
  461  01:CC3A  20 50 CD      jsr plMove
  462                     
  463  01:CC3D  B5 4F         lda <zplheadtilel,x
  464  01:CC3F  99 44 22      sta satb+4,y
  465  01:CC42  B5 51         lda <zplheadtileh,x
  466  01:CC44  99 45 22      sta satb+5,y
  467                     
  468  01:CC47  18            clc
  469  01:CC48  60            rts
  470                     
  471                                             ;移動先のvmapアドレス差分
  472  01:CC49            .dirnum2vmapdiff:
  473                     ;         U   R   D   L
  474  01:CC49  E0 FF         dw  -32,  1, 32, -1
       01:CC4B  01 00     
       01:CC4D  20 00     
       01:CC4F  FF FF     
  475                     
  476                                             ;死亡
  477  01:CC51            .dead:
  478  01:CC51  A9 01         lda #1
  479  01:CC53  85 03         sta <.tmp_dead_flg  ;死んだ
  480                     
  481  01:CC55  38            sec
  482  01:CC56  60            rts
  483                     ;
  484                     ;       移動可能方向の数（インデックス値のセットされたビットの数）
  485                     ;
  486  01:CC57            .DirCountTbl:
  487  01:CC57  00 01 01      db      0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4
       01:CC5A  02 01 02  
       01:CC5D  02 03 01  
       01:CC60  02 02 03  
       01:CC63  02 03 03  
       01:CC66  04        
  488                     
  489                     ;BodyCornerPartsTiles:
  490                     ;    dw  (PatternAddress+66*16)/16
  491                     
  492  01:CC67            BlankPartsTiles:
  493  01:CC67  34 01         dw  (PatternAddress+52*16)/16
  494                     
  495                     
  496                     
  497                     ;
  498                     ;       ヘビの尻尾の動き
  499                     ;
  500                     ;       @args           x = キャラクタインデックス
  501                     ;       @saveregs       x
  502                     ;       @return         その場で停止すべき時は cf=1
  503                     ;
  504  01:CC69            plTailAction:
  505           200C      .tmp_fldadr_l   equ     zarg2       ;フィールドアドレス
  506           200D      .tmp_fldadr_h   equ     zarg3
  507                     
  508           2003      .tmp_frame  equ ztmp0
  509                     
  510                                             ;尻尾を停止させる指示が出ている場合は何もしない
  511  01:CC69  A5 53         lda <zplTailStop
  512                     ;    bne .notmove
  513  01:CC6B  F0 01         beq .go
  514  01:CC6D  60            rts
  515  01:CC6E            .go:
  516                                             ;グリッド同士の間にいる場合
  517  01:CC6E  A3 07 55      tst #$7,<zplcount,x
  518                     ;    lda <zplx,x
  519                     ;    ora <zply,x
  520                     ;    and #$07
  521  01:CC71  D0 27         bne .move2
  522                     ;    beq .move
  523                     ;    clc
  524                     ;    rts
  525                     
  526                                             ;グリッドに収まった場合は方向転換
  527  01:CC73            .move:
  528  01:CC73  20 64 CB      jsr plGetBatFldAdr
  529                                             ;フィールド上の現在位置の値
  530                                             ;頭が移動した方向を尻尾の移動方向とする
  531  01:CC76  B2 0C         lda [.tmp_fldadr_l]
  532  01:CC78  48            pha
  533                     ;    pha
  534  01:CC79  0A            asl a
  535  01:CC7A  0A            asl a
  536  01:CC7B  0A            asl a
  537  01:CC7C  0A            asl a
  538  01:CC7D  20 E1 CA      jsr plSetDir
  539                     
  540                                             ;方向転換をしたら
  541  01:CC80  A9 80         lda #%10000000
  542  01:CC82  85 54         sta <zplTailPriority
  543                     ;    sta <zpldir,x
  544                                             ;頭が移動した方向をクリア
  545  01:CC84  68            pla
  546  01:CC85  29 F0         and #$f0
  547  01:CC87  92 0C         sta [.tmp_fldadr_l]
  548                     
  549                                             ;描画
  550  01:CC89  A9 67         lda #LOW(BlankPartsTiles)
  551  01:CC8B  85 0C         sta <zarg2
  552  01:CC8D  A9 CC         lda #HIGH(BlankPartsTiles)
  553  01:CC8F  85 0D         sta <zarg3
  554  01:CC91  A9 01         lda #1
  555  01:CC93  85 0E         sta <zarg4
  556  01:CC95  20 C2 C9      jsr vqPush
  557                     
  558  01:CC98  80 15         bra .move3
  559                     
  560                                             ;グリッド同士の間にいる場合
  561                                             ;次の移動方向が変わる予定なら、尻尾の表示プライオリティを変えて、胴体に
  562  01:CC9A            .move2:
  563  01:CC9A  A5 54         lda <zplTailPriority
  564  01:CC9C  F0 11         beq .move3
  565                     
  566  01:CC9E  20 64 CB      jsr plGetBatFldAdr
  567  01:CCA1  B2 0C         lda [.tmp_fldadr_l]
  568  01:CCA3  0A            asl a
  569  01:CCA4  0A            asl a
  570  01:CCA5  0A            asl a
  571  01:CCA6  0A            asl a
  572  01:CCA7  F0 06         beq .move3          ;今の場所の胴体がすでに消えているなら何もしない
  573  01:CCA9  D5 3D         cmp <zpldir,x
  574  01:CCAB  F0 02         beq .move3
  575                                             ;表示プライオリティをBGより下にして、胴体に隠れるようにする
  576  01:CCAD  64 54         stz <zplTailPriority
  577                     
  578  01:CCAF            .move3:
  579  01:CCAF  20 50 CD      jsr plMove
  580                     
  581  01:CCB2  B4 43         ldy <zpldirnum,x
  582  01:CCB4  B5 39         lda <zplx,x
  583  01:CCB6  18            clc
  584  01:CCB7  79 FF CC      adc .sprdx,y
  585  01:CCBA  8D 4A 22      sta satb+8+2
  586  01:CCBD  9C 4B 22      stz satb+8+2+1
  587                     
  588  01:CCC0  B5 3B         lda <zply,x
  589  01:CCC2  18            clc
  590  01:CCC3  79 03 CD      adc .sprdy,y
  591  01:CCC6  8D 48 22      sta satb+8+0
  592  01:CCC9  62            cla
  593  01:CCCA  69 00         adc #0
  594  01:CCCC  8D 49 22      sta satb+8+1
  595                     
  596                     
  597                                                 ;尻尾のアニメーション用フレームカウンタ
  598  01:CCCF  A5 17         lda <zframe
  599  01:CCD1  29 03         and #$03
  600  01:CCD3  0A            asl a
  601  01:CCD4  0A            asl a
  602  01:CCD5  85 03         sta <.tmp_frame
  603                     
  604                                                 ;TODO: 前にaslした後でまたlsrしてるのが無駄だなあ
  605  01:CCD7  B5 3D         lda <zpldir,x
  606  01:CCD9  4A            lsr a
  607  01:CCDA  4A            lsr a
  608  01:CCDB  4A            lsr a
  609  01:CCDC  4A            lsr a
  610  01:CCDD  A8            tay
  611  01:CCDE  B9 07 CD      lda .dir2index,y
  612  01:CCE1  05 03         ora <.tmp_frame
  613  01:CCE3  A8            tay
  614  01:CCE4  B9 10 CD      lda .TailPartsTiles,y
  615  01:CCE7  8D 4C 22      sta satb+8+4
  616  01:CCEA  B9 11 CD      lda .TailPartsTiles+1,y
  617  01:CCED  8D 4D 22      sta satb+8+5
  618  01:CCF0  B9 12 CD      lda .TailPartsTiles+2,y
  619  01:CCF3  05 54         ora <zplTailPriority        ;プライオリティ
  620  01:CCF5  8D 4E 22      sta satb+8+6
  621  01:CCF8  B9 13 CD      lda .TailPartsTiles+3,y
  622  01:CCFB  8D 4F 22      sta satb+8+7
  623                     
  624                     
  625                     ;    clc
  626  01:CCFE  60            rts
  627                     
  628                     ;.notmove:
  629                     ;    sec
  630                     ;    rts
  631                     
  632  01:CCFF            .sprdx:
  633  01:CCFF  1C            db  $20-4       ;U
  634  01:CD00  18            db  $20-8       ;R
  635  01:CD01  1C            db  $20-4       ;D
  636  01:CD02  20            db  $20-0       ;L
  637                     
  638                     ;   +16 はスクロールカウンタの差分
  639  01:CD03            .sprdy:
  640  01:CD03  51            db  $40+16+1    ;U
  641  01:CD04  4D            db  $40+16+1-4  ;R
  642  01:CD05  49            db  $40+16+1-8  ;D
  643  01:CD06  4D            db  $40+16+1-4  ;L
  644                     
  645                                                     ;方向のビット(LDRU)を .BodyPartsTiles のインデックスに変換
  646                                                     ;ビットは1つしかセットされてないことが前提
  647  01:CD07            .dir2index:
  648  01:CD07  00            db  0
  649  01:CD08  00            db  0   ;U
  650  01:CD09  10            db  1*16   ;R
  651  01:CD0A  00            db  0
  652  01:CD0B  20            db  2*16   ;D
  653  01:CD0C  00            db  0
  654  01:CD0D  00            db  0
  655  01:CD0E  00            db  0
  656  01:CD0F  30            db  3*16   ;L
  657                     
  658           4000      SpritePatternAddress  equ $4000
  659  01:CD10            .TailPartsTiles:
  660  01:CD10  08 02         dw  (SpritePatternAddress+04*64)/32,%0000000000000000
       01:CD12  00 00     
  661  01:CD14  0A 02         dw  (SpritePatternAddress+05*64)/32,%0000000000000000
       01:CD16  00 00     
  662  01:CD18  08 02         dw  (SpritePatternAddress+04*64)/32,%0000000000000000
       01:CD1A  00 00     
  663  01:CD1C  0A 02         dw  (SpritePatternAddress+05*64)/32,%0000100000000000
       01:CD1E  00 08     
  664                     
  665  01:CD20  0C 02         dw  (SpritePatternAddress+06*64)/32,%0000000000000000
       01:CD22  00 00     
  666  01:CD24  0E 02         dw  (SpritePatternAddress+07*64)/32,%0000000000000000
       01:CD26  00 00     
  667  01:CD28  0C 02         dw  (SpritePatternAddress+06*64)/32,%0000000000000000
       01:CD2A  00 00     
  668  01:CD2C  0E 02         dw  (SpritePatternAddress+07*64)/32,%1000000000000000
       01:CD2E  00 80     
  669                     
  670  01:CD30  08 02         dw  (SpritePatternAddress+04*64)/32,%1000000000000000
       01:CD32  00 80     
  671  01:CD34  0A 02         dw  (SpritePatternAddress+05*64)/32,%1000000000000000
       01:CD36  00 80     
  672  01:CD38  08 02         dw  (SpritePatternAddress+04*64)/32,%1000000000000000
       01:CD3A  00 80     
  673  01:CD3C  0A 02         dw  (SpritePatternAddress+05*64)/32,%1000100000000000
       01:CD3E  00 88     
  674                     
  675  01:CD40  0C 02         dw  (SpritePatternAddress+06*64)/32,%0000100000000000
       01:CD42  00 08     
  676  01:CD44  0E 02         dw  (SpritePatternAddress+07*64)/32,%0000100000000000
       01:CD46  00 08     
  677  01:CD48  0C 02         dw  (SpritePatternAddress+06*64)/32,%0000100000000000
       01:CD4A  00 08     
  678  01:CD4C  0E 02         dw  (SpritePatternAddress+07*64)/32,%1000100000000000
       01:CD4E  00 88     
  679                     
  680                     
  681                     ;    dw  (SpritePatternAddress+04*64)/32,%0000000010000000
  682                     ;    dw  (SpritePatternAddress+05*64)/32,%0000000010000000
  683                     ;    dw  (SpritePatternAddress+04*64)/32,%0000000010000000
  684                     ;    dw  (SpritePatternAddress+05*64)/32,%0000100010000000
  685                     
  686                     ;    dw  (SpritePatternAddress+06*64)/32,%0000000010000000
  687                     ;    dw  (SpritePatternAddress+07*64)/32,%0000000010000000
  688                     ;    dw  (SpritePatternAddress+06*64)/32,%0000000010000000
  689                     ;    dw  (SpritePatternAddress+07*64)/32,%1000000010000000
  690                     
  691                     ;    dw  (SpritePatternAddress+04*64)/32,%1000000010000000
  692                     ;    dw  (SpritePatternAddress+05*64)/32,%1000000010000000
  693                     ;    dw  (SpritePatternAddress+04*64)/32,%1000000010000000
  694                     ;    dw  (SpritePatternAddress+05*64)/32,%1000100010000000
  695                     
  696                     ;    dw  (SpritePatternAddress+06*64)/32,%0000100010000000
  697                     ;    dw  (SpritePatternAddress+07*64)/32,%0000100010000000
  698                     ;    dw  (SpritePatternAddress+06*64)/32,%0000100010000000
  699                     ;    dw  (SpritePatternAddress+07*64)/32,%1000100010000000
  700                     
  701                     
  702                     ;       移動
  703                     ;       @args           x = キャラクタインデックス
  704                     ;       @saveregs       x,y
  705                     ;       @return         なし
  706  01:CD50            plMove:
  707           2003      .tmp_x  equ ztmp0
  708           2004      .tmp_y  equ ztmp1
  709                     
  710  01:CD50  B5 39         lda <zplx,x
  711  01:CD52  85 03         sta <.tmp_x
  712  01:CD54  B5 3B         lda <zply,x
  713  01:CD56  85 04         sta <.tmp_y
  714                     
  715  01:CD58  B5 55         lda <zplcount,x
  716  01:CD5A  18            clc
  717  01:CD5B  65 41         adc <zplspeed
  718  01:CD5D  C9 08         cmp #8
  719  01:CD5F  90 02         bcc .under8
  720  01:CD61  A9 08         lda #8
  721  01:CD63            .under8:
  722  01:CD63  95 55         sta <zplcount,x
  723                     
  724  01:CD65  B5 3D         lda     <zpldir,x         ;bits of zpldir = LDRU----
  725  01:CD67  0A            asl     a
  726  01:CD68  B0 11         bcs     .moveleft
  727  01:CD6A  0A            asl     a
  728  01:CD6B  B0 17         bcs     .movedown
  729  01:CD6D  0A            asl     a
  730  01:CD6E  B0 1D         bcs     .moveright
  731  01:CD70  10 22         bpl     .notmove
  732  01:CD72            .moveup:
  733  01:CD72  A5 04         lda <.tmp_y
  734  01:CD74  38            sec
  735  01:CD75  F5 55         sbc <zplcount,x
  736  01:CD77  85 04         sta <.tmp_y
  737                     ;    lda     <zply,x
  738                     ;    sec
  739                     ;    sbc     <zplspeed,x
  740                     ;    sta     <zply,x
  741  01:CD79  80 19         bra     .moved
  742  01:CD7B            .moveleft:
  743  01:CD7B  A5 03         lda <.tmp_x
  744  01:CD7D  38            sec
  745  01:CD7E  F5 55         sbc <zplcount,x
  746  01:CD80  85 03         sta <.tmp_x
  747                     ;    lda     <zplx,x
  748                     ;    sec
  749                     ;    sbc     <zplspeed,x
  750                     ;    sta     <zplx,x
  751  01:CD82  80 10         bra     .moved
  752  01:CD84            .movedown:
  753  01:CD84  A5 04         lda <.tmp_y
  754  01:CD86  18            clc
  755  01:CD87  75 55         adc <zplcount,x
  756  01:CD89  85 04         sta <.tmp_y
  757                     ;    lda     <zply,x
  758                     ;    clc
  759                     ;    adc     <zplspeed,x
  760                     ;    sta     <zply,x
  761  01:CD8B  80 07         bra     .moved
  762  01:CD8D            .moveright:
  763  01:CD8D  A5 03         lda <.tmp_x
  764  01:CD8F  18            clc
  765  01:CD90  75 55         adc <zplcount,x
  766  01:CD92  85 03         sta <.tmp_x
  767                     ;    lda     <zplx,x
  768                     ;    clc
  769                     ;    adc     <zplspeed,x
  770                     ;    sta     <zplx,x
  771  01:CD94            .notmove:
  772  01:CD94            .moved:
  773                                             ;スプライト座標設定
  774  01:CD94  8A            txa
  775  01:CD95  0A            asl a
  776  01:CD96  0A            asl a
  777  01:CD97  0A            asl a
  778  01:CD98  A8            tay
  779                     
  780                     ;    lda     <zplx,x
  781  01:CD99  A5 03         lda <.tmp_x
  782  01:CD9B  18            clc
  783  01:CD9C  69 1C         adc     #$20-4
  784  01:CD9E  99 42 22      sta     satb+2,y
  785  01:CDA1  62            cla
  786  01:CDA2  99 43 22      sta     satb+3,y
  787                     
  788                     ;    lda     <zply,x
  789  01:CDA5  A5 04         lda <.tmp_y
  790  01:CDA7  18            clc
  791  01:CDA8  69 4D         adc     #$40-4+16+1   ;+16 はスクロールカウンタの差分
  792  01:CDAA  99 40 22      sta     satb+0,y
  793  01:CDAD  A9 00         lda     #0
  794  01:CDAF  69 00         adc     #0
  795  01:CDB1  99 41 22      sta     satb+1,y
  796                     
  797                     
  798  01:CDB4  B5 55         lda <zplcount,x
  799  01:CDB6  C9 08         cmp #8
  800  01:CDB8  F0 01         beq .movetonextgrid
  801  01:CDBA  60            rts
  802                     
  803  01:CDBB            .movetonextgrid:
  804  01:CDBB  A5 03         lda <.tmp_x
  805  01:CDBD  95 39         sta <zplx,x
  806  01:CDBF  A5 04         lda <.tmp_y
  807  01:CDC1  95 3B         sta <zply,x
  808  01:CDC3  74 55         stz <zplcount,x
  809  01:CDC5  60            rts
  810                     
  811                     
  812                     ;
  813                     ;
  814                     ;
  815                     ;       胴体のパターン書き換え
  816                     ;       @args           なし
  817                     ;       @saveregs       なし
  818                     ;       @return         なし
  819  01:CDC6            plWriteBodyPattern:
  820                                                 ;パターンデータの書き換えサイズ（ワード）
  821                                                 ;書き換えるのは２プレーン分のみなので8ワード
  822  01:CDC6  A9 08         lda #8
  823  01:CDC8  85 0E         sta <zarg4
  824                                                 ;パターンデータ（４種類）の選択
  825                                                 ;パターンデータは1セット16バイトで、上下左右各方向4セット
  826                                                 ;並び順は LLLLDDDDRRRRUUUU 
  827  01:CDCA  A5 55         lda <zplcount
  828  01:CDCC  29 06         and #%0110
  829  01:CDCE  0A            asl a
  830  01:CDCF  0A            asl a
  831  01:CDD0  0A            asl a
  832                                                 ;Lのパターンアドレス
  833  01:CDD1  69 40         adc #LOW(BodyPatterns)
  834  01:CDD3  85 0C         sta <zarg2
  835  01:CDD5  A9 49         lda #HIGH(BodyPatterns)
  836  01:CDD7  69 00         adc #0
  837  01:CDD9  85 0D         sta <zarg3
  838                                                 ;LのVRAMアドレス
  839  01:CDDB  A9 20         lda #LOW(PatternAddress+66*16)
  840  01:CDDD  85 0A         sta <zarg0
  841  01:CDDF  A9 14         lda #HIGH(PatternAddress+66*16)
  842  01:CDE1  85 0B         sta <zarg1
  843  01:CDE3  20 C2 C9      jsr vqPush
  844                                                 ;Dのパターンアドレス
  845  01:CDE6  A5 0C         lda <zarg2
  846  01:CDE8  18            clc
  847  01:CDE9  69 40         adc #64
  848  01:CDEB  85 0C         sta <zarg2
  849  01:CDED  A5 0D         lda <zarg3
  850  01:CDEF  69 00         adc #0
  851  01:CDF1  85 0D         sta <zarg3
  852                                                 ;DのVRAMアドレス
  853  01:CDF3  A9 30         lda #LOW(PatternAddress+67*16)
  854  01:CDF5  85 0A         sta <zarg0
  855  01:CDF7  A9 14         lda #HIGH(PatternAddress+67*16)
  856  01:CDF9  85 0B         sta <zarg1
  857  01:CDFB  20 C2 C9      jsr vqPush
  858                                                 ;Rのパターンアドレス
  859  01:CDFE  A5 0C         lda <zarg2
  860  01:CE00  18            clc
  861  01:CE01  69 40         adc #64
  862  01:CE03  85 0C         sta <zarg2
  863  01:CE05  A5 0D         lda <zarg3
  864  01:CE07  69 00         adc #0
  865  01:CE09  85 0D         sta <zarg3
  866                                                 ;RのVRAMアドレス
  867  01:CE0B  A9 40         lda #LOW(PatternAddress+68*16)
  868  01:CE0D  85 0A         sta <zarg0
  869  01:CE0F  A9 14         lda #HIGH(PatternAddress+68*16)
  870  01:CE11  85 0B         sta <zarg1
  871  01:CE13  20 C2 C9      jsr vqPush
  872                                                 ;Uのパターンアドレス
  873  01:CE16  A5 0C         lda <zarg2
  874  01:CE18  18            clc
  875  01:CE19  69 40         adc #64
  876  01:CE1B  85 0C         sta <zarg2
  877  01:CE1D  A5 0D         lda <zarg3
  878  01:CE1F  69 00         adc #0
  879  01:CE21  85 0D         sta <zarg3
  880                                                 ;UのVRAMアドレス
  881  01:CE23  A9 50         lda #LOW(PatternAddress+69*16)
  882  01:CE25  85 0A         sta <zarg0
  883  01:CE27  A9 14         lda #HIGH(PatternAddress+69*16)
  884  01:CE29  85 0B         sta <zarg1
  885  01:CE2B  20 C2 C9      jsr vqPush
  886                     
  887  01:CE2E  60            rts
  888                     
  889                     
  890                     
  891                     ;
  892                     ;   task test
  893                     ;
  894  01:CE2F            plTask:
  895           2003      .tmp_dead_flg   equ ztmp0
  896                     
  897                                         ;頭
  898  01:CE2F  82                clx
  899  01:CE30  20 87 CB          jsr     plHeadAction
  900  01:CE33  B0 0A             bcs     .skipmove
  901                     ;       jsr     plMove
  902                     
  903                                         ;胴体のパターン書き換え
  904                     ;    lda <zplcount
  905                     ;    clc
  906                     ;    adc <zplspeed
  907                     ;    sta <zplcount
  908  01:CE35  20 C6 CD      jsr plWriteBodyPattern
  909                     
  910                                         ;尻尾
  911  01:CE38  A2 01         ldx #1
  912  01:CE3A  20 69 CC      jsr plTailAction
  913                     ;    bcs .yield
  914                     ;    jsr plMove
  915  01:CE3D  80 05         bra .yield
  916                     
  917  01:CE3F            .skipmove:
  918  01:CE3F  83 FF 03      tst #$ff,<.tmp_dead_flg
  919  01:CE42  D0 09         bne .dead
  920                     
  921  01:CE44            .yield:
  922  01:CE44  A5 18         lda <zdotnum
  923  01:CE46  F0 12         beq .clear
  924                     
  925  01:CE48  20 28 C6      jsr tkYield
  926  01:CE4B  80 E2         bra plTask
  927                     
  928  01:CE4D            .dead:
  929  01:CE4D  64 53         stz <zplTailStop
  930                     
  931  01:8E4F                    tkChangeTask_   tklDead
  932  01:8E57                tkYield_
  933                     
  934  01:CE5A            .clear:
  935  01:8E5A                    tkChangeTask_   tklClearWave
  936  01:8E62                tkYield_
  937                     
  938                     
  939                     ;
  940                     ;   自分の胴体を噛んだ時の処理
  941                     ;
  942  01:CE65            plDeadTask:
  943  01:CE65  A2 01         ldx #1
  944  01:CE67  20 69 CC      jsr plTailAction
  945  01:CE6A  B5 3D         lda <zpldir,x
  946  01:CE6C  F0 05         beq .over
  947  01:8E6E                tkYield_
  948  01:CE71  80 F2         bra plDeadTask
  949                     
  950  01:CE73            .over:
  951                     ;       tkChangeTask_   tklInitWave
  952  01:8E73                    tkChangeTask_   tklAppear
  953  01:8E7B                tkYield_
#[1]   nibbler.asm
   36                             
   37                             
   38                             
   39                             
